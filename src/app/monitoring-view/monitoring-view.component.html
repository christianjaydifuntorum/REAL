<div class="container mt-4">
	<!-- Title Header -->
	<div class="row mb-4">
		<div class="col-12">
			<h3 class="text-center">REMOTE ELECTRICAL ANALYZER AND LOGGER</h3>
		</div>
	</div>

	<div class="row">
		<!-- First Table -->
		<div class="col-12 col-md-6">
			<table class="table table-bordered">
				<thead>
					<tr>
						<th colspan="2" class="text-center">Electrical Measurements</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Date</td>
						<td>{{ monitoringView.current_date }}</td>
					</tr>
					<tr>
						<td>Time</td>
						<td>{{ monitoringView.current_time }}</td>
					</tr>
					<tr>
						<td>Voltage</td>
						<td [ngClass]="getVoltageClass(monitoringView.voltage_V)">{{ monitoringView.voltage_V | number:'1.2-2' }} V</td>
					</tr>
					<tr>
						<td>Current</td>
						<td>{{ monitoringView.current_A }} A</td>
					</tr>
					<tr>
						<td>Frequency</td>
						<td>{{ monitoringView.frequency_Hz }} Hz</td>
					</tr>
					<tr>
						<td>Active Power</td>
						<td>{{ monitoringView.active_power_W }} kW</td>
					</tr>
					<tr>
						<td>Power Factor</td>
						<td [ngClass]="getPowerFactorClass(monitoringView.power_factor)">{{ monitoringView.power_factor
							}}</td>
					</tr>
					<tr>
						<td>Phase Angle</td>
						<td>{{ monitoringView.phase_angle_deg | number:'1.2-2' }} °</td>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- Second Table -->
		<div class="col-12 col-md-6">
			<table class="table table-bordered">
				<thead>
					<tr>
						<th colspan="2" class="text-center">Cost Calculation</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Energy Used</td>
						<td>
							<select class="wider-dropdown" [(ngModel)]="selectedEnergy" (change)="updateEnergy()">
								<option *ngFor="let energy_kWh of uniqueEnergyList" [value]="energy_kWh">
									{{ energy_kWh }} kWh
								</option>
							</select>
						</td>
					</tr>
					<tr>
						<td>Input Cost Per kWh</td>
						<td>
							<div class="input-group">
								<input min="0" type="number" class="form-control" placeholder="Unit Value kWh"
									[(ngModel)]="inputCost" name="inputCost" (keydown)="preventInvalidInput($event)">
								<button class="btn btn-sm btn-primary" (click)="calculate()">Send</button>
							</div>
						</td>
					</tr>
					<tr>
						<td>Cost Per kWh</td>
						<td>
							<input type="text" class="form-control" value="1 kWh = ₱{{ inputCost }}" readonly disabled>
						</td>
					</tr>
					<tr>
						<td>Consumption in PHP</td>
						<td>
							<div class="d-flex justify-content-between align-items-center">
								<span>{{ consumptionKwh | number:'1.2-2' }}</span>
								<button class="btn btn-sm btn-secondary" (click)="resetConsumption()">Reset</button>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
			<table class="table table-bordered legend-table mt-3">
				<thead>
					<tr>
						<th colspan="2" class="text-center">Legend</th>
					</tr>
					<tr>
						<th>Status</th>
						<th>Color</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Ideal</td>
						<td class="green">Green</td>
					</tr>
					<tr>
						<td>Fair</td>
						<td class="yellow">Yellow</td>
					</tr>
					<tr>
						<td>Poor</td>
						<td class="red">Red</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<!-- Filters Section -->
	<div class="filters mt-4">
		<!-- Date Filter -->
		<div class="filter-row">
			<div class="filter-item">
				<label for="filterDate">Select Date:</label>
				<input type="date" id="filterDate" [(ngModel)]="filterDate" />
			</div>
		</div>

		<!-- Time Filters -->
		<div class="filter-row">
			<div class="filter-item">
				<label for="startTime">Start Time:</label>
				<input type="time" id="startTime" [(ngModel)]="startTime" />
			</div>
			<div class="filter-item">
				<label for="endTime">End Time:</label>
				<input type="time" id="endTime" [(ngModel)]="endTime" />
			</div>
		</div>

		<!-- Filter Button -->
		<button class="button btn btn-primary mt-3" [disabled]="!filterDate || !startTime || !endTime"
			(click)="onFilter()">
			Apply Filter
		</button>
		<button class="button btn btn-warning mt" (click)="downloadPDF()"
			[disabled]="filteredMonitoringViewList.length === 0 || pdfLoading">
			<span *ngIf="pdfLoading">
				<div class="spinner-border spinner-border-sm text-light" role="status">
					<span class="visually-hidden">Generating...</span>
				</div> Generating...
			</span>
			<span *ngIf="!pdfLoading">Download PDF</span>
		</button>

	</div>


	<!-- Second Table -->
	<div class="table-container mt-3">
		<table class="table table-striped table-bordered">
			<thead>
				<tr>
					<th>Date & Time</th>
					<th>Voltage (V)</th>
					<th>Current (A)</th>
					<th>Power Factor</th>
					<th>Frequency (Hz)</th>
					<th>Phase Angle (°)</th>
					<th>Active Power (W)</th>
					<th>Energy (kWh)</th>
				</tr>
			</thead>
			<!-- Show loading message -->
			<tbody *ngIf="loading">
				<tr>
					<td colspan="8" class="text-center">
						Loading data, please wait...
						<div class="spinner-border text-primary" role="status">
							<span class="visually-hidden">Loading...</span>
						</div>
					</td>
				</tr>
			</tbody>
			<!-- Show data when loaded -->
			<tbody *ngIf="!loading">
				<tr *ngFor="let data of filteredMonitoringViewList">
					<td>{{ data.current_date + ' ' + data.current_time }}</td>
					<td [ngClass]="getVoltageClass(data.voltage_V)">{{ data.voltage_V | number:'1.2-2' }} V</td>
					<td>{{ data.current_A }} A</td>
					<td [ngClass]="getPowerFactorClass(data.power_factor)">{{ data.power_factor }}</td>
					<td>{{ data.frequency_Hz }} Hz</td>
					<td>{{ data.phase_angle_deg | number:'1.2-2' }}°</td>
					<td>{{ data.active_power_W }} W</td>
					<td>{{ data.energy_kWh | number:'1.2-2' }} kWh</td>
				</tr>
			</tbody>
		</table>
	</div>

</div>