import{A as t0,B as Cn,C as di,D as nh,E as Jl,F as ly,G as n0,H as r0,I as re,J as en,K as pt,L as uy,M as i0,N as Xl,O as we,P as ln,Q as rh,R as cy,S as Dn,T as hi,U as fo,V as ih,W as o0,X as Un,Y as Dt,a as $,b as pe,c as oy,d as x,e as zb,f as Zd,g as Wb,h as Kb,i as L,j as Ss,k as Jd,l as Qb,m as Yb,n as wt,o as Xd,p as Zl,q as sy,r as Zb,s as ir,t as ay,u as eh,v as Jb,w as Xb,x as th,y as ut,z as e0}from"./chunk-TFNTWWHP.js";function py(n,e){return Object.is(n,e)}var gt=null,oh=!1,gy=1,un=Symbol("SIGNAL");function Ce(n){let e=gt;return gt=n,e}function s0(){return gt}var tu={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function ah(n){if(oh)throw new Error("");if(gt===null)return;gt.consumerOnSignalRead(n);let e=gt.nextProducerIndex++;if(ch(gt),e<gt.producerNode.length&&gt.producerNode[e]!==n&&eu(gt)){let t=gt.producerNode[e];uh(t,gt.producerIndexOfThis[e])}gt.producerNode[e]!==n&&(gt.producerNode[e]=n,gt.producerIndexOfThis[e]=eu(gt)?u0(n,gt,e):0),gt.producerLastReadVersion[e]=n.version}function wV(){gy++}function my(n){if(!(eu(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===gy)){if(!n.producerMustRecompute(n)&&!_y(n)){fy(n);return}n.producerRecomputeValue(n),fy(n)}}function a0(n){if(n.liveConsumerNode===void 0)return;let e=oh;oh=!0;try{for(let t of n.liveConsumerNode)t.dirty||EV(t)}finally{oh=e}}function l0(){return gt?.consumerAllowSignalWrites!==!1}function EV(n){n.dirty=!0,a0(n),n.consumerMarkedDirty?.(n)}function fy(n){n.dirty=!1,n.lastCleanEpoch=gy}function lh(n){return n&&(n.nextProducerIndex=0),Ce(n)}function yy(n,e){if(Ce(e),!(!n||n.producerNode===void 0||n.producerIndexOfThis===void 0||n.producerLastReadVersion===void 0)){if(eu(n))for(let t=n.nextProducerIndex;t<n.producerNode.length;t++)uh(n.producerNode[t],n.producerIndexOfThis[t]);for(;n.producerNode.length>n.nextProducerIndex;)n.producerNode.pop(),n.producerLastReadVersion.pop(),n.producerIndexOfThis.pop()}}function _y(n){ch(n);for(let e=0;e<n.producerNode.length;e++){let t=n.producerNode[e],r=n.producerLastReadVersion[e];if(r!==t.version||(my(t),r!==t.version))return!0}return!1}function vy(n){if(ch(n),eu(n))for(let e=0;e<n.producerNode.length;e++)uh(n.producerNode[e],n.producerIndexOfThis[e]);n.producerNode.length=n.producerLastReadVersion.length=n.producerIndexOfThis.length=0,n.liveConsumerNode&&(n.liveConsumerNode.length=n.liveConsumerIndexOfThis.length=0)}function u0(n,e,t){if(c0(n),n.liveConsumerNode.length===0&&d0(n))for(let r=0;r<n.producerNode.length;r++)n.producerIndexOfThis[r]=u0(n.producerNode[r],n,r);return n.liveConsumerIndexOfThis.push(t),n.liveConsumerNode.push(e)-1}function uh(n,e){if(c0(n),n.liveConsumerNode.length===1&&d0(n))for(let r=0;r<n.producerNode.length;r++)uh(n.producerNode[r],n.producerIndexOfThis[r]);let t=n.liveConsumerNode.length-1;if(n.liveConsumerNode[e]=n.liveConsumerNode[t],n.liveConsumerIndexOfThis[e]=n.liveConsumerIndexOfThis[t],n.liveConsumerNode.length--,n.liveConsumerIndexOfThis.length--,e<n.liveConsumerNode.length){let r=n.liveConsumerIndexOfThis[e],i=n.liveConsumerNode[e];ch(i),i.producerIndexOfThis[r]=e}}function eu(n){return n.consumerIsAlwaysLive||(n?.liveConsumerNode?.length??0)>0}function ch(n){n.producerNode??=[],n.producerIndexOfThis??=[],n.producerLastReadVersion??=[]}function c0(n){n.liveConsumerNode??=[],n.liveConsumerIndexOfThis??=[]}function d0(n){return n.producerNode!==void 0}function h0(n){let e=Object.create(IV);e.computation=n;let t=()=>{if(my(e),ah(e),e.value===sh)throw e.error;return e.value};return t[un]=e,t}var dy=Symbol("UNSET"),hy=Symbol("COMPUTING"),sh=Symbol("ERRORED"),IV=pe($({},tu),{value:dy,dirty:!0,error:null,equal:py,kind:"computed",producerMustRecompute(n){return n.value===dy||n.value===hy},producerRecomputeValue(n){if(n.value===hy)throw new Error("Detected cycle in computations.");let e=n.value;n.value=hy;let t=lh(n),r,i=!1;try{r=n.computation(),Ce(null),i=e!==dy&&e!==sh&&r!==sh&&n.equal(e,r)}catch(o){r=sh,n.error=o}finally{yy(n,t)}if(i){n.value=e;return}n.value=r,n.version++}});function CV(){throw new Error}var f0=CV;function p0(){f0()}function g0(n){f0=n}var DV=null;function m0(n){let e=Object.create(wy);e.value=n;let t=()=>(ah(e),e.value);return t[un]=e,t}function dh(n,e){l0()||p0(),n.equal(n.value,e)||(n.value=e,TV(n))}function y0(n,e){l0()||p0(),dh(n,e(n.value))}var wy=pe($({},tu),{equal:py,value:void 0,kind:"signal"});function TV(n){n.version++,wV(),a0(n),DV?.()}function se(n){return typeof n=="function"}function As(n){let t=n(r=>{Error.call(r),r.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var hh=As(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((r,i)=>`${i+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function po(n,e){if(n){let t=n.indexOf(e);0<=t&&n.splice(t,1)}}var tt=class n{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let o of t)o.remove(this);else t.remove(this);let{initialTeardown:r}=this;if(se(r))try{r()}catch(o){e=o instanceof hh?o.errors:[o]}let{_finalizers:i}=this;if(i){this._finalizers=null;for(let o of i)try{_0(o)}catch(s){e=e??[],s instanceof hh?e=[...e,...s.errors]:e.push(s)}}if(e)throw new hh(e)}}add(e){var t;if(e&&e!==this)if(this.closed)_0(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}}_hasParent(e){let{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){let{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&po(t,e)}remove(e){let{_finalizers:t}=this;t&&po(t,e),e instanceof n&&e._removeParent(this)}};tt.EMPTY=(()=>{let n=new tt;return n.closed=!0,n})();var Ey=tt.EMPTY;function fh(n){return n instanceof tt||n&&"closed"in n&&se(n.remove)&&se(n.add)&&se(n.unsubscribe)}function _0(n){se(n)?n():n.unsubscribe()}var $n={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Ms={setTimeout(n,e,...t){let{delegate:r}=Ms;return r?.setTimeout?r.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){let{delegate:e}=Ms;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function ph(n){Ms.setTimeout(()=>{let{onUnhandledError:e}=$n;if(e)e(n);else throw n})}function go(){}var v0=Iy("C",void 0,void 0);function w0(n){return Iy("E",void 0,n)}function E0(n){return Iy("N",n,void 0)}function Iy(n,e,t){return{kind:n,value:e,error:t}}var mo=null;function Rs(n){if($n.useDeprecatedSynchronousErrorHandling){let e=!mo;if(e&&(mo={errorThrown:!1,error:null}),n(),e){let{errorThrown:t,error:r}=mo;if(mo=null,t)throw r}}else n()}function I0(n){$n.useDeprecatedSynchronousErrorHandling&&mo&&(mo.errorThrown=!0,mo.error=n)}var yo=class extends tt{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,fh(e)&&e.add(this)):this.destination=AV}static create(e,t,r){return new Nr(e,t,r)}next(e){this.isStopped?Dy(E0(e),this):this._next(e)}error(e){this.isStopped?Dy(w0(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Dy(v0,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},bV=Function.prototype.bind;function Cy(n,e){return bV.call(n,e)}var Ty=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(r){gh(r)}}error(e){let{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(r){gh(r)}else gh(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){gh(t)}}},Nr=class extends yo{constructor(e,t,r){super();let i;if(se(e)||!e)i={next:e??void 0,error:t??void 0,complete:r??void 0};else{let o;this&&$n.useDeprecatedNextContext?(o=Object.create(e),o.unsubscribe=()=>this.unsubscribe(),i={next:e.next&&Cy(e.next,o),error:e.error&&Cy(e.error,o),complete:e.complete&&Cy(e.complete,o)}):i=e}this.destination=new Ty(i)}};function gh(n){$n.useDeprecatedSynchronousErrorHandling?I0(n):ph(n)}function SV(n){throw n}function Dy(n,e){let{onStoppedNotification:t}=$n;t&&Ms.setTimeout(()=>t(n,e))}var AV={closed:!0,next:go,error:SV,complete:go};var xs=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Tt(n){return n}function by(...n){return Sy(n)}function Sy(n){return n.length===0?Tt:n.length===1?n[0]:function(t){return n.reduce((r,i)=>i(r),t)}}var de=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){let r=new n;return r.source=this,r.operator=t,r}subscribe(t,r,i){let o=RV(t)?t:new Nr(t,r,i);return Rs(()=>{let{operator:s,source:a}=this;o.add(s?s.call(o,a):a?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return r=C0(r),new r((i,o)=>{let s=new Nr({next:a=>{try{t(a)}catch(l){o(l),s.unsubscribe()}},error:o,complete:i});this.subscribe(s)})}_subscribe(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)}[xs](){return this}pipe(...t){return Sy(t)(this)}toPromise(t){return t=C0(t),new t((r,i)=>{let o;this.subscribe(s=>o=s,s=>i(s),()=>r(o))})}}return n.create=e=>new n(e),n})();function C0(n){var e;return(e=n??$n.Promise)!==null&&e!==void 0?e:Promise}function MV(n){return n&&se(n.next)&&se(n.error)&&se(n.complete)}function RV(n){return n&&n instanceof yo||MV(n)&&fh(n)}function Ay(n){return se(n?.lift)}function ue(n){return e=>{if(Ay(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ae(n,e,t,r,i){return new My(n,e,t,r,i)}var My=class extends yo{constructor(e,t,r,i,o,s){super(e),this.onFinalize=o,this.shouldUnsubscribe=s,this._next=t?function(a){try{t(a)}catch(l){e.error(l)}}:super._next,this._error=i?function(a){try{i(a)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function Ns(){return ue((n,e)=>{let t=null;n._refCount++;let r=ae(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount){t=null;return}let i=n._connection,o=t;t=null,i&&(!o||i===o)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}var Ps=class extends de{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,Ay(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new tt;let t=this.getSubject();e.add(this.source.subscribe(ae(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),e.closed&&(this._connection=null,e=tt.EMPTY)}return e}refCount(){return Ns()(this)}};var D0=As(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Ge=(()=>{class n extends de{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let r=new mh(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new D0}next(t){Rs(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(t)}})}error(t){Rs(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){Rs(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:r,isStopped:i,observers:o}=this;return r||i?Ey:(this.currentObservers=null,o.push(t),new tt(()=>{this.currentObservers=null,po(o,t)}))}_checkFinalizedStatuses(t){let{hasError:r,thrownError:i,isStopped:o}=this;r?t.error(i):o&&t.complete()}asObservable(){let t=new de;return t.source=this,t}}return n.create=(e,t)=>new mh(e,t),n})(),mh=class extends Ge{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.next)===null||r===void 0||r.call(t,e)}error(e){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.error)===null||r===void 0||r.call(t,e)}complete(){var e,t;(t=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||t===void 0||t.call(e)}_subscribe(e){var t,r;return(r=(t=this.source)===null||t===void 0?void 0:t.subscribe(e))!==null&&r!==void 0?r:Ey}};var bt=class extends Ge{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){let{hasError:e,thrownError:t,_value:r}=this;if(e)throw t;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}};var nu={now(){return(nu.delegate||Date).now()},delegate:void 0};var ru=class extends Ge{constructor(e=1/0,t=1/0,r=nu){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){let{isStopped:t,_buffer:r,_infiniteTimeWindow:i,_timestampProvider:o,_windowTime:s}=this;t||(r.push(e),!i&&r.push(o.now()+s)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();let t=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:i}=this,o=i.slice();for(let s=0;s<o.length&&!e.closed;s+=r?1:2)e.next(o[s]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){let{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:i}=this,o=(i?1:2)*e;if(e<1/0&&o<r.length&&r.splice(0,r.length-o),!i){let s=t.now(),a=0;for(let l=1;l<r.length&&r[l]<=s;l+=2)a=l;a&&r.splice(0,a+1)}}};var yh=class extends tt{constructor(e,t){super()}schedule(e,t=0){return this}};var iu={setInterval(n,e,...t){let{delegate:r}=iu;return r?.setInterval?r.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){let{delegate:e}=iu;return(e?.clearInterval||clearInterval)(n)},delegate:void 0};var ks=class extends yh{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var r;if(this.closed)return this;this.state=e;let i=this.id,o=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(o,i,t)),this.pending=!0,this.delay=t,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(o,this.id,t),this}requestAsyncId(e,t,r=0){return iu.setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,t,r=0){if(r!=null&&this.delay===r&&this.pending===!1)return t;t!=null&&iu.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let r=this._execute(e,t);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let r=!1,i;try{this.work(e)}catch(o){r=!0,i=o||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){let{id:e,scheduler:t}=this,{actions:r}=t;this.work=this.state=this.scheduler=null,this.pending=!1,po(r,this),e!=null&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}};var Os=class n{constructor(e,t=n.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,r){return new this.schedulerActionCtor(this,e).schedule(r,t)}};Os.now=nu.now;var Fs=class extends Os{constructor(e,t=Os.now){super(e,t),this.actions=[],this._active=!1}flush(e){let{actions:t}=this;if(this._active){t.push(e);return}let r;this._active=!0;do if(r=e.execute(e.state,e.delay))break;while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}};var _o=new Fs(ks);var _h=class extends ks{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,r=0){return r!=null&&r>0||r==null&&this.delay>0?super.requestAsyncId(e,t,r):(e.flush(this),0)}};var vh=class extends Fs{};var Ry=new vh(_h);var qt=new de(n=>n.complete());function T0(n){return n&&se(n.schedule)}function xy(n){return n[n.length-1]}function Vs(n){return se(xy(n))?n.pop():void 0}function or(n){return T0(xy(n))?n.pop():void 0}function b0(n,e){return typeof xy(n)=="number"?n.pop():e}var wh=n=>n&&typeof n.length=="number"&&typeof n!="function";function Eh(n){return se(n?.then)}function Ih(n){return se(n[xs])}function Ch(n){return Symbol.asyncIterator&&se(n?.[Symbol.asyncIterator])}function Dh(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function xV(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Th=xV();function bh(n){return se(n?.[Th])}function Sh(n){return Wb(this,arguments,function*(){let t=n.getReader();try{for(;;){let{value:r,done:i}=yield Zd(t.read());if(i)return yield Zd(void 0);yield yield Zd(r)}}finally{t.releaseLock()}})}function Ah(n){return se(n?.getReader)}function je(n){if(n instanceof de)return n;if(n!=null){if(Ih(n))return NV(n);if(wh(n))return PV(n);if(Eh(n))return kV(n);if(Ch(n))return S0(n);if(bh(n))return OV(n);if(Ah(n))return FV(n)}throw Dh(n)}function NV(n){return new de(e=>{let t=n[xs]();if(se(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function PV(n){return new de(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function kV(n){return new de(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,ph)})}function OV(n){return new de(e=>{for(let t of n)if(e.next(t),e.closed)return;e.complete()})}function S0(n){return new de(e=>{VV(n,e).catch(t=>e.error(t))})}function FV(n){return S0(Sh(n))}function VV(n,e){var t,r,i,o;return zb(this,void 0,void 0,function*(){try{for(t=Kb(n);r=yield t.next(),!r.done;){let s=r.value;if(e.next(s),e.closed)return}}catch(s){i={error:s}}finally{try{r&&!r.done&&(o=t.return)&&(yield o.call(t))}finally{if(i)throw i.error}}e.complete()})}function tn(n,e,t,r=0,i=!1){let o=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(o),!i)return o}function sr(n,e=0){return ue((t,r)=>{t.subscribe(ae(r,i=>tn(r,n,()=>r.next(i),e),()=>tn(r,n,()=>r.complete(),e),i=>tn(r,n,()=>r.error(i),e)))})}function Pr(n,e=0){return ue((t,r)=>{r.add(n.schedule(()=>t.subscribe(r),e))})}function A0(n,e){return je(n).pipe(Pr(e),sr(e))}function M0(n,e){return je(n).pipe(Pr(e),sr(e))}function R0(n,e){return new de(t=>{let r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function x0(n,e){return new de(t=>{let r;return tn(t,e,()=>{r=n[Th](),tn(t,e,()=>{let i,o;try{({value:i,done:o}=r.next())}catch(s){t.error(s);return}o?t.complete():t.next(i)},0,!0)}),()=>se(r?.return)&&r.return()})}function Mh(n,e){if(!n)throw new Error("Iterable cannot be null");return new de(t=>{tn(t,e,()=>{let r=n[Symbol.asyncIterator]();tn(t,e,()=>{r.next().then(i=>{i.done?t.complete():t.next(i.value)})},0,!0)})})}function N0(n,e){return Mh(Sh(n),e)}function P0(n,e){if(n!=null){if(Ih(n))return A0(n,e);if(wh(n))return R0(n,e);if(Eh(n))return M0(n,e);if(Ch(n))return Mh(n,e);if(bh(n))return x0(n,e);if(Ah(n))return N0(n,e)}throw Dh(n)}function ke(n,e){return e?P0(n,e):je(n)}function ne(...n){let e=or(n);return ke(n,e)}function Ls(n,e){let t=se(n)?n:()=>n,r=i=>i.error(t());return new de(e?i=>e.schedule(r,0,i):r)}function Ny(n){return!!n&&(n instanceof de||se(n.lift)&&se(n.subscribe))}var kr=As(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function Q(n,e){return ue((t,r)=>{let i=0;t.subscribe(ae(r,o=>{r.next(n.call(e,o,i++))}))})}var{isArray:LV}=Array;function jV(n,e){return LV(e)?n(...e):n(e)}function Rh(n){return Q(e=>jV(n,e))}var{isArray:BV}=Array,{getPrototypeOf:UV,prototype:$V,keys:HV}=Object;function xh(n){if(n.length===1){let e=n[0];if(BV(e))return{args:e,keys:null};if(qV(e)){let t=HV(e);return{args:t.map(r=>e[r]),keys:t}}}return{args:n,keys:null}}function qV(n){return n&&typeof n=="object"&&UV(n)===$V}function Nh(n,e){return n.reduce((t,r,i)=>(t[r]=e[i],t),{})}function Ph(...n){let e=or(n),t=Vs(n),{args:r,keys:i}=xh(n);if(r.length===0)return ke([],e);let o=new de(GV(r,e,i?s=>Nh(i,s):Tt));return t?o.pipe(Rh(t)):o}function GV(n,e,t=Tt){return r=>{k0(e,()=>{let{length:i}=n,o=new Array(i),s=i,a=i;for(let l=0;l<i;l++)k0(e,()=>{let c=ke(n[l],e),d=!1;c.subscribe(ae(r,f=>{o[l]=f,d||(d=!0,a--),a||r.next(t(o.slice()))},()=>{--s||r.complete()}))},r)},r)}}function k0(n,e,t){n?tn(t,n,e):e()}function O0(n,e,t,r,i,o,s,a){let l=[],c=0,d=0,f=!1,g=()=>{f&&!l.length&&!c&&e.complete()},m=T=>c<r?v(T):l.push(T),v=T=>{o&&e.next(T),c++;let S=!1;je(t(T,d++)).subscribe(ae(e,O=>{i?.(O),o?m(O):e.next(O)},()=>{S=!0},void 0,()=>{if(S)try{for(c--;l.length&&c<r;){let O=l.shift();s?tn(e,s,()=>v(O)):v(O)}g()}catch(O){e.error(O)}}))};return n.subscribe(ae(e,m,()=>{f=!0,g()})),()=>{a?.()}}function mt(n,e,t=1/0){return se(e)?mt((r,i)=>Q((o,s)=>e(r,o,i,s))(je(n(r,i))),t):(typeof e=="number"&&(t=e),ue((r,i)=>O0(r,i,n,t)))}function ou(n=1/0){return mt(Tt,n)}function F0(){return ou(1)}function js(...n){return F0()(ke(n,or(n)))}function kh(n){return new de(e=>{je(n()).subscribe(e)})}function Py(...n){let e=Vs(n),{args:t,keys:r}=xh(n),i=new de(o=>{let{length:s}=t;if(!s){o.complete();return}let a=new Array(s),l=s,c=s;for(let d=0;d<s;d++){let f=!1;je(t[d]).subscribe(ae(o,g=>{f||(f=!0,c--),a[d]=g},()=>l--,void 0,()=>{(!l||!f)&&(c||o.next(r?Nh(r,a):a),o.complete())}))}});return e?i.pipe(Rh(e)):i}function Bs(...n){let e=or(n),t=b0(n,1/0),r=n;return r.length?r.length===1?je(r[0]):ou(t)(ke(r,e)):qt}function Vt(n,e){return ue((t,r)=>{let i=0;t.subscribe(ae(r,o=>n.call(e,o,i++)&&r.next(o)))})}function fi(n){return ue((e,t)=>{let r=null,i=!1,o;r=e.subscribe(ae(t,void 0,void 0,s=>{o=je(n(s,fi(n)(e))),r?(r.unsubscribe(),r=null,o.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,o.subscribe(t))})}function V0(n,e,t,r,i){return(o,s)=>{let a=t,l=e,c=0;o.subscribe(ae(s,d=>{let f=c++;l=a?n(l,d,f):(a=!0,d),r&&s.next(l)},i&&(()=>{a&&s.next(l),s.complete()})))}}function Us(n,e){return se(e)?mt(n,e,1):mt(n,1)}function pi(n){return ue((e,t)=>{let r=!1;e.subscribe(ae(t,i=>{r=!0,t.next(i)},()=>{r||t.next(n),t.complete()}))})}function Or(n){return n<=0?()=>qt:ue((e,t)=>{let r=0;e.subscribe(ae(t,i=>{++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function su(n,e=Tt){return n=n??zV,ue((t,r)=>{let i,o=!0;t.subscribe(ae(r,s=>{let a=e(s);(o||!n(i,a))&&(o=!1,i=a,r.next(s))}))})}function zV(n,e){return n===e}function Oh(n=WV){return ue((e,t)=>{let r=!1;e.subscribe(ae(t,i=>{r=!0,t.next(i)},()=>r?t.complete():t.error(n())))})}function WV(){return new kr}function au(n){return ue((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}function Hn(n,e){let t=arguments.length>=2;return r=>r.pipe(n?Vt((i,o)=>n(i,o,r)):Tt,Or(1),t?pi(e):Oh(()=>new kr))}function $s(n){return n<=0?()=>qt:ue((e,t)=>{let r=[];e.subscribe(ae(t,i=>{r.push(i),n<r.length&&r.shift()},()=>{for(let i of r)t.next(i);t.complete()},void 0,()=>{r=null}))})}function ky(n,e){let t=arguments.length>=2;return r=>r.pipe(n?Vt((i,o)=>n(i,o,r)):Tt,$s(1),t?pi(e):Oh(()=>new kr))}function lu(){return ue((n,e)=>{let t,r=!1;n.subscribe(ae(e,i=>{let o=t;t=i,r&&e.next([o,i]),r=!0}))})}function ar(n,e){return ue(V0(n,e,arguments.length>=2,!0))}function uu(n={}){let{connector:e=()=>new Ge,resetOnError:t=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=n;return o=>{let s,a,l,c=0,d=!1,f=!1,g=()=>{a?.unsubscribe(),a=void 0},m=()=>{g(),s=l=void 0,d=f=!1},v=()=>{let T=s;m(),T?.unsubscribe()};return ue((T,S)=>{c++,!f&&!d&&g();let O=l=l??e();S.add(()=>{c--,c===0&&!f&&!d&&(a=Oy(v,i))}),O.subscribe(S),!s&&c>0&&(s=new Nr({next:B=>O.next(B),error:B=>{f=!0,g(),a=Oy(m,t,B),O.error(B)},complete:()=>{d=!0,g(),a=Oy(m,r),O.complete()}}),je(T).subscribe(s))})(o)}}function Oy(n,e,...t){if(e===!0){n();return}if(e===!1)return;let r=new Nr({next:()=>{r.unsubscribe(),n()}});return je(e(...t)).subscribe(r)}function Fh(n,e,t){let r,i=!1;return n&&typeof n=="object"?{bufferSize:r=1/0,windowTime:e=1/0,refCount:i=!1,scheduler:t}=n:r=n??1/0,uu({connector:()=>new ru(r,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}function Fy(n){return ue((e,t)=>{let r=!1,i=0;e.subscribe(ae(t,o=>(r||(r=!n(o,i++)))&&t.next(o)))})}function vo(...n){let e=or(n);return ue((t,r)=>{(e?js(n,t,e):js(n,t)).subscribe(r)})}function Qe(n,e){return ue((t,r)=>{let i=null,o=0,s=!1,a=()=>s&&!i&&r.complete();t.subscribe(ae(r,l=>{i?.unsubscribe();let c=0,d=o++;je(n(l,d)).subscribe(i=ae(r,f=>r.next(e?e(l,f,d,c++):f),()=>{i=null,a()}))},()=>{s=!0,a()}))})}function Vh(n,e){return se(e)?Qe(()=>n,e):Qe(()=>n)}function Vy(n){return ue((e,t)=>{je(n).subscribe(ae(t,()=>t.complete(),go)),!t.closed&&e.subscribe(t)})}function St(n,e,t){let r=se(n)||e||t?{next:n,error:e,complete:t}:n;return r?ue((i,o)=>{var s;(s=r.subscribe)===null||s===void 0||s.call(r);let a=!0;i.subscribe(ae(o,l=>{var c;(c=r.next)===null||c===void 0||c.call(r,l),o.next(l)},()=>{var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),o.complete()},l=>{var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),o.error(l)},()=>{var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):Tt}function Ly(...n){let e=Vs(n);return ue((t,r)=>{let i=n.length,o=new Array(i),s=n.map(()=>!1),a=!1;for(let l=0;l<i;l++)je(n[l]).subscribe(ae(r,c=>{o[l]=c,!a&&!s[l]&&(s[l]=!0,(a=s.every(Tt))&&(s=null))},go));t.subscribe(ae(r,l=>{if(a){let c=[l,...o];r.next(e?e(...c):c)}}))})}var KV="https://g.co/ng/security#xss",te=class extends Error{code;constructor(e,t){super(U_(e,t)),this.code=e}};function U_(n,e){return`${`NG0${Math.abs(n)}`}${e?": "+e:""}`}var DS=Symbol("InputSignalNode#UNSET"),QV=pe($({},wy),{transformFn:void 0,applyValueToInputSignal(n,e){dh(n,e)}});function TS(n,e){let t=Object.create(QV);t.value=n,t.transformFn=e?.transform;function r(){if(ah(t),t.value===DS)throw new te(-950,!1);return t.value}return r[un]=t,r}function wu(n){return{toString:n}.toString()}var Lh="__parameters__";function YV(n){return function(...t){if(n){let r=n(...t);for(let i in r)this[i]=r[i]}}}function bS(n,e,t){return wu(()=>{let r=YV(e);function i(...o){if(this instanceof i)return r.apply(this,o),this;let s=new i(...o);return a.annotation=s,a;function a(l,c,d){let f=l.hasOwnProperty(Lh)?l[Lh]:Object.defineProperty(l,Lh,{value:[]})[Lh];for(;f.length<=d;)f.push(null);return(f[d]=f[d]||[]).push(s),l}}return t&&(i.prototype=Object.create(t.prototype)),i.prototype.ngMetadataName=n,i.annotationCls=i,i})}function Be(n){for(let e in n)if(n[e]===Be)return e;throw Error("Could not find renamed property on target object.")}function ZV(n,e){for(let t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function zt(n){if(typeof n=="string")return n;if(Array.isArray(n))return"["+n.map(zt).join(", ")+"]";if(n==null)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;let e=n.toString();if(e==null)return""+e;let t=e.indexOf(`
`);return t===-1?e:e.substring(0,t)}function L0(n,e){return n==null||n===""?e===null?"":e:e==null||e===""?n:n+" "+e}var JV=Be({__forward_ref__:Be});function Di(n){return n.__forward_ref__=Di,n.toString=function(){return zt(this())},n}function Gt(n){return SS(n)?n():n}function SS(n){return typeof n=="function"&&n.hasOwnProperty(JV)&&n.__forward_ref__===Di}function ee(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function hn(n){return{providers:n.providers||[],imports:n.imports||[]}}function mf(n){return j0(n,MS)||j0(n,RS)}function AS(n){return mf(n)!==null}function j0(n,e){return n.hasOwnProperty(e)?n[e]:null}function XV(n){let e=n&&(n[MS]||n[RS]);return e||null}function B0(n){return n&&(n.hasOwnProperty(U0)||n.hasOwnProperty(eL))?n[U0]:null}var MS=Be({\u0275prov:Be}),U0=Be({\u0275inj:Be}),RS=Be({ngInjectableDef:Be}),eL=Be({ngInjectorDef:Be}),z=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(e,t){this._desc=e,this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=ee({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function xS(n){return n&&!!n.\u0275providers}var tL=Be({\u0275cmp:Be}),nL=Be({\u0275dir:Be}),rL=Be({\u0275pipe:Be}),iL=Be({\u0275mod:Be}),zh=Be({\u0275fac:Be}),fu=Be({__NG_ELEMENT_ID__:Be}),$0=Be({__NG_ENV_ID__:Be});function NS(n){return typeof n=="string"?n:n==null?"":String(n)}function oL(n){return typeof n=="function"?n.name||n.toString():typeof n=="object"&&n!=null&&typeof n.type=="function"?n.type.name||n.type.toString():NS(n)}function sL(n,e){let t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new te(-200,n)}function $_(n,e){throw new te(-201,!1)}var me=function(n){return n[n.Default=0]="Default",n[n.Host=1]="Host",n[n.Self=2]="Self",n[n.SkipSelf=4]="SkipSelf",n[n.Optional=8]="Optional",n}(me||{}),Zy;function PS(){return Zy}function Tn(n){let e=Zy;return Zy=n,e}function kS(n,e,t){let r=mf(n);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(t&me.Optional)return null;if(e!==void 0)return e;$_(n,"Injector")}var aL={},pu=aL,Jy="__NG_DI_FLAG__",Wh="ngTempTokenPath",lL="ngTokenPath",uL=/\n/gm,cL="\u0275",H0="__source",zs;function dL(){return zs}function gi(n){let e=zs;return zs=n,e}function hL(n,e=me.Default){if(zs===void 0)throw new te(-203,!1);return zs===null?kS(n,void 0,e):zs.get(n,e&me.Optional?null:void 0,e)}function j(n,e=me.Default){return(PS()||hL)(Gt(n),e)}function V(n,e=me.Default){return j(n,yf(e))}function yf(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function Xy(n){let e=[];for(let t=0;t<n.length;t++){let r=Gt(n[t]);if(Array.isArray(r)){if(r.length===0)throw new te(900,!1);let i,o=me.Default;for(let s=0;s<r.length;s++){let a=r[s],l=fL(a);typeof l=="number"?l===-1?i=a.token:o|=l:i=a}e.push(j(i,o))}else e.push(j(r))}return e}function OS(n,e){return n[Jy]=e,n.prototype[Jy]=e,n}function fL(n){return n[Jy]}function pL(n,e,t,r){let i=n[Wh];throw e[H0]&&i.unshift(e[H0]),n.message=gL(`
`+n.message,i,t,r),n[lL]=i,n[Wh]=null,n}function gL(n,e,t,r=null){n=n&&n.charAt(0)===`
`&&n.charAt(1)==cL?n.slice(2):n;let i=zt(e);if(Array.isArray(e))i=e.map(zt).join(" -> ");else if(typeof e=="object"){let o=[];for(let s in e)if(e.hasOwnProperty(s)){let a=e[s];o.push(s+":"+(typeof a=="string"?JSON.stringify(a):zt(a)))}i=`{${o.join(", ")}}`}return`${t}${r?"("+r+")":""}[${i}]: ${n.replace(uL,`
  `)}`}var _f=OS(bS("Optional"),8);var mL=OS(bS("SkipSelf"),4);function Ks(n,e){let t=n.hasOwnProperty(zh);return t?n[zh]:null}function H_(n,e){n.forEach(t=>Array.isArray(t)?H_(t,e):e(t))}function FS(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Kh(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function yL(n,e,t,r){let i=n.length;if(i==e)n.push(t,r);else if(i===1)n.push(r,n[0]),n[0]=t;else{for(i--,n.push(n[i-1],n[i]);i>e;){let o=i-2;n[i]=n[o],i--}n[e]=t,n[e+1]=r}}function _L(n,e,t){let r=Eu(n,e);return r>=0?n[r|1]=t:(r=~r,yL(n,r,e,t)),r}function jy(n,e){let t=Eu(n,e);if(t>=0)return n[t|1]}function Eu(n,e){return vL(n,e,1)}function vL(n,e,t){let r=0,i=n.length>>t;for(;i!==r;){let o=r+(i-r>>1),s=n[o<<t];if(e===s)return o<<t;s>e?i=o:r=o+1}return~(i<<t)}var Qs={},bn=[],Ys=new z(""),VS=new z("",-1),LS=new z(""),Qh=class{get(e,t=pu){if(t===pu){let r=new Error(`NullInjectorError: No provider for ${zt(e)}!`);throw r.name="NullInjectorError",r}return t}};function jS(n,e){let t=n[iL]||null;if(!t&&e===!0)throw new Error(`Type ${zt(n)} does not have '\u0275mod' property.`);return t}function Eo(n){return n[tL]||null}function BS(n){return n[nL]||null}function US(n){return n[rL]||null}function $S(n){let e=Eo(n)||BS(n)||US(n);return e!==null&&e.standalone}function q_(n){return{\u0275providers:n}}function G_(...n){return{\u0275providers:HS(!0,n),\u0275fromNgModule:!0}}function HS(n,...e){let t=[],r=new Set,i,o=s=>{t.push(s)};return H_(e,s=>{let a=s;e_(a,o,[],r)&&(i||=[],i.push(a))}),i!==void 0&&qS(i,o),t}function qS(n,e){for(let t=0;t<n.length;t++){let{ngModule:r,providers:i}=n[t];z_(i,o=>{e(o,r)})}}function e_(n,e,t,r){if(n=Gt(n),!n)return!1;let i=null,o=B0(n),s=!o&&Eo(n);if(!o&&!s){let l=n.ngModule;if(o=B0(l),o)i=l;else return!1}else{if(s&&!s.standalone)return!1;i=n}let a=r.has(i);if(s){if(a)return!1;if(r.add(i),s.dependencies){let l=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let c of l)e_(c,e,t,r)}}else if(o){if(o.imports!=null&&!a){r.add(i);let c;try{H_(o.imports,d=>{e_(d,e,t,r)&&(c||=[],c.push(d))})}finally{}c!==void 0&&qS(c,e)}if(!a){let c=Ks(i)||(()=>new i);e({provide:i,useFactory:c,deps:bn},i),e({provide:LS,useValue:i,multi:!0},i),e({provide:Ys,useValue:()=>j(i),multi:!0},i)}let l=o.providers;if(l!=null&&!a){let c=n;z_(l,d=>{e(d,c)})}}else return!1;return i!==n&&n.providers!==void 0}function z_(n,e){for(let t of n)xS(t)&&(t=t.\u0275providers),Array.isArray(t)?z_(t,e):e(t)}var wL=Be({provide:String,useValue:Be});function GS(n){return n!==null&&typeof n=="object"&&wL in n}function EL(n){return!!(n&&n.useExisting)}function IL(n){return!!(n&&n.useFactory)}function Zs(n){return typeof n=="function"}function CL(n){return!!n.useClass}var vf=new z(""),Uh={},DL={},By;function W_(){return By===void 0&&(By=new Qh),By}var it=class{},gu=class extends it{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(e,t,r,i){super(),this.parent=t,this.source=r,this.scopes=i,n_(e,s=>this.processProvider(s)),this.records.set(VS,Hs(void 0,this)),i.has("environment")&&this.records.set(it,Hs(void 0,this));let o=this.records.get(vf);o!=null&&typeof o.value=="string"&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(LS,bn,me.Self))}destroy(){du(this),this._destroyed=!0;let e=Ce(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of t)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Ce(e)}}onDestroy(e){return du(this),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){du(this);let t=gi(this),r=Tn(void 0),i;try{return e()}finally{gi(t),Tn(r)}}get(e,t=pu,r=me.Default){if(du(this),e.hasOwnProperty($0))return e[$0](this);r=yf(r);let i,o=gi(this),s=Tn(void 0);try{if(!(r&me.SkipSelf)){let l=this.records.get(e);if(l===void 0){let c=ML(e)&&mf(e);c&&this.injectableDefInScope(c)?l=Hs(t_(e),Uh):l=null,this.records.set(e,l)}if(l!=null)return this.hydrate(e,l)}let a=r&me.Self?W_():this.parent;return t=r&me.Optional&&t===pu?null:t,a.get(e,t)}catch(a){if(a.name==="NullInjectorError"){if((a[Wh]=a[Wh]||[]).unshift(zt(e)),o)throw a;return pL(a,e,"R3InjectorError",this.source)}else throw a}finally{Tn(s),gi(o)}}resolveInjectorInitializers(){let e=Ce(null),t=gi(this),r=Tn(void 0),i;try{let o=this.get(Ys,bn,me.Self);for(let s of o)s()}finally{gi(t),Tn(r),Ce(e)}}toString(){let e=[],t=this.records;for(let r of t.keys())e.push(zt(r));return`R3Injector[${e.join(", ")}]`}processProvider(e){e=Gt(e);let t=Zs(e)?e:Gt(e&&e.provide),r=bL(e);if(!Zs(e)&&e.multi===!0){let i=this.records.get(t);i||(i=Hs(void 0,Uh,!0),i.factory=()=>Xy(i.multi),this.records.set(t,i)),t=e,i.multi.push(e)}this.records.set(t,r)}hydrate(e,t){let r=Ce(null);try{return t.value===Uh&&(t.value=DL,t.value=t.factory()),typeof t.value=="object"&&t.value&&AL(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{Ce(r)}}injectableDefInScope(e){if(!e.providedIn)return!1;let t=Gt(e.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){let t=this._onDestroyHooks.indexOf(e);t!==-1&&this._onDestroyHooks.splice(t,1)}};function t_(n){let e=mf(n),t=e!==null?e.factory:Ks(n);if(t!==null)return t;if(n instanceof z)throw new te(204,!1);if(n instanceof Function)return TL(n);throw new te(204,!1)}function TL(n){if(n.length>0)throw new te(204,!1);let t=XV(n);return t!==null?()=>t.factory(n):()=>new n}function bL(n){if(GS(n))return Hs(void 0,n.useValue);{let e=zS(n);return Hs(e,Uh)}}function zS(n,e,t){let r;if(Zs(n)){let i=Gt(n);return Ks(i)||t_(i)}else if(GS(n))r=()=>Gt(n.useValue);else if(IL(n))r=()=>n.useFactory(...Xy(n.deps||[]));else if(EL(n))r=()=>j(Gt(n.useExisting));else{let i=Gt(n&&(n.useClass||n.provide));if(SL(n))r=()=>new i(...Xy(n.deps));else return Ks(i)||t_(i)}return r}function du(n){if(n.destroyed)throw new te(205,!1)}function Hs(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function SL(n){return!!n.deps}function AL(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function ML(n){return typeof n=="function"||typeof n=="object"&&n instanceof z}function n_(n,e){for(let t of n)Array.isArray(t)?n_(t,e):t&&xS(t)?n_(t.\u0275providers,e):e(t)}function Mn(n,e){n instanceof gu&&du(n);let t,r=gi(n),i=Tn(void 0);try{return e()}finally{gi(r),Tn(i)}}function WS(){return PS()!==void 0||dL()!=null}function KS(n){if(!WS())throw new te(-203,!1)}function RL(n){return typeof n=="function"}var jr=0,Ie=1,ce=2,Wt=3,Gn=4,zn=5,Yh=6,Zh=7,ur=8,Js=9,_i=10,yt=11,mu=12,q0=13,aa=14,cr=15,Xs=16,qs=17,ea=18,wf=19,QS=20,mi=21,Uy=22,Jh=23,cn=24,Fr=25,YS=1;var Io=7,Xh=8,ef=9,An=10;function yi(n){return Array.isArray(n)&&typeof n[YS]=="object"}function Br(n){return Array.isArray(n)&&n[YS]===!0}function ZS(n){return(n.flags&4)!==0}function Ef(n){return n.componentOffset>-1}function K_(n){return(n.flags&1)===1}function vi(n){return!!n.template}function r_(n){return(n[ce]&512)!==0}function Iu(n){return(n[ce]&256)===256}var i_=class{previousValue;currentValue;firstChange;constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}};function JS(n,e,t,r){e!==null?e.applyValueToInputSignal(e,r):n[t]=r}var Cu=(()=>{let n=()=>XS;return n.ngInherit=!0,n})();function XS(n){return n.type.prototype.ngOnChanges&&(n.setInput=NL),xL}function xL(){let n=tA(this),e=n?.current;if(e){let t=n.previous;if(t===Qs)n.previous=e;else for(let r in e)t[r]=e[r];n.current=null,this.ngOnChanges(e)}}function NL(n,e,t,r,i){let o=this.declaredInputs[r],s=tA(n)||PL(n,{previous:Qs,current:null}),a=s.current||(s.current={}),l=s.previous,c=l[o];a[o]=new i_(c&&c.currentValue,t,l===Qs),JS(n,e,i,t)}var eA="__ngSimpleChanges__";function tA(n){return n[eA]||null}function PL(n,e){return n[eA]=e}var G0=null;var Sn=function(n,e,t){G0?.(n,e,t)},kL="svg",OL="math";function dr(n){for(;Array.isArray(n);)n=n[jr];return n}function nA(n,e){return dr(e[n])}function Wn(n,e){return dr(e[n.index])}function rA(n,e){return n.data[e]}function Ti(n,e){let t=e[n];return yi(t)?t:t[jr]}function Q_(n){return(n[ce]&128)===128}function FL(n){return Br(n[Wt])}function tf(n,e){return e==null?null:n[e]}function iA(n){n[qs]=0}function Y_(n){n[ce]&1024||(n[ce]|=1024,Q_(n)&&Cf(n))}function VL(n,e){for(;n>0;)e=e[aa],n--;return e}function If(n){return!!(n[ce]&9216||n[cn]?.dirty)}function o_(n){n[_i].changeDetectionScheduler?.notify(9),n[ce]&64&&(n[ce]|=1024),If(n)&&Cf(n)}function Cf(n){n[_i].changeDetectionScheduler?.notify(0);let e=Co(n);for(;e!==null&&!(e[ce]&8192||(e[ce]|=8192,!Q_(e)));)e=Co(e)}function oA(n,e){if(Iu(n))throw new te(911,!1);n[mi]===null&&(n[mi]=[]),n[mi].push(e)}function LL(n,e){if(n[mi]===null)return;let t=n[mi].indexOf(e);t!==-1&&n[mi].splice(t,1)}function Co(n){let e=n[Wt];return Br(e)?e[Wt]:e}function jL(n){return n[Zh]??=[]}function BL(n){return n.cleanup??=[]}var Te={lFrame:fA(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var s_=!1;function UL(){return Te.lFrame.elementDepthCount}function $L(){Te.lFrame.elementDepthCount++}function HL(){Te.lFrame.elementDepthCount--}function sA(){return Te.bindingsEnabled}function qL(){return Te.skipHydrationRootTNode!==null}function GL(n){return Te.skipHydrationRootTNode===n}function zL(){Te.skipHydrationRootTNode=null}function Ye(){return Te.lFrame.lView}function fn(){return Te.lFrame.tView}function nn(){let n=aA();for(;n!==null&&n.type===64;)n=n.parent;return n}function aA(){return Te.lFrame.currentTNode}function WL(){let n=Te.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}function Du(n,e){let t=Te.lFrame;t.currentTNode=n,t.isParent=e}function lA(){return Te.lFrame.isParent}function KL(){Te.lFrame.isParent=!1}function uA(){return s_}function z0(n){let e=s_;return s_=n,e}function QL(n){return Te.lFrame.bindingIndex=n}function Z_(){return Te.lFrame.bindingIndex++}function YL(n){let e=Te.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function ZL(){return Te.lFrame.inI18n}function JL(n,e){let t=Te.lFrame;t.bindingIndex=t.bindingRootIndex=n,a_(e)}function XL(){return Te.lFrame.currentDirectiveIndex}function a_(n){Te.lFrame.currentDirectiveIndex=n}function ej(n){let e=Te.lFrame.currentDirectiveIndex;return e===-1?null:n[e]}function cA(n){Te.lFrame.currentQueryIndex=n}function tj(n){let e=n[Ie];return e.type===2?e.declTNode:e.type===1?n[zn]:null}function dA(n,e,t){if(t&me.SkipSelf){let i=e,o=n;for(;i=i.parent,i===null&&!(t&me.Host);)if(i=tj(o),i===null||(o=o[aa],i.type&10))break;if(i===null)return!1;e=i,n=o}let r=Te.lFrame=hA();return r.currentTNode=e,r.lView=n,!0}function J_(n){let e=hA(),t=n[Ie];Te.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function hA(){let n=Te.lFrame,e=n===null?null:n.child;return e===null?fA(n):e}function fA(n){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=e),e}function pA(){let n=Te.lFrame;return Te.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var gA=pA;function X_(){let n=pA();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function nj(n){return(Te.lFrame.contextLView=VL(n,Te.lFrame.contextLView))[ur]}function la(){return Te.lFrame.selectedIndex}function Do(n){Te.lFrame.selectedIndex=n}function ev(){let n=Te.lFrame;return rA(n.tView,n.selectedIndex)}function rj(){return Te.lFrame.currentNamespace}var mA=!0;function tv(){return mA}function nv(n){mA=n}function ij(n,e,t){let{ngOnChanges:r,ngOnInit:i,ngDoCheck:o}=e.type.prototype;if(r){let s=XS(e);(t.preOrderHooks??=[]).push(n,s),(t.preOrderCheckHooks??=[]).push(n,s)}i&&(t.preOrderHooks??=[]).push(0-n,i),o&&((t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o))}function rv(n,e){for(let t=e.directiveStart,r=e.directiveEnd;t<r;t++){let o=n.data[t].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:d}=o;s&&(n.contentHooks??=[]).push(-t,s),a&&((n.contentHooks??=[]).push(t,a),(n.contentCheckHooks??=[]).push(t,a)),l&&(n.viewHooks??=[]).push(-t,l),c&&((n.viewHooks??=[]).push(t,c),(n.viewCheckHooks??=[]).push(t,c)),d!=null&&(n.destroyHooks??=[]).push(t,d)}}function $h(n,e,t){yA(n,e,3,t)}function Hh(n,e,t,r){(n[ce]&3)===t&&yA(n,e,t,r)}function $y(n,e){let t=n[ce];(t&3)===e&&(t&=16383,t+=1,n[ce]=t)}function yA(n,e,t,r){let i=r!==void 0?n[qs]&65535:0,o=r??-1,s=e.length-1,a=0;for(let l=i;l<s;l++)if(typeof e[l+1]=="number"){if(a=e[l],r!=null&&a>=r)break}else e[l]<0&&(n[qs]+=65536),(a<o||o==-1)&&(oj(n,t,e,l),n[qs]=(n[qs]&4294901760)+l+2),l++}function W0(n,e){Sn(4,n,e);let t=Ce(null);try{e.call(n)}finally{Ce(t),Sn(5,n,e)}}function oj(n,e,t,r){let i=t[r]<0,o=t[r+1],s=i?-t[r]:t[r],a=n[s];i?n[ce]>>14<n[qs]>>16&&(n[ce]&3)===e&&(n[ce]+=16384,W0(a,o)):W0(a,o)}var Ws=-1,To=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(e,t,r){this.factory=e,this.canSeeViewProviders=t,this.injectImpl=r}};function sj(n){return n instanceof To}function aj(n){return(n.flags&8)!==0}function lj(n){return(n.flags&16)!==0}function uj(n,e,t){let r=0;for(;r<t.length;){let i=t[r];if(typeof i=="number"){if(i!==0)break;r++;let o=t[r++],s=t[r++],a=t[r++];n.setAttribute(e,s,a,o)}else{let o=i,s=t[++r];dj(o)?n.setProperty(e,o,s):n.setAttribute(e,o,s),r++}}return r}function cj(n){return n===3||n===4||n===6}function dj(n){return n.charCodeAt(0)===64}function ta(n,e){if(!(e===null||e.length===0))if(n===null||n.length===0)n=e.slice();else{let t=-1;for(let r=0;r<e.length;r++){let i=e[r];typeof i=="number"?t=i:t===0||(t===-1||t===2?K0(n,t,i,null,e[++r]):K0(n,t,i,null,null))}}return n}function K0(n,e,t,r,i){let o=0,s=n.length;if(e===-1)s=-1;else for(;o<n.length;){let a=n[o++];if(typeof a=="number"){if(a===e){s=-1;break}else if(a>e){s=o-1;break}}}for(;o<n.length;){let a=n[o];if(typeof a=="number")break;if(a===t){if(r===null){i!==null&&(n[o+1]=i);return}else if(r===n[o+1]){n[o+2]=i;return}}o++,r!==null&&o++,i!==null&&o++}s!==-1&&(n.splice(s,0,e),o=s+1),n.splice(o++,0,t),r!==null&&n.splice(o++,0,r),i!==null&&n.splice(o++,0,i)}var Hy={},l_=class{injector;parentInjector;constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,r){r=yf(r);let i=this.injector.get(e,Hy,r);return i!==Hy||t===Hy?i:this.parentInjector.get(e,t,r)}};function _A(n){return n!==Ws}function nf(n){return n&32767}function hj(n){return n>>16}function rf(n,e){let t=hj(n),r=e;for(;t>0;)r=r[aa],t--;return r}var u_=!0;function Q0(n){let e=u_;return u_=n,e}var fj=256,vA=fj-1,wA=5,pj=0,lr={};function gj(n,e,t){let r;typeof t=="string"?r=t.charCodeAt(0)||0:t.hasOwnProperty(fu)&&(r=t[fu]),r==null&&(r=t[fu]=pj++);let i=r&vA,o=1<<i;e.data[n+(i>>wA)]|=o}function of(n,e){let t=EA(n,e);if(t!==-1)return t;let r=e[Ie];r.firstCreatePass&&(n.injectorIndex=e.length,qy(r.data,n),qy(e,null),qy(r.blueprint,null));let i=iv(n,e),o=n.injectorIndex;if(_A(i)){let s=nf(i),a=rf(i,e),l=a[Ie].data;for(let c=0;c<8;c++)e[o+c]=a[s+c]|l[s+c]}return e[o+8]=i,o}function qy(n,e){n.push(0,0,0,0,0,0,0,0,e)}function EA(n,e){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||e[n.injectorIndex+8]===null?-1:n.injectorIndex}function iv(n,e){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let t=0,r=null,i=e;for(;i!==null;){if(r=bA(i),r===null)return Ws;if(t++,i=i[aa],r.injectorIndex!==-1)return r.injectorIndex|t<<16}return Ws}function c_(n,e,t){gj(n,e,t)}function IA(n,e,t){if(t&me.Optional||n!==void 0)return n;$_(e,"NodeInjector")}function CA(n,e,t,r){if(t&me.Optional&&r===void 0&&(r=null),!(t&(me.Self|me.Host))){let i=n[Js],o=Tn(void 0);try{return i?i.get(e,r,t&me.Optional):kS(e,r,t&me.Optional)}finally{Tn(o)}}return IA(r,e,t)}function DA(n,e,t,r=me.Default,i){if(n!==null){if(e[ce]&2048&&!(r&me.Self)){let s=wj(n,e,t,r,lr);if(s!==lr)return s}let o=TA(n,e,t,r,lr);if(o!==lr)return o}return CA(e,t,r,i)}function TA(n,e,t,r,i){let o=_j(t);if(typeof o=="function"){if(!dA(e,n,r))return r&me.Host?IA(i,t,r):CA(e,t,r,i);try{let s;if(s=o(r),s==null&&!(r&me.Optional))$_(t);else return s}finally{gA()}}else if(typeof o=="number"){let s=null,a=EA(n,e),l=Ws,c=r&me.Host?e[cr][zn]:null;for((a===-1||r&me.SkipSelf)&&(l=a===-1?iv(n,e):e[a+8],l===Ws||!Z0(r,!1)?a=-1:(s=e[Ie],a=nf(l),e=rf(l,e)));a!==-1;){let d=e[Ie];if(Y0(o,a,d.data)){let f=mj(a,e,t,s,r,c);if(f!==lr)return f}l=e[a+8],l!==Ws&&Z0(r,e[Ie].data[a+8]===c)&&Y0(o,a,e)?(s=d,a=nf(l),e=rf(l,e)):a=-1}}return i}function mj(n,e,t,r,i,o){let s=e[Ie],a=s.data[n+8],l=r==null?Ef(a)&&u_:r!=s&&(a.type&3)!==0,c=i&me.Host&&o===a,d=yj(a,s,t,l,c);return d!==null?na(e,s,d,a):lr}function yj(n,e,t,r,i){let o=n.providerIndexes,s=e.data,a=o&1048575,l=n.directiveStart,c=n.directiveEnd,d=o>>20,f=r?a:a+d,g=i?a+d:c;for(let m=f;m<g;m++){let v=s[m];if(m<l&&t===v||m>=l&&v.type===t)return m}if(i){let m=s[l];if(m&&vi(m)&&m.type===t)return l}return null}function na(n,e,t,r){let i=n[t],o=e.data;if(sj(i)){let s=i;s.resolving&&sL(oL(o[t]));let a=Q0(s.canSeeViewProviders);s.resolving=!0;let l,c=s.injectImpl?Tn(s.injectImpl):null,d=dA(n,r,me.Default);try{i=n[t]=s.factory(void 0,o,n,r),e.firstCreatePass&&t>=r.directiveStart&&ij(t,o[t],e)}finally{c!==null&&Tn(c),Q0(a),s.resolving=!1,gA()}}return i}function _j(n){if(typeof n=="string")return n.charCodeAt(0)||0;let e=n.hasOwnProperty(fu)?n[fu]:void 0;return typeof e=="number"?e>=0?e&vA:vj:e}function Y0(n,e,t){let r=1<<n;return!!(t[e+(n>>wA)]&r)}function Z0(n,e){return!(n&me.Self)&&!(n&me.Host&&e)}var wo=class{_tNode;_lView;constructor(e,t){this._tNode=e,this._lView=t}get(e,t,r){return DA(this._tNode,this._lView,e,yf(r),t)}};function vj(){return new wo(nn(),Ye())}function bi(n){return wu(()=>{let e=n.prototype.constructor,t=e[zh]||d_(e),r=Object.prototype,i=Object.getPrototypeOf(n.prototype).constructor;for(;i&&i!==r;){let o=i[zh]||d_(i);if(o&&o!==t)return o;i=Object.getPrototypeOf(i)}return o=>new o})}function d_(n){return SS(n)?()=>{let e=d_(Gt(n));return e&&e()}:Ks(n)}function wj(n,e,t,r,i){let o=n,s=e;for(;o!==null&&s!==null&&s[ce]&2048&&!(s[ce]&512);){let a=TA(o,s,t,r|me.Self,lr);if(a!==lr)return a;let l=o.parent;if(!l){let c=s[QS];if(c){let d=c.get(t,lr,r);if(d!==lr)return d}l=bA(s),s=s[aa]}o=l}return i}function bA(n){let e=n[Ie],t=e.type;return t===2?e.declTNode:t===1?n[zn]:null}function J0(n,e=null,t=null,r){let i=SA(n,e,t,r);return i.resolveInjectorInitializers(),i}function SA(n,e=null,t=null,r,i=new Set){let o=[t||bn,G_(n)];return r=r||(typeof n=="object"?void 0:zt(n)),new gu(o,e||W_(),r||null,i)}var dn=class n{static THROW_IF_NOT_FOUND=pu;static NULL=new Qh;static create(e,t){if(Array.isArray(e))return J0({name:""},t,e,"");{let r=e.name??"";return J0({name:r},e.parent,e.providers,r)}}static \u0275prov=ee({token:n,providedIn:"any",factory:()=>j(VS)});static __NG_ELEMENT_ID__=-1};var Ej=new z("");Ej.__NG_ELEMENT_ID__=n=>{let e=nn();if(e===null)throw new te(204,!1);if(e.type&2)return e.value;if(n&me.Optional)return null;throw new te(204,!1)};var AA=!1,ov=(()=>{class n{static __NG_ELEMENT_ID__=Ij;static __NG_ENV_ID__=t=>t}return n})(),h_=class extends ov{_lView;constructor(e){super(),this._lView=e}onDestroy(e){return oA(this._lView,e),()=>LL(this._lView,e)}};function Ij(){return new h_(Ye())}var ra=class{},sv=new z("",{providedIn:"root",factory:()=>!1});var MA=new z(""),RA=new z(""),Mo=(()=>{class n{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new bt(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let t=this.taskId++;return this.pendingTasks.add(t),t}has(t){return this.pendingTasks.has(t)}remove(t){this.pendingTasks.delete(t),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=ee({token:n,providedIn:"root",factory:()=>new n})}return n})(),av=(()=>{class n{internalPendingTasks=V(Mo);scheduler=V(ra);add(){let t=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(t)&&(this.scheduler.notify(12),this.internalPendingTasks.remove(t))}}run(t){return x(this,null,function*(){let r=this.add();try{return yield t()}finally{r()}})}static \u0275prov=ee({token:n,providedIn:"root",factory:()=>new n})}return n})(),f_=class extends Ge{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(e=!1){super(),this.__isAsync=e,WS()&&(this.destroyRef=V(ov,{optional:!0})??void 0,this.pendingTasks=V(Mo,{optional:!0})??void 0)}emit(e){let t=Ce(null);try{super.next(e)}finally{Ce(t)}}subscribe(e,t,r){let i=e,o=t||(()=>null),s=r;if(e&&typeof e=="object"){let l=e;i=l.next?.bind(l),o=l.error?.bind(l),s=l.complete?.bind(l)}this.__isAsync&&(o=this.wrapInTimeout(o),i&&(i=this.wrapInTimeout(i)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:i,error:o,complete:s});return e instanceof tt&&e.add(a),a}wrapInTimeout(e){return t=>{let r=this.pendingTasks?.add();setTimeout(()=>{e(t),r!==void 0&&this.pendingTasks?.remove(r)})}}},At=f_;function sf(...n){}function xA(n){let e,t;function r(){n=sf;try{t!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(t),e!==void 0&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{n(),r()}),typeof requestAnimationFrame=="function"&&(t=requestAnimationFrame(()=>{n(),r()})),()=>r()}function X0(n){return queueMicrotask(()=>n()),()=>{n=sf}}var lv="isAngularZone",af=lv+"_ID",Cj=0,De=class n{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new At(!1);onMicrotaskEmpty=new At(!1);onStable=new At(!1);onError=new At(!1);constructor(e){let{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:i=!1,scheduleInRootZone:o=AA}=e;if(typeof Zone>"u")throw new te(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!i&&r,s.shouldCoalesceRunChangeDetection=i,s.callbackScheduled=!1,s.scheduleInRootZone=o,bj(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(lv)===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new te(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new te(909,!1)}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,i){let o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+i,e,Dj,sf,sf);try{return o.runTask(s,t,r)}finally{o.cancelTask(s)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}},Dj={};function uv(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function Tj(n){if(n.isCheckStableRunning||n.callbackScheduled)return;n.callbackScheduled=!0;function e(){xA(()=>{n.callbackScheduled=!1,p_(n),n.isCheckStableRunning=!0,uv(n),n.isCheckStableRunning=!1})}n.scheduleInRootZone?Zone.root.run(()=>{e()}):n._outer.run(()=>{e()}),p_(n)}function bj(n){let e=()=>{Tj(n)},t=Cj++;n._inner=n._inner.fork({name:"angular",properties:{[lv]:!0,[af]:t,[af+t]:!0},onInvokeTask:(r,i,o,s,a,l)=>{if(Sj(l))return r.invokeTask(o,s,a,l);try{return eS(n),r.invokeTask(o,s,a,l)}finally{(n.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&e(),tS(n)}},onInvoke:(r,i,o,s,a,l,c)=>{try{return eS(n),r.invoke(o,s,a,l,c)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!Aj(l)&&e(),tS(n)}},onHasTask:(r,i,o,s)=>{r.hasTask(o,s),i===o&&(s.change=="microTask"?(n._hasPendingMicrotasks=s.microTask,p_(n),uv(n)):s.change=="macroTask"&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(r,i,o,s)=>(r.handleError(o,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}function p_(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.callbackScheduled===!0?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function eS(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function tS(n){n._nesting--,uv(n)}var g_=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new At;onMicrotaskEmpty=new At;onStable=new At;onError=new At;run(e,t,r){return e.apply(t,r)}runGuarded(e,t,r){return e.apply(t,r)}runOutsideAngular(e){return e()}runTask(e,t,r,i){return e.apply(t,r)}};function Sj(n){return NA(n,"__ignore_ng_zone__")}function Aj(n){return NA(n,"__scheduler_tick__")}function NA(n,e){return!Array.isArray(n)||n.length!==1?!1:n[0]?.data?.[e]===!0}var wi=class{_console=console;handleError(e){this._console.error("ERROR",e)}},Mj=new z("",{providedIn:"root",factory:()=>{let n=V(De),e=V(wi);return t=>n.runOutsideAngular(()=>e.handleError(t))}});function nS(n,e){return TS(n,e)}function Rj(n){return TS(DS,n)}var PA=(nS.required=Rj,nS);function xj(){return Df(nn(),Ye())}function Df(n,e){return new fr(Wn(n,e))}var fr=(()=>{class n{nativeElement;constructor(t){this.nativeElement=t}static __NG_ELEMENT_ID__=xj}return n})();var rS=new Set;function Tf(n){rS.has(n)||(rS.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}function Nj(n){return typeof n=="function"&&n[un]!==void 0}function Tu(n,e){Tf("NgSignals");let t=m0(n),r=t[un];return e?.equal&&(r.equal=e.equal),t.set=i=>dh(r,i),t.update=i=>y0(r,i),t.asReadonly=Pj.bind(t),t}function Pj(){let n=this[un];if(n.readonlyFn===void 0){let e=()=>this();e[un]=n,n.readonlyFn=e}return n.readonlyFn}function kA(n){return Nj(n)&&typeof n.set=="function"}function OA(n){return(n.flags&128)===128}var FA=function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n}(FA||{}),VA=new Map,kj=0;function Oj(){return kj++}function Fj(n){VA.set(n[wf],n)}function m_(n){VA.delete(n[wf])}var iS="__ngContext__";function bo(n,e){yi(e)?(n[iS]=e[wf],Fj(e)):n[iS]=e}function LA(n){return BA(n[mu])}function jA(n){return BA(n[Gn])}function BA(n){for(;n!==null&&!Br(n);)n=n[Gn];return n}var y_;function UA(n){y_=n}function Vj(){if(y_!==void 0)return y_;if(typeof document<"u")return document;throw new te(210,!1)}var cv=new z("",{providedIn:"root",factory:()=>Lj}),Lj="ng",dv=new z(""),rn=new z("",{providedIn:"platform",factory:()=>"unknown"});var hv=new z("",{providedIn:"root",factory:()=>Vj().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var jj="h",Bj="b";var $A=!1,Uj=new z("",{providedIn:"root",factory:()=>$A});var HA=function(n){return n[n.CHANGE_DETECTION=0]="CHANGE_DETECTION",n[n.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",n}(HA||{}),bf=new z("");var $j=(()=>{class n{impl=null;execute(){this.impl?.execute()}static \u0275prov=ee({token:n,providedIn:"root",factory:()=>new n})}return n})();var Hj=()=>null;function fv(n,e,t=!1){return Hj(n,e,t)}function qA(n,e){let t=n.contentQueries;if(t!==null){let r=Ce(null);try{for(let i=0;i<t.length;i+=2){let o=t[i],s=t[i+1];if(s!==-1){let a=n.data[s];cA(o),a.contentQueries(2,e[s],s)}}}finally{Ce(r)}}}function __(n,e,t){cA(0);let r=Ce(null);try{e(n,t)}finally{Ce(r)}}function GA(n,e,t){if(ZS(e)){let r=Ce(null);try{let i=e.directiveStart,o=e.directiveEnd;for(let s=i;s<o;s++){let a=n.data[s];if(a.contentQueries){let l=t[s];a.contentQueries(1,l,s)}}}finally{Ce(r)}}}var hr=function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n}(hr||{});var v_=class{changingThisBreaksApplicationSecurity;constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${KV})`}};function pv(n){return n instanceof v_?n.changingThisBreaksApplicationSecurity:n}function zA(n){return n instanceof Function?n():n}var Ei=function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n}(Ei||{});function qj(n,e,t){let r=n.length;for(;;){let i=n.indexOf(e,t);if(i===-1)return i;if(i===0||n.charCodeAt(i-1)<=32){let o=e.length;if(i+o===r||n.charCodeAt(i+o)<=32)return i}t=i+1}}var WA="ng-template";function Gj(n,e,t,r){let i=0;if(r){for(;i<e.length&&typeof e[i]=="string";i+=2)if(e[i]==="class"&&qj(e[i+1].toLowerCase(),t,0)!==-1)return!0}else if(gv(n))return!1;if(i=e.indexOf(1,i),i>-1){let o;for(;++i<e.length&&typeof(o=e[i])=="string";)if(o.toLowerCase()===t)return!0}return!1}function gv(n){return n.type===4&&n.value!==WA}function zj(n,e,t){let r=n.type===4&&!t?WA:n.value;return e===r}function Wj(n,e,t){let r=4,i=n.attrs,o=i!==null?Yj(i):0,s=!1;for(let a=0;a<e.length;a++){let l=e[a];if(typeof l=="number"){if(!s&&!qn(r)&&!qn(l))return!1;if(s&&qn(l))continue;s=!1,r=l|r&1;continue}if(!s)if(r&4){if(r=2|r&1,l!==""&&!zj(n,l,t)||l===""&&e.length===1){if(qn(r))return!1;s=!0}}else if(r&8){if(i===null||!Gj(n,i,l,t)){if(qn(r))return!1;s=!0}}else{let c=e[++a],d=Kj(l,i,gv(n),t);if(d===-1){if(qn(r))return!1;s=!0;continue}if(c!==""){let f;if(d>o?f="":f=i[d+1].toLowerCase(),r&2&&c!==f){if(qn(r))return!1;s=!0}}}}return qn(r)||s}function qn(n){return(n&1)===0}function Kj(n,e,t,r){if(e===null)return-1;let i=0;if(r||!t){let o=!1;for(;i<e.length;){let s=e[i];if(s===n)return i;if(s===3||s===6)o=!0;else if(s===1||s===2){let a=e[++i];for(;typeof a=="string";)a=e[++i];continue}else{if(s===4)break;if(s===0){i+=4;continue}}i+=o?1:2}return-1}else return Zj(e,n)}function Qj(n,e,t=!1){for(let r=0;r<e.length;r++)if(Wj(n,e[r],t))return!0;return!1}function Yj(n){for(let e=0;e<n.length;e++){let t=n[e];if(cj(t))return e}return n.length}function Zj(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){let r=n[t];if(typeof r=="number")return-1;if(r===e)return t;t++}return-1}function oS(n,e){return n?":not("+e.trim()+")":e}function Jj(n){let e=n[0],t=1,r=2,i="",o=!1;for(;t<n.length;){let s=n[t];if(typeof s=="string")if(r&2){let a=n[++t];i+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else r&8?i+="."+s:r&4&&(i+=" "+s);else i!==""&&!qn(s)&&(e+=oS(o,i),i=""),r=s,o=o||!qn(r);t++}return i!==""&&(e+=oS(o,i)),e}function Xj(n){return n.map(Jj).join(",")}function e2(n){let e=[],t=[],r=1,i=2;for(;r<n.length;){let o=n[r];if(typeof o=="string")i===2?o!==""&&e.push(o,n[++r]):i===8&&t.push(o);else{if(!qn(i))break;i=o}r++}return{attrs:e,classes:t}}var Ro={};function be(n=1){KA(fn(),Ye(),la()+n,!1)}function KA(n,e,t,r){if(!r)if((e[ce]&3)===3){let o=n.preOrderCheckHooks;o!==null&&$h(e,o,t)}else{let o=n.preOrderHooks;o!==null&&Hh(e,o,0,t)}Do(t)}function Me(n,e=me.Default){let t=Ye();if(t===null)return j(n,e);let r=nn();return DA(r,t,Gt(n),e)}function QA(n,e,t,r,i,o){let s=Ce(null);try{let a=null;i&Ei.SignalBased&&(a=e[r][un]),a!==null&&a.transformFn!==void 0&&(o=a.transformFn(o)),i&Ei.HasDecoratorInputTransform&&(o=n.inputTransforms[r].call(e,o)),n.setInput!==null?n.setInput(e,a,o,t,r):JS(e,a,r,o)}finally{Ce(s)}}function t2(n,e){return n.createText(e)}function n2(n,e,t){n.setValue(e,t)}function YA(n,e,t){return n.createElement(e,t)}function lf(n,e,t,r,i){n.insertBefore(e,t,r,i)}function ZA(n,e,t){n.appendChild(e,t)}function sS(n,e,t,r,i){r!==null?lf(n,e,t,r,i):ZA(n,e,t)}function r2(n,e,t){n.removeChild(null,e,t)}function i2(n,e,t){n.setAttribute(e,"style",t)}function o2(n,e,t){t===""?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function JA(n,e,t){let{mergedAttrs:r,classes:i,styles:o}=t;r!==null&&uj(n,e,r),i!==null&&o2(n,e,i),o!==null&&i2(n,e,o)}function Sf(n,e,t,r,i,o,s,a,l,c,d){let f=e.blueprint.slice();return f[jr]=i,f[ce]=r|4|128|8|64|1024,(c!==null||n&&n[ce]&2048)&&(f[ce]|=2048),iA(f),f[Wt]=f[aa]=n,f[ur]=t,f[_i]=s||n&&n[_i],f[yt]=a||n&&n[yt],f[Js]=l||n&&n[Js]||null,f[zn]=o,f[wf]=Oj(),f[Yh]=d,f[QS]=c,f[cr]=e.type==2?n[cr]:f,f}function XA(n,e,t,r){if(t===0)return-1;let i=e.length;for(let o=0;o<t;o++)e.push(r),n.blueprint.push(r),n.data.push(null);return i}function eM(n,e,t,r,i){let o=la(),s=r&2;try{Do(-1),s&&e.length>Fr&&KA(n,e,Fr,!1),Sn(s?2:0,i),t(r,i)}finally{Do(o),Sn(s?3:1,i)}}function tM(n,e,t){sA()&&(g2(n,e,t,Wn(t,e)),(t.flags&64)===64&&sM(n,e,t))}function nM(n,e,t=Wn){let r=e.localNames;if(r!==null){let i=e.index+1;for(let o=0;o<r.length;o+=2){let s=r[o+1],a=s===-1?t(e,n):n[s];n[i++]=a}}}function rM(n){let e=n.tView;return e===null||e.incompleteFirstPass?n.tView=mv(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}function mv(n,e,t,r,i,o,s,a,l,c,d){let f=Fr+r,g=f+i,m=s2(f,g),v=typeof c=="function"?c():c;return m[Ie]={type:n,blueprint:m,template:t,queries:null,viewQuery:a,declTNode:e,data:m.slice().fill(null,f),bindingStartIndex:f,expandoStartIndex:g,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof o=="function"?o():o,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:l,consts:v,incompleteFirstPass:!1,ssrId:d}}function s2(n,e){let t=[];for(let r=0;r<e;r++)t.push(r<n?null:Ro);return t}function a2(n,e,t,r){let o=r.get(Uj,$A)||t===hr.ShadowDom,s=n.selectRootElement(e,o);return l2(s),s}function l2(n){u2(n)}var u2=()=>null;function aS(n,e,t,r,i){for(let o in e){if(!e.hasOwnProperty(o))continue;let s=e[o];if(s===void 0)continue;r??={};let a,l=Ei.None;Array.isArray(s)?(a=s[0],l=s[1]):a=s;let c=o;if(i!==null){if(!i.hasOwnProperty(o))continue;c=i[o]}n===0?lS(r,t,c,a,l):lS(r,t,c,a)}return r}function lS(n,e,t,r,i){let o;n.hasOwnProperty(t)?(o=n[t]).push(e,r):o=n[t]=[e,r],i!==void 0&&o.push(i)}function c2(n,e,t){let r=e.directiveStart,i=e.directiveEnd,o=n.data,s=e.attrs,a=[],l=null,c=null;for(let d=r;d<i;d++){let f=o[d],g=t?t.get(f):null,m=g?g.inputs:null,v=g?g.outputs:null;l=aS(0,f.inputs,d,l,m),c=aS(1,f.outputs,d,c,v);let T=l!==null&&s!==null&&!gv(e)?D2(l,d,s):null;a.push(T)}l!==null&&(l.hasOwnProperty("class")&&(e.flags|=8),l.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=l,e.outputs=c}function d2(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function yv(n,e,t,r,i,o,s,a){let l=Wn(e,t),c=e.inputs,d;!a&&c!=null&&(d=c[r])?(_v(n,t,d,r,i),Ef(e)&&h2(t,e.index)):e.type&3?(r=d2(r),i=s!=null?s(i,e.value||"",r):i,o.setProperty(l,r,i)):e.type&12}function h2(n,e){let t=Ti(e,n);t[ce]&16||(t[ce]|=64)}function iM(n,e,t,r){if(sA()){let i=r===null?null:{"":-1},o=y2(n,t),s,a;o===null?s=a=null:[s,a]=o,s!==null&&oM(n,e,t,s,i,a),i&&_2(t,r,i)}t.mergedAttrs=ta(t.mergedAttrs,t.attrs)}function oM(n,e,t,r,i,o){for(let c=0;c<r.length;c++)c_(of(t,e),n,r[c].type);w2(t,n.data.length,r.length);for(let c=0;c<r.length;c++){let d=r[c];d.providersResolver&&d.providersResolver(d)}let s=!1,a=!1,l=XA(n,e,r.length,null);for(let c=0;c<r.length;c++){let d=r[c];t.mergedAttrs=ta(t.mergedAttrs,d.hostAttrs),E2(n,t,e,l,d),v2(l,d,i),d.contentQueries!==null&&(t.flags|=4),(d.hostBindings!==null||d.hostAttrs!==null||d.hostVars!==0)&&(t.flags|=64);let f=d.type.prototype;!s&&(f.ngOnChanges||f.ngOnInit||f.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),s=!0),!a&&(f.ngOnChanges||f.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),a=!0),l++}c2(n,t,o)}function f2(n,e,t,r,i){let o=i.hostBindings;if(o){let s=n.hostBindingOpCodes;s===null&&(s=n.hostBindingOpCodes=[]);let a=~e.index;p2(s)!=a&&s.push(a),s.push(t,r,o)}}function p2(n){let e=n.length;for(;e>0;){let t=n[--e];if(typeof t=="number"&&t<0)return t}return 0}function g2(n,e,t,r){let i=t.directiveStart,o=t.directiveEnd;Ef(t)&&I2(e,t,n.data[i+t.componentOffset]),n.firstCreatePass||of(t,e),bo(r,e);let s=t.initialInputs;for(let a=i;a<o;a++){let l=n.data[a],c=na(e,n,a,t);if(bo(c,e),s!==null&&C2(e,a-i,c,l,t,s),vi(l)){let d=Ti(t.index,e);d[ur]=na(e,n,a,t)}}}function sM(n,e,t){let r=t.directiveStart,i=t.directiveEnd,o=t.index,s=XL();try{Do(o);for(let a=r;a<i;a++){let l=n.data[a],c=e[a];a_(a),(l.hostBindings!==null||l.hostVars!==0||l.hostAttrs!==null)&&m2(l,c)}}finally{Do(-1),a_(s)}}function m2(n,e){n.hostBindings!==null&&n.hostBindings(1,e)}function y2(n,e){let t=n.directiveRegistry,r=null,i=null;if(t)for(let o=0;o<t.length;o++){let s=t[o];if(Qj(e,s.selectors,!1))if(r||(r=[]),vi(s))if(s.findHostDirectiveDefs!==null){let a=[];i=i||new Map,s.findHostDirectiveDefs(s,a,i),r.unshift(...a,s);let l=a.length;w_(n,e,l)}else r.unshift(s),w_(n,e,0);else i=i||new Map,s.findHostDirectiveDefs?.(s,r,i),r.push(s)}return r===null?null:[r,i]}function w_(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function _2(n,e,t){if(e){let r=n.localNames=[];for(let i=0;i<e.length;i+=2){let o=t[e[i+1]];if(o==null)throw new te(-301,!1);r.push(e[i],o)}}}function v2(n,e,t){if(t){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)t[e.exportAs[r]]=n;vi(e)&&(t[""]=n)}}function w2(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function E2(n,e,t,r,i){n.data[r]=i;let o=i.factory||(i.factory=Ks(i.type,!0)),s=new To(o,vi(i),Me);n.blueprint[r]=s,t[r]=s,f2(n,e,r,XA(n,t,i.hostVars,Ro),i)}function aM(n){let e=16;return n.signals?e=4096:n.onPush&&(e=64),e}function I2(n,e,t){let r=Wn(e,n),i=rM(t),o=n[_i].rendererFactory,s=Af(n,Sf(n,i,null,aM(t),r,e,null,o.createRenderer(r,t),null,null,null));n[e.index]=s}function C2(n,e,t,r,i,o){let s=o[e];if(s!==null)for(let a=0;a<s.length;){let l=s[a++],c=s[a++],d=s[a++],f=s[a++];QA(r,t,l,c,d,f)}}function D2(n,e,t){let r=null,i=0;for(;i<t.length;){let o=t[i];if(o===0){i+=4;continue}else if(o===5){i+=2;continue}if(typeof o=="number")break;if(n.hasOwnProperty(o)){r===null&&(r=[]);let s=n[o];for(let a=0;a<s.length;a+=3)if(s[a]===e){r.push(o,s[a+1],s[a+2],t[i+1]);break}}i+=2}return r}function lM(n,e,t,r){return[n,!0,0,e,null,r,null,t,null,null]}function Af(n,e){return n[mu]?n[q0][Gn]=e:n[mu]=e,n[q0]=e,e}function uM(n,e){let t=n[Js],r=t?t.get(wi,null):null;r&&r.handleError(e)}function _v(n,e,t,r,i){for(let o=0;o<t.length;){let s=t[o++],a=t[o++],l=t[o++],c=e[s],d=n.data[s];QA(d,c,r,a,l,i)}}function T2(n,e){let t=Ti(e,n),r=t[Ie];b2(r,t);let i=t[jr];i!==null&&t[Yh]===null&&(t[Yh]=fv(i,t[Js])),vv(r,t,t[ur])}function b2(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}function vv(n,e,t){J_(e);try{let r=n.viewQuery;r!==null&&__(1,r,t);let i=n.template;i!==null&&eM(n,e,i,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),e[ea]?.finishViewCreation(n),n.staticContentQueries&&qA(n,e),n.staticViewQueries&&__(2,n.viewQuery,t);let o=n.components;o!==null&&S2(e,o)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{e[ce]&=-5,X_()}}function S2(n,e){for(let t=0;t<e.length;t++)T2(n,e[t])}var Vr=function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n}(Vr||{}),A2;function wv(n,e){return A2(n,e)}function Gs(n,e,t,r,i){if(r!=null){let o,s=!1;Br(r)?o=r:yi(r)&&(s=!0,r=r[jr]);let a=dr(r);n===0&&t!==null?i==null?ZA(e,t,a):lf(e,t,a,i||null,!0):n===1&&t!==null?lf(e,t,a,i||null,!0):n===2?r2(e,a,s):n===3&&e.destroyNode(a),o!=null&&U2(e,n,o,t,i)}}function M2(n,e){cM(n,e),e[jr]=null,e[zn]=null}function R2(n,e,t,r,i,o){r[jr]=i,r[zn]=e,Mf(n,r,t,1,i,o)}function cM(n,e){e[_i].changeDetectionScheduler?.notify(10),Mf(n,e,e[yt],2,null,null)}function x2(n){let e=n[mu];if(!e)return Gy(n[Ie],n);for(;e;){let t=null;if(yi(e))t=e[mu];else{let r=e[An];r&&(t=r)}if(!t){for(;e&&!e[Gn]&&e!==n;)yi(e)&&Gy(e[Ie],e),e=e[Wt];e===null&&(e=n),yi(e)&&Gy(e[Ie],e),t=e&&e[Gn]}e=t}}function N2(n,e,t,r){let i=An+r,o=t.length;r>0&&(t[i-1][Gn]=e),r<o-An?(e[Gn]=t[i],FS(t,An+r,e)):(t.push(e),e[Gn]=null),e[Wt]=t;let s=e[Xs];s!==null&&t!==s&&dM(s,e);let a=e[ea];a!==null&&a.insertView(n),o_(e),e[ce]|=128}function dM(n,e){let t=n[ef],r=e[Wt];if(yi(r))n[ce]|=2;else{let i=r[Wt][cr];e[cr]!==i&&(n[ce]|=2)}t===null?n[ef]=[e]:t.push(e)}function Ev(n,e){let t=n[ef],r=t.indexOf(e);t.splice(r,1)}function E_(n,e){if(n.length<=An)return;let t=An+e,r=n[t];if(r){let i=r[Xs];i!==null&&i!==n&&Ev(i,r),e>0&&(n[t-1][Gn]=r[Gn]);let o=Kh(n,An+e);M2(r[Ie],r);let s=o[ea];s!==null&&s.detachView(o[Ie]),r[Wt]=null,r[Gn]=null,r[ce]&=-129}return r}function hM(n,e){if(Iu(e))return;let t=e[yt];t.destroyNode&&Mf(n,e,t,3,null,null),x2(e)}function Gy(n,e){if(Iu(e))return;let t=Ce(null);try{e[ce]&=-129,e[ce]|=256,e[cn]&&vy(e[cn]),k2(n,e),P2(n,e),e[Ie].type===1&&e[yt].destroy();let r=e[Xs];if(r!==null&&Br(e[Wt])){r!==e[Wt]&&Ev(r,e);let i=e[ea];i!==null&&i.detachView(n)}m_(e)}finally{Ce(t)}}function P2(n,e){let t=n.cleanup,r=e[Zh];if(t!==null)for(let s=0;s<t.length-1;s+=2)if(typeof t[s]=="string"){let a=t[s+3];a>=0?r[a]():r[-a].unsubscribe(),s+=2}else{let a=r[t[s+1]];t[s].call(a)}r!==null&&(e[Zh]=null);let i=e[mi];if(i!==null){e[mi]=null;for(let s=0;s<i.length;s++){let a=i[s];a()}}let o=e[Jh];if(o!==null){e[Jh]=null;for(let s of o)s.destroy()}}function k2(n,e){let t;if(n!=null&&(t=n.destroyHooks)!=null)for(let r=0;r<t.length;r+=2){let i=e[t[r]];if(!(i instanceof To)){let o=t[r+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){let a=i[o[s]],l=o[s+1];Sn(4,a,l);try{l.call(a)}finally{Sn(5,a,l)}}else{Sn(4,i,o);try{o.call(i)}finally{Sn(5,i,o)}}}}}function O2(n,e,t){return F2(n,e.parent,t)}function F2(n,e,t){let r=e;for(;r!==null&&r.type&168;)e=r,r=e.parent;if(r===null)return t[jr];{let{componentOffset:i}=r;if(i>-1){let{encapsulation:o}=n.data[r.directiveStart+i];if(o===hr.None||o===hr.Emulated)return null}return Wn(r,t)}}function V2(n,e,t){return j2(n,e,t)}function L2(n,e,t){return n.type&40?Wn(n,t):null}var j2=L2,uS;function Iv(n,e,t,r){let i=O2(n,r,e),o=e[yt],s=r.parent||e[zn],a=V2(s,r,e);if(i!=null)if(Array.isArray(t))for(let l=0;l<t.length;l++)sS(o,i,t[l],a,!1);else sS(o,i,t,a,!1);uS!==void 0&&uS(o,r,e,t,i)}function hu(n,e){if(e!==null){let t=e.type;if(t&3)return Wn(e,n);if(t&4)return I_(-1,n[e.index]);if(t&8){let r=e.child;if(r!==null)return hu(n,r);{let i=n[e.index];return Br(i)?I_(-1,i):dr(i)}}else{if(t&128)return hu(n,e.next);if(t&32)return wv(e,n)()||dr(n[e.index]);{let r=fM(n,e);if(r!==null){if(Array.isArray(r))return r[0];let i=Co(n[cr]);return hu(i,r)}else return hu(n,e.next)}}}return null}function fM(n,e){if(e!==null){let r=n[cr][zn],i=e.projection;return r.projection[i]}return null}function I_(n,e){let t=An+n+1;if(t<e.length){let r=e[t],i=r[Ie].firstChild;if(i!==null)return hu(r,i)}return e[Io]}function Cv(n,e,t,r,i,o,s){for(;t!=null;){if(t.type===128){t=t.next;continue}let a=r[t.index],l=t.type;if(s&&e===0&&(a&&bo(dr(a),r),t.flags|=2),(t.flags&32)!==32)if(l&8)Cv(n,e,t.child,r,i,o,!1),Gs(e,n,i,a,o);else if(l&32){let c=wv(t,r),d;for(;d=c();)Gs(e,n,i,d,o);Gs(e,n,i,a,o)}else l&16?B2(n,e,r,t,i,o):Gs(e,n,i,a,o);t=s?t.projectionNext:t.next}}function Mf(n,e,t,r,i,o){Cv(t,r,n.firstChild,e,i,o,!1)}function B2(n,e,t,r,i,o){let s=t[cr],l=s[zn].projection[r.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++){let d=l[c];Gs(e,n,i,d,o)}else{let c=l,d=s[Wt];OA(r)&&(c.flags|=128),Cv(n,e,c,d,i,o,!0)}}function U2(n,e,t,r,i){let o=t[Io],s=dr(t);o!==s&&Gs(e,n,r,o,i);for(let a=An;a<t.length;a++){let l=t[a];Mf(l[Ie],l,n,e,r,o)}}function $2(n,e,t,r,i){if(e)i?n.addClass(t,r):n.removeClass(t,r);else{let o=r.indexOf("-")===-1?void 0:Vr.DashCase;i==null?n.removeStyle(t,r,o):(typeof i=="string"&&i.endsWith("!important")&&(i=i.slice(0,-10),o|=Vr.Important),n.setStyle(t,r,i,o))}}function H2(n,e,t,r){let i=Ce(null);try{let o=e.tView,a=n[ce]&4096?4096:16,l=Sf(n,o,t,a,null,e,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),c=n[e.index];l[Xs]=c;let d=n[ea];return d!==null&&(l[ea]=d.createEmbeddedView(o)),vv(o,l,t),l}finally{Ce(i)}}function cS(n,e){return!e||e.firstChild===null||OA(n)}function q2(n,e,t,r=!0){let i=e[Ie];if(N2(i,e,n,t),r){let s=I_(t,n),a=e[yt],l=a.parentNode(n[Io]);l!==null&&R2(i,n[zn],a,e,l,s)}let o=e[Yh];o!==null&&o.firstChild!==null&&(o.firstChild=null)}function uf(n,e,t,r,i=!1){for(;t!==null;){if(t.type===128){t=i?t.projectionNext:t.next;continue}let o=e[t.index];o!==null&&r.push(dr(o)),Br(o)&&G2(o,r);let s=t.type;if(s&8)uf(n,e,t.child,r);else if(s&32){let a=wv(t,e),l;for(;l=a();)r.push(l)}else if(s&16){let a=fM(e,t);if(Array.isArray(a))r.push(...a);else{let l=Co(e[cr]);uf(l[Ie],l,a,r,!0)}}t=i?t.projectionNext:t.next}return r}function G2(n,e){for(let t=An;t<n.length;t++){let r=n[t],i=r[Ie].firstChild;i!==null&&uf(r[Ie],r,i,e)}n[Io]!==n[jr]&&e.push(n[Io])}var pM=[];function z2(n){return n[cn]??W2(n)}function W2(n){let e=pM.pop()??Object.create(Q2);return e.lView=n,e}function K2(n){n.lView[cn]!==n&&(n.lView=null,pM.push(n))}var Q2=pe($({},tu),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{Cf(n.lView)},consumerOnSignalRead(){this.lView[cn]=this}});function Y2(n){let e=n[cn]??Object.create(Z2);return e.lView=n,e}var Z2=pe($({},tu),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{let e=Co(n.lView);for(;e&&!gM(e[Ie]);)e=Co(e);e&&Y_(e)},consumerOnSignalRead(){this.lView[cn]=this}});function gM(n){return n.type!==2}function mM(n){if(n[Jh]===null)return;let e=!0;for(;e;){let t=!1;for(let r of n[Jh])r.dirty&&(t=!0,r.zone===null||Zone.current===r.zone?r.run():r.zone.run(()=>r.run()));e=t&&!!(n[ce]&8192)}}var J2=100;function yM(n,e=!0,t=0){let i=n[_i].rendererFactory,o=!1;o||i.begin?.();try{X2(n,t)}catch(s){throw e&&uM(n,s),s}finally{o||i.end?.()}}function X2(n,e){let t=uA();try{z0(!0),C_(n,e);let r=0;for(;If(n);){if(r===J2)throw new te(103,!1);r++,C_(n,1)}}finally{z0(t)}}function eB(n,e,t,r){if(Iu(e))return;let i=e[ce],o=!1,s=!1;J_(e);let a=!0,l=null,c=null;o||(gM(n)?(c=z2(e),l=lh(c)):s0()===null?(a=!1,c=Y2(e),l=lh(c)):e[cn]&&(vy(e[cn]),e[cn]=null));try{iA(e),QL(n.bindingStartIndex),t!==null&&eM(n,e,t,2,r);let d=(i&3)===3;if(!o)if(d){let m=n.preOrderCheckHooks;m!==null&&$h(e,m,null)}else{let m=n.preOrderHooks;m!==null&&Hh(e,m,0,null),$y(e,0)}if(s||tB(e),mM(e),_M(e,0),n.contentQueries!==null&&qA(n,e),!o)if(d){let m=n.contentCheckHooks;m!==null&&$h(e,m)}else{let m=n.contentHooks;m!==null&&Hh(e,m,1),$y(e,1)}rB(n,e);let f=n.components;f!==null&&wM(e,f,0);let g=n.viewQuery;if(g!==null&&__(2,g,r),!o)if(d){let m=n.viewCheckHooks;m!==null&&$h(e,m)}else{let m=n.viewHooks;m!==null&&Hh(e,m,2),$y(e,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),e[Uy]){for(let m of e[Uy])m();e[Uy]=null}o||(e[ce]&=-73)}catch(d){throw o||Cf(e),d}finally{c!==null&&(yy(c,l),a&&K2(c)),X_()}}function _M(n,e){for(let t=LA(n);t!==null;t=jA(t))for(let r=An;r<t.length;r++){let i=t[r];vM(i,e)}}function tB(n){for(let e=LA(n);e!==null;e=jA(e)){if(!(e[ce]&2))continue;let t=e[ef];for(let r=0;r<t.length;r++){let i=t[r];Y_(i)}}}function nB(n,e,t){let r=Ti(e,n);vM(r,t)}function vM(n,e){Q_(n)&&C_(n,e)}function C_(n,e){let r=n[Ie],i=n[ce],o=n[cn],s=!!(e===0&&i&16);if(s||=!!(i&64&&e===0),s||=!!(i&1024),s||=!!(o?.dirty&&_y(o)),s||=!1,o&&(o.dirty=!1),n[ce]&=-9217,s)eB(r,n,r.template,n[ur]);else if(i&8192){mM(n),_M(n,1);let a=r.components;a!==null&&wM(n,a,1)}}function wM(n,e,t){for(let r=0;r<e.length;r++)nB(n,e[r],t)}function rB(n,e){let t=n.hostBindingOpCodes;if(t!==null)try{for(let r=0;r<t.length;r++){let i=t[r];if(i<0)Do(~i);else{let o=i,s=t[++r],a=t[++r];JL(s,o);let l=e[o];Sn(24,l),a(2,l),Sn(25,l)}}}finally{Do(-1)}}function Dv(n,e){let t=uA()?64:1088;for(n[_i].changeDetectionScheduler?.notify(e);n;){n[ce]|=t;let r=Co(n);if(r_(n)&&!r)return n;n=r}return null}var So=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let e=this._lView,t=e[Ie];return uf(t,e,t.firstChild,[])}constructor(e,t,r=!0){this._lView=e,this._cdRefInjectingView=t,this.notifyErrorHandler=r}get context(){return this._lView[ur]}get dirty(){return!!(this._lView[ce]&9280)||!!this._lView[cn]?.dirty}set context(e){this._lView[ur]=e}get destroyed(){return Iu(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[Wt];if(Br(e)){let t=e[Xh],r=t?t.indexOf(this):-1;r>-1&&(E_(e,r),Kh(t,r))}this._attachedToViewContainer=!1}hM(this._lView[Ie],this._lView)}onDestroy(e){oA(this._lView,e)}markForCheck(){Dv(this._cdRefInjectingView||this._lView,4)}markForRefresh(){Y_(this._cdRefInjectingView||this._lView)}detach(){this._lView[ce]&=-129}reattach(){o_(this._lView),this._lView[ce]|=128}detectChanges(){this._lView[ce]|=1024,yM(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new te(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let e=r_(this._lView),t=this._lView[Xs];t!==null&&!e&&Ev(t,this._lView),cM(this._lView[Ie],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new te(902,!1);this._appRef=e;let t=r_(this._lView),r=this._lView[Xs];r!==null&&!t&&dM(r,this._lView),o_(this._lView)}},Rf=(()=>{class n{static __NG_ELEMENT_ID__=sB}return n})(),iB=Rf,oB=class extends iB{_declarationLView;_declarationTContainer;elementRef;constructor(e,t,r){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,t){return this.createEmbeddedViewImpl(e,t)}createEmbeddedViewImpl(e,t,r){let i=H2(this._declarationLView,this._declarationTContainer,e,{embeddedViewInjector:t,dehydratedView:r});return new So(i)}};function sB(){return aB(nn(),Ye())}function aB(n,e){return n.type&4?new oB(e,n,Df(n,e)):null}function xf(n,e,t,r,i){let o=n.data[e];if(o===null)o=lB(n,e,t,r,i),ZL()&&(o.flags|=32);else if(o.type&64){o.type=t,o.value=r,o.attrs=i;let s=WL();o.injectorIndex=s===null?-1:s.injectorIndex}return Du(o,!0),o}function lB(n,e,t,r,i){let o=aA(),s=lA(),a=s?o:o&&o.parent,l=n.data[e]=cB(n,a,t,e,r,i);return uB(n,l,o,s),l}function uB(n,e,t,r){n.firstChild===null&&(n.firstChild=e),t!==null&&(r?t.child==null&&e.parent!==null&&(t.child=e):t.next===null&&(t.next=e,e.prev=t))}function cB(n,e,t,r,i,o){let s=e?e.injectorIndex:-1,a=0;return qL()&&(a|=128),{type:t,index:r,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:i,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var zY=new RegExp(`^(\\d+)*(${Bj}|${jj})*(.*)`);var dB=()=>null;function dS(n,e){return dB(n,e)}var D_=class{},cf=class{},T_=class{resolveComponentFactory(e){throw Error(`No component factory found for ${zt(e)}.`)}},ia=class{static NULL=new T_},oa=class{},Ur=(()=>{class n{destroyNode=null;static __NG_ELEMENT_ID__=()=>hB()}return n})();function hB(){let n=Ye(),e=nn(),t=Ti(e.index,n);return(yi(t)?t:n)[yt]}var fB=(()=>{class n{static \u0275prov=ee({token:n,providedIn:"root",factory:()=>null})}return n})();function b_(n,e,t){let r=t?n.styles:null,i=t?n.classes:null,o=0;if(e!==null)for(let s=0;s<e.length;s++){let a=e[s];if(typeof a=="number")o=a;else if(o==1)i=L0(i,a);else if(o==2){let l=a,c=e[++s];r=L0(r,l+": "+c+";")}}t?n.styles=r:n.stylesWithoutHost=r,t?n.classes=i:n.classesWithoutHost=i}var df=class extends ia{ngModule;constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let t=Eo(e);return new yu(t,this.ngModule)}};function hS(n,e){let t=[];for(let r in n){if(!n.hasOwnProperty(r))continue;let i=n[r];if(i===void 0)continue;let o=Array.isArray(i),s=o?i[0]:i,a=o?i[1]:Ei.None;e?t.push({propName:s,templateName:r,isSignal:(a&Ei.SignalBased)!==0}):t.push({propName:s,templateName:r})}return t}function pB(n){let e=n.toLowerCase();return e==="svg"?kL:e==="math"?OL:null}function gB(n){let{attrs:e,classes:t}=e2(n),r=e;return t.length&&r.push(1,...t),r}var yu=class extends cf{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;get inputs(){let e=this.componentDef,t=e.inputTransforms,r=hS(e.inputs,!0);if(t!==null)for(let i of r)t.hasOwnProperty(i.propName)&&(i.transform=t[i.propName]);return r}get outputs(){return hS(this.componentDef.outputs,!1)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=Xj(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,r,i){let o=Ce(null);try{i=i||this.ngModule;let s=i instanceof it?i:i?.injector;s&&this.componentDef.getStandaloneInjector!==null&&(s=this.componentDef.getStandaloneInjector(s)||s);let a=s?new l_(e,s):e,l=a.get(oa,null);if(l===null)throw new te(407,!1);let c=a.get(fB,null),d=a.get(ra,null),f={rendererFactory:l,sanitizer:c,changeDetectionScheduler:d},g=l.createRenderer(null,this.componentDef),m=this.componentDef.selectors[0][0]||"div",v=r?a2(g,r,this.componentDef.encapsulation,a):YA(g,m,pB(m)),T=512;this.componentDef.signals?T|=4096:this.componentDef.onPush||(T|=16);let S=null;v!==null&&(S=fv(v,a,!0));let O=mv(0,null,null,1,0,null,null,null,null,null,null),B=Sf(null,O,null,T,null,null,f,g,a,null,S);B[Fr]=v,J_(B);let F,W=null;try{let X=this.componentDef,I,_=null;X.findHostDirectiveDefs?(I=[],_=new Map,X.findHostDirectiveDefs(X,I,_),I.push(X)):I=[X];let E=r?["ng-version","19.1.3"]:gB(this.componentDef.selectors[0]),C=xf(O,Fr,2,"#host",E);for(let D of I)C.mergedAttrs=ta(C.mergedAttrs,D.hostAttrs);C.mergedAttrs=ta(C.mergedAttrs,E),b_(C,C.mergedAttrs,!0),v&&JA(g,v,C),W=mB(C,v,X,I,B,f),t!==void 0&&_B(C,this.ngContentSelectors,t),F=yB(W,X,I,_,B,[vB]),vv(O,B,null)}catch(X){throw W!==null&&m_(W),m_(B),X}finally{X_()}let oe=rA(O,Fr);return new S_(this.componentType,F,Df(oe,B),B,oe)}finally{Ce(o)}}},S_=class extends D_{location;_rootLView;_tNode;instance;hostView;changeDetectorRef;componentType;previousInputValues=null;constructor(e,t,r,i,o){super(),this.location=r,this._rootLView=i,this._tNode=o,this.instance=t,this.hostView=this.changeDetectorRef=new So(i,void 0,!1),this.componentType=e}setInput(e,t){let r=this._tNode.inputs,i;if(r!==null&&(i=r[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;let o=this._rootLView;_v(o[Ie],o,i,e,t),this.previousInputValues.set(e,t);let s=Ti(this._tNode.index,o);Dv(s,1)}}get injector(){return new wo(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function mB(n,e,t,r,i,o){let s=i[Ie],a=null;e!==null&&(a=fv(e,i[Js]));let l=o.rendererFactory.createRenderer(e,t),c=Sf(i,rM(t),null,aM(t),i[n.index],n,o,l,null,null,a);return s.firstCreatePass&&w_(s,n,r.length-1),Af(i,c),i[n.index]=c}function yB(n,e,t,r,i,o){let s=nn(),a=i[Ie],l=Wn(s,i);oM(a,i,s,t,null,r);for(let d=0;d<t.length;d++){let f=s.directiveStart+d,g=na(i,a,f,s);bo(g,i)}sM(a,i,s),l&&bo(l,i);let c=na(i,a,s.directiveStart+s.componentOffset,s);if(n[ur]=i[ur]=c,o!==null)for(let d of o)d(c,e);return GA(a,s,i),c}function _B(n,e,t){let r=n.projection=[];for(let i=0;i<e.length;i++){let o=t[i];r.push(o!=null&&o.length?Array.from(o):null)}}function vB(){let n=nn();rv(Ye()[Ie],n)}var ua=(()=>{class n{static __NG_ELEMENT_ID__=wB}return n})();function wB(){let n=nn();return IB(n,Ye())}var EB=ua,EM=class extends EB{_lContainer;_hostTNode;_hostLView;constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return Df(this._hostTNode,this._hostLView)}get injector(){return new wo(this._hostTNode,this._hostLView)}get parentInjector(){let e=iv(this._hostTNode,this._hostLView);if(_A(e)){let t=rf(e,this._hostLView),r=nf(e),i=t[Ie].data[r+8];return new wo(i,t)}else return new wo(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let t=fS(this._lContainer);return t!==null&&t[e]||null}get length(){return this._lContainer.length-An}createEmbeddedView(e,t,r){let i,o;typeof r=="number"?i=r:r!=null&&(i=r.index,o=r.injector);let s=dS(this._lContainer,e.ssrId),a=e.createEmbeddedViewImpl(t||{},o,s);return this.insertImpl(a,i,cS(this._hostTNode,s)),a}createComponent(e,t,r,i,o){let s=e&&!RL(e),a;if(s)a=t;else{let v=t||{};a=v.index,r=v.injector,i=v.projectableNodes,o=v.environmentInjector||v.ngModuleRef}let l=s?e:new yu(Eo(e)),c=r||this.parentInjector;if(!o&&l.ngModule==null){let T=(s?c:this.parentInjector).get(it,null);T&&(o=T)}let d=Eo(l.componentType??{}),f=dS(this._lContainer,d?.id??null),g=f?.firstChild??null,m=l.create(c,i,g,o);return this.insertImpl(m.hostView,a,cS(this._hostTNode,f)),m}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,r){let i=e._lView;if(FL(i)){let a=this.indexOf(e);if(a!==-1)this.detach(a);else{let l=i[Wt],c=new EM(l,l[zn],l[Wt]);c.detach(c.indexOf(e))}}let o=this._adjustIndex(t),s=this._lContainer;return q2(s,i,o,r),e.attachToViewContainerRef(),FS(zy(s),o,e),e}move(e,t){return this.insert(e,t)}indexOf(e){let t=fS(this._lContainer);return t!==null?t.indexOf(e):-1}remove(e){let t=this._adjustIndex(e,-1),r=E_(this._lContainer,t);r&&(Kh(zy(this._lContainer),t),hM(r[Ie],r))}detach(e){let t=this._adjustIndex(e,-1),r=E_(this._lContainer,t);return r&&Kh(zy(this._lContainer),t)!=null?new So(r):null}_adjustIndex(e,t=0){return e??this.length+t}};function fS(n){return n[Xh]}function zy(n){return n[Xh]||(n[Xh]=[])}function IB(n,e){let t,r=e[n.index];return Br(r)?t=r:(t=lM(r,e,null,n),e[n.index]=t,Af(e,t)),DB(t,e,n,r),new EM(t,n,e)}function CB(n,e){let t=n[yt],r=t.createComment(""),i=Wn(e,n),o=t.parentNode(i);return lf(t,o,r,t.nextSibling(i),!1),r}var DB=SB,TB=()=>!1;function bB(n,e,t){return TB(n,e,t)}function SB(n,e,t,r){if(n[Io])return;let i;t.type&8?i=dr(r):i=CB(e,t),n[Io]=i}var Ii=class{},_u=class{};var A_=class extends Ii{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new df(this);constructor(e,t,r,i=!0){super(),this.ngModuleType=e,this._parent=t;let o=jS(e);this._bootstrapComponents=zA(o.bootstrap),this._r3Injector=SA(e,t,[{provide:Ii,useValue:this},{provide:ia,useValue:this.componentFactoryResolver},...r],zt(e),new Set(["environment"])),i&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},M_=class extends _u{moduleType;constructor(e){super(),this.moduleType=e}create(e){return new A_(this.moduleType,e,[])}};var hf=class extends Ii{injector;componentFactoryResolver=new df(this);instance=null;constructor(e){super();let t=new gu([...e.providers,{provide:Ii,useValue:this},{provide:ia,useValue:this.componentFactoryResolver}],e.parent||W_(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function Tv(n,e,t=null){return new hf({providers:n,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}var AB=(()=>{class n{_injector;cachedInjectors=new Map;constructor(t){this._injector=t}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){let r=HS(!1,t.type),i=r.length>0?Tv([r],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,i)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(let t of this.cachedInjectors.values())t!==null&&t.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=ee({token:n,providedIn:"environment",factory:()=>new n(j(it))})}return n})();function ca(n){return wu(()=>{let e=IM(n),t=pe($({},e),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===FA.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:e.standalone?i=>i.get(AB).getOrCreateStandaloneInjector(t):null,getExternalStyles:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||hr.Emulated,styles:n.styles||bn,_:null,schemas:n.schemas||null,tView:null,id:""});e.standalone&&Tf("NgStandalone"),CM(t);let r=n.dependencies;return t.directiveDefs=gS(r,!1),t.pipeDefs=gS(r,!0),t.id=xB(t),t})}function MB(n){return Eo(n)||BS(n)}function RB(n){return n!==null}function pn(n){return wu(()=>({type:n.type,bootstrap:n.bootstrap||bn,declarations:n.declarations||bn,imports:n.imports||bn,exports:n.exports||bn,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function pS(n,e){if(n==null)return Qs;let t={};for(let r in n)if(n.hasOwnProperty(r)){let i=n[r],o,s,a=Ei.None;Array.isArray(i)?(a=i[0],o=i[1],s=i[2]??o):(o=i,s=i),e?(t[o]=a!==Ei.None?[r,a]:r,e[o]=s):t[o]=r}return t}function Mt(n){return wu(()=>{let e=IM(n);return CM(e),e})}function IM(n){let e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:n.inputs||Qs,exportAs:n.exportAs||null,standalone:n.standalone??!0,signals:n.signals===!0,selectors:n.selectors||bn,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:pS(n.inputs,e),outputs:pS(n.outputs),debugInfo:null}}function CM(n){n.features?.forEach(e=>e(n))}function gS(n,e){if(!n)return null;let t=e?US:MB;return()=>(typeof n=="function"?n():n).map(r=>t(r)).filter(RB)}function xB(n){let e=0,t=typeof n.consts=="function"?"":n.consts,r=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,t,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery];for(let o of r.join("|"))e=Math.imul(31,e)+o.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function NB(n){return Object.getPrototypeOf(n.prototype).constructor}function $r(n){let e=NB(n.type),t=!0,r=[n];for(;e;){let i;if(vi(n))i=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new te(903,!1);i=e.\u0275dir}if(i){if(t){r.push(i);let s=n;s.inputs=jh(n.inputs),s.inputTransforms=jh(n.inputTransforms),s.declaredInputs=jh(n.declaredInputs),s.outputs=jh(n.outputs);let a=i.hostBindings;a&&VB(n,a);let l=i.viewQuery,c=i.contentQueries;if(l&&OB(n,l),c&&FB(n,c),PB(n,i),ZV(n.outputs,i.outputs),vi(i)&&i.data.animation){let d=n.data;d.animation=(d.animation||[]).concat(i.data.animation)}}let o=i.features;if(o)for(let s=0;s<o.length;s++){let a=o[s];a&&a.ngInherit&&a(n),a===$r&&(t=!1)}}e=Object.getPrototypeOf(e)}kB(r)}function PB(n,e){for(let t in e.inputs){if(!e.inputs.hasOwnProperty(t)||n.inputs.hasOwnProperty(t))continue;let r=e.inputs[t];if(r!==void 0&&(n.inputs[t]=r,n.declaredInputs[t]=e.declaredInputs[t],e.inputTransforms!==null)){let i=Array.isArray(r)?r[0]:r;if(!e.inputTransforms.hasOwnProperty(i))continue;n.inputTransforms??={},n.inputTransforms[i]=e.inputTransforms[i]}}}function kB(n){let e=0,t=null;for(let r=n.length-1;r>=0;r--){let i=n[r];i.hostVars=e+=i.hostVars,i.hostAttrs=ta(i.hostAttrs,t=ta(t,i.hostAttrs))}}function jh(n){return n===Qs?{}:n===bn?[]:n}function OB(n,e){let t=n.viewQuery;t?n.viewQuery=(r,i)=>{e(r,i),t(r,i)}:n.viewQuery=e}function FB(n,e){let t=n.contentQueries;t?n.contentQueries=(r,i,o)=>{e(r,i,o),t(r,i,o)}:n.contentQueries=e}function VB(n,e){let t=n.hostBindings;t?n.hostBindings=(r,i)=>{e(r,i),t(r,i)}:n.hostBindings=e}function DM(n){return jB(n)?Array.isArray(n)||!(n instanceof Map)&&Symbol.iterator in n:!1}function LB(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{let t=n[Symbol.iterator](),r;for(;!(r=t.next()).done;)e(r.value)}}function jB(n){return n!==null&&(typeof n=="function"||typeof n=="object")}function Nf(n,e,t){let r=n[e];return Object.is(r,t)?!1:(n[e]=t,!0)}function BB(n){return(n.flags&32)===32}function UB(n,e,t,r,i,o,s,a,l){let c=e.consts,d=xf(e,n,4,s||null,a||null);iM(e,t,d,tf(c,l)),rv(e,d);let f=d.tView=mv(2,d,r,i,o,e.directiveRegistry,e.pipeRegistry,null,e.schemas,c,null);return e.queries!==null&&(e.queries.template(e,d),f.queries=e.queries.embeddedTView(d)),d}function $B(n,e,t,r,i,o,s,a,l,c){let d=t+Fr,f=e.firstCreatePass?UB(d,e,n,r,i,o,s,a,l):e.data[d];Du(f,!1);let g=HB(e,n,f,t);tv()&&Iv(e,n,g,f),bo(g,n);let m=lM(g,n,g,f);return n[d]=m,Af(n,m),bB(m,f,n),K_(f)&&tM(e,n,f),l!=null&&nM(n,f,c),f}function bu(n,e,t,r,i,o,s,a){let l=Ye(),c=fn(),d=tf(c.consts,o);return $B(l,c,n,e,t,r,i,d,s,a),bu}var HB=qB;function qB(n,e,t,r){return nv(!0),e[yt].createComment("")}var bv=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();var TM=new z("");function xo(n){return!!n&&typeof n.then=="function"}function bM(n){return!!n&&typeof n.subscribe=="function"}var SM=new z("");var AM=(()=>{class n{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((t,r)=>{this.resolve=t,this.reject=r});appInits=V(SM,{optional:!0})??[];injector=V(dn);constructor(){}runInitializers(){if(this.initialized)return;let t=[];for(let i of this.appInits){let o=Mn(this.injector,i);if(xo(o))t.push(o);else if(bM(o)){let s=new Promise((a,l)=>{o.subscribe({complete:a,error:l})});t.push(s)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{r()}).catch(i=>{this.reject(i)}),t.length===0&&r(),this.initialized=!0}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),GB=(()=>{class n{static \u0275prov=ee({token:n,providedIn:"root",factory:()=>new R_})}return n})(),R_=class{queuedEffectCount=0;queues=new Map;schedule(e){this.enqueue(e)}remove(e){let t=e.zone,r=this.queues.get(t);r.has(e)&&(r.delete(e),this.queuedEffectCount--)}enqueue(e){let t=e.zone;this.queues.has(t)||this.queues.set(t,new Set);let r=this.queues.get(t);r.has(e)||(this.queuedEffectCount++,r.add(e))}flush(){for(;this.queuedEffectCount>0;)for(let[e,t]of this.queues)e===null?this.flushQueue(t):e.run(()=>this.flushQueue(t))}flushQueue(e){for(let t of e)e.delete(t),this.queuedEffectCount--,t.run()}},Sv=new z("");function zB(){g0(()=>{throw new te(600,!1)})}function WB(n){return n.isBoundToModule}var KB=10;function QB(n,e,t){try{let r=t();return xo(r)?r.catch(i=>{throw e.runOutsideAngular(()=>n.handleError(i)),i}):r}catch(r){throw e.runOutsideAngular(()=>n.handleError(r)),r}}var Ci=(()=>{class n{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=V(Mj);afterRenderManager=V($j);zonelessEnabled=V(sv);rootEffectScheduler=V(GB);dirtyFlags=0;deferredDirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new Ge;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=V(Mo).hasPendingTasks.pipe(Q(t=>!t));constructor(){V(bf,{optional:!0})}whenStable(){let t;return new Promise(r=>{t=this.isStable.subscribe({next:i=>{i&&r()}})}).finally(()=>{t.unsubscribe()})}_injector=V(it);_rendererFactory=null;get injector(){return this._injector}bootstrap(t,r){let i=t instanceof cf;if(!this._injector.get(AM).done){let g=!i&&$S(t),m=!1;throw new te(405,m)}let s;i?s=t:s=this._injector.get(ia).resolveComponentFactory(t),this.componentTypes.push(s.componentType);let a=WB(s)?void 0:this._injector.get(Ii),l=r||s.selector,c=s.create(dn.NULL,[],l,a),d=c.location.nativeElement,f=c.injector.get(TM,null);return f?.registerApplication(d),c.onDestroy(()=>{this.detachView(c.hostView),qh(this.components,c),f?.unregisterApplication(d)}),this._loadComponent(c),c}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick=()=>{if(this.tracingSnapshot!==null){let r=this.tracingSnapshot;this.tracingSnapshot=null,r.run(HA.CHANGE_DETECTION,this._tick),r.dispose();return}if(this._runningTick)throw new te(101,!1);let t=Ce(null);try{this._runningTick=!0,this.synchronize()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1,Ce(t),this.afterTick.next()}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(oa,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let t=0;for(;this.dirtyFlags!==0&&t++<KB;)this.synchronizeOnce()}synchronizeOnce(){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let t=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r,notifyErrorHandler:i}of this.allViews)YB(r,i,t,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:t})=>If(t))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(t){let r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){let r=t;qh(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(Sv,[]).forEach(i=>i(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>qh(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new te(406,!1);let t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function qh(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function YB(n,e,t,r){if(!t&&!If(n))return;yM(n,e,t&&!r?0:1)}function MM(n,e,t,r){return Nf(n,Z_(),t)?e+NS(t)+r:Ro}function Bh(n,e){return n<<17|e<<2}function Ao(n){return n>>17&32767}function ZB(n){return(n&2)==2}function JB(n,e){return n&131071|e<<17}function x_(n){return n|2}function sa(n){return(n&131068)>>2}function Wy(n,e){return n&-131069|e<<2}function XB(n){return(n&1)===1}function N_(n){return n|1}function eU(n,e,t,r,i,o){let s=o?e.classBindings:e.styleBindings,a=Ao(s),l=sa(s);n[r]=t;let c=!1,d;if(Array.isArray(t)){let f=t;d=f[1],(d===null||Eu(f,d)>0)&&(c=!0)}else d=t;if(i)if(l!==0){let g=Ao(n[a+1]);n[r+1]=Bh(g,a),g!==0&&(n[g+1]=Wy(n[g+1],r)),n[a+1]=JB(n[a+1],r)}else n[r+1]=Bh(a,0),a!==0&&(n[a+1]=Wy(n[a+1],r)),a=r;else n[r+1]=Bh(l,0),a===0?a=r:n[l+1]=Wy(n[l+1],r),l=r;c&&(n[r+1]=x_(n[r+1])),mS(n,d,r,!0),mS(n,d,r,!1),tU(e,d,n,r,o),s=Bh(a,l),o?e.classBindings=s:e.styleBindings=s}function tU(n,e,t,r,i){let o=i?n.residualClasses:n.residualStyles;o!=null&&typeof e=="string"&&Eu(o,e)>=0&&(t[r+1]=N_(t[r+1]))}function mS(n,e,t,r){let i=n[t+1],o=e===null,s=r?Ao(i):sa(i),a=!1;for(;s!==0&&(a===!1||o);){let l=n[s],c=n[s+1];nU(l,e)&&(a=!0,n[s+1]=r?N_(c):x_(c)),s=r?Ao(c):sa(c)}a&&(n[t+1]=r?x_(i):N_(i))}function nU(n,e){return n===null||e==null||(Array.isArray(n)?n[1]:n)===e?!0:Array.isArray(n)&&typeof e=="string"?Eu(n,e)>=0:!1}function Rn(n,e,t){let r=Ye(),i=Z_();if(Nf(r,i,e)){let o=fn(),s=ev();yv(o,s,r,n,e,r[yt],t,!1)}return Rn}function yS(n,e,t,r,i){let o=e.inputs,s=i?"class":"style";_v(n,t,o[s],s,r)}function Av(n,e){return rU(n,e,null,!0),Av}function rU(n,e,t,r){let i=Ye(),o=fn(),s=YL(2);if(o.firstUpdatePass&&oU(o,n,s,r),e!==Ro&&Nf(i,s,e)){let a=o.data[la()];cU(o,a,i,i[yt],n,i[s+1]=dU(e,t),r,s)}}function iU(n,e){return e>=n.expandoStartIndex}function oU(n,e,t,r){let i=n.data;if(i[t+1]===null){let o=i[la()],s=iU(n,t);hU(o,r)&&e===null&&!s&&(e=!1),e=sU(i,o,e,r),eU(i,o,e,t,s,r)}}function sU(n,e,t,r){let i=ej(n),o=r?e.residualClasses:e.residualStyles;if(i===null)(r?e.classBindings:e.styleBindings)===0&&(t=Ky(null,n,e,t,r),t=vu(t,e.attrs,r),o=null);else{let s=e.directiveStylingLast;if(s===-1||n[s]!==i)if(t=Ky(i,n,e,t,r),o===null){let l=aU(n,e,r);l!==void 0&&Array.isArray(l)&&(l=Ky(null,n,e,l[1],r),l=vu(l,e.attrs,r),lU(n,e,r,l))}else o=uU(n,e,r)}return o!==void 0&&(r?e.residualClasses=o:e.residualStyles=o),t}function aU(n,e,t){let r=t?e.classBindings:e.styleBindings;if(sa(r)!==0)return n[Ao(r)]}function lU(n,e,t,r){let i=t?e.classBindings:e.styleBindings;n[Ao(i)]=r}function uU(n,e,t){let r,i=e.directiveEnd;for(let o=1+e.directiveStylingLast;o<i;o++){let s=n[o].hostAttrs;r=vu(r,s,t)}return vu(r,e.attrs,t)}function Ky(n,e,t,r,i){let o=null,s=t.directiveEnd,a=t.directiveStylingLast;for(a===-1?a=t.directiveStart:a++;a<s&&(o=e[a],r=vu(r,o.hostAttrs,i),o!==n);)a++;return n!==null&&(t.directiveStylingLast=a),r}function vu(n,e,t){let r=t?1:2,i=-1;if(e!==null)for(let o=0;o<e.length;o++){let s=e[o];typeof s=="number"?i=s:i===r&&(Array.isArray(n)||(n=n===void 0?[]:["",n]),_L(n,s,t?!0:e[++o]))}return n===void 0?null:n}function cU(n,e,t,r,i,o,s,a){if(!(e.type&3))return;let l=n.data,c=l[a+1],d=XB(c)?_S(l,e,t,i,sa(c),s):void 0;if(!ff(d)){ff(o)||ZB(c)&&(o=_S(l,null,t,i,a,s));let f=nA(la(),t);$2(r,s,f,i,o)}}function _S(n,e,t,r,i,o){let s=e===null,a;for(;i>0;){let l=n[i],c=Array.isArray(l),d=c?l[1]:l,f=d===null,g=t[i+1];g===Ro&&(g=f?bn:void 0);let m=f?jy(g,r):d===r?g:void 0;if(c&&!ff(m)&&(m=jy(l,r)),ff(m)&&(a=m,s))return a;let v=n[i+1];i=s?Ao(v):sa(v)}if(e!==null){let l=o?e.residualClasses:e.residualStyles;l!=null&&(a=jy(l,r))}return a}function ff(n){return n!==void 0}function dU(n,e){return n==null||n===""||(typeof e=="string"?n=n+e:typeof n=="object"&&(n=zt(pv(n)))),n}function hU(n,e){return(n.flags&(e?8:16))!==0}function fU(n,e,t,r,i,o){let s=e.consts,a=tf(s,i),l=xf(e,n,2,r,a);return iM(e,t,l,tf(s,o)),l.attrs!==null&&b_(l,l.attrs,!1),l.mergedAttrs!==null&&b_(l,l.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,l),l}function Y(n,e,t,r){let i=Ye(),o=fn(),s=Fr+n,a=i[yt],l=o.firstCreatePass?fU(s,o,i,e,t,r):o.data[s],c=pU(o,i,l,a,e,n);i[s]=c;let d=K_(l);return Du(l,!0),JA(a,c,l),!BB(l)&&tv()&&Iv(o,i,c,l),UL()===0&&bo(c,i),$L(),d&&(tM(o,i,l),GA(o,l,i)),r!==null&&nM(i,l),Y}function Z(){let n=nn();lA()?KL():(n=n.parent,Du(n,!1));let e=n;GL(e)&&zL(),HL();let t=fn();return t.firstCreatePass&&(rv(t,n),ZS(n)&&t.queries.elementEnd(n)),e.classesWithoutHost!=null&&aj(e)&&yS(t,e,Ye(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&lj(e)&&yS(t,e,Ye(),e.stylesWithoutHost,!1),Z}function No(n,e,t,r){return Y(n,e,t,r),Z(),No}var pU=(n,e,t,r,i,o)=>(nv(!0),YA(r,i,rj()));var pf="en-US";var gU=pf;function mU(n){typeof n=="string"&&(gU=n.toLowerCase().replace(/_/g,"-"))}var yU=(n,e,t)=>{};function xn(n,e,t,r){let i=Ye(),o=fn(),s=nn();return RM(o,i,i[yt],s,n,e,r),xn}function _U(n,e,t,r){let i=n.cleanup;if(i!=null)for(let o=0;o<i.length-1;o+=2){let s=i[o];if(s===t&&i[o+1]===r){let a=e[Zh],l=i[o+2];return a.length>l?a[l]:null}typeof s=="string"&&(o+=2)}return null}function RM(n,e,t,r,i,o,s){let a=K_(r),c=n.firstCreatePass&&BL(n),d=e[ur],f=jL(e),g=!0;if(r.type&3||s){let T=Wn(r,e),S=s?s(T):T,O=f.length,B=s?W=>s(dr(W[r.index])):r.index,F=null;if(!s&&a&&(F=_U(n,e,i,r.index)),F!==null){let W=F.__ngLastListenerFn__||F;W.__ngNextListenerFn__=o,F.__ngLastListenerFn__=o,g=!1}else{o=wS(r,e,d,o),yU(T,i,o);let W=t.listen(S,i,o);f.push(o,W),c&&c.push(i,B,O,O+1)}}else o=wS(r,e,d,o);let m=r.outputs,v;if(g&&m!==null&&(v=m[i])){let T=v.length;if(T)for(let S=0;S<T;S+=2){let O=v[S],B=v[S+1],oe=e[O][B].subscribe(o),X=f.length;f.push(o,oe),c&&c.push(i,r.index,X,-(X+1))}}}function vS(n,e,t,r){let i=Ce(null);try{return Sn(6,e,t),t(r)!==!1}catch(o){return uM(n,o),!1}finally{Sn(7,e,t),Ce(i)}}function wS(n,e,t,r){return function i(o){if(o===Function)return r;let s=n.componentOffset>-1?Ti(n.index,e):e;Dv(s,5);let a=vS(e,t,r,o),l=i.__ngNextListenerFn__;for(;l;)a=vS(e,t,l,o)&&a,l=l.__ngNextListenerFn__;return a}}function Mv(n=1){return nj(n)}function Rv(n,e,t,r,i){let o=Ye(),s=MM(o,e,t,r);if(s!==Ro){let a=fn(),l=ev();yv(a,l,o,n,s,o[yt],i,!1)}return Rv}function ie(n,e=""){let t=Ye(),r=fn(),i=n+Fr,o=r.firstCreatePass?xf(r,i,1,e,null):r.data[i],s=vU(r,t,o,e,n);t[i]=s,tv()&&Iv(r,t,s,o),Du(o,!1)}var vU=(n,e,t,r,i)=>(nv(!0),t2(e[yt],r));function Si(n){return Kt("",n,""),Si}function Kt(n,e,t){let r=Ye(),i=MM(r,n,e,t);return i!==Ro&&wU(r,la(),i),Kt}function wU(n,e,t){let r=nA(e,n);n2(n[yt],r,t)}function Po(n,e,t){kA(e)&&(e=e());let r=Ye(),i=Z_();if(Nf(r,i,e)){let o=fn(),s=ev();yv(o,s,r,n,e,r[yt],t,!1)}return Po}function da(n,e){let t=kA(n);return t&&n.set(e),t}function ko(n,e){let t=Ye(),r=fn(),i=nn();return RM(r,t,t[yt],i,n,e),ko}function EU(n,e,t){let r=fn();if(r.firstCreatePass){let i=vi(n);P_(t,r.data,r.blueprint,i,!0),P_(e,r.data,r.blueprint,i,!1)}}function P_(n,e,t,r,i){if(n=Gt(n),Array.isArray(n))for(let o=0;o<n.length;o++)P_(n[o],e,t,r,i);else{let o=fn(),s=Ye(),a=nn(),l=Zs(n)?n:Gt(n.provide),c=zS(n),d=a.providerIndexes&1048575,f=a.directiveStart,g=a.providerIndexes>>20;if(Zs(n)||!n.multi){let m=new To(c,i,Me),v=Yy(l,e,i?d:d+g,f);v===-1?(c_(of(a,s),o,l),Qy(o,n,e.length),e.push(l),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),t.push(m),s.push(m)):(t[v]=m,s[v]=m)}else{let m=Yy(l,e,d+g,f),v=Yy(l,e,d,d+g),T=m>=0&&t[m],S=v>=0&&t[v];if(i&&!S||!i&&!T){c_(of(a,s),o,l);let O=DU(i?CU:IU,t.length,i,r,c);!i&&S&&(t[v].providerFactory=O),Qy(o,n,e.length,0),e.push(l),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),t.push(O),s.push(O)}else{let O=xM(t[i?v:m],c,!i&&r);Qy(o,n,m>-1?m:v,O)}!i&&r&&S&&t[v].componentProviders++}}}function Qy(n,e,t,r){let i=Zs(e),o=CL(e);if(i||o){let l=(o?Gt(e.useClass):e).prototype.ngOnDestroy;if(l){let c=n.destroyHooks||(n.destroyHooks=[]);if(!i&&e.multi){let d=c.indexOf(t);d===-1?c.push(t,[r,l]):c[d+1].push(r,l)}else c.push(t,l)}}}function xM(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function Yy(n,e,t,r){for(let i=t;i<r;i++)if(e[i]===n)return i;return-1}function IU(n,e,t,r){return k_(this.multi,[])}function CU(n,e,t,r){let i=this.multi,o;if(this.providerFactory){let s=this.providerFactory.componentProviders,a=na(t,t[Ie],this.providerFactory.index,r);o=a.slice(0,s),k_(i,o);for(let l=s;l<a.length;l++)o.push(a[l])}else o=[],k_(i,o);return o}function k_(n,e){for(let t=0;t<n.length;t++){let r=n[t];e.push(r())}return e}function DU(n,e,t,r,i){let o=new To(n,t,Me);return o.multi=[],o.index=e,o.componentProviders=0,xM(o,i,r&&!t),o}function ha(n,e=[]){return t=>{t.providersResolver=(r,i)=>EU(r,i?i(n):n,e)}}var Lr=class{full;major;minor;patch;constructor(e){this.full=e;let t=e.split(".");this.major=t[0],this.minor=t[1],this.patch=t.slice(2).join(".")}},NM=new Lr("19.1.3"),O_=class{ngModuleFactory;componentFactories;constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}},xv=(()=>{class n{compileModuleSync(t){return new M_(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){let r=this.compileModuleSync(t),i=jS(t),o=zA(i.declarations).reduce((s,a)=>{let l=Eo(a);return l&&s.push(new yu(l)),s},[]);return new O_(r,o)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var TU=(()=>{class n{zone=V(De);changeDetectionScheduler=V(ra);applicationRef=V(Ci);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function bU({ngZoneFactory:n,ignoreChangesOutsideZone:e,scheduleInRootZone:t}){return n??=()=>new De(pe($({},SU()),{scheduleInRootZone:t})),[{provide:De,useFactory:n},{provide:Ys,multi:!0,useFactory:()=>{let r=V(TU,{optional:!0});return()=>r.initialize()}},{provide:Ys,multi:!0,useFactory:()=>{let r=V(AU);return()=>{r.initialize()}}},e===!0?{provide:MA,useValue:!0}:[],{provide:RA,useValue:t??AA}]}function SU(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var AU=(()=>{class n{subscription=new tt;initialized=!1;zone=V(De);pendingTasks=V(Mo);initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{De.assertNotInAngularZone(),queueMicrotask(()=>{t!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{De.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var MU=(()=>{class n{appRef=V(Ci);taskService=V(Mo);ngZone=V(De);zonelessEnabled=V(sv);tracing=V(bf,{optional:!0});disableScheduling=V(MA,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new tt;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(af):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(V(RA,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof g_||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&t===5)return;let r=!1;switch(t){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 8:{this.appRef.deferredDirtyFlags|=8;break}case 6:{this.appRef.dirtyFlags|=2,r=!0;break}case 13:{this.appRef.dirtyFlags|=16,r=!0;break}case 14:{this.appRef.dirtyFlags|=2,r=!0;break}case 12:{r=!0;break}case 10:case 9:case 7:case 11:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(r))return;let i=this.useMicrotaskScheduler?X0:xA;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>i(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>i(()=>this.tick()))}shouldScheduleTick(t){return!(this.disableScheduling&&!t||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(af+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(r){throw this.taskService.remove(t),r}finally{this.cleanup()}this.useMicrotaskScheduler=!0,X0(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function RU(){return typeof $localize<"u"&&$localize.locale||pf}var Nv=new z("",{providedIn:"root",factory:()=>V(Nv,me.Optional|me.SkipSelf)||RU()});var F_=new z(""),xU=new z("");function cu(n){return!n.moduleRef}function NU(n){let e=cu(n)?n.r3Injector:n.moduleRef.injector,t=e.get(De);return t.run(()=>{cu(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();let r=e.get(wi,null),i;if(t.runOutsideAngular(()=>{i=t.onError.subscribe({next:o=>{r.handleError(o)}})}),cu(n)){let o=()=>e.destroy(),s=n.platformInjector.get(F_);s.add(o),e.onDestroy(()=>{i.unsubscribe(),s.delete(o)})}else{let o=()=>n.moduleRef.destroy(),s=n.platformInjector.get(F_);s.add(o),n.moduleRef.onDestroy(()=>{qh(n.allPlatformModules,n.moduleRef),i.unsubscribe(),s.delete(o)})}return QB(r,t,()=>{let o=e.get(AM);return o.runInitializers(),o.donePromise.then(()=>{let s=e.get(Nv,pf);if(mU(s||pf),!e.get(xU,!0))return cu(n)?e.get(Ci):(n.allPlatformModules.push(n.moduleRef),n.moduleRef);if(cu(n)){let l=e.get(Ci);return n.rootComponent!==void 0&&l.bootstrap(n.rootComponent),l}else return PU(n.moduleRef,n.allPlatformModules),n.moduleRef})})})}function PU(n,e){let t=n.injector.get(Ci);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(r=>t.bootstrap(r));else if(n.instance.ngDoBootstrap)n.instance.ngDoBootstrap(t);else throw new te(-403,!1);e.push(n)}var Gh=null;function kU(n=[],e){return dn.create({name:e,providers:[{provide:vf,useValue:"platform"},{provide:F_,useValue:new Set([()=>Gh=null])},...n]})}function OU(n=[]){if(Gh)return Gh;let e=kU(n);return Gh=e,zB(),FU(e),e}function FU(n){let e=n.get(dv,null);Mn(n,()=>{e?.forEach(t=>t())})}function Su(){return!1}var Oo=(()=>{class n{static __NG_ELEMENT_ID__=VU}return n})();function VU(n){return LU(nn(),Ye(),(n&16)===16)}function LU(n,e,t){if(Ef(n)&&!t){let r=Ti(n.index,e);return new So(r,r)}else if(n.type&175){let r=e[cr];return new So(r,e)}return null}var V_=class{constructor(){}supports(e){return DM(e)}create(e){return new L_(e)}},jU=(n,e)=>e,L_=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(e){this._trackByFn=e||jU}forEachItem(e){let t;for(t=this._itHead;t!==null;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,r=this._removalsHead,i=0,o=null;for(;t||r;){let s=!r||t&&t.currentIndex<ES(r,i,o)?t:r,a=ES(s,i,o),l=s.currentIndex;if(s===r)i--,r=r._nextRemoved;else if(t=t._next,s.previousIndex==null)i++;else{o||(o=[]);let c=a-i,d=l-i;if(c!=d){for(let g=0;g<c;g++){let m=g<o.length?o[g]:o[g]=0,v=m+g;d<=v&&v<c&&(o[g]=m+1)}let f=s.previousIndex;o[f]=d-c}}a!==l&&e(s,a,l)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;t!==null;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;t!==null;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;t!==null;t=t._nextIdentityChange)e(t)}diff(e){if(e==null&&(e=[]),!DM(e))throw new te(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._itHead,r=!1,i,o,s;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)o=e[a],s=this._trackByFn(a,o),t===null||!Object.is(t.trackById,s)?(t=this._mismatch(t,o,s,a),r=!0):(r&&(t=this._verifyReinsertion(t,o,s,a)),Object.is(t.item,o)||this._addIdentityChange(t,o)),t=t._next}else i=0,LB(e,a=>{s=this._trackByFn(i,a),t===null||!Object.is(t.trackById,s)?(t=this._mismatch(t,a,s,i),r=!0):(r&&(t=this._verifyReinsertion(t,a,s,i)),Object.is(t.item,a)||this._addIdentityChange(t,a)),t=t._next,i++}),this.length=i;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;e!==null;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;e!==null;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,r,i){let o;return e===null?o=this._itTail:(o=e._prev,this._remove(e)),e=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,o,i)):(e=this._linkedRecords===null?null:this._linkedRecords.get(r,i),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,o,i)):e=this._addAfter(new j_(t,r),o,i)),e}_verifyReinsertion(e,t,r,i){let o=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null);return o!==null?e=this._reinsertAfter(o,e._prev,i):e.currentIndex!=i&&(e.currentIndex=i,this._addToMoves(e,i)),e}_truncate(e){for(;e!==null;){let t=e._next;this._addToRemovals(this._unlink(e)),e=t}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,r){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(e);let i=e._prevRemoved,o=e._nextRemoved;return i===null?this._removalsHead=o:i._nextRemoved=o,o===null?this._removalsTail=i:o._prevRemoved=i,this._insertAfter(e,t,r),this._addToMoves(e,r),e}_moveAfter(e,t,r){return this._unlink(e),this._insertAfter(e,t,r),this._addToMoves(e,r),e}_addAfter(e,t,r){return this._insertAfter(e,t,r),this._additionsTail===null?this._additionsTail=this._additionsHead=e:this._additionsTail=this._additionsTail._nextAdded=e,e}_insertAfter(e,t,r){let i=t===null?this._itHead:t._next;return e._next=i,e._prev=t,i===null?this._itTail=e:i._prev=e,t===null?this._itHead=e:t._next=e,this._linkedRecords===null&&(this._linkedRecords=new gf),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){this._linkedRecords!==null&&this._linkedRecords.remove(e);let t=e._prev,r=e._next;return t===null?this._itHead=r:t._next=r,r===null?this._itTail=t:r._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail===null?this._movesTail=this._movesHead=e:this._movesTail=this._movesTail._nextMoved=e),e}_addToRemovals(e){return this._unlinkedRecords===null&&(this._unlinkedRecords=new gf),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=e:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=e,e}},j_=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(e,t){this.item=e,this.trackById=t}},B_=class{_head=null;_tail=null;add(e){this._head===null?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let r;for(r=this._head;r!==null;r=r._nextDup)if((t===null||t<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){let t=e._prevDup,r=e._nextDup;return t===null?this._head=r:t._nextDup=r,r===null?this._tail=t:r._prevDup=t,this._head===null}},gf=class{map=new Map;put(e){let t=e.trackById,r=this.map.get(t);r||(r=new B_,this.map.set(t,r)),r.add(e)}get(e,t){let r=e,i=this.map.get(r);return i?i.get(e,t):null}remove(e){let t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function ES(n,e,t){let r=n.previousIndex;if(r===null)return r;let i=0;return t&&r<t.length&&(i=t[r]),r+e+i}function IS(){return new Pv([new V_])}var Pv=(()=>{class n{factories;static \u0275prov=ee({token:n,providedIn:"root",factory:IS});constructor(t){this.factories=t}static create(t,r){if(r!=null){let i=r.factories.slice();t=t.concat(i)}return new n(t)}static extend(t){return{provide:n,useFactory:r=>n.create(t,r||IS()),deps:[[n,new mL,new _f]]}}find(t){let r=this.factories.find(i=>i.supports(t));if(r!=null)return r;throw new te(901,!1)}}return n})();function PM(n){try{let{rootComponent:e,appProviders:t,platformProviders:r}=n,i=OU(r),o=[bU({}),{provide:ra,useExisting:MU},...t||[]],s=new hf({providers:o,parent:i,debugName:"",runEnvironmentInitializers:!1});return NU({r3Injector:s.injector,platformInjector:i,rootComponent:e})}catch(e){return Promise.reject(e)}}function Pf(n){return typeof n=="boolean"?n:n!=null&&n!=="false"}function Au(n,e){Tf("NgSignals");let t=h0(n);return e?.equal&&(t[un].equal=e.equal),t}function Hr(n){let e=Ce(null);try{return n()}finally{Ce(e)}}var CS=class{[un];constructor(e){this[un]=e}destroy(){this[un].destroy()}};var jM=null;function qr(){return jM}function BM(n){jM??=n}var kf=class{};var Pn=new z(""),UM=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:()=>V($U),providedIn:"platform"})}return n})();var $U=(()=>{class n extends UM{_location;_history;_doc=V(Pn);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return qr().getBaseHref(this._doc)}onPopState(t){let r=qr().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){let r=qr().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,i){this._history.pushState(t,r,i)}replaceState(t,r,i){this._history.replaceState(t,r,i)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function $M(n,e){if(n.length==0)return e;if(e.length==0)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,t==2?n+e.substring(1):t==1?n+e:n+"/"+e}function kM(n){let e=n.match(/#|\?|$/),t=e&&e.index||n.length,r=t-(n[t-1]==="/"?1:0);return n.slice(0,r)+n.slice(t)}function Fo(n){return n&&n[0]!=="?"?"?"+n:n}var Ff=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:()=>V(HM),providedIn:"root"})}return n})(),HU=new z(""),HM=(()=>{class n extends Ff{_platformLocation;_baseHref;_removeListenerFns=[];constructor(t,r){super(),this._platformLocation=t,this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??V(Pn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return $M(this._baseHref,t)}path(t=!1){let r=this._platformLocation.pathname+Fo(this._platformLocation.search),i=this._platformLocation.hash;return i&&t?`${r}${i}`:r}pushState(t,r,i,o){let s=this.prepareExternalUrl(i+Fo(o));this._platformLocation.pushState(t,r,s)}replaceState(t,r,i,o){let s=this.prepareExternalUrl(i+Fo(o));this._platformLocation.replaceState(t,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(r){return new(r||n)(j(UM),j(HU,8))};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Mu=(()=>{class n{_subject=new Ge;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(t){this._locationStrategy=t;let r=this._locationStrategy.getBaseHref();this._basePath=zU(kM(OM(r))),this._locationStrategy.onPopState(i=>{this._subject.next({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+Fo(r))}normalize(t){return n.stripTrailingSlash(GU(this._basePath,OM(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",i=null){this._locationStrategy.pushState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Fo(r)),i)}replaceState(t,r="",i=null){this._locationStrategy.replaceState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Fo(r)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(i=>i(t,r))}subscribe(t,r,i){return this._subject.subscribe({next:t,error:r??void 0,complete:i??void 0})}static normalizeQueryParams=Fo;static joinWithSlash=$M;static stripTrailingSlash=kM;static \u0275fac=function(r){return new(r||n)(j(Ff))};static \u0275prov=ee({token:n,factory:()=>qU(),providedIn:"root"})}return n})();function qU(){return new Mu(j(Ff))}function GU(n,e){if(!n||!e.startsWith(n))return e;let t=e.substring(n.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function OM(n){return n.replace(/\/index.html$/,"")}function zU(n){if(new RegExp("^(https?:)?//").test(n)){let[,t]=n.split(/\/\/[^\/]+/);return t}return n}function qM(n,e){e=encodeURIComponent(e);for(let t of n.split(";")){let r=t.indexOf("="),[i,o]=r==-1?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===e)return decodeURIComponent(o)}return null}var kv=/\s+/,FM=[],GM=(()=>{class n{_ngEl;_renderer;initialClasses=FM;rawClass;stateMap=new Map;constructor(t,r){this._ngEl=t,this._renderer=r}set klass(t){this.initialClasses=t!=null?t.trim().split(kv):FM}set ngClass(t){this.rawClass=typeof t=="string"?t.trim().split(kv):t}ngDoCheck(){for(let r of this.initialClasses)this._updateState(r,!0);let t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(let r of t)this._updateState(r,!0);else if(t!=null)for(let r of Object.keys(t))this._updateState(r,!!t[r]);this._applyStateDiff()}_updateState(t,r){let i=this.stateMap.get(t);i!==void 0?(i.enabled!==r&&(i.changed=!0,i.enabled=r),i.touched=!0):this.stateMap.set(t,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(let t of this.stateMap){let r=t[0],i=t[1];i.changed?(this._toggleClass(r,i.enabled),i.changed=!1):i.touched||(i.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),i.touched=!1}}_toggleClass(t,r){t=t.trim(),t.length>0&&t.split(kv).forEach(i=>{r?this._renderer.addClass(this._ngEl.nativeElement,i):this._renderer.removeClass(this._ngEl.nativeElement,i)})}static \u0275fac=function(r){return new(r||n)(Me(fr),Me(Ur))};static \u0275dir=Mt({type:n,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return n})();var Ov=class{$implicit;ngForOf;index;count;constructor(e,t,r,i){this.$implicit=e,this.ngForOf=t,this.index=r,this.count=i}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},zM=(()=>{class n{_viewContainer;_template;_differs;set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(t,r,i){this._viewContainer=t,this._template=r,this._differs=i}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){let t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){let r=this._viewContainer;t.forEachOperation((i,o,s)=>{if(i.previousIndex==null)r.createEmbeddedView(this._template,new Ov(i.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)r.remove(o===null?void 0:o);else if(o!==null){let a=r.get(o);r.move(a,s),VM(a,i)}});for(let i=0,o=r.length;i<o;i++){let a=r.get(i).context;a.index=i,a.count=o,a.ngForOf=this._ngForOf}t.forEachIdentityChange(i=>{let o=r.get(i.currentIndex);VM(o,i)})}static ngTemplateContextGuard(t,r){return!0}static \u0275fac=function(r){return new(r||n)(Me(ua),Me(Rf),Me(Pv))};static \u0275dir=Mt({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return n})();function VM(n,e){n.context.$implicit=e.item}var WM=(()=>{class n{_viewContainer;_context=new Fv;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(t,r){this._viewContainer=t,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){LM("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){LM("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(t,r){return!0}static \u0275fac=function(r){return new(r||n)(Me(ua),Me(Rf))};static \u0275dir=Mt({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return n})(),Fv=class{$implicit=null;ngIf=null};function LM(n,e){if(!!!(!e||e.createEmbeddedView))throw new Error(`${n} must be a TemplateRef, but received '${zt(e)}'.`)}var Ru=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=pn({type:n});static \u0275inj=hn({})}return n})(),KM="browser",WU="server";function Vo(n){return n===WU}var Of=class{};var Lv=class extends kf{supportsDOMEvents=!0},jv=class n extends Lv{static makeCurrent(){BM(new n)}onAndCancel(e,t,r,i){return e.addEventListener(t,r,i),()=>{e.removeEventListener(t,r,i)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=QU();return t==null?null:YU(t)}resetBaseElement(){xu=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return qM(document.cookie,e)}},xu=null;function QU(){return xu=xu||document.querySelector("base"),xu?xu.getAttribute("href"):null}function YU(n){return new URL(n,document.baseURI).pathname}var ZU=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac})}return n})(),Bv=new z(""),eR=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,r){this._zone=r,t.forEach(i=>{i.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,i,o){return this._findPluginFor(r).addEventListener(t,r,i,o)}getZone(){return this._zone}_findPluginFor(t){let r=this._eventNameToPlugin.get(t);if(r)return r;if(r=this._plugins.find(o=>o.supports(t)),!r)throw new te(5101,!1);return this._eventNameToPlugin.set(t,r),r}static \u0275fac=function(r){return new(r||n)(j(Bv),j(De))};static \u0275prov=ee({token:n,factory:n.\u0275fac})}return n})(),Lf=class{_doc;constructor(e){this._doc=e}manager},Vf="ng-app-id";function QM(n){for(let e of n)e.remove()}function YM(n,e){let t=e.createElement("style");return t.textContent=n,t}function JU(n,e,t,r){let i=n.head?.querySelectorAll(`style[${Vf}="${e}"],link[${Vf}="${e}"]`);if(i)for(let o of i)o.removeAttribute(Vf),o instanceof HTMLLinkElement?r.set(o.href.slice(o.href.lastIndexOf("/")+1),{usage:0,elements:[o]}):o.textContent&&t.set(o.textContent,{usage:0,elements:[o]})}function Uv(n,e){let t=e.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",n),t}var tR=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(t,r,i,o={}){this.doc=t,this.appId=r,this.nonce=i,this.isServer=Vo(o),JU(t,r,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,r){for(let i of t)this.addUsage(i,this.inline,YM);r?.forEach(i=>this.addUsage(i,this.external,Uv))}removeStyles(t,r){for(let i of t)this.removeUsage(i,this.inline);r?.forEach(i=>this.removeUsage(i,this.external))}addUsage(t,r,i){let o=r.get(t);o?o.usage++:r.set(t,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,i(t,this.doc)))})}removeUsage(t,r){let i=r.get(t);i&&(i.usage--,i.usage<=0&&(QM(i.elements),r.delete(t)))}ngOnDestroy(){for(let[,{elements:t}]of[...this.inline,...this.external])QM(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(let[r,{elements:i}]of this.inline)i.push(this.addElement(t,YM(r,this.doc)));for(let[r,{elements:i}]of this.external)i.push(this.addElement(t,Uv(r,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,r){return this.nonce&&r.setAttribute("nonce",this.nonce),this.isServer&&r.setAttribute(Vf,this.appId),t.appendChild(r)}static \u0275fac=function(r){return new(r||n)(j(Pn),j(cv),j(hv,8),j(rn))};static \u0275prov=ee({token:n,factory:n.\u0275fac})}return n})(),Vv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},Hv=/%COMP%/g,nR="%COMP%",XU=`_nghost-${nR}`,e$=`_ngcontent-${nR}`,t$=!0,n$=new z("",{providedIn:"root",factory:()=>t$});function r$(n){return e$.replace(Hv,n)}function i$(n){return XU.replace(Hv,n)}function rR(n,e){return e.map(t=>t.replace(Hv,n))}var ZM=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(t,r,i,o,s,a,l,c=null,d=null){this.eventManager=t,this.sharedStylesHost=r,this.appId=i,this.removeStylesOnCompDestroy=o,this.doc=s,this.platformId=a,this.ngZone=l,this.nonce=c,this.tracingService=d,this.platformIsServer=Vo(a),this.defaultRenderer=new Nu(t,s,l,this.platformIsServer,this.tracingService)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===hr.ShadowDom&&(r=pe($({},r),{encapsulation:hr.Emulated}));let i=this.getOrCreateRenderer(t,r);return i instanceof jf?i.applyToHost(t):i instanceof Pu&&i.applyStyles(),i}getOrCreateRenderer(t,r){let i=this.rendererByCompId,o=i.get(r.id);if(!o){let s=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,d=this.removeStylesOnCompDestroy,f=this.platformIsServer;switch(r.encapsulation){case hr.Emulated:o=new jf(l,c,r,this.appId,d,s,a,f,this.tracingService);break;case hr.ShadowDom:return new $v(l,c,t,r,s,a,this.nonce,f,this.tracingService);default:o=new Pu(l,c,r,d,s,a,f,this.tracingService);break}i.set(r.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(r){return new(r||n)(j(eR),j(tR),j(cv),j(n$),j(Pn),j(rn),j(De),j(hv),j(bf,8))};static \u0275prov=ee({token:n,factory:n.\u0275fac})}return n})(),Nu=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,t,r,i,o){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.tracingService=o}destroy(){}destroyNode=null;createElement(e,t){return t?this.doc.createElementNS(Vv[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(JM(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(JM(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){t.remove()}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new te(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let o=Vv[i];o?e.setAttributeNS(o,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=Vv[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(Vr.DashCase|Vr.Important)?e.style.setProperty(t,r,i&Vr.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&Vr.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r,i){if(typeof e=="string"&&(e=qr().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);let o=this.decoratePreventDefault(r);return this.tracingService!==null&&this.tracingService.wrapEventListener&&(o=this.tracingService.wrapEventListener(e,t,o)),this.eventManager.addEventListener(e,t,o,i)}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function JM(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var $v=class extends Nu{sharedStylesHost;hostEl;shadowRoot;constructor(e,t,r,i,o,s,a,l,c){super(e,o,s,l,c),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let d=rR(i.id,i.styles);for(let g of d){let m=document.createElement("style");a&&m.setAttribute("nonce",a),m.textContent=g,this.shadowRoot.appendChild(m)}let f=i.getExternalStyles?.();if(f)for(let g of f){let m=Uv(g,o);a&&m.setAttribute("nonce",a),this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Pu=class extends Nu{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(e,t,r,i,o,s,a,l,c){super(e,o,s,a,l),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=c?rR(c,r.styles):r.styles,this.styleUrls=r.getExternalStyles?.(c)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},jf=class extends Pu{contentAttr;hostAttr;constructor(e,t,r,i,o,s,a,l,c){let d=i+"-"+r.id;super(e,t,r,o,s,a,l,c,d),this.contentAttr=r$(d),this.hostAttr=i$(d)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},o$=(()=>{class n extends Lf{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,i,o){return t.addEventListener(r,i,o),()=>this.removeEventListener(t,r,i,o)}removeEventListener(t,r,i,o){return t.removeEventListener(r,i,o)}static \u0275fac=function(r){return new(r||n)(j(Pn))};static \u0275prov=ee({token:n,factory:n.\u0275fac})}return n})(),XM=["alt","control","meta","shift"],s$={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},a$={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},l$=(()=>{class n extends Lf{constructor(t){super(t)}supports(t){return n.parseEventName(t)!=null}addEventListener(t,r,i,o){let s=n.parseEventName(r),a=n.eventCallback(s.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>qr().onAndCancel(t,s.domEventName,a,o))}static parseEventName(t){let r=t.toLowerCase().split("."),i=r.shift();if(r.length===0||!(i==="keydown"||i==="keyup"))return null;let o=n._normalizeKey(r.pop()),s="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),s="code."),XM.forEach(c=>{let d=r.indexOf(c);d>-1&&(r.splice(d,1),s+=c+".")}),s+=o,r.length!=0||o.length===0)return null;let l={};return l.domEventName=i,l.fullKey=s,l}static matchEventFullKeyCode(t,r){let i=s$[t.key]||t.key,o="";return r.indexOf("code.")>-1&&(i=t.code,o="code."),i==null||!i?!1:(i=i.toLowerCase(),i===" "?i="space":i==="."&&(i="dot"),XM.forEach(s=>{if(s!==i){let a=a$[s];a(t)&&(o+=s+".")}}),o+=i,o===r)}static eventCallback(t,r,i){return o=>{n.matchEventFullKeyCode(o,t)&&i.runGuarded(()=>r(o))}}static _normalizeKey(t){return t==="esc"?"escape":t}static \u0275fac=function(r){return new(r||n)(j(Pn))};static \u0275prov=ee({token:n,factory:n.\u0275fac})}return n})();function iR(n,e){return PM($({rootComponent:n},u$(e)))}function u$(n){return{appProviders:[...p$,...n?.providers??[]],platformProviders:f$}}function c$(){jv.makeCurrent()}function d$(){return new wi}function h$(){return UA(document),document}var f$=[{provide:rn,useValue:KM},{provide:dv,useValue:c$,multi:!0},{provide:Pn,useFactory:h$,deps:[]}];var p$=[{provide:vf,useValue:"root"},{provide:wi,useFactory:d$,deps:[]},{provide:Bv,useClass:o$,multi:!0,deps:[Pn,De,rn]},{provide:Bv,useClass:l$,multi:!0,deps:[Pn]},ZM,tR,eR,{provide:oa,useExisting:ZM},{provide:Of,useClass:ZU,deps:[]},[]];var oR=(()=>{class n{_doc;constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static \u0275fac=function(r){return new(r||n)(j(Pn))};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var ge="primary",Qu=Symbol("RouteTitle"),Kv=class{params;constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function _a(n){return new Kv(n)}function y$(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let o=0;o<r.length;o++){let s=r[o],a=n[o];if(s[0]===":")i[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function _$(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!pr(n[t],e[t]))return!1;return!0}function pr(n,e){let t=n?Qv(n):void 0,r=e?Qv(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let o=0;o<t.length;o++)if(i=t[o],!fR(n[i],e[i]))return!1;return!0}function Qv(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function fR(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,o)=>r[o]===i)}else return n===e}function pR(n){return n.length>0?n[n.length-1]:null}function Ai(n){return Ny(n)?n:xo(n)?ke(Promise.resolve(n)):ne(n)}var v$={exact:mR,subset:yR},gR={exact:w$,subset:E$,ignored:()=>!0};function sR(n,e,t){return v$[t.paths](n.root,e.root,t.matrixParams)&&gR[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function w$(n,e){return pr(n,e)}function mR(n,e,t){if(!jo(n.segments,e.segments)||!$f(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!mR(n.children[r],e.children[r],t))return!1;return!0}function E$(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>fR(n[t],e[t]))}function yR(n,e,t){return _R(n,e,e.segments,t)}function _R(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!jo(i,t)||e.hasChildren()||!$f(i,t,r))}else if(n.segments.length===t.length){if(!jo(n.segments,t)||!$f(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!yR(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),o=t.slice(n.segments.length);return!jo(n.segments,i)||!$f(n.segments,i,r)||!n.children[ge]?!1:_R(n.children[ge],e,o,r)}}function $f(n,e,t){return e.every((r,i)=>gR[t](n[i].parameters,r.parameters))}var zr=class{root;queryParams;fragment;_queryParamMap;constructor(e=new Oe([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=_a(this.queryParams),this._queryParamMap}toString(){return D$.serialize(this)}},Oe=class{segments;children;parent=null;constructor(e,t){this.segments=e,this.children=t,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Hf(this)}},Lo=class{path;parameters;_parameterMap;constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=_a(this.parameters),this._parameterMap}toString(){return wR(this)}};function I$(n,e){return jo(n,e)&&n.every((t,r)=>pr(t.parameters,e[r].parameters))}function jo(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function C$(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===ge&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==ge&&(t=t.concat(e(i,r)))}),t}var Ew=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:()=>new ju,providedIn:"root"})}return n})(),ju=class{parse(e){let t=new Zv(e);return new zr(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${ku(e.root,!0)}`,r=S$(e.queryParams),i=typeof e.fragment=="string"?`#${T$(e.fragment)}`:"";return`${t}${r}${i}`}},D$=new ju;function Hf(n){return n.segments.map(e=>wR(e)).join("/")}function ku(n,e){if(!n.hasChildren())return Hf(n);if(e){let t=n.children[ge]?ku(n.children[ge],!1):"",r=[];return Object.entries(n.children).forEach(([i,o])=>{i!==ge&&r.push(`${i}:${ku(o,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=C$(n,(r,i)=>i===ge?[ku(n.children[ge],!1)]:[`${i}:${ku(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[ge]!=null?`${Hf(n)}/${t[0]}`:`${Hf(n)}/(${t.join("//")})`}}function vR(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Bf(n){return vR(n).replace(/%3B/gi,";")}function T$(n){return encodeURI(n)}function Yv(n){return vR(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function qf(n){return decodeURIComponent(n)}function aR(n){return qf(n.replace(/\+/g,"%20"))}function wR(n){return`${Yv(n.path)}${b$(n.parameters)}`}function b$(n){return Object.entries(n).map(([e,t])=>`;${Yv(e)}=${Yv(t)}`).join("")}function S$(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${Bf(t)}=${Bf(i)}`).join("&"):`${Bf(t)}=${Bf(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var A$=/^[^\/()?;#]+/;function qv(n){let e=n.match(A$);return e?e[0]:""}var M$=/^[^\/()?;=#]+/;function R$(n){let e=n.match(M$);return e?e[0]:""}var x$=/^[^=?&#]+/;function N$(n){let e=n.match(x$);return e?e[0]:""}var P$=/^[^&#]+/;function k$(n){let e=n.match(P$);return e?e[0]:""}var Zv=class{url;remaining;constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Oe([],{}):new Oe([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[ge]=new Oe(e,t)),r}parseSegment(){let e=qv(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new te(4009,!1);return this.capture(e),new Lo(qf(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=R$(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=qv(this.remaining);i&&(r=i,this.capture(r))}e[qf(t)]=qf(r)}parseQueryParam(e){let t=N$(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let s=k$(this.remaining);s&&(r=s,this.capture(r))}let i=aR(t),o=aR(r);if(e.hasOwnProperty(i)){let s=e[i];Array.isArray(s)||(s=[s],e[i]=s),s.push(o)}else e[i]=o}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=qv(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new te(4010,!1);let o;r.indexOf(":")>-1?(o=r.slice(0,r.indexOf(":")),this.capture(o),this.capture(":")):e&&(o=ge);let s=this.parseChildren();t[o]=Object.keys(s).length===1?s[ge]:new Oe([],s),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new te(4011,!1)}};function ER(n){return n.segments.length>0?new Oe([],{[ge]:n}):n}function IR(n){let e={};for(let[r,i]of Object.entries(n.children)){let o=IR(i);if(r===ge&&o.segments.length===0&&o.hasChildren())for(let[s,a]of Object.entries(o.children))e[s]=a;else(o.segments.length>0||o.hasChildren())&&(e[r]=o)}let t=new Oe(n.segments,e);return O$(t)}function O$(n){if(n.numberOfChildren===1&&n.children[ge]){let e=n.children[ge];return new Oe(n.segments.concat(e.segments),e.children)}return n}function Bu(n){return n instanceof zr}function F$(n,e,t=null,r=null){let i=CR(n);return DR(i,e,t,r)}function CR(n){let e;function t(o){let s={};for(let l of o.children){let c=t(l);s[l.outlet]=c}let a=new Oe(o.url,s);return o===n&&(e=a),a}let r=t(n.root),i=ER(r);return e??i}function DR(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return Gv(i,i,i,t,r);let o=V$(e);if(o.toRoot())return Gv(i,i,new Oe([],{}),t,r);let s=L$(o,i,n),a=s.processChildren?Fu(s.segmentGroup,s.index,o.commands):bR(s.segmentGroup,s.index,o.commands);return Gv(i,s.segmentGroup,a,t,r)}function Gf(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function Uu(n){return typeof n=="object"&&n!=null&&n.outlets}function Gv(n,e,t,r,i){let o={};r&&Object.entries(r).forEach(([l,c])=>{o[l]=Array.isArray(c)?c.map(d=>`${d}`):`${c}`});let s;n===e?s=t:s=TR(n,e,t);let a=ER(IR(s));return new zr(a,o,i)}function TR(n,e,t){let r={};return Object.entries(n.children).forEach(([i,o])=>{o===e?r[i]=t:r[i]=TR(o,e,t)}),new Oe(n.segments,r)}var zf=class{isAbsolute;numberOfDoubleDots;commands;constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Gf(r[0]))throw new te(4003,!1);let i=r.find(Uu);if(i&&i!==pR(r))throw new te(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function V$(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new zf(!0,0,n);let e=0,t=!1,r=n.reduce((i,o,s)=>{if(typeof o=="object"&&o!=null){if(o.outlets){let a={};return Object.entries(o.outlets).forEach(([l,c])=>{a[l]=typeof c=="string"?c.split("/"):c}),[...i,{outlets:a}]}if(o.segmentPath)return[...i,o.segmentPath]}return typeof o!="string"?[...i,o]:s===0?(o.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?t=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,o]},[]);return new zf(t,e,r)}var ga=class{segmentGroup;processChildren;index;constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function L$(n,e,t){if(n.isAbsolute)return new ga(e,!0,0);if(!t)return new ga(e,!1,NaN);if(t.parent===null)return new ga(t,!0,0);let r=Gf(n.commands[0])?0:1,i=t.segments.length-1+r;return j$(t,i,n.numberOfDoubleDots)}function j$(n,e,t){let r=n,i=e,o=t;for(;o>i;){if(o-=i,r=r.parent,!r)throw new te(4005,!1);i=r.segments.length}return new ga(r,!1,i-o)}function B$(n){return Uu(n[0])?n[0].outlets:{[ge]:n}}function bR(n,e,t){if(n??=new Oe([],{}),n.segments.length===0&&n.hasChildren())return Fu(n,e,t);let r=U$(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let o=new Oe(n.segments.slice(0,r.pathIndex),{});return o.children[ge]=new Oe(n.segments.slice(r.pathIndex),n.children),Fu(o,0,i)}else return r.match&&i.length===0?new Oe(n.segments,{}):r.match&&!n.hasChildren()?Jv(n,e,t):r.match?Fu(n,0,i):Jv(n,e,t)}function Fu(n,e,t){if(t.length===0)return new Oe(n.segments,{});{let r=B$(t),i={};if(Object.keys(r).some(o=>o!==ge)&&n.children[ge]&&n.numberOfChildren===1&&n.children[ge].segments.length===0){let o=Fu(n.children[ge],e,t);return new Oe(n.segments,o.children)}return Object.entries(r).forEach(([o,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(i[o]=bR(n.children[o],e,s))}),Object.entries(n.children).forEach(([o,s])=>{r[o]===void 0&&(i[o]=s)}),new Oe(n.segments,i)}}function U$(n,e,t){let r=0,i=e,o={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return o;let s=n.segments[i],a=t[r];if(Uu(a))break;let l=`${a}`,c=r<t.length-1?t[r+1]:null;if(i>0&&l===void 0)break;if(l&&c&&typeof c=="object"&&c.outlets===void 0){if(!uR(l,c,s))return o;r+=2}else{if(!uR(l,{},s))return o;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function Jv(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let o=t[i];if(Uu(o)){let l=$$(o.outlets);return new Oe(r,l)}if(i===0&&Gf(t[0])){let l=n.segments[e];r.push(new Lo(l.path,lR(t[0]))),i++;continue}let s=Uu(o)?o.outlets[ge]:`${o}`,a=i<t.length-1?t[i+1]:null;s&&a&&Gf(a)?(r.push(new Lo(s,lR(a))),i+=2):(r.push(new Lo(s,{})),i++)}return new Oe(r,{})}function $$(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=Jv(new Oe([],{}),0,r))}),e}function lR(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function uR(n,e,t){return n==t.path&&pr(e,t.parameters)}var Vu="imperative",Rt=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(Rt||{}),kn=class{id;url;constructor(e,t){this.id=e,this.url=t}},$u=class extends kn{type=Rt.NavigationStart;navigationTrigger;restoredState;constructor(e,t,r="imperative",i=null){super(e,t),this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Bo=class extends kn{urlAfterRedirects;type=Rt.NavigationEnd;constructor(e,t,r){super(e,t),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},mn=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(mn||{}),Xv=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(Xv||{}),Gr=class extends kn{reason;code;type=Rt.NavigationCancel;constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Uo=class extends kn{reason;code;type=Rt.NavigationSkipped;constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i}},Hu=class extends kn{error;target;type=Rt.NavigationError;constructor(e,t,r,i){super(e,t),this.error=r,this.target=i}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Wf=class extends kn{urlAfterRedirects;state;type=Rt.RoutesRecognized;constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},ew=class extends kn{urlAfterRedirects;state;type=Rt.GuardsCheckStart;constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},tw=class extends kn{urlAfterRedirects;state;shouldActivate;type=Rt.GuardsCheckEnd;constructor(e,t,r,i,o){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=o}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},nw=class extends kn{urlAfterRedirects;state;type=Rt.ResolveStart;constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},rw=class extends kn{urlAfterRedirects;state;type=Rt.ResolveEnd;constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},iw=class{route;type=Rt.RouteConfigLoadStart;constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},ow=class{route;type=Rt.RouteConfigLoadEnd;constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},sw=class{snapshot;type=Rt.ChildActivationStart;constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},aw=class{snapshot;type=Rt.ChildActivationEnd;constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},lw=class{snapshot;type=Rt.ActivationStart;constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},uw=class{snapshot;type=Rt.ActivationEnd;constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var qu=class{},va=class{url;navigationBehaviorOptions;constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};function H$(n,e){return n.providers&&!n._injector&&(n._injector=Tv(n.providers,e,`Route: ${n.path}`)),n._injector??e}function Kn(n){return n.outlet||ge}function q$(n,e){let t=n.filter(r=>Kn(r)===e);return t.push(...n.filter(r=>Kn(r)!==e)),t}function Yu(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var cw=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Yu(this.route?.snapshot)??this.rootInjector}constructor(e){this.rootInjector=e,this.children=new ep(this.rootInjector)}},ep=(()=>{class n{rootInjector;contexts=new Map;constructor(t){this.rootInjector=t}onChildOutletCreated(t,r){let i=this.getOrCreateContext(t);i.outlet=r,this.contexts.set(t,i)}onChildOutletDestroyed(t){let r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new cw(this.rootInjector),this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}static \u0275fac=function(r){return new(r||n)(j(it))};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Kf=class{_root;constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=dw(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=dw(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=hw(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return hw(e,this._root).map(t=>t.value)}};function dw(n,e){if(n===e.value)return e;for(let t of e.children){let r=dw(n,t);if(r)return r}return null}function hw(n,e){if(n===e.value)return[e];for(let t of e.children){let r=hw(n,t);if(r.length)return r.unshift(e),r}return[]}var gn=class{value;children;constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function pa(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var Qf=class extends Kf{snapshot;constructor(e,t){super(e),this.snapshot=t,Iw(this,e)}toString(){return this.snapshot.toString()}};function SR(n){let e=G$(n),t=new bt([new Lo("",{})]),r=new bt({}),i=new bt({}),o=new bt({}),s=new bt(""),a=new wa(t,r,o,s,i,ge,n,e.root);return a.snapshot=e.root,new Qf(new gn(a,[]),e)}function G$(n){let e={},t={},r={},i="",o=new ma([],e,r,i,t,ge,n,null,{});return new Zf("",new gn(o,[]))}var wa=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(e,t,r,i,o,s,a,l){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=o,this.outlet=s,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(Q(c=>c[Qu]))??ne(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Q(e=>_a(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Q(e=>_a(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Yf(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:$($({},e.params),n.params),data:$($({},e.data),n.data),resolve:$($($($({},n.data),e.data),i?.data),n._resolvedData)}:r={params:$({},n.params),data:$({},n.data),resolve:$($({},n.data),n._resolvedData??{})},i&&MR(i)&&(r.resolve[Qu]=i.title),r}var ma=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Qu]}constructor(e,t,r,i,o,s,a,l,c){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=o,this.outlet=s,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=_a(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=_a(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},Zf=class extends Kf{url;constructor(e,t){super(t),this.url=e,Iw(this,t)}toString(){return AR(this._root)}};function Iw(n,e){e.value._routerState=n,e.children.forEach(t=>Iw(n,t))}function AR(n){let e=n.children.length>0?` { ${n.children.map(AR).join(", ")} } `:"";return`${n.value}${e}`}function zv(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,pr(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),pr(e.params,t.params)||n.paramsSubject.next(t.params),_$(e.url,t.url)||n.urlSubject.next(t.url),pr(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function fw(n,e){let t=pr(n.params,e.params)&&I$(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||fw(n.parent,e.parent))}function MR(n){return typeof n.title=="string"||n.title===null}var z$=new z(""),Cw=(()=>{class n{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=ge;activateEvents=new At;deactivateEvents=new At;attachEvents=new At;detachEvents=new At;routerOutletData=PA(void 0);parentContexts=V(ep);location=V(ua);changeDetector=V(Oo);inputBinder=V(Dw,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(t){if(t.name){let{firstChange:r,previousValue:i}=t.name;if(r)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new te(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new te(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new te(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new te(4013,!1);this._activatedRoute=t;let i=this.location,s=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new pw(t,a,i.injector,this.routerOutletData);this.activated=i.createComponent(s,{index:i.length,injector:l,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(r){return new(r||n)};static \u0275dir=Mt({type:n,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Cu]})}return n})(),pw=class n{route;childContexts;parent;outletData;__ngOutletInjector(e){return new n(this.route,this.childContexts,e,this.outletData)}constructor(e,t,r,i){this.route=e,this.childContexts=t,this.parent=r,this.outletData=i}get(e,t){return e===wa?this.route:e===ep?this.childContexts:e===z$?this.outletData:this.parent.get(e,t)}},Dw=new z("");function W$(n,e,t){let r=Gu(n,e._root,t?t._root:void 0);return new Qf(r,e)}function Gu(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=K$(n,e,t);return new gn(r,i)}else{if(n.shouldAttach(e.value)){let o=n.retrieve(e.value);if(o!==null){let s=o.route;return s.value._futureSnapshot=e.value,s.children=e.children.map(a=>Gu(n,a)),s}}let r=Q$(e.value),i=e.children.map(o=>Gu(n,o));return new gn(r,i)}}function K$(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return Gu(n,r,i);return Gu(n,r)})}function Q$(n){return new wa(new bt(n.url),new bt(n.params),new bt(n.queryParams),new bt(n.fragment),new bt(n.data),n.outlet,n.component,n)}var zu=class{redirectTo;navigationBehaviorOptions;constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},RR="ngNavigationCancelingError";function Jf(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=Bu(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=xR(!1,mn.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function xR(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[RR]=!0,t.cancellationCode=e,t}function Y$(n){return NR(n)&&Bu(n.url)}function NR(n){return!!n&&n[RR]}var Z$=(n,e,t,r)=>Q(i=>(new gw(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),gw=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(e,t,r,i,o){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=o}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),zv(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=pa(t);e.children.forEach(o=>{let s=o.value.outlet;this.deactivateRoutes(o,i[s],r),delete i[s]}),Object.values(i).forEach(o=>{this.deactivateRouteAndItsChildren(o,r)})}deactivateRoutes(e,t,r){let i=e.value,o=t?t.value:null;if(i===o)if(i.component){let s=r.getContext(i.outlet);s&&this.deactivateChildRoutes(e,t,s.children)}else this.deactivateChildRoutes(e,t,r);else o&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,o=pa(e);for(let s of Object.values(o))this.deactivateRouteAndItsChildren(s,i);if(r&&r.outlet){let s=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:s,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,o=pa(e);for(let s of Object.values(o))this.deactivateRouteAndItsChildren(s,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=pa(t);e.children.forEach(o=>{this.activateRoutes(o,i[o.value.outlet],r),this.forwardEvent(new uw(o.value.snapshot))}),e.children.length&&this.forwardEvent(new aw(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,o=t?t.value:null;if(zv(i),i===o)if(i.component){let s=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,s.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let s=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),zv(a.route.value),this.activateChildRoutes(e,null,s.children)}else s.attachRef=null,s.route=i,s.outlet&&s.outlet.activateWith(i,s.injector),this.activateChildRoutes(e,null,s.children)}else this.activateChildRoutes(e,null,r)}},Xf=class{path;route;constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},ya=class{component;route;constructor(e,t){this.component=e,this.route=t}};function J$(n,e,t){let r=n._root,i=e?e._root:null;return Ou(r,i,t,[r.value])}function X$(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function Ia(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!AS(n)?n:e.get(n):r}function Ou(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let o=pa(e);return n.children.forEach(s=>{eH(s,o[s.value.outlet],t,r.concat([s.value]),i),delete o[s.value.outlet]}),Object.entries(o).forEach(([s,a])=>Lu(a,t.getContext(s),i)),i}function eH(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let o=n.value,s=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){let l=tH(s,o,o.routeConfig.runGuardsAndResolvers);l?i.canActivateChecks.push(new Xf(r)):(o.data=s.data,o._resolvedData=s._resolvedData),o.component?Ou(n,e,a?a.children:null,r,i):Ou(n,e,t,r,i),l&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new ya(a.outlet.component,s))}else s&&Lu(e,a,i),i.canActivateChecks.push(new Xf(r)),o.component?Ou(n,null,a?a.children:null,r,i):Ou(n,null,t,r,i);return i}function tH(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!jo(n.url,e.url);case"pathParamsOrQueryParamsChange":return!jo(n.url,e.url)||!pr(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!fw(n,e)||!pr(n.queryParams,e.queryParams);case"paramsChange":default:return!fw(n,e)}}function Lu(n,e,t){let r=pa(n),i=n.value;Object.entries(r).forEach(([o,s])=>{i.component?e?Lu(s,e.children.getContext(o),t):Lu(s,null,t):Lu(s,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new ya(e.outlet.component,i)):t.canDeactivateChecks.push(new ya(null,i)):t.canDeactivateChecks.push(new ya(null,i))}function Zu(n){return typeof n=="function"}function nH(n){return typeof n=="boolean"}function rH(n){return n&&Zu(n.canLoad)}function iH(n){return n&&Zu(n.canActivate)}function oH(n){return n&&Zu(n.canActivateChild)}function sH(n){return n&&Zu(n.canDeactivate)}function aH(n){return n&&Zu(n.canMatch)}function PR(n){return n instanceof kr||n?.name==="EmptyError"}var Uf=Symbol("INITIAL_VALUE");function Ea(){return Qe(n=>Ph(n.map(e=>e.pipe(Or(1),vo(Uf)))).pipe(Q(e=>{for(let t of e)if(t!==!0){if(t===Uf)return Uf;if(t===!1||lH(t))return t}return!0}),Vt(e=>e!==Uf),Or(1)))}function lH(n){return Bu(n)||n instanceof zu}function uH(n,e){return mt(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:o,canDeactivateChecks:s}}=t;return s.length===0&&o.length===0?ne(pe($({},t),{guardsResult:!0})):cH(s,r,i,n).pipe(mt(a=>a&&nH(a)?dH(r,o,n,e):ne(a)),Q(a=>pe($({},t),{guardsResult:a})))})}function cH(n,e,t,r){return ke(n).pipe(mt(i=>mH(i.component,i.route,t,e,r)),Hn(i=>i!==!0,!0))}function dH(n,e,t,r){return ke(e).pipe(Us(i=>js(fH(i.route.parent,r),hH(i.route,r),gH(n,i.path,t),pH(n,i.route,t))),Hn(i=>i!==!0,!0))}function hH(n,e){return n!==null&&e&&e(new lw(n)),ne(!0)}function fH(n,e){return n!==null&&e&&e(new sw(n)),ne(!0)}function pH(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return ne(!0);let i=r.map(o=>kh(()=>{let s=Yu(e)??t,a=Ia(o,s),l=iH(a)?a.canActivate(e,n):Mn(s,()=>a(e,n));return Ai(l).pipe(Hn())}));return ne(i).pipe(Ea())}function gH(n,e,t){let r=e[e.length-1],o=e.slice(0,e.length-1).reverse().map(s=>X$(s)).filter(s=>s!==null).map(s=>kh(()=>{let a=s.guards.map(l=>{let c=Yu(s.node)??t,d=Ia(l,c),f=oH(d)?d.canActivateChild(r,n):Mn(c,()=>d(r,n));return Ai(f).pipe(Hn())});return ne(a).pipe(Ea())}));return ne(o).pipe(Ea())}function mH(n,e,t,r,i){let o=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!o||o.length===0)return ne(!0);let s=o.map(a=>{let l=Yu(e)??i,c=Ia(a,l),d=sH(c)?c.canDeactivate(n,e,t,r):Mn(l,()=>c(n,e,t,r));return Ai(d).pipe(Hn())});return ne(s).pipe(Ea())}function yH(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return ne(!0);let o=i.map(s=>{let a=Ia(s,n),l=rH(a)?a.canLoad(e,t):Mn(n,()=>a(e,t));return Ai(l)});return ne(o).pipe(Ea(),kR(r))}function kR(n){return by(St(e=>{if(typeof e!="boolean")throw Jf(n,e)}),Q(e=>e===!0))}function _H(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return ne(!0);let o=i.map(s=>{let a=Ia(s,n),l=aH(a)?a.canMatch(e,t):Mn(n,()=>a(e,t));return Ai(l)});return ne(o).pipe(Ea(),kR(r))}var Wu=class{segmentGroup;constructor(e){this.segmentGroup=e||null}},Ku=class extends Error{urlTree;constructor(e){super(),this.urlTree=e}};function fa(n){return Ls(new Wu(n))}function vH(n){return Ls(new te(4e3,!1))}function wH(n){return Ls(xR(!1,mn.GuardRejected))}var mw=class{urlSerializer;urlTree;constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return ne(r);if(i.numberOfChildren>1||!i.children[ge])return vH(`${e.redirectTo}`);i=i.children[ge]}}applyRedirectCommands(e,t,r,i,o){if(typeof t!="string"){let a=t,{queryParams:l,fragment:c,routeConfig:d,url:f,outlet:g,params:m,data:v,title:T}=i,S=Mn(o,()=>a({params:m,data:v,queryParams:l,fragment:c,routeConfig:d,url:f,outlet:g,title:T}));if(S instanceof zr)throw new Ku(S);t=S}let s=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t[0]==="/")throw new Ku(s);return s}applyRedirectCreateUrlTree(e,t,r,i){let o=this.createSegmentGroup(e,t.root,r,i);return new zr(o,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,o])=>{if(typeof o=="string"&&o[0]===":"){let a=o.substring(1);r[i]=t[a]}else r[i]=o}),r}createSegmentGroup(e,t,r,i){let o=this.createSegments(e,t.segments,r,i),s={};return Object.entries(t.children).forEach(([a,l])=>{s[a]=this.createSegmentGroup(e,l,r,i)}),new Oe(o,s)}createSegments(e,t,r,i){return t.map(o=>o.path[0]===":"?this.findPosParam(e,o,i):this.findOrReturn(o,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new te(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},yw={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function EH(n,e,t,r,i){let o=OR(n,e,t);return o.matched?(r=H$(e,r),_H(r,e,t,i).pipe(Q(s=>s===!0?o:$({},yw)))):ne(o)}function OR(n,e,t){if(e.path==="**")return IH(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?$({},yw):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||y$)(t,n,e);if(!i)return $({},yw);let o={};Object.entries(i.posParams??{}).forEach(([a,l])=>{o[a]=l.path});let s=i.consumed.length>0?$($({},o),i.consumed[i.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:s,positionalParamSegments:i.posParams??{}}}function IH(n){return{matched:!0,parameters:n.length>0?pR(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function cR(n,e,t,r){return t.length>0&&TH(n,t,r)?{segmentGroup:new Oe(e,DH(r,new Oe(t,n.children))),slicedSegments:[]}:t.length===0&&bH(n,t,r)?{segmentGroup:new Oe(n.segments,CH(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new Oe(n.segments,n.children),slicedSegments:t}}function CH(n,e,t,r){let i={};for(let o of t)if(tp(n,e,o)&&!r[Kn(o)]){let s=new Oe([],{});i[Kn(o)]=s}return $($({},r),i)}function DH(n,e){let t={};t[ge]=e;for(let r of n)if(r.path===""&&Kn(r)!==ge){let i=new Oe([],{});t[Kn(r)]=i}return t}function TH(n,e,t){return t.some(r=>tp(n,e,r)&&Kn(r)!==ge)}function bH(n,e,t){return t.some(r=>tp(n,e,r))}function tp(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function SH(n,e,t){return e.length===0&&!n.children[t]}var _w=class{};function AH(n,e,t,r,i,o,s="emptyOnly"){return new vw(n,e,t,r,i,s,o).recognize()}var MH=31,vw=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(e,t,r,i,o,s,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=o,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new mw(this.urlSerializer,this.urlTree)}noMatchError(e){return new te(4002,`'${e.segmentGroup}'`)}recognize(){let e=cR(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(Q(({children:t,rootSnapshot:r})=>{let i=new gn(r,t),o=new Zf("",i),s=F$(r,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(s),{state:o,tree:s}}))}match(e){let t=new ma([],Object.freeze({}),Object.freeze($({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),ge,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,ge,t).pipe(Q(r=>({children:r,rootSnapshot:t})),fi(r=>{if(r instanceof Ku)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Wu?this.noMatchError(r):r}))}processSegmentGroup(e,t,r,i,o){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r,o):this.processSegment(e,t,r,r.segments,i,!0,o).pipe(Q(s=>s instanceof gn?[s]:[]))}processChildren(e,t,r,i){let o=[];for(let s of Object.keys(r.children))s==="primary"?o.unshift(s):o.push(s);return ke(o).pipe(Us(s=>{let a=r.children[s],l=q$(t,s);return this.processSegmentGroup(e,l,a,s,i)}),ar((s,a)=>(s.push(...a),s)),pi(null),ky(),mt(s=>{if(s===null)return fa(r);let a=FR(s);return RH(a),ne(a)}))}processSegment(e,t,r,i,o,s,a){return ke(t).pipe(Us(l=>this.processSegmentAgainstRoute(l._injector??e,t,l,r,i,o,s,a).pipe(fi(c=>{if(c instanceof Wu)return ne(null);throw c}))),Hn(l=>!!l),fi(l=>{if(PR(l))return SH(r,i,o)?ne(new _w):fa(r);throw l}))}processSegmentAgainstRoute(e,t,r,i,o,s,a,l){return Kn(r)!==s&&(s===ge||!tp(i,o,r))?fa(i):r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,o,s,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,o,s,l):fa(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,o,s,a){let{matched:l,parameters:c,consumedSegments:d,positionalParamSegments:f,remainingSegments:g}=OR(t,i,o);if(!l)return fa(t);typeof i.redirectTo=="string"&&i.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>MH&&(this.allowRedirects=!1));let m=new ma(o,c,Object.freeze($({},this.urlTree.queryParams)),this.urlTree.fragment,dR(i),Kn(i),i.component??i._loadedComponent??null,i,hR(i)),v=Yf(m,a,this.paramsInheritanceStrategy);m.params=Object.freeze(v.params),m.data=Object.freeze(v.data);let T=this.applyRedirects.applyRedirectCommands(d,i.redirectTo,f,m,e);return this.applyRedirects.lineralizeSegments(i,T).pipe(mt(S=>this.processSegment(e,r,t,S.concat(g),s,!1,a)))}matchSegmentAgainstRoute(e,t,r,i,o,s){let a=EH(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),a.pipe(Qe(l=>l.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(Qe(({routes:c})=>{let d=r._loadedInjector??e,{parameters:f,consumedSegments:g,remainingSegments:m}=l,v=new ma(g,f,Object.freeze($({},this.urlTree.queryParams)),this.urlTree.fragment,dR(r),Kn(r),r.component??r._loadedComponent??null,r,hR(r)),T=Yf(v,s,this.paramsInheritanceStrategy);v.params=Object.freeze(T.params),v.data=Object.freeze(T.data);let{segmentGroup:S,slicedSegments:O}=cR(t,g,m,c);if(O.length===0&&S.hasChildren())return this.processChildren(d,c,S,v).pipe(Q(F=>new gn(v,F)));if(c.length===0&&O.length===0)return ne(new gn(v,[]));let B=Kn(r)===o;return this.processSegment(d,c,S,O,B?ge:o,!0,v).pipe(Q(F=>new gn(v,F instanceof gn?[F]:[])))}))):fa(t)))}getChildConfig(e,t,r){return t.children?ne({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?ne({routes:t._loadedRoutes,injector:t._loadedInjector}):yH(e,t,r,this.urlSerializer).pipe(mt(i=>i?this.configLoader.loadChildren(e,t).pipe(St(o=>{t._loadedRoutes=o.routes,t._loadedInjector=o.injector})):wH(t))):ne({routes:[],injector:e})}};function RH(n){n.sort((e,t)=>e.value.outlet===ge?-1:t.value.outlet===ge?1:e.value.outlet.localeCompare(t.value.outlet))}function xH(n){let e=n.value.routeConfig;return e&&e.path===""}function FR(n){let e=[],t=new Set;for(let r of n){if(!xH(r)){e.push(r);continue}let i=e.find(o=>r.value.routeConfig===o.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=FR(r.children);e.push(new gn(r.value,i))}return e.filter(r=>!t.has(r))}function dR(n){return n.data||{}}function hR(n){return n.resolve||{}}function NH(n,e,t,r,i,o){return mt(s=>AH(n,e,t,r,s.extractedUrl,i,o).pipe(Q(({state:a,tree:l})=>pe($({},s),{targetSnapshot:a,urlAfterRedirects:l}))))}function PH(n,e){return mt(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return ne(t);let o=new Set(i.map(l=>l.route)),s=new Set;for(let l of o)if(!s.has(l))for(let c of VR(l))s.add(c);let a=0;return ke(s).pipe(Us(l=>o.has(l)?kH(l,r,n,e):(l.data=Yf(l,l.parent,n).resolve,ne(void 0))),St(()=>a++),$s(1),mt(l=>a===s.size?ne(t):qt))})}function VR(n){let e=n.children.map(t=>VR(t)).flat();return[n,...e]}function kH(n,e,t,r){let i=n.routeConfig,o=n._resolve;return i?.title!==void 0&&!MR(i)&&(o[Qu]=i.title),OH(o,n,e,r).pipe(Q(s=>(n._resolvedData=s,n.data=Yf(n,n.parent,t).resolve,null)))}function OH(n,e,t,r){let i=Qv(n);if(i.length===0)return ne({});let o={};return ke(i).pipe(mt(s=>FH(n[s],e,t,r).pipe(Hn(),St(a=>{if(a instanceof zu)throw Jf(new ju,a);o[s]=a}))),$s(1),Q(()=>o),fi(s=>PR(s)?qt:Ls(s)))}function FH(n,e,t,r){let i=Yu(e)??r,o=Ia(n,i),s=o.resolve?o.resolve(e,t):Mn(i,()=>o(e,t));return Ai(s)}function Wv(n){return Qe(e=>{let t=n(e);return t?ke(t).pipe(Q(()=>e)):ne(e)})}var LR=(()=>{class n{buildTitle(t){let r,i=t.root;for(;i!==void 0;)r=this.getResolvedTitleForRoute(i)??r,i=i.children.find(o=>o.outlet===ge);return r}getResolvedTitleForRoute(t){return t.data[Qu]}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:()=>V(VH),providedIn:"root"})}return n})(),VH=(()=>{class n extends LR{title;constructor(t){super(),this.title=t}updateTitle(t){let r=this.buildTitle(t);r!==void 0&&this.title.setTitle(r)}static \u0275fac=function(r){return new(r||n)(j(oR))};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Tw=new z("",{providedIn:"root",factory:()=>({})}),LH=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275cmp=ca({type:n,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(r,i){r&1&&No(0,"router-outlet")},dependencies:[Cw],encapsulation:2})}return n})();function bw(n){let e=n.children&&n.children.map(bw),t=e?pe($({},n),{children:e}):$({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==ge&&(t.component=LH),t}var Sw=new z(""),jH=(()=>{class n{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=V(xv);loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return ne(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);let r=Ai(t.loadComponent()).pipe(Q(jR),St(o=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=o}),au(()=>{this.componentLoaders.delete(t)})),i=new Ps(r,()=>new Ge).pipe(Ns());return this.componentLoaders.set(t,i),i}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return ne({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let o=BH(r,this.compiler,t,this.onLoadEndListener).pipe(au(()=>{this.childrenLoaders.delete(r)})),s=new Ps(o,()=>new Ge).pipe(Ns());return this.childrenLoaders.set(r,s),s}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function BH(n,e,t,r){return Ai(n.loadChildren()).pipe(Q(jR),mt(i=>i instanceof _u||Array.isArray(i)?ne(i):ke(e.compileModuleAsync(i))),Q(i=>{r&&r(n);let o,s,a=!1;return Array.isArray(i)?(s=i,a=!0):(o=i.create(t).injector,s=o.get(Sw,[],{optional:!0,self:!0}).flat()),{routes:s.map(bw),injector:o}}))}function UH(n){return n&&typeof n=="object"&&"default"in n}function jR(n){return UH(n)?n.default:n}var Aw=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:()=>V($H),providedIn:"root"})}return n})(),$H=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),HH=new z("");var qH=new z(""),GH=(()=>{class n{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new Ge;transitionAbortSubject=new Ge;configLoader=V(jH);environmentInjector=V(it);urlSerializer=V(Ew);rootContexts=V(ep);location=V(Mu);inputBindingEnabled=V(Dw,{optional:!0})!==null;titleStrategy=V(LR);options=V(Tw,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=V(Aw);createViewTransition=V(HH,{optional:!0});navigationErrorHandler=V(qH,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>ne(void 0);rootComponentType=null;constructor(){let t=i=>this.events.next(new iw(i)),r=i=>this.events.next(new ow(i));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=t}complete(){this.transitions?.complete()}handleNavigationRequest(t){let r=++this.navigationId;this.transitions?.next(pe($($({},this.transitions.value),t),{id:r}))}setupNavigations(t,r,i){return this.transitions=new bt({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:Vu,restoredState:null,currentSnapshot:i.snapshot,targetSnapshot:null,currentRouterState:i,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Vt(o=>o.id!==0),Q(o=>pe($({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),Qe(o=>{let s=!1,a=!1;return ne(o).pipe(Qe(l=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",mn.SupersededByNewNavigation),qt;this.currentTransition=o,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,targetBrowserUrl:typeof l.extras.browserUrl=="string"?this.urlSerializer.parse(l.extras.browserUrl):l.extras.browserUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?pe($({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let c=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),d=l.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!c&&d!=="reload"){let f="";return this.events.next(new Uo(l.id,this.urlSerializer.serialize(l.rawUrl),f,Xv.IgnoredSameUrlNavigation)),l.resolve(!1),qt}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return ne(l).pipe(Qe(f=>{let g=this.transitions?.getValue();return this.events.next(new $u(f.id,this.urlSerializer.serialize(f.extractedUrl),f.source,f.restoredState)),g!==this.transitions?.getValue()?qt:Promise.resolve(f)}),NH(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),St(f=>{o.targetSnapshot=f.targetSnapshot,o.urlAfterRedirects=f.urlAfterRedirects,this.currentNavigation=pe($({},this.currentNavigation),{finalUrl:f.urlAfterRedirects});let g=new Wf(f.id,this.urlSerializer.serialize(f.extractedUrl),this.urlSerializer.serialize(f.urlAfterRedirects),f.targetSnapshot);this.events.next(g)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:f,extractedUrl:g,source:m,restoredState:v,extras:T}=l,S=new $u(f,this.urlSerializer.serialize(g),m,v);this.events.next(S);let O=SR(this.rootComponentType).snapshot;return this.currentTransition=o=pe($({},l),{targetSnapshot:O,urlAfterRedirects:g,extras:pe($({},T),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=g,ne(o)}else{let f="";return this.events.next(new Uo(l.id,this.urlSerializer.serialize(l.extractedUrl),f,Xv.IgnoredByUrlHandlingStrategy)),l.resolve(!1),qt}}),St(l=>{let c=new ew(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}),Q(l=>(this.currentTransition=o=pe($({},l),{guards:J$(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),o)),uH(this.environmentInjector,l=>this.events.next(l)),St(l=>{if(o.guardsResult=l.guardsResult,l.guardsResult&&typeof l.guardsResult!="boolean")throw Jf(this.urlSerializer,l.guardsResult);let c=new tw(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(c)}),Vt(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",mn.GuardRejected),!1)),Wv(l=>{if(l.guards.canActivateChecks.length)return ne(l).pipe(St(c=>{let d=new nw(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(d)}),Qe(c=>{let d=!1;return ne(c).pipe(PH(this.paramsInheritanceStrategy,this.environmentInjector),St({next:()=>d=!0,complete:()=>{d||this.cancelNavigationTransition(c,"",mn.NoDataFromResolver)}}))}),St(c=>{let d=new rw(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(d)}))}),Wv(l=>{let c=d=>{let f=[];d.routeConfig?.loadComponent&&!d.routeConfig._loadedComponent&&f.push(this.configLoader.loadComponent(d.routeConfig).pipe(St(g=>{d.component=g}),Q(()=>{})));for(let g of d.children)f.push(...c(g));return f};return Ph(c(l.targetSnapshot.root)).pipe(pi(null),Or(1))}),Wv(()=>this.afterPreactivation()),Qe(()=>{let{currentSnapshot:l,targetSnapshot:c}=o,d=this.createViewTransition?.(this.environmentInjector,l.root,c.root);return d?ke(d).pipe(Q(()=>o)):ne(o)}),Q(l=>{let c=W$(t.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=o=pe($({},l),{targetRouterState:c}),this.currentNavigation.targetRouterState=c,o}),St(()=>{this.events.next(new qu)}),Z$(this.rootContexts,t.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),Or(1),St({next:l=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Bo(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{s=!0}}),Vy(this.transitionAbortSubject.pipe(St(l=>{throw l}))),au(()=>{!s&&!a&&this.cancelNavigationTransition(o,"",mn.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),fi(l=>{if(a=!0,NR(l))this.events.next(new Gr(o.id,this.urlSerializer.serialize(o.extractedUrl),l.message,l.cancellationCode)),Y$(l)?this.events.next(new va(l.url,l.navigationBehaviorOptions)):o.resolve(!1);else{let c=new Hu(o.id,this.urlSerializer.serialize(o.extractedUrl),l,o.targetSnapshot??void 0);try{let d=Mn(this.environmentInjector,()=>this.navigationErrorHandler?.(c));if(d instanceof zu){let{message:f,cancellationCode:g}=Jf(this.urlSerializer,d);this.events.next(new Gr(o.id,this.urlSerializer.serialize(o.extractedUrl),f,g)),this.events.next(new va(d.redirectTo,d.navigationBehaviorOptions))}else throw this.events.next(c),l}catch(d){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(d)}}return qt}))}))}cancelNavigationTransition(t,r,i){let o=new Gr(t.id,this.urlSerializer.serialize(t.extractedUrl),r,i);this.events.next(o),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return t.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function zH(n){return n!==Vu}var WH=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:()=>V(KH),providedIn:"root"})}return n})(),ww=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},KH=(()=>{class n extends ww{static \u0275fac=(()=>{let t;return function(i){return(t||(t=bi(n)))(i||n)}})();static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),BR=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:()=>V(QH),providedIn:"root"})}return n})(),QH=(()=>{class n extends BR{location=V(Mu);urlSerializer=V(Ew);options=V(Tw,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=V(Aw);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new zr;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}routerState=SR(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(r=>{r.type==="popstate"&&t(r.url,r.state)})}handleRouterEvent(t,r){if(t instanceof $u)this.stateMemento=this.createStateMemento();else if(t instanceof Uo)this.rawUrlTree=r.initialUrl;else if(t instanceof Wf){if(this.urlUpdateStrategy==="eager"&&!r.extras.skipLocationChange){let i=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(r.targetBrowserUrl??i,r)}}else t instanceof qu?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(r.targetBrowserUrl??this.rawUrlTree,r)):t instanceof Gr&&(t.code===mn.GuardRejected||t.code===mn.NoDataFromResolver)?this.restoreHistory(r):t instanceof Hu?this.restoreHistory(r,!0):t instanceof Bo&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,r){let i=t instanceof zr?this.urlSerializer.serialize(t):t;if(this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl){let o=this.browserPageId,s=$($({},r.extras.state),this.generateNgRouterState(r.id,o));this.location.replaceState(i,"",s)}else{let o=$($({},r.extras.state),this.generateNgRouterState(r.id,this.browserPageId+1));this.location.go(i,"",o)}}restoreHistory(t,r=!1){if(this.canceledNavigationResolution==="computed"){let i=this.browserPageId,o=this.currentPageId-i;o!==0?this.location.historyGo(o):this.currentUrlTree===t.finalUrl&&o===0&&(this.resetState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}static \u0275fac=(()=>{let t;return function(i){return(t||(t=bi(n)))(i||n)}})();static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function YH(n,e){n.events.pipe(Vt(t=>t instanceof Bo||t instanceof Gr||t instanceof Hu||t instanceof Uo),Q(t=>t instanceof Bo||t instanceof Uo?0:(t instanceof Gr?t.code===mn.Redirect||t.code===mn.SupersededByNewNavigation:!1)?2:1),Vt(t=>t!==2),Or(1)).subscribe(()=>{e()})}var ZH={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},JH={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},UR=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=V(bv);stateManager=V(BR);options=V(Tw,{optional:!0})||{};pendingTasks=V(Mo);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=V(GH);urlSerializer=V(Ew);location=V(Mu);urlHandlingStrategy=V(Aw);_events=new Ge;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=V(WH);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=V(Sw,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!V(Dw,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}eventsSubscription=new tt;subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(r=>{try{let i=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(i!==null&&o!==null){if(this.stateManager.handleRouterEvent(r,o),r instanceof Gr&&r.code!==mn.Redirect&&r.code!==mn.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof Bo)this.navigated=!0;else if(r instanceof va){let s=r.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(r.url,i.currentRawUrl),l=$({browserUrl:i.extras.browserUrl,info:i.extras.info,skipLocationChange:i.extras.skipLocationChange,replaceUrl:i.extras.replaceUrl||this.urlUpdateStrategy==="eager"||zH(i.source)},s);this.scheduleNavigation(a,Vu,null,l,{resolve:i.resolve,reject:i.reject,promise:i.promise})}}eq(r)&&this._events.next(r)}catch(i){this.navigationTransitions.transitionAbortSubject.next(i)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Vu,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(t,"popstate",r)},0)})}navigateToSyncWithBrowser(t,r,i){let o={replaceUrl:!0},s=i?.navigationId?i:null;if(i){let l=$({},i);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(o.state=l)}let a=this.parseUrl(t);this.scheduleNavigation(a,r,s,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(bw),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,r={}){let{relativeTo:i,queryParams:o,fragment:s,queryParamsHandling:a,preserveFragment:l}=r,c=l?this.currentUrlTree.fragment:s,d=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":d=$($({},this.currentUrlTree.queryParams),o);break;case"preserve":d=this.currentUrlTree.queryParams;break;default:d=o||null}d!==null&&(d=this.removeEmptyProps(d));let f;try{let g=i?i.snapshot:this.routerState.snapshot.root;f=CR(g)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),f=this.currentUrlTree.root}return DR(f,t,d,c??null)}navigateByUrl(t,r={skipLocationChange:!1}){let i=Bu(t)?t:this.parseUrl(t),o=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(o,Vu,null,r)}navigate(t,r={skipLocationChange:!1}){return XH(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,r){let i;if(r===!0?i=$({},ZH):r===!1?i=$({},JH):i=r,Bu(t))return sR(this.currentUrlTree,t,i);let o=this.parseUrl(t);return sR(this.currentUrlTree,o,i)}removeEmptyProps(t){return Object.entries(t).reduce((r,[i,o])=>(o!=null&&(r[i]=o),r),{})}scheduleNavigation(t,r,i,o,s){if(this.disposed)return Promise.resolve(!1);let a,l,c;s?(a=s.resolve,l=s.reject,c=s.promise):c=new Promise((f,g)=>{a=f,l=g});let d=this.pendingTasks.add();return YH(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(d))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:o,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(f=>Promise.reject(f))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function XH(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new te(4008,!1)}function eq(n){return!(n instanceof qu)&&!(n instanceof va)}var tq=new z("");function $R(n,...e){return q_([{provide:Sw,multi:!0,useValue:n},[],{provide:wa,useFactory:nq,deps:[UR]},{provide:Sv,multi:!0,useFactory:rq},e.map(t=>t.\u0275providers)])}function nq(n){return n.routerState.root}function rq(){let n=V(dn);return e=>{let t=n.get(Ci);if(e!==t.components[0])return;let r=n.get(UR),i=n.get(iq);n.get(oq)===1&&r.initialNavigation(),n.get(sq,null,me.Optional)?.setUpPreloading(),n.get(tq,null,me.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var iq=new z("",{factory:()=>new Ge}),oq=new z("",{providedIn:"root",factory:()=>1});var sq=new z("");var ZR=(()=>{class n{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,r){this._renderer=t,this._elementRef=r}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(r){return new(r||n)(Me(Ur),Me(fr))};static \u0275dir=Mt({type:n})}return n})(),sp=(()=>{class n extends ZR{static \u0275fac=(()=>{let t;return function(i){return(t||(t=bi(n)))(i||n)}})();static \u0275dir=Mt({type:n,features:[$r]})}return n})(),rc=new z("");var aq={provide:rc,useExisting:Di(()=>ap),multi:!0};function lq(){let n=qr()?qr().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var uq=new z(""),ap=(()=>{class n extends ZR{_compositionMode;_composing=!1;constructor(t,r,i){super(t,r),this._compositionMode=i,this._compositionMode==null&&(this._compositionMode=!lq())}writeValue(t){let r=t??"";this.setProperty("value",r)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(r){return new(r||n)(Me(Ur),Me(fr),Me(uq,8))};static \u0275dir=Mt({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){r&1&&xn("input",function(s){return i._handleInput(s.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(s){return i._compositionEnd(s.target.value)})},standalone:!1,features:[ha([aq]),$r]})}return n})();var cq=new z(""),dq=new z("");function JR(n){return n!=null}function XR(n){return xo(n)?ke(n):n}function ex(n){let e={};return n.forEach(t=>{e=t!=null?$($({},e),t):e}),Object.keys(e).length===0?null:e}function tx(n,e){return e.map(t=>t(n))}function hq(n){return!n.validate}function nx(n){return n.map(e=>hq(e)?e:t=>e.validate(t))}function fq(n){if(!n)return null;let e=n.filter(JR);return e.length==0?null:function(t){return ex(tx(t,e))}}function rx(n){return n!=null?fq(nx(n)):null}function pq(n){if(!n)return null;let e=n.filter(JR);return e.length==0?null:function(t){let r=tx(t,e).map(XR);return Py(r).pipe(Q(ex))}}function ix(n){return n!=null?pq(nx(n)):null}function HR(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function gq(n){return n._rawValidators}function mq(n){return n._rawAsyncValidators}function Mw(n){return n?Array.isArray(n)?n:[n]:[]}function rp(n,e){return Array.isArray(n)?n.includes(e):n===e}function qR(n,e){let t=Mw(e);return Mw(n).forEach(i=>{rp(t,i)||t.push(i)}),t}function GR(n,e){return Mw(e).filter(t=>!rp(n,t))}var ip=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=rx(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=ix(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Rw=class extends ip{name;get formDirective(){return null}get path(){return null}},nc=class extends ip{_parent=null;name=null;valueAccessor=null},xw=class{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},yq={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},$J=pe($({},yq),{"[class.ng-submitted]":"isSubmitted"}),ox=(()=>{class n extends xw{constructor(t){super(t)}static \u0275fac=function(r){return new(r||n)(Me(nc,2))};static \u0275dir=Mt({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){r&2&&Av("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},standalone:!1,features:[$r]})}return n})();var Ju="VALID",np="INVALID",Ca="PENDING",Xu="DISABLED",Ta=class{},op=class extends Ta{value;source;constructor(e,t){super(),this.value=e,this.source=t}},ec=class extends Ta{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}},tc=class extends Ta{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}},Da=class extends Ta{status;source;constructor(e,t){super(),this.status=e,this.source=t}};function _q(n){return(lp(n)?n.validators:n)||null}function vq(n){return Array.isArray(n)?rx(n):n||null}function wq(n,e){return(lp(e)?e.asyncValidators:n)||null}function Eq(n){return Array.isArray(n)?ix(n):n||null}function lp(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}var Nw=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return Hr(this.statusReactive)}set status(e){Hr(()=>this.statusReactive.set(e))}_status=Au(()=>this.statusReactive());statusReactive=Tu(void 0);get valid(){return this.status===Ju}get invalid(){return this.status===np}get pending(){return this.status==Ca}get disabled(){return this.status===Xu}get enabled(){return this.status!==Xu}errors;get pristine(){return Hr(this.pristineReactive)}set pristine(e){Hr(()=>this.pristineReactive.set(e))}_pristine=Au(()=>this.pristineReactive());pristineReactive=Tu(!0);get dirty(){return!this.pristine}get touched(){return Hr(this.touchedReactive)}set touched(e){Hr(()=>this.touchedReactive.set(e))}_touched=Au(()=>this.touchedReactive());touchedReactive=Tu(!1);get untouched(){return!this.touched}_events=new Ge;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(qR(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(qR(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(GR(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(GR(e,this._rawAsyncValidators))}hasValidator(e){return rp(this._rawValidators,e)}hasAsyncValidator(e){return rp(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(pe($({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new tc(!0,r))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:r})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,r),t&&e.emitEvent!==!1&&this._events.next(new tc(!1,r))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(pe($({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new ec(!1,r))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,r),t&&e.emitEvent!==!1&&this._events.next(new ec(!0,r))}markAsPending(e={}){this.status=Ca;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Da(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(pe($({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Xu,this.errors=null,this._forEachChild(i=>{i.disable(pe($({},e),{onlySelf:!0}))}),this._updateValue();let r=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new op(this.value,r)),this._events.next(new Da(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(pe($({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ju,this._forEachChild(r=>{r.enable(pe($({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(pe($({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ju||this.status===Ca)&&this._runAsyncValidator(r,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new op(this.value,t)),this._events.next(new Da(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(pe($({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Xu:Ju}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Ca,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let r=XR(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,r){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||r)&&this._events.next(new Da(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,r)}_initObservables(){this.valueChanges=new At,this.statusChanges=new At}_calculateStatus(){return this._allControlsDisabled()?Xu:this.errors?np:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ca)?Ca:this._anyControlsHaveStatus(np)?np:Ju}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let r=!this._anyControlsDirty(),i=this.pristine!==r;this.pristine=r,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new ec(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new tc(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){lp(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=vq(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=Eq(this._rawAsyncValidators)}};var sx=new z("",{providedIn:"root",factory:()=>Pw}),Pw="always";function Iq(n,e){return[...e.path,n]}function Cq(n,e,t=Pw){Tq(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),bq(n,e),Aq(n,e),Sq(n,e),Dq(n,e)}function zR(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function Dq(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function Tq(n,e){let t=gq(n);e.validator!==null?n.setValidators(HR(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=mq(n);e.asyncValidator!==null?n.setAsyncValidators(HR(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();zR(e._rawValidators,i),zR(e._rawAsyncValidators,i)}function bq(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&ax(n,e)})}function Sq(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&ax(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function ax(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function Aq(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function Mq(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function Rq(n){return Object.getPrototypeOf(n.constructor)===sp}function xq(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(o=>{o.constructor===ap?t=o:Rq(o)?r=o:i=o}),i||r||t||null}function WR(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function KR(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Nq=class extends Nw{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,r){super(_q(t),wq(r,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),lp(t)&&(t.nonNullable||t.initialValueIsDefault)&&(KR(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){WR(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){WR(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){KR(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var Pq={provide:nc,useExisting:Di(()=>kw)},QR=Promise.resolve(),kw=(()=>{class n extends nc{_changeDetectorRef;callSetDisabledState;control=new Nq;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new At;constructor(t,r,i,o,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=xq(this,o)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),Mq(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){Cq(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){QR.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let r=t.isDisabled.currentValue,i=r!==0&&Pf(r);QR.then(()=>{i&&!this.control.disabled?this.control.disable():!i&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?Iq(t,this._parent):[t]}static \u0275fac=function(r){return new(r||n)(Me(Rw,9),Me(cq,10),Me(dq,10),Me(rc,10),Me(Oo,8),Me(sx,8))};static \u0275dir=Mt({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[ha([Pq]),$r,Cu]})}return n})();var kq={provide:rc,useExisting:Di(()=>Ow),multi:!0},Ow=(()=>{class n extends sp{writeValue(t){let r=t??"";this.setProperty("value",r)}registerOnChange(t){this.onChange=r=>{t(r==""?null:parseFloat(r))}}static \u0275fac=(()=>{let t;return function(i){return(t||(t=bi(n)))(i||n)}})();static \u0275dir=Mt({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,i){r&1&&xn("input",function(s){return i.onChange(s.target.value)})("blur",function(){return i.onTouched()})},standalone:!1,features:[ha([kq]),$r]})}return n})();var Oq={provide:rc,useExisting:Di(()=>up),multi:!0};function lx(n,e){return n==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function Fq(n){return n.split(":")[0]}var up=(()=>{class n extends sp{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;writeValue(t){this.value=t;let r=this._getOptionId(t),i=lx(r,t);this.setProperty("value",i)}registerOnChange(t){this.onChange=r=>{this.value=this._getOptionValue(r),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),t))return r;return null}_getOptionValue(t){let r=Fq(t);return this._optionMap.has(r)?this._optionMap.get(r):t}static \u0275fac=(()=>{let t;return function(i){return(t||(t=bi(n)))(i||n)}})();static \u0275dir=Mt({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,i){r&1&&xn("change",function(s){return i.onChange(s.target.value)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[ha([Oq]),$r]})}return n})(),ux=(()=>{class n{_element;_renderer;_select;id;constructor(t,r,i){this._element=t,this._renderer=r,this._select=i,this._select&&(this.id=this._select._registerOption())}set ngValue(t){this._select!=null&&(this._select._optionMap.set(this.id,t),this._setElementValue(lx(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||n)(Me(fr),Me(Ur),Me(up,9))};static \u0275dir=Mt({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})(),Vq={provide:rc,useExisting:Di(()=>cx),multi:!0};function YR(n,e){return n==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function Lq(n){return n.split(":")[0]}var cx=(()=>{class n extends sp{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;writeValue(t){this.value=t;let r;if(Array.isArray(t)){let i=t.map(o=>this._getOptionId(o));r=(o,s)=>{o._setSelected(i.indexOf(s.toString())>-1)}}else r=(i,o)=>{i._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(t){this.onChange=r=>{let i=[],o=r.selectedOptions;if(o!==void 0){let s=o;for(let a=0;a<s.length;a++){let l=s[a],c=this._getOptionValue(l.value);i.push(c)}}else{let s=r.options;for(let a=0;a<s.length;a++){let l=s[a];if(l.selected){let c=this._getOptionValue(l.value);i.push(c)}}}this.value=i,t(i)}}_registerOption(t){let r=(this._idCounter++).toString();return this._optionMap.set(r,t),r}_getOptionId(t){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,t))return r;return null}_getOptionValue(t){let r=Lq(t);return this._optionMap.has(r)?this._optionMap.get(r)._value:t}static \u0275fac=(()=>{let t;return function(i){return(t||(t=bi(n)))(i||n)}})();static \u0275dir=Mt({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,i){r&1&&xn("change",function(s){return i.onChange(s.target)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[ha([Vq]),$r]})}return n})(),dx=(()=>{class n{_element;_renderer;_select;id;_value;constructor(t,r,i){this._element=t,this._renderer=r,this._select=i,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){this._select!=null&&(this._value=t,this._setElementValue(YR(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(YR(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||n)(Me(fr),Me(Ur),Me(cx,9))};static \u0275dir=Mt({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})();var jq=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=pn({type:n});static \u0275inj=hn({})}return n})();var hx=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:sx,useValue:t.callSetDisabledState??Pw}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=pn({type:n});static \u0275inj=hn({imports:[jq]})}return n})();var Uq="firebase",$q="11.2.0";Un(Uq,$q,"app");function nt(n){n===void 0&&(KS(nt),n=V(dn));let e=n.get(av);return t=>new de(r=>{let i=e.add(),o=!1;function s(){o||(i(),o=!0)}let a=t.subscribe({next:l=>{r.next(l),s()},complete:()=>{r.complete(),s()},error:l=>{r.error(l),s()}});return a.add(()=>{r.unsubscribe(),s()}),a})}var ba=new Lr("ANGULARFIRE2_VERSION");var fx=(n,e)=>{let t=e?[e]:o0(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(s=>{r.includes(s)||r.push(s)})}),r},Fw=function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n}(Fw||{}),aX=Su()&&typeof Zone<"u"?Fw.WARN:Fw.SILENT;var cp=class{zone;delegate;constructor(e,t=Ry){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,o=function(s){i?i.runGuarded(()=>{e.apply(this,[s])}):e.apply(this,[s])};return this.delegate.schedule(o,t,r)}},$o=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=V(De);this.outsideAngular=t.runOutsideAngular(()=>new cp(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new cp(typeof Zone>"u"?void 0:Zone.current,_o))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Hq=new Map,qq={activated:!1,tokenObservers:[]},Gq={initialized:!1,enabled:!1};function Qn(n){return Hq.get(n)||Object.assign({},qq)}function wx(){return Gq}var zq="https://content-firebaseappcheck.googleapis.com/v1";var Wq="exchangeDebugToken",px={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},gX=24*60*60*1e3;var jw=class{constructor(e,t,r,i,o){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=o,this.pending=null,this.nextErrorWaitInterval=i,i>o)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return x(this,null,function*(){this.stop();try{this.pending=new wt,this.pending.promise.catch(t=>{}),yield Kq(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new wt,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function Kq(n){return new Promise(e=>{setTimeout(e,n)})}var Qq={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Mi=new Xb("appCheck","AppCheck",Qq);function Ex(n){if(!Qn(n).activated)throw Mi.create("use-before-activation",{appName:n.name})}function Ix(r,i){return x(this,arguments,function*({url:n,body:e},t){let o={"Content-Type":"application/json"},s=t.getImmediate({optional:!0});if(s){let m=yield s.getHeartbeatsHeader();m&&(o["X-Firebase-Client"]=m)}let a={method:"POST",body:JSON.stringify(e),headers:o},l;try{l=yield fetch(n,a)}catch(m){throw Mi.create("fetch-network-error",{originalErrorMessage:m?.message})}if(l.status!==200)throw Mi.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(m){throw Mi.create("fetch-parse-error",{originalErrorMessage:m?.message})}let d=c.ttl.match(/^([\d.]+)(s)$/);if(!d||!d[2]||isNaN(Number(d[1])))throw Mi.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let f=Number(d[1])*1e3,g=Date.now();return{token:c.token,expireTimeMillis:g+f,issuedAtTimeMillis:g}})}function Cx(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${zq}/projects/${t}/apps/${r}:${Wq}?key=${i}`,body:{debug_token:e}}}var Yq="firebase-app-check-database",Zq=1,Bw="firebase-app-check-store";var dp=null;function Jq(){return dp||(dp=new Promise((n,e)=>{try{let t=indexedDB.open(Yq,Zq);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Mi.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Bw,{keyPath:"compositeKey"})}}}catch(t){e(Mi.create("storage-open",{originalErrorMessage:t?.message}))}}),dp)}function Xq(n,e){return eG(tG(n),e)}function eG(n,e){return x(this,null,function*(){let r=(yield Jq()).transaction(Bw,"readwrite"),o=r.objectStore(Bw).put({compositeKey:n,value:e});return new Promise((s,a)=>{o.onsuccess=l=>{s()},r.onerror=l=>{var c;a(Mi.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function tG(n){return`${n.options.appId}-${n.name}`}var Uw=new hi("@firebase/app-check");function Lw(n,e){return eh()?Xq(n,e).catch(t=>{Uw.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Dx(){return wx().enabled}function Tx(){return x(this,null,function*(){let n=wx();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var nG={error:"UNKNOWN_ERROR"};function rG(n){return Jd.encodeString(JSON.stringify(n),!1)}function $w(n,e=!1){return x(this,null,function*(){let t=n.app;Ex(t);let r=Qn(t),i=r.token,o;if(i&&!ic(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(ic(l)?i=l:yield Lw(t,void 0))}if(!e&&i&&ic(i))return{token:i.token};let s=!1;if(Dx()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Ix(Cx(t,yield Tx()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),s=!0);let l=yield r.exchangeTokenPromise;return yield Lw(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),s=!0),i=yield Qn(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?Uw.warn(l.message):Uw.error(l),o=l}let a;return i?o?ic(i)?a={token:i.token,internalError:o}:a=mx(o):(a={token:i.token},r.token=i,yield Lw(t,i)):a=mx(o),s&&aG(t,a),a})}function iG(n){return x(this,null,function*(){let e=n.app;Ex(e);let{provider:t}=Qn(e);if(Dx()){let r=yield Tx(),{token:i}=yield Ix(Cx(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function oG(n,e,t,r){let{app:i}=n,o=Qn(i),s={next:t,error:r,type:e};if(o.tokenObservers=[...o.tokenObservers,s],o.token&&ic(o.token)){let a=o.token;Promise.resolve().then(()=>{t({token:a.token}),gx(n)}).catch(()=>{})}o.cachedTokenPromise.then(()=>gx(n))}function bx(n,e){let t=Qn(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function gx(n){let{app:e}=n,t=Qn(e),r=t.tokenRefresher;r||(r=sG(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function sG(n){let{app:e}=n;return new jw(()=>x(this,null,function*(){let t=Qn(e),r;if(t.token?r=yield $w(n,!0):r=yield $w(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Qn(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},px.RETRIAL_MIN_WAIT,px.RETRIAL_MAX_WAIT)}function aG(n,e){let t=Qn(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function ic(n){return n.expireTimeMillis-Date.now()>0}function mx(n){return{token:rG(nG),error:n}}var Hw=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Qn(this.app);for(let t of e)bx(this.app,t.next);return Promise.resolve()}};function lG(n,e){return new Hw(n,e)}function uG(n){return{getToken:e=>$w(n,e),getLimitedUseToken:()=>iG(n),addTokenListener:e=>oG(n,"INTERNAL",e),removeTokenListener:e=>bx(n.app,e)}}var cG="@firebase/app-check",dG="0.8.11";var hG="app-check",yx="app-check-internal";function fG(){fo(new ln(hG,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return lG(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(yx).initialize()})),fo(new ln(yx,n=>{let e=n.getProvider("app-check").getImmediate();return uG(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Un(cG,dG)}fG();var pG="app-check";var Ri=class{constructor(){return fx(pG)}};var gG=["localhost","0.0.0.0","127.0.0.1"],RX=typeof window<"u"&&gG.includes(window.location.hostname);var mG="firebase",yG="11.2.0";Dt.registerVersion(mG,yG,"app-compat");var _G=["ngOnDestroy"],Ax=(n,e,t,r={})=>new Proxy(n,{get:(i,o)=>t.runOutsideAngular(()=>{if(n[o])return r?.spy?.get&&r.spy.get(o,n[o]),n[o];if(_G.indexOf(o)>-1)return()=>{};let s=e.toPromise().then(a=>{let l=a?.[o];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>s[l],apply:(a,l,c)=>s.then(d=>{let f=d?.(...c);return r?.spy?.apply&&r.spy.apply(o,c,f),f})})})});var hp=class{constructor(e){return e}},xi=new z("angularfire2.app.options"),Ni=new z("angularfire2.app.name");function Ho(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let s=Dt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Dt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(s.options)){let a=!!module.hot;vG("error",`${s.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new hp(s)}var vG=(n,...e)=>{Su()&&typeof console<"u"&&console[n](...e)},wG={provide:hp,useFactory:Ho,deps:[xi,De,[new _f,Ni]]},Mx=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:xi,useValue:t},{provide:Ni,useValue:r}]}}constructor(t){Dt.registerVersion("angularfire",ba.full,"core"),Dt.registerVersion("angularfire",ba.full,"app-compat"),Dt.registerVersion("angular",NM.full,t.toString())}static \u0275fac=function(r){return new(r||n)(j(rn))};static \u0275mod=pn({type:n});static \u0275inj=hn({providers:[wG]})}return n})();function Sa(n,e,t,r,i){let[,o,s]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(o)return EG(i,s)||(Sx("error",`${e} was already initialized on the ${t} Firebase App with different settings.${IG?" You may need to reload as Firebase is not HMR aware.":""}`),Sx("warn",{is:i,was:s})),o;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function EG(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var IG=typeof module<"u"&&!!module.hot,Sx=(n,...e)=>{Su()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var oc=new z("angularfire2.auth.use-emulator"),sc=new z("angularfire2.auth.settings"),ac=new z("angularfire2.auth.tenant-id"),lc=new z("angularfire2.auth.langugage-code"),uc=new z("angularfire2.auth.use-device-language"),cc=new z("angularfire.auth.persistence"),dc=(n,e,t,r,i,o,s,a)=>Sa(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,o&&l.useDeviceLanguage(),s)for(let[c,d]of Object.entries(s))l.settings[c]=d;return a&&l.setPersistence(a),l},[t,r,i,o,s,a]),hc=(()=>{class n{injector=V(it);authState;idToken;user;idTokenResult;credential;constructor(t,r,i,o,s,a,l,c,d,f,g,m){let v=new Ge,T=ne(void 0).pipe(sr(s.outsideAngular),Qe(()=>o.runOutsideAngular(()=>import("./chunk-VTHNAWUC.js"))),Q(()=>Ho(t,o,r)),Q(S=>dc(S,o,a,c,d,f,l,g)),Fh({bufferSize:1,refCount:!1}));if(Vo(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=ne(null);else{T.pipe(Hn()).subscribe();let S=T.pipe(Qe(F=>F.getRedirectResult().then(W=>W,()=>null)),nt(this.injector),Fh({bufferSize:1,refCount:!1})),O=T.pipe(Qe(F=>new de(W=>({unsubscribe:o.runOutsideAngular(()=>F.onAuthStateChanged(oe=>W.next(oe),oe=>W.error(oe),()=>W.complete()))})))),B=T.pipe(Qe(F=>new de(W=>({unsubscribe:o.runOutsideAngular(()=>F.onIdTokenChanged(oe=>W.next(oe),oe=>W.error(oe),()=>W.complete()))}))));this.authState=S.pipe(Vh(O),Pr(s.outsideAngular),sr(s.insideAngular)),this.user=S.pipe(Vh(B),Pr(s.outsideAngular),sr(s.insideAngular)),this.idToken=this.user.pipe(Qe(F=>F?ke(F.getIdToken()):ne(null))),this.idTokenResult=this.user.pipe(Qe(F=>F?ke(F.getIdTokenResult()):ne(null))),this.credential=Bs(S,v,this.authState.pipe(Vt(F=>!F))).pipe(Q(F=>F?.user?F:null),Pr(s.outsideAngular),sr(s.insideAngular))}return Ax(this,T,o,{spy:{apply:(S,O,B)=>{(S.startsWith("signIn")||S.startsWith("createUser"))&&B.then(F=>v.next(F))}}})}static \u0275fac=function(r){return new(r||n)(j(xi),j(Ni,8),j(rn),j(De),j($o),j(oc,8),j(sc,8),j(ac,8),j(lc,8),j(uc,8),j(cc,8),j(Ri,8))};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Rx=(()=>{class n{constructor(){Dt.registerVersion("angularfire",ba.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=pn({type:n});static \u0275inj=hn({providers:[hc]})}return n})();var Nx="@firebase/database",Px="1.0.11";var nI="";function rI(n){nI=n}var Jw=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ut(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:th(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Xw=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Cn(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var cN=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Jw(e)}}catch{}return new Xw},Go=cN("localStorage"),eE=cN("sessionStorage");var xa=new hi("@firebase/database"),dN=function(){let n=1;return function(){return n++}}(),hN=function(n){let e=i0(n),t=new r0;t.update(e);let r=t.digest();return Jd.encodeByteArray(r)},Fc=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Fc.apply(null,r):typeof r=="object"?e+=ut(r):e+=r,e+=" "}return e},zo=null,kx=!0,fN=function(n,e){L(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(xa.logLevel=Dn.VERBOSE,zo=xa.log.bind(xa),e&&eE.set("logging_enabled",!0)):typeof n=="function"?zo=n:(zo=null,eE.remove("logging_enabled"))},Et=function(...n){if(kx===!0&&(kx=!1,zo===null&&eE.get("logging_enabled")===!0&&fN(!0)),zo){let e=Fc.apply(null,n);zo(e)}},Vc=function(n){return function(...e){Et(n,...e)}},tE=function(...n){let e="FIREBASE INTERNAL ERROR: "+Fc(...n);xa.error(e)},yr=function(...n){let e=`FIREBASE FATAL ERROR: ${Fc(...n)}`;throw xa.error(e),new Error(e)},Lt=function(...n){let e="FIREBASE WARNING: "+Fc(...n);xa.warn(e)},DG=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Lt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Bp=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},TG=function(n){if(ir()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Fi="[MIN_NAME]",Wr="[MAX_NAME]",Ko=function(n,e){if(n===e)return 0;if(n===Fi||e===Wr)return-1;if(e===Fi||n===Wr)return 1;{let t=Ox(n),r=Ox(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},bG=function(n,e){return n===e?0:n<e?-1:1},fc=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+ut(e))},iI=function(n){if(typeof n!="object"||n===null)return ut(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=ut(e[r]),t+=":",t+=iI(n[e[r]]);return t+="}",t},pN=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function It(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var gN=function(n){L(!Bp(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,o,s,a,l;n===0?(o=0,s=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),o=a+r,s=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(o=0,s=Math.round(n/Math.pow(2,1-r-t))));let c=[];for(l=t;l;l-=1)c.push(s%2?1:0),s=Math.floor(s/2);for(l=e;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);c.push(i?1:0),c.reverse();let d=c.join(""),f="";for(l=0;l<64;l+=8){let g=parseInt(d.substr(l,8),2).toString(16);g.length===1&&(g="0"+g),f=f+g}return f.toLowerCase()},SG=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},AG=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function MG(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var RG=new RegExp("^-?(0*)\\d{1,10}$"),xG=-2147483648,NG=2147483647,Ox=function(n){if(RG.test(n)){let e=Number(n);if(e>=xG&&e<=NG)return e}return null},Ba=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw Lt("Exception was thrown by user callback.",t),e},Math.floor(0))}},PG=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},yc=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var nE=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){Lt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var rE=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Et("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Lt(e)}},_c=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),pp="5",mN="v",yN="s",_N="r",vN="f",wN=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,EN="ls",IN="p",iE="ac",CN="websocket",DN="long_polling";var gp=class{constructor(e,t,r,i,o=!1,s="",a=!1,l=!1){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=o,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Go.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Go.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function kG(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function TN(n,e,t){L(typeof e=="string","typeof type must == string"),L(typeof t=="object","typeof params must == object");let r;if(e===CN)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===DN)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);kG(n)&&(t.ns=n.namespace);let i=[];return It(t,(o,s)=>{i.push(o+"="+s)}),r+i.join("&")}var oE=class{constructor(){this.counters_={}}incrementCounter(e,t=1){Cn(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Yb(this.counters_)}};var Gw={},zw={};function oI(n){let e=n.toString();return Gw[e]||(Gw[e]=new oE),Gw[e]}function OG(n,e){let t=n.toString();return zw[t]||(zw[t]=e()),zw[t]}var sE=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Ba(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var Fx="start",FG="close",VG="pLPCommand",LG="pRTLPCB",bN="id",SN="pw",AN="ser",jG="cb",BG="seg",UG="ts",$G="d",HG="dframe",MN=1870,RN=30,qG=MN-RN,GG=25e3,zG=3e4,Ic=class n{constructor(e,t,r,i,o,s,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=o,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Vc(e),this.stats_=oI(t),this.urlFn=l=>(this.appCheckToken&&(l[iE]=this.appCheckToken),TN(t,DN,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new sE(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(zG)),TG(()=>{if(this.isClosed_)return;this.scriptTagHolder=new aE((...o)=>{let[s,a,l,c,d]=o;if(this.incrementIncomingBytes_(o),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,s===Fx)this.id=a,this.password=l;else if(s===FG)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+s)},(...o)=>{let[s,a]=o;this.incrementIncomingBytes_(o),this.myPacketOrderer.handleResponse(s,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[Fx]="t",r[AN]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[jG]=this.scriptTagHolder.uniqueCallbackIdentifier),r[mN]=pp,this.transportSessionId&&(r[yN]=this.transportSessionId),this.lastSessionId&&(r[EN]=this.lastSessionId),this.applicationId&&(r[IN]=this.applicationId),this.appCheckToken&&(r[iE]=this.appCheckToken),typeof location<"u"&&location.hostname&&wN.test(location.hostname)&&(r[_N]=vN);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return ir()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!SG()&&!AG()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=ut(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=Qb(t),i=pN(r,qG);for(let o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(ir())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[HG]="t",r[bN]=e,r[SN]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=ut(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},aE=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,ir())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=dN(),window[VG+this.uniqueCallbackIdentifier]=e,window[LG+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let o="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(o='<script>document.domain="'+document.domain+'";<\/script>');let s="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(a){Et("frame writing exception"),a.stack&&Et(a.stack),Et(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Et("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[bN]=this.myID,e[SN]=this.myPW,e[AN]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+RN+r.length<=MN;){let s=this.pendingSegs.shift();r=r+"&"+BG+i+"="+s.seg+"&"+UG+i+"="+s.ts+"&"+$G+i+"="+s.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(GG)),o=()=>{clearTimeout(i),r()};this.addTag(e,o)}addTag(e,t){ir()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Et("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var WG=16384,KG=45e3,mp=null;typeof MozWebSocket<"u"?mp=MozWebSocket:typeof WebSocket<"u"&&(mp=WebSocket);var Ma=(()=>{class n{constructor(t,r,i,o,s,a,l){this.connId=t,this.applicationId=i,this.appCheckToken=o,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Vc(this.connId),this.stats_=oI(r),this.connURL=n.connectionURL_(r,a,l,o,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,o,s){let a={};return a[mN]=pp,!ir()&&typeof location<"u"&&location.hostname&&wN.test(location.hostname)&&(a[_N]=vN),r&&(a[yN]=r),i&&(a[EN]=i),o&&(a[iE]=o),s&&(a[IN]=s),TN(t,CN,a)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Go.set("previous_websocket_failure",!0);try{let i;if(ir()){let o=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${pp}/${nI}/${process.platform}/${o}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let s=process.env,a=this.connURL.indexOf("wss://")===0?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new mp(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let o=i.message||i.data;o&&this.log_(o),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let o=i.message||i.data;o&&this.log_(o),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&mp!==null&&!n.forceDisallow_}static previouslyFailed(){return Go.isInMemoryStorage||Go.get("previous_websocket_failure")===!0}markConnectionHealthy(){Go.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=th(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(L(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=ut(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=pN(r,WG);i.length>1&&this.sendString_(String(i.length));for(let o=0;o<i.length;o++)this.sendString_(i[o])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(KG))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),xN=(()=>{class n{static get ALL_TRANSPORTS(){return[Ic,Ma]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){let r=Ma&&Ma.isAvailable(),i=r&&!Ma.previouslyFailed();if(t.webSocketOnly&&(r||Lt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Ma];else{let o=this.transports_=[];for(let s of n.ALL_TRANSPORTS)s&&s.isAvailable()&&o.push(s);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),QG=6e4,YG=5e3,ZG=10*1024,JG=100*1024,Ww="t",Vx="d",XG="s",Lx="r",ez="e",jx="o",Bx="a",Ux="n",$x="p",tz="h",lE=class{constructor(e,t,r,i,o,s,a,l,c,d){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=o,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Vc("c:"+this.id+":"),this.transportManager_=new xN(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=yc(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>JG?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>ZG?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Ww in e){let t=e[Ww];t===Bx?this.upgradeIfSecondaryHealthy_():t===Lx?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===jx&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=fc("t",e),r=fc("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:$x,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Bx,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Ux,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=fc("t",e),r=fc("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=fc(Ww,e);if(Vx in e){let r=e[Vx];if(t===tz){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===Ux){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===XG?this.onConnectionShutdown_(r):t===Lx?this.onReset_(r):t===ez?tE("Server Error: "+r):t===jx?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):tE("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),pp!==r&&Lt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),yc(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(QG))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):yc(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(YG))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:$x,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Go.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var yp=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var _p=class{constructor(e){this.allowedEvents_=e,this.listeners_={},L(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let o=0;o<i.length;o++)if(i[o].callback===t&&(!r||r===i[o].context)){i.splice(o,1);return}}validateEventType_(e){L(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var vp=class n extends _p{static getInstance(){return new n}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!sy()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return L(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var Hx=32,qx=768,Pe=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function Ne(){return new Pe("")}function ye(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Vi(n){return n.pieces_.length-n.pieceNum_}function Ue(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Pe(n.pieces_,e)}function sI(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function nz(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Cc(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function NN(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new Pe(e,0)}function We(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof Pe)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new Pe(t,0)}function _e(n){return n.pieceNum_>=n.pieces_.length}function Qt(n,e){let t=ye(n),r=ye(e);if(t===null)return e;if(t===r)return Qt(Ue(n),Ue(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function rz(n,e){let t=Cc(n,0),r=Cc(e,0);for(let i=0;i<t.length&&i<r.length;i++){let o=Ko(t[i],r[i]);if(o!==0)return o}return t.length===r.length?0:t.length<r.length?-1:1}function aI(n,e){if(Vi(n)!==Vi(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function On(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Vi(n)>Vi(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var uE=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Cc(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Xl(this.parts_[r]);PN(this)}};function iz(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Xl(e),PN(n)}function oz(n){let e=n.parts_.pop();n.byteLength_-=Xl(e),n.parts_.length>0&&(n.byteLength_-=1)}function PN(n){if(n.byteLength_>qx)throw new Error(n.errorPrefix_+"has a key path longer than "+qx+" bytes ("+n.byteLength_+").");if(n.parts_.length>Hx)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Hx+") or object contains a cycle "+qo(n))}function qo(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var cE=class n extends _p{static getInstance(){return new n}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return L(e==="visible","Unknown event type: "+e),[this.visible_]}};var pc=1e3,sz=60*5*1e3,Gx=30*1e3,az=1.3,lz=3e4,uz="server_kill",zx=3,lI=(()=>{class n extends yp{constructor(t,r,i,o,s,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=o,this.onServerInfoUpdate_=s,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=Vc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=pc,this.maxReconnectDelay_=sz,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!ir())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");cE.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&vp.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let o=++this.requestNumber_,s={r:o,a:t,b:r};this.log_(ut(s)),L(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),i&&(this.requestCBHash_[o]=i)}get(t){this.initConnection_();let r=new wt,o={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?r.resolve(l):r.reject(l)}};this.outstandingGets_.push(o),this.outstandingGetCount_++;let s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),r.promise}listen(t,r,i,o){this.initConnection_();let s=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+s),this.listens.has(a)||this.listens.set(a,new Map),L(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),L(!this.listens.get(a).has(s),"listen() called twice for same path/queryId.");let l={onComplete:o,hashFn:r,query:t,tag:i};this.listens.get(a).set(s,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),o=r._queryIdentifier;this.log_("Listen on "+i+" for "+o);let s={p:i},a="q";t.tag&&(s.q=r._queryObject,s.t=t.tag),s.h=t.hashFn(),this.sendRequest(a,s,l=>{let c=l.d,d=l.s;n.warnOnListenWarnings_(c,r),(this.listens.get(i)&&this.listens.get(i).get(o))===t&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(i,o),t.onComplete&&t.onComplete(d,c))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&Cn(t,"w")){let i=di(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let o='".indexOn": "'+r._queryParams.getIndex().toString()+'"',s=r._path.toString();Lt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${o} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||t0(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Gx)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=e0(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,o=>{let s=o.s,a=o.d||"error";this.authToken_===t&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),o=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+o),L(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,o)&&this.connected_&&this.sendUnlisten_(i,o,t._queryObject,r)}sendUnlisten_(t,r,i,o){this.log_("Unlisten on "+t+" for "+r);let s={p:t},a="n";o&&(s.q=i,s.t=o),this.sendRequest(a,s)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,o){let s={p:r,d:i};this.log_("onDisconnect "+t,s),this.sendRequest(t,s,a=>{o&&setTimeout(()=>{o(a.s,a.d)},Math.floor(0))})}put(t,r,i,o){this.putInternal("p",t,r,i,o)}merge(t,r,i,o){this.putInternal("m",t,r,i,o)}putInternal(t,r,i,o,s){this.initConnection_();let a={p:r,d:i};s!==void 0&&(a.h=s),this.outstandingPuts_.push({action:t,request:a,onComplete:o}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,o=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,s=>{this.log_(r+" response",s),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),o&&o(s.s,s.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let s=i.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+ut(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):tE("Unrecognized action received from server: "+ut(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){L(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=pc,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=pc,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>lz&&(this.reconnectDelay_=pc),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*az)}this.onConnectStatus_(!1)}establishConnection_(){return x(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),o=this.id+":"+n.nextConnectionId_++,s=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,i())},d=function(g){L(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(g)};this.realtime_={close:c,sendRequest:d};let f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[g,m]=yield Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);a?Et("getToken() completed but was canceled"):(Et("getToken() completed. Creating connection."),this.authToken_=g&&g.accessToken,this.appCheckToken_=m&&m.token,l=new lE(o,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,v=>{Lt(v+" ("+this.repoInfo_.toString()+")"),this.interrupt(uz)},s))}catch(g){this.log_("Failed to get token: "+g),a||(this.repoInfo_.nodeAdmin&&Lt(g),c())}}})}interrupt(t){Et("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Et("Resuming connection for reason: "+t),delete this.interruptReasons_[t],nh(this.interruptReasons_)&&(this.reconnectDelay_=pc,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(s=>iI(s)).join("$"):i="default";let o=this.removeListen_(t,i);o&&o.onComplete&&o.onComplete("permission_denied")}removeListen_(t,r){let i=new Pe(t).toString(),o;if(this.listens.has(i)){let s=this.listens.get(i);o=s.get(r),s.delete(r),s.size===0&&this.listens.delete(i)}else o=void 0;return o}onAuthRevoked_(t,r){Et("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=zx&&(this.reconnectDelay_=Gx,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){Et("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=zx&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";ir()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+nI.replace(/\./g,"-")]=1,sy()?t["framework.cordova"]=1:Zb()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=vp.getInstance().currentlyOnline();return nh(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),ve=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var Na=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new ve(Fi,e),i=new ve(Fi,t);return this.compare(r,i)!==0}minPost(){return ve.MIN}};var fp,wp=class extends Na{static get __EMPTY_NODE(){return fp}static set __EMPTY_NODE(e){fp=e}compare(e,t){return Ko(e.name,t.name)}isDefinedOn(e){throw Ss("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ve.MIN}maxPost(){return new ve(Wr,fp)}makePost(e,t){return L(typeof e=="string","KeyIndex indexValue must always be a string."),new ve(e,fp)}toString(){return".key"}},mr=new wp;var Ra=class{constructor(e,t,r,i,o=null){this.isReverse_=i,this.resultGenerator_=o,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(e=e,s=t?r(e.key,t):1,i&&(s*=-1),s<0)this.isReverse_?e=e.left:e=e.right;else if(s===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Yn=(()=>{class n{constructor(t,r,i,o,s){this.key=t,this.value=r,this.color=i??n.RED,this.left=o??Fn.EMPTY_NODE,this.right=s??Fn.EMPTY_NODE}copy(t,r,i,o,s){return new n(t??this.key,r??this.value,i??this.color,o??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let o=this,s=i(t,o.key);return s<0?o=o.copy(null,null,null,o.left.insert(t,r,i),null):s===0?o=o.copy(null,r,null,null,null):o=o.copy(null,null,null,null,o.right.insert(t,r,i)),o.fixUp_()}removeMin_(){if(this.left.isEmpty())return Fn.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,o;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return Fn.EMPTY_NODE;o=i.right.min_(),i=i.copy(o.key,o.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),dE=class{copy(e,t,r,i,o){return this}insert(e,t,r){return new Yn(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},Fn=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Yn.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Yn.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ra(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ra(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ra(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ra(this.root_,null,this.comparator_,!0,e)}};Fn.EMPTY_NODE=new dE;function cz(n,e){return Ko(n.name,e.name)}function uI(n,e){return Ko(n,e)}var hE;function dz(n){hE=n}var kN=function(n){return typeof n=="number"?"number:"+gN(n):"string:"+n},ON=function(n){if(n.isLeafNode()){let e=n.val();L(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Cn(e,".sv"),"Priority must be a string or number.")}else L(n===hE||n.isEmpty(),"priority of unexpected type.");L(n===hE||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Wx,Pa=(()=>{class n{static set __childrenNodeConstructor(t){Wx=t}static get __childrenNodeConstructor(){return Wx}constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,L(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),ON(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return _e(t)?this:ye(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=ye(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(L(i!==".priority"||Vi(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ue(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+kN(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=gN(this.value_):t+=this.value_,this.lazyHash_=hN(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(L(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,o=n.VALUE_TYPE_ORDER.indexOf(r),s=n.VALUE_TYPE_ORDER.indexOf(i);return L(o>=0,"Unknown leaf type: "+r),L(s>=0,"Unknown leaf type: "+i),o===s?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-o}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),FN,VN;function hz(n){FN=n}function fz(n){VN=n}var fE=class extends Na{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),o=r.compareTo(i);return o===0?Ko(e.name,t.name):o}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ve.MIN}maxPost(){return new ve(Wr,new Pa("[PRIORITY-POST]",VN))}makePost(e,t){let r=FN(e);return new ve(t,new Pa("[PRIORITY-POST]",r))}toString(){return".priority"}},$e=new fE;var pz=Math.log(2),pE=class{constructor(e){let t=o=>parseInt(Math.log(o)/pz,10),r=o=>parseInt(Array(o+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Ep=function(n,e,t,r){n.sort(e);let i=function(l,c){let d=c-l,f,g;if(d===0)return null;if(d===1)return f=n[l],g=t?t(f):f,new Yn(g,f.node,Yn.BLACK,null,null);{let m=parseInt(d/2,10)+l,v=i(l,m),T=i(m+1,c);return f=n[m],g=t?t(f):f,new Yn(g,f.node,Yn.BLACK,v,T)}},o=function(l){let c=null,d=null,f=n.length,g=function(v,T){let S=f-v,O=f;f-=v;let B=i(S+1,O),F=n[S],W=t?t(F):F;m(new Yn(W,F.node,T,null,B))},m=function(v){c?(c.left=v,c=v):(d=v,c=v)};for(let v=0;v<l.count;++v){let T=l.nextBitIsOne(),S=Math.pow(2,l.count-(v+1));T?g(S,Yn.BLACK):(g(S,Yn.BLACK),g(S,Yn.RED))}return d},s=new pE(n.length),a=o(s);return new Fn(r||e,a)};var Kw,Aa={},ka=class n{static get Default(){return L(Aa&&$e,"ChildrenNode.ts has not been loaded"),Kw=Kw||new n({".priority":Aa},{".priority":$e}),Kw}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=di(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Fn?t:null}hasIndex(e){return Cn(this.indexSet_,e.toString())}addIndex(e,t){L(e!==mr,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,o=t.getIterator(ve.Wrap),s=o.getNext();for(;s;)i=i||e.isDefinedOn(s.node),r.push(s),s=o.getNext();let a;i?a=Ep(r,e.getCompare()):a=Aa;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let d=Object.assign({},this.indexes_);return d[l]=a,new n(d,c)}addToIndexes(e,t){let r=Jl(this.indexes_,(i,o)=>{let s=di(this.indexSet_,o);if(L(s,"Missing index implementation for "+o),i===Aa)if(s.isDefinedOn(e.node)){let a=[],l=t.getIterator(ve.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),Ep(a,s.getCompare())}else return Aa;else{let a=t.get(e.name),l=i;return a&&(l=l.remove(new ve(e.name,a))),l.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=Jl(this.indexes_,i=>{if(i===Aa)return i;{let o=t.get(e.name);return o?i.remove(new ve(e.name,o)):i}});return new n(r,this.indexSet_)}};var gc,he=(()=>{class n{static get EMPTY_NODE(){return gc||(gc=new n(new Fn(uI),null,ka.Default))}constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&ON(this.priorityNode_),this.children_.isEmpty()&&L(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||gc}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?gc:r}}getChild(t){let r=ye(t);return r===null?this:this.getImmediateChild(r).getChild(Ue(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(L(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new ve(t,r),o,s;r.isEmpty()?(o=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(t,r),s=this.indexMap_.addToIndexes(i,this.children_));let a=o.isEmpty()?gc:this.priorityNode_;return new n(o,a,s)}}updateChild(t,r){let i=ye(t);if(i===null)return r;{L(ye(t)!==".priority"||Vi(t)===1,".priority must be the last token in a path");let o=this.getImmediateChild(i).updateChild(Ue(t),r);return this.updateImmediateChild(i,o)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,o=0,s=!0;if(this.forEachChild($e,(a,l)=>{r[a]=l.val(t),i++,s&&n.INTEGER_REGEXP_.test(a)?o=Math.max(o,Number(a)):s=!1}),!t&&s&&o<2*i){let a=[];for(let l in r)a[l]=r[l];return a}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+kN(this.getPriority().val())+":"),this.forEachChild($e,(r,i)=>{let o=i.hash();o!==""&&(t+=":"+r+":"+o)}),this.lazyHash_=t===""?"":hN(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let o=this.resolveIndex_(i);if(o){let s=o.getPredecessorKey(new ve(t,r));return s?s.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new ve(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new ve(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(o=>r(o.name,o.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,o=>o);{let o=this.children_.getIteratorFrom(t.name,ve.Wrap),s=o.peek();for(;s!=null&&r.compare(s,t)<0;)o.getNext(),s=o.peek();return o}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,o=>o);{let o=this.children_.getReverseIteratorFrom(t.name,ve.Wrap),s=o.peek();for(;s!=null&&r.compare(s,t)>0;)o.getNext(),s=o.peek();return o}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Lc?-1:0}withIndex(t){if(t===mr||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===mr||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator($e),o=r.getIterator($e),s=i.getNext(),a=o.getNext();for(;s&&a;){if(s.name!==a.name||!s.node.equals(a.node))return!1;s=i.getNext(),a=o.getNext()}return s===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===mr?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),gE=class extends he{constructor(){super(new Fn(uI),he.EMPTY_NODE,ka.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return he.EMPTY_NODE}isEmpty(){return!1}},Lc=new gE;Object.defineProperties(ve,{MIN:{value:new ve(Fi,he.EMPTY_NODE)},MAX:{value:new ve(Wr,Lc)}});wp.__EMPTY_NODE=he.EMPTY_NODE;Pa.__childrenNodeConstructor=he;dz(Lc);fz(Lc);var gz=!0;function Ze(n,e=null){if(n===null)return he.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),L(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Pa(t,Ze(e))}if(!(n instanceof Array)&&gz){let t=[],r=!1;if(It(n,(s,a)=>{if(s.substring(0,1)!=="."){let l=Ze(a);l.isEmpty()||(r=r||!l.getPriority().isEmpty(),t.push(new ve(s,l)))}}),t.length===0)return he.EMPTY_NODE;let o=Ep(t,cz,s=>s.name,uI);if(r){let s=Ep(t,$e.getCompare());return new he(o,Ze(e),new ka({".priority":s},{".priority":$e}))}else return new he(o,Ze(e),ka.Default)}else{let t=he.EMPTY_NODE;return It(n,(r,i)=>{if(Cn(n,r)&&r.substring(0,1)!=="."){let o=Ze(i);(o.isLeafNode()||!o.isEmpty())&&(t=t.updateImmediateChild(r,o))}}),t.updatePriority(Ze(e))}}hz(Ze);var Dc=class extends Na{constructor(e){super(),this.indexPath_=e,L(!_e(e)&&ye(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),o=r.compareTo(i);return o===0?Ko(e.name,t.name):o}makePost(e,t){let r=Ze(e),i=he.EMPTY_NODE.updateChild(this.indexPath_,r);return new ve(t,i)}maxPost(){let e=he.EMPTY_NODE.updateChild(this.indexPath_,Lc);return new ve(Wr,e)}toString(){return Cc(this.indexPath_,0).join("/")}};var mE=class extends Na{compare(e,t){let r=e.node.compareTo(t.node);return r===0?Ko(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ve.MIN}maxPost(){return ve.MAX}makePost(e,t){let r=Ze(e);return new ve(t,r)}toString(){return".value"}},cI=new mE;function LN(n){return{type:"value",snapshotNode:n}}function Oa(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Tc(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function bc(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function mz(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Sc=class{constructor(e){this.index_=e}updateChild(e,t,r,i,o,s){L(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(s!=null&&(r.isEmpty()?e.hasChild(t)?s.trackChildChange(Tc(t,a)):L(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(Oa(t,r)):s.trackChildChange(bc(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild($e,(i,o)=>{t.hasChild(i)||r.trackChildChange(Tc(i,o))}),t.isLeafNode()||t.forEachChild($e,(i,o)=>{if(e.hasChild(i)){let s=e.getImmediateChild(i);s.equals(o)||r.trackChildChange(bc(i,o,s))}else r.trackChildChange(Oa(i,o))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?he.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Ip=class n{constructor(e){this.indexedFilter_=new Sc(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,o,s){return this.matches(new ve(t,r))||(r=he.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,o,s)}updateFullNode(e,t,r){t.isLeafNode()&&(t=he.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(he.EMPTY_NODE);let o=this;return t.forEachChild($e,(s,a)=>{o.matches(new ve(s,a))||(i=i.updateImmediateChild(s,he.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var yE=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new Ip(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,o,s){return this.rangedFilter_.matches(new ve(t,r))||(r=he.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,o,s):this.fullLimitUpdateChild_(e,t,r,o,s)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=he.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=he.EMPTY_NODE.withIndex(this.index_);let o;this.reverse_?o=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let s=0;for(;o.hasNext()&&s<this.limit_;){let a=o.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),s++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(he.EMPTY_NODE);let o;this.reverse_?o=i.getReverseIterator(this.index_):o=i.getIterator(this.index_);let s=0;for(;o.hasNext();){let a=o.getNext();s<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?s++:i=i.updateImmediateChild(a.name,he.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,o){let s;if(this.reverse_){let f=this.index_.getCompare();s=(g,m)=>f(m,g)}else s=this.index_.getCompare();let a=e;L(a.numChildren()===this.limit_,"");let l=new ve(t,r),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(l);if(a.hasChild(t)){let f=a.getImmediateChild(t),g=i.getChildAfterChild(this.index_,c,this.reverse_);for(;g!=null&&(g.name===t||a.hasChild(g.name));)g=i.getChildAfterChild(this.index_,g,this.reverse_);let m=g==null?1:s(g,l);if(d&&!r.isEmpty()&&m>=0)return o?.trackChildChange(bc(t,r,f)),a.updateImmediateChild(t,r);{o?.trackChildChange(Tc(t,f));let T=a.updateImmediateChild(t,he.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(o?.trackChildChange(Oa(g.name,g.node)),T.updateImmediateChild(g.name,g.node)):T}}else return r.isEmpty()?e:d&&s(c,l)>=0?(o!=null&&(o.trackChildChange(Tc(c.name,c.node)),o.trackChildChange(Oa(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(c.name,he.EMPTY_NODE)):e}};var Ac=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=$e}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return L(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return L(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Fi}hasEnd(){return this.endSet_}getIndexEndValue(){return L(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return L(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Wr}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return L(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===$e}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function yz(n){return n.loadsAllData()?new Sc(n.getIndex()):n.hasLimit()?new yE(n):new Ip(n)}function _z(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function vz(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function _E(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function wz(n,e,t){let r;return n.index_===mr||t?r=_E(n,e,t):r=_E(n,e,Wr),r.startAfterSet_=!0,r}function vE(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function Ez(n,e,t){let r;return n.index_===mr||t?r=vE(n,e,t):r=vE(n,e,Fi),r.endBeforeSet_=!0,r}function Up(n,e){let t=n.copy();return t.index_=e,t}function Kx(n){let e={};if(n.isDefault())return e;let t;if(n.index_===$e?t="$priority":n.index_===cI?t="$value":n.index_===mr?t="$key":(L(n.index_ instanceof Dc,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=ut(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=ut(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+ut(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=ut(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+ut(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Qx(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==$e&&(e.i=n.index_.toString()),e}var wE=class n extends yp{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(L(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=Vc("p:rest:"),this.listens_={}}listen(e,t,r,i){let o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);let s=n.getListenId_(e,r),a={};this.listens_[s]=a;let l=Kx(e._queryParams);this.restRequest_(o+".json",l,(c,d)=>{let f=d;if(c===404&&(f=null,c=null),c===null&&this.onDataUpdate_(o,f,!1,r),di(this.listens_,s)===a){let g;c?c===401?g="permission_denied":g="rest_error:"+c:g="ok",i(g,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=Kx(e._queryParams),r=e._path.toString(),i=new wt;return this.restRequest_(r+".json",t,(o,s)=>{let a=s;o===404&&(a=null,o=null),o===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,o])=>{i&&i.accessToken&&(t.auth=i.accessToken),o&&o.token&&(t.ac=o.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+n0(t);this.log_("Sending REST request for "+s);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+s+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=th(a.responseText)}catch{Lt("Failed to parse JSON response for "+s+": "+a.responseText)}r(null,l)}else a.status!==401&&a.status!==404&&Lt("Got unsuccessful REST response for "+s+" Status: "+a.status),r(a.status);r=null}},a.open("GET",s,!0),a.send()})}};var EE=class{constructor(){this.rootNode_=he.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Cp(){return{value:null,children:new Map}}function Ua(n,e,t){if(_e(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=ye(e);n.children.has(r)||n.children.set(r,Cp());let i=n.children.get(r);e=Ue(e),Ua(i,e,t)}}function IE(n,e){if(_e(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild($e,(r,i)=>{Ua(n,new Pe(r),i)}),IE(n,e)}}else if(n.children.size>0){let t=ye(e);return e=Ue(e),n.children.has(t)&&IE(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function CE(n,e,t){n.value!==null?t(e,n.value):Iz(n,(r,i)=>{let o=new Pe(e.toString()+"/"+r);CE(i,o,t)})}function Iz(n,e){n.children.forEach((t,r)=>{e(r,t)})}var DE=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&It(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var Yx=10*1e3,Cz=30*1e3,Dz=5*60*1e3,TE=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new DE(e);let r=Yx+(Cz-Yx)*Math.random();yc(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;It(e,(i,o)=>{o>0&&Cn(this.statsToReport_,i)&&(t[i]=o,r=!0)}),r&&this.server_.reportStats(t),yc(this.reportStats_.bind(this),Math.floor(Math.random()*2*Dz))}};var gr=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(gr||{});function dI(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function hI(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function fI(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var bE=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=gr.ACK_USER_WRITE,this.source=dI()}operationForChild(e){if(_e(this.path)){if(this.affectedTree.value!=null)return L(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new Pe(e));return new n(Ne(),t,this.revert)}}else return L(ye(this.path)===e,"operationForChild called for unrelated child."),new n(Ue(this.path),this.affectedTree,this.revert)}};var Dp=class n{constructor(e,t){this.source=e,this.path=t,this.type=gr.LISTEN_COMPLETE}operationForChild(e){return _e(this.path)?new n(this.source,Ne()):new n(this.source,Ue(this.path))}};var Fa=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=gr.OVERWRITE}operationForChild(e){return _e(this.path)?new n(this.source,Ne(),this.snap.getImmediateChild(e)):new n(this.source,Ue(this.path),this.snap)}};var Mc=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=gr.MERGE}operationForChild(e){if(_e(this.path)){let t=this.children.subtree(new Pe(e));return t.isEmpty()?null:t.value?new Fa(this.source,Ne(),t.value):new n(this.source,Ne(),t)}else return L(ye(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,Ue(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var _r=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(_e(e))return this.isFullyInitialized()&&!this.filtered_;let t=ye(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var SE=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function Tz(n,e,t,r){let i=[],o=[];return e.forEach(s=>{s.type==="child_changed"&&n.index_.indexedValueChanged(s.oldSnap,s.snapshotNode)&&o.push(mz(s.childName,s.snapshotNode))}),mc(n,i,"child_removed",e,r,t),mc(n,i,"child_added",e,r,t),mc(n,i,"child_moved",o,r,t),mc(n,i,"child_changed",e,r,t),mc(n,i,"value",e,r,t),i}function mc(n,e,t,r,i,o){let s=r.filter(a=>a.type===t);s.sort((a,l)=>Sz(n,a,l)),s.forEach(a=>{let l=bz(n,a,o);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function bz(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Sz(n,e,t){if(e.childName==null||t.childName==null)throw Ss("Should only compare child_ events.");let r=new ve(e.childName,e.snapshotNode),i=new ve(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function $p(n,e){return{eventCache:n,serverCache:e}}function vc(n,e,t,r){return $p(new _r(e,t,r),n.serverCache)}function jN(n,e,t,r){return $p(n.eventCache,new _r(e,t,r))}function Tp(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Wo(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Qw,Az=()=>(Qw||(Qw=new Fn(bG)),Qw),Yt=class n{static fromObject(e){let t=new n(null);return It(e,(r,i)=>{t=t.set(new Pe(r),i)}),t}constructor(e,t=Az()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Ne(),value:this.value};if(_e(e))return null;{let r=ye(e),i=this.children.get(r);if(i!==null){let o=i.findRootMostMatchingPathAndValue(Ue(e),t);return o!=null?{path:We(new Pe(r),o.path),value:o.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(_e(e))return this;{let t=ye(e),r=this.children.get(t);return r!==null?r.subtree(Ue(e)):new n(null)}}set(e,t){if(_e(e))return new n(t,this.children);{let r=ye(e),o=(this.children.get(r)||new n(null)).set(Ue(e),t),s=this.children.insert(r,o);return new n(this.value,s)}}remove(e){if(_e(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=ye(e),r=this.children.get(t);if(r){let i=r.remove(Ue(e)),o;return i.isEmpty()?o=this.children.remove(t):o=this.children.insert(t,i),this.value===null&&o.isEmpty()?new n(null):new n(this.value,o)}else return this}}get(e){if(_e(e))return this.value;{let t=ye(e),r=this.children.get(t);return r?r.get(Ue(e)):null}}setTree(e,t){if(_e(e))return t;{let r=ye(e),o=(this.children.get(r)||new n(null)).setTree(Ue(e),t),s;return o.isEmpty()?s=this.children.remove(r):s=this.children.insert(r,o),new n(this.value,s)}}fold(e){return this.fold_(Ne(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,o)=>{r[i]=o.fold_(We(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,Ne(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(_e(e))return null;{let o=ye(e),s=this.children.get(o);return s?s.findOnPath_(Ue(e),We(t,o),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ne(),t)}foreachOnPath_(e,t,r){if(_e(e))return this;{this.value&&r(t,this.value);let i=ye(e),o=this.children.get(i);return o?o.foreachOnPath_(Ue(e),We(t,i),r):new n(null)}}foreach(e){this.foreach_(Ne(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(We(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var Zn=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new Yt(null))}};function wc(n,e,t){if(_e(e))return new Zn(new Yt(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,o=r.value,s=Qt(i,e);return o=o.updateChild(s,t),new Zn(n.writeTree_.set(i,o))}else{let i=new Yt(t),o=n.writeTree_.setTree(e,i);return new Zn(o)}}}function AE(n,e,t){let r=n;return It(t,(i,o)=>{r=wc(r,We(e,i),o)}),r}function Zx(n,e){if(_e(e))return Zn.empty();{let t=n.writeTree_.setTree(e,new Yt(null));return new Zn(t)}}function ME(n,e){return Qo(n,e)!=null}function Qo(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Qt(t.path,e)):null}function Jx(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild($e,(r,i)=>{e.push(new ve(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new ve(r,i.value))}),e}function ki(n,e){if(_e(e))return n;{let t=Qo(n,e);return t!=null?new Zn(new Yt(t)):new Zn(n.writeTree_.subtree(e))}}function RE(n){return n.writeTree_.isEmpty()}function Va(n,e){return BN(Ne(),n.writeTree_,e)}function BN(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,o)=>{i===".priority"?(L(o.value!==null,"Priority writes must always be leaf nodes"),r=o.value):t=BN(We(n,i),o,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(We(n,".priority"),r)),t}}function Hp(n,e){return qN(e,n)}function Mz(n,e,t,r,i){L(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=wc(n.visibleWrites,e,t)),n.lastWriteId=r}function Rz(n,e,t,r){L(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=AE(n.visibleWrites,e,t),n.lastWriteId=r}function xz(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function Nz(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);L(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,o=!1,s=n.allWrites.length-1;for(;i&&s>=0;){let a=n.allWrites[s];a.visible&&(s>=t&&Pz(a,r.path)?i=!1:On(r.path,a.path)&&(o=!0)),s--}if(i){if(o)return kz(n),!0;if(r.snap)n.visibleWrites=Zx(n.visibleWrites,r.path);else{let a=r.children;It(a,l=>{n.visibleWrites=Zx(n.visibleWrites,We(r.path,l))})}return!0}else return!1}function Pz(n,e){if(n.snap)return On(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&On(We(n.path,t),e))return!0;return!1}function kz(n){n.visibleWrites=UN(n.allWrites,Oz,Ne()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Oz(n){return n.visible}function UN(n,e,t){let r=Zn.empty();for(let i=0;i<n.length;++i){let o=n[i];if(e(o)){let s=o.path,a;if(o.snap)On(t,s)?(a=Qt(t,s),r=wc(r,a,o.snap)):On(s,t)&&(a=Qt(s,t),r=wc(r,Ne(),o.snap.getChild(a)));else if(o.children){if(On(t,s))a=Qt(t,s),r=AE(r,a,o.children);else if(On(s,t))if(a=Qt(s,t),_e(a))r=AE(r,Ne(),o.children);else{let l=di(o.children,ye(a));if(l){let c=l.getChild(Ue(a));r=wc(r,Ne(),c)}}}else throw Ss("WriteRecord should have .snap or .children")}}return r}function $N(n,e,t,r,i){if(!r&&!i){let o=Qo(n.visibleWrites,e);if(o!=null)return o;{let s=ki(n.visibleWrites,e);if(RE(s))return t;if(t==null&&!ME(s,Ne()))return null;{let a=t||he.EMPTY_NODE;return Va(s,a)}}}else{let o=ki(n.visibleWrites,e);if(!i&&RE(o))return t;if(!i&&t==null&&!ME(o,Ne()))return null;{let s=function(c){return(c.visible||i)&&(!r||!~r.indexOf(c.writeId))&&(On(c.path,e)||On(e,c.path))},a=UN(n.allWrites,s,e),l=t||he.EMPTY_NODE;return Va(a,l)}}}function Fz(n,e,t){let r=he.EMPTY_NODE,i=Qo(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild($e,(o,s)=>{r=r.updateImmediateChild(o,s)}),r;if(t){let o=ki(n.visibleWrites,e);return t.forEachChild($e,(s,a)=>{let l=Va(ki(o,new Pe(s)),a);r=r.updateImmediateChild(s,l)}),Jx(o).forEach(s=>{r=r.updateImmediateChild(s.name,s.node)}),r}else{let o=ki(n.visibleWrites,e);return Jx(o).forEach(s=>{r=r.updateImmediateChild(s.name,s.node)}),r}}function Vz(n,e,t,r,i){L(r||i,"Either existingEventSnap or existingServerSnap must exist");let o=We(e,t);if(ME(n.visibleWrites,o))return null;{let s=ki(n.visibleWrites,o);return RE(s)?i.getChild(t):Va(s,i.getChild(t))}}function Lz(n,e,t,r){let i=We(e,t),o=Qo(n.visibleWrites,i);if(o!=null)return o;if(r.isCompleteForChild(t)){let s=ki(n.visibleWrites,i);return Va(s,r.getNode().getImmediateChild(t))}else return null}function jz(n,e){return Qo(n.visibleWrites,e)}function Bz(n,e,t,r,i,o,s){let a,l=ki(n.visibleWrites,e),c=Qo(l,Ne());if(c!=null)a=c;else if(t!=null)a=Va(l,t);else return[];if(a=a.withIndex(s),!a.isEmpty()&&!a.isLeafNode()){let d=[],f=s.getCompare(),g=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s),m=g.getNext();for(;m&&d.length<i;)f(m,r)!==0&&d.push(m),m=g.getNext();return d}else return[]}function Uz(){return{visibleWrites:Zn.empty(),allWrites:[],lastWriteId:-1}}function bp(n,e,t,r){return $N(n.writeTree,n.treePath,e,t,r)}function pI(n,e){return Fz(n.writeTree,n.treePath,e)}function Xx(n,e,t,r){return Vz(n.writeTree,n.treePath,e,t,r)}function Sp(n,e){return jz(n.writeTree,We(n.treePath,e))}function $z(n,e,t,r,i,o){return Bz(n.writeTree,n.treePath,e,t,r,i,o)}function gI(n,e,t){return Lz(n.writeTree,n.treePath,e,t)}function HN(n,e){return qN(We(n.treePath,e),n.writeTree)}function qN(n,e){return{treePath:n,writeTree:e}}var xE=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;L(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),L(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let o=i.type;if(t==="child_added"&&o==="child_removed")this.changeMap.set(r,bc(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&o==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&o==="child_changed")this.changeMap.set(r,Tc(r,i.oldSnap));else if(t==="child_changed"&&o==="child_added")this.changeMap.set(r,Oa(r,e.snapshotNode));else if(t==="child_changed"&&o==="child_changed")this.changeMap.set(r,bc(r,e.snapshotNode,i.oldSnap));else throw Ss("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var NE=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},GN=new NE,Rc=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new _r(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return gI(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Wo(this.viewCache_),o=$z(this.writes_,i,t,1,r,e);return o.length===0?null:o[0]}};function Hz(n){return{filter:n}}function qz(n,e){L(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),L(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Gz(n,e,t,r,i){let o=new xE,s,a;if(t.type===gr.OVERWRITE){let c=t;c.source.fromUser?s=PE(n,e,c.path,c.snap,r,i,o):(L(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!_e(c.path),s=Ap(n,e,c.path,c.snap,r,i,a,o))}else if(t.type===gr.MERGE){let c=t;c.source.fromUser?s=Wz(n,e,c.path,c.children,r,i,o):(L(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),s=kE(n,e,c.path,c.children,r,i,a,o))}else if(t.type===gr.ACK_USER_WRITE){let c=t;c.revert?s=Yz(n,e,c.path,r,i,o):s=Kz(n,e,c.path,c.affectedTree,r,i,o)}else if(t.type===gr.LISTEN_COMPLETE)s=Qz(n,e,t.path,r,o);else throw Ss("Unknown operation type: "+t.type);let l=o.getChanges();return zz(e,s,l),{viewCache:s,changes:l}}function zz(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=Tp(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&t.push(LN(Tp(e)))}}function zN(n,e,t,r,i,o){let s=e.eventCache;if(Sp(r,t)!=null)return e;{let a,l;if(_e(t))if(L(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=Wo(e),d=c instanceof he?c:he.EMPTY_NODE,f=pI(r,d);a=n.filter.updateFullNode(e.eventCache.getNode(),f,o)}else{let c=bp(r,Wo(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,o)}else{let c=ye(t);if(c===".priority"){L(Vi(t)===1,"Can't have a priority with additional path components");let d=s.getNode();l=e.serverCache.getNode();let f=Xx(r,t,d,l);f!=null?a=n.filter.updatePriority(d,f):a=s.getNode()}else{let d=Ue(t),f;if(s.isCompleteForChild(c)){l=e.serverCache.getNode();let g=Xx(r,t,s.getNode(),l);g!=null?f=s.getNode().getImmediateChild(c).updateChild(d,g):f=s.getNode().getImmediateChild(c)}else f=gI(r,c,e.serverCache);f!=null?a=n.filter.updateChild(s.getNode(),c,f,d,i,o):a=s.getNode()}}return vc(e,a,s.isFullyInitialized()||_e(t),n.filter.filtersNodes())}}function Ap(n,e,t,r,i,o,s,a){let l=e.serverCache,c,d=s?n.filter:n.filter.getIndexedFilter();if(_e(t))c=d.updateFullNode(l.getNode(),r,null);else if(d.filtersNodes()&&!l.isFiltered()){let m=l.getNode().updateChild(t,r);c=d.updateFullNode(l.getNode(),m,null)}else{let m=ye(t);if(!l.isCompleteForPath(t)&&Vi(t)>1)return e;let v=Ue(t),S=l.getNode().getImmediateChild(m).updateChild(v,r);m===".priority"?c=d.updatePriority(l.getNode(),S):c=d.updateChild(l.getNode(),m,S,v,GN,null)}let f=jN(e,c,l.isFullyInitialized()||_e(t),d.filtersNodes()),g=new Rc(i,f,o);return zN(n,f,t,i,g,a)}function PE(n,e,t,r,i,o,s){let a=e.eventCache,l,c,d=new Rc(i,e,o);if(_e(t))c=n.filter.updateFullNode(e.eventCache.getNode(),r,s),l=vc(e,c,!0,n.filter.filtersNodes());else{let f=ye(t);if(f===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),r),l=vc(e,c,a.isFullyInitialized(),a.isFiltered());else{let g=Ue(t),m=a.getNode().getImmediateChild(f),v;if(_e(g))v=r;else{let T=d.getCompleteChild(f);T!=null?sI(g)===".priority"&&T.getChild(NN(g)).isEmpty()?v=T:v=T.updateChild(g,r):v=he.EMPTY_NODE}if(m.equals(v))l=e;else{let T=n.filter.updateChild(a.getNode(),f,v,g,d,s);l=vc(e,T,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function eN(n,e){return n.eventCache.isCompleteForChild(e)}function Wz(n,e,t,r,i,o,s){let a=e;return r.foreach((l,c)=>{let d=We(t,l);eN(e,ye(d))&&(a=PE(n,a,d,c,i,o,s))}),r.foreach((l,c)=>{let d=We(t,l);eN(e,ye(d))||(a=PE(n,a,d,c,i,o,s))}),a}function tN(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function kE(n,e,t,r,i,o,s,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;_e(t)?c=r:c=new Yt(null).setTree(t,r);let d=e.serverCache.getNode();return c.children.inorderTraversal((f,g)=>{if(d.hasChild(f)){let m=e.serverCache.getNode().getImmediateChild(f),v=tN(n,m,g);l=Ap(n,l,new Pe(f),v,i,o,s,a)}}),c.children.inorderTraversal((f,g)=>{let m=!e.serverCache.isCompleteForChild(f)&&g.value===null;if(!d.hasChild(f)&&!m){let v=e.serverCache.getNode().getImmediateChild(f),T=tN(n,v,g);l=Ap(n,l,new Pe(f),T,i,o,s,a)}}),l}function Kz(n,e,t,r,i,o,s){if(Sp(i,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(r.value!=null){if(_e(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Ap(n,e,t,l.getNode().getChild(t),i,o,a,s);if(_e(t)){let c=new Yt(null);return l.getNode().forEachChild(mr,(d,f)=>{c=c.set(new Pe(d),f)}),kE(n,e,t,c,i,o,a,s)}else return e}else{let c=new Yt(null);return r.foreach((d,f)=>{let g=We(t,d);l.isCompleteForPath(g)&&(c=c.set(d,l.getNode().getChild(g)))}),kE(n,e,t,c,i,o,a,s)}}function Qz(n,e,t,r,i){let o=e.serverCache,s=jN(e,o.getNode(),o.isFullyInitialized()||_e(t),o.isFiltered());return zN(n,s,t,r,GN,i)}function Yz(n,e,t,r,i,o){let s;if(Sp(r,t)!=null)return e;{let a=new Rc(r,e,i),l=e.eventCache.getNode(),c;if(_e(t)||ye(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=bp(r,Wo(e));else{let f=e.serverCache.getNode();L(f instanceof he,"serverChildren would be complete if leaf node"),d=pI(r,f)}d=d,c=n.filter.updateFullNode(l,d,o)}else{let d=ye(t),f=gI(r,d,e.serverCache);f==null&&e.serverCache.isCompleteForChild(d)&&(f=l.getImmediateChild(d)),f!=null?c=n.filter.updateChild(l,d,f,Ue(t),a,o):e.eventCache.getNode().hasChild(d)?c=n.filter.updateChild(l,d,he.EMPTY_NODE,Ue(t),a,o):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(s=bp(r,Wo(e)),s.isLeafNode()&&(c=n.filter.updateFullNode(c,s,o)))}return s=e.serverCache.isFullyInitialized()||Sp(r,Ne())!=null,vc(e,c,s,n.filter.filtersNodes())}}var OE=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new Sc(r.getIndex()),o=yz(r);this.processor_=Hz(o);let s=t.serverCache,a=t.eventCache,l=i.updateFullNode(he.EMPTY_NODE,s.getNode(),null),c=o.updateFullNode(he.EMPTY_NODE,a.getNode(),null),d=new _r(l,s.isFullyInitialized(),i.filtersNodes()),f=new _r(c,a.isFullyInitialized(),o.filtersNodes());this.viewCache_=$p(f,d),this.eventGenerator_=new SE(this.query_)}get query(){return this.query_}};function Zz(n){return n.viewCache_.serverCache.getNode()}function Jz(n){return Tp(n.viewCache_)}function Xz(n,e){let t=Wo(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!_e(e)&&!t.getImmediateChild(ye(e)).isEmpty())?t.getChild(e):null}function nN(n){return n.eventRegistrations_.length===0}function e4(n,e){n.eventRegistrations_.push(e)}function rN(n,e,t){let r=[];if(t){L(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(o=>{let s=o.createCancelEvent(t,i);s&&r.push(s)})}if(e){let i=[];for(let o=0;o<n.eventRegistrations_.length;++o){let s=n.eventRegistrations_[o];if(!s.matches(e))i.push(s);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(o+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function iN(n,e,t,r){e.type===gr.MERGE&&e.source.queryId!==null&&(L(Wo(n.viewCache_),"We should always have a full cache before handling merges"),L(Tp(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,o=Gz(n.processor_,i,e,t,r);return qz(n.processor_,o.viewCache),L(o.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=o.viewCache,WN(n,o.changes,o.viewCache.eventCache.getNode(),null)}function t4(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild($e,(o,s)=>{r.push(Oa(o,s))}),t.isFullyInitialized()&&r.push(LN(t.getNode())),WN(n,r,t.getNode(),e)}function WN(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return Tz(n.eventGenerator_,e,t,i)}var Mp,Rp=class{constructor(){this.views=new Map}};function n4(n){L(!Mp,"__referenceConstructor has already been defined"),Mp=n}function r4(){return L(Mp,"Reference.ts has not been loaded"),Mp}function i4(n){return n.views.size===0}function mI(n,e,t,r){let i=e.source.queryId;if(i!==null){let o=n.views.get(i);return L(o!=null,"SyncTree gave us an op for an invalid query."),iN(o,e,t,r)}else{let o=[];for(let s of n.views.values())o=o.concat(iN(s,e,t,r));return o}}function KN(n,e,t,r,i){let o=e._queryIdentifier,s=n.views.get(o);if(!s){let a=bp(t,i?r:null),l=!1;a?l=!0:r instanceof he?(a=pI(t,r),l=!1):(a=he.EMPTY_NODE,l=!1);let c=$p(new _r(a,l,!1),new _r(r,i,!1));return new OE(e,c)}return s}function o4(n,e,t,r,i,o){let s=KN(n,e,r,i,o);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,s),e4(s,t),t4(s,t)}function s4(n,e,t,r){let i=e._queryIdentifier,o=[],s=[],a=Li(n);if(i==="default")for(let[l,c]of n.views.entries())s=s.concat(rN(c,t,r)),nN(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||o.push(c.query));else{let l=n.views.get(i);l&&(s=s.concat(rN(l,t,r)),nN(l)&&(n.views.delete(i),l.query._queryParams.loadsAllData()||o.push(l.query)))}return a&&!Li(n)&&o.push(new(r4())(e._repo,e._path)),{removed:o,events:s}}function QN(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Oi(n,e){let t=null;for(let r of n.views.values())t=t||Xz(r,e);return t}function YN(n,e){if(e._queryParams.loadsAllData())return qp(n);{let r=e._queryIdentifier;return n.views.get(r)}}function ZN(n,e){return YN(n,e)!=null}function Li(n){return qp(n)!=null}function qp(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var xp;function a4(n){L(!xp,"__referenceConstructor has already been defined"),xp=n}function l4(){return L(xp,"Reference.ts has not been loaded"),xp}var u4=1,Np=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Yt(null),this.pendingWriteTree_=Uz(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function yI(n,e,t,r,i){return Mz(n.pendingWriteTree_,e,t,r,i),i?$a(n,new Fa(dI(),e,t)):[]}function c4(n,e,t,r){Rz(n.pendingWriteTree_,e,t,r);let i=Yt.fromObject(t);return $a(n,new Mc(dI(),e,i))}function Pi(n,e,t=!1){let r=xz(n.pendingWriteTree_,e);if(Nz(n.pendingWriteTree_,e)){let o=new Yt(null);return r.snap!=null?o=o.set(Ne(),!0):It(r.children,s=>{o=o.set(new Pe(s),!0)}),$a(n,new bE(r.path,o,t))}else return[]}function jc(n,e,t){return $a(n,new Fa(hI(),e,t))}function d4(n,e,t){let r=Yt.fromObject(t);return $a(n,new Mc(hI(),e,r))}function h4(n,e){return $a(n,new Dp(hI(),e))}function f4(n,e,t){let r=_I(n,t);if(r){let i=vI(r),o=i.path,s=i.queryId,a=Qt(o,e),l=new Dp(fI(s),a);return wI(n,o,l)}else return[]}function Pp(n,e,t,r,i=!1){let o=e._path,s=n.syncPointTree_.get(o),a=[];if(s&&(e._queryIdentifier==="default"||ZN(s,e))){let l=s4(s,e,t,r);i4(s)&&(n.syncPointTree_=n.syncPointTree_.remove(o));let c=l.removed;if(a=l.events,!i){let d=c.findIndex(g=>g._queryParams.loadsAllData())!==-1,f=n.syncPointTree_.findOnPath(o,(g,m)=>Li(m));if(d&&!f){let g=n.syncPointTree_.subtree(o);if(!g.isEmpty()){let m=m4(g);for(let v=0;v<m.length;++v){let T=m[v],S=T.query,O=tP(n,T);n.listenProvider_.startListening(Ec(S),xc(n,S),O.hashFn,O.onComplete)}}}!f&&c.length>0&&!r&&(d?n.listenProvider_.stopListening(Ec(e),null):c.forEach(g=>{let m=n.queryToTagMap.get(zp(g));n.listenProvider_.stopListening(Ec(g),m)}))}y4(n,c)}return a}function JN(n,e,t,r){let i=_I(n,r);if(i!=null){let o=vI(i),s=o.path,a=o.queryId,l=Qt(s,e),c=new Fa(fI(a),l,t);return wI(n,s,c)}else return[]}function p4(n,e,t,r){let i=_I(n,r);if(i){let o=vI(i),s=o.path,a=o.queryId,l=Qt(s,e),c=Yt.fromObject(t),d=new Mc(fI(a),l,c);return wI(n,s,d)}else return[]}function FE(n,e,t,r=!1){let i=e._path,o=null,s=!1;n.syncPointTree_.foreachOnPath(i,(g,m)=>{let v=Qt(g,i);o=o||Oi(m,v),s=s||Li(m)});let a=n.syncPointTree_.get(i);a?(s=s||Li(a),o=o||Oi(a,Ne())):(a=new Rp,n.syncPointTree_=n.syncPointTree_.set(i,a));let l;o!=null?l=!0:(l=!1,o=he.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((m,v)=>{let T=Oi(v,Ne());T&&(o=o.updateImmediateChild(m,T))}));let c=ZN(a,e);if(!c&&!e._queryParams.loadsAllData()){let g=zp(e);L(!n.queryToTagMap.has(g),"View does not exist, but we have a tag");let m=_4();n.queryToTagMap.set(g,m),n.tagToQueryMap.set(m,g)}let d=Hp(n.pendingWriteTree_,i),f=o4(a,e,t,d,o,l);if(!c&&!s&&!r){let g=YN(a,e);f=f.concat(v4(n,e,g))}return f}function Gp(n,e,t){let i=n.pendingWriteTree_,o=n.syncPointTree_.findOnPath(e,(s,a)=>{let l=Qt(s,e),c=Oi(a,l);if(c)return c});return $N(i,e,o,t,!0)}function g4(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(c,d)=>{let f=Qt(c,t);r=r||Oi(d,f)});let i=n.syncPointTree_.get(t);i?r=r||Oi(i,Ne()):(i=new Rp,n.syncPointTree_=n.syncPointTree_.set(t,i));let o=r!=null,s=o?new _r(r,!0,!1):null,a=Hp(n.pendingWriteTree_,e._path),l=KN(i,e,a,o?s.getNode():he.EMPTY_NODE,o);return Jz(l)}function $a(n,e){return XN(e,n.syncPointTree_,null,Hp(n.pendingWriteTree_,Ne()))}function XN(n,e,t,r){if(_e(n.path))return eP(n,e,t,r);{let i=e.get(Ne());t==null&&i!=null&&(t=Oi(i,Ne()));let o=[],s=ye(n.path),a=n.operationForChild(s),l=e.children.get(s);if(l&&a){let c=t?t.getImmediateChild(s):null,d=HN(r,s);o=o.concat(XN(a,l,c,d))}return i&&(o=o.concat(mI(i,n,r,t))),o}}function eP(n,e,t,r){let i=e.get(Ne());t==null&&i!=null&&(t=Oi(i,Ne()));let o=[];return e.children.inorderTraversal((s,a)=>{let l=t?t.getImmediateChild(s):null,c=HN(r,s),d=n.operationForChild(s);d&&(o=o.concat(eP(d,a,l,c)))}),i&&(o=o.concat(mI(i,n,r,t))),o}function tP(n,e){let t=e.query,r=xc(n,t);return{hashFn:()=>(Zz(e)||he.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?f4(n,t._path,r):h4(n,t._path);{let o=MG(i,t);return Pp(n,t,null,o)}}}}function xc(n,e){let t=zp(e);return n.queryToTagMap.get(t)}function zp(n){return n._path.toString()+"$"+n._queryIdentifier}function _I(n,e){return n.tagToQueryMap.get(e)}function vI(n){let e=n.indexOf("$");return L(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Pe(n.substr(0,e))}}function wI(n,e,t){let r=n.syncPointTree_.get(e);L(r,"Missing sync point for query tag that we're tracking");let i=Hp(n.pendingWriteTree_,e);return mI(r,t,i,null)}function m4(n){return n.fold((e,t,r)=>{if(t&&Li(t))return[qp(t)];{let i=[];return t&&(i=QN(t)),It(r,(o,s)=>{i=i.concat(s)}),i}})}function Ec(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(l4())(n._repo,n._path):n}function y4(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=zp(r),o=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(o)}}}function _4(){return u4++}function v4(n,e,t){let r=e._path,i=xc(n,e),o=tP(n,t),s=n.listenProvider_.startListening(Ec(e),i,o.hashFn,o.onComplete),a=n.syncPointTree_.subtree(r);if(i)L(!Li(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,d,f)=>{if(!_e(c)&&d&&Li(d))return[qp(d).query];{let g=[];return d&&(g=g.concat(QN(d).map(m=>m.query))),It(f,(m,v)=>{g=g.concat(v)}),g}});for(let c=0;c<l.length;++c){let d=l[c];n.listenProvider_.stopListening(Ec(d),xc(n,d))}}return s}var VE=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},LE=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=We(this.path_,e);return new n(this.syncTree_,t)}node(){return Gp(this.syncTree_,this.path_)}},w4=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},oN=function(n,e,t){if(!n||typeof n!="object")return n;if(L(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return E4(n[".sv"],e,t);if(typeof n[".sv"]=="object")return I4(n[".sv"],e);L(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},E4=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:L(!1,"Unexpected server value: "+n)}},I4=function(n,e,t){n.hasOwnProperty("increment")||L(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&L(!1,"Unexpected increment value: "+r);let i=e.node();if(L(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let s=i.getValue();return typeof s!="number"?r:s+r},nP=function(n,e,t,r){return II(e,new LE(t,n),r)},EI=function(n,e,t){return II(n,new VE(e),t)};function II(n,e,t){let r=n.getPriority().val(),i=oN(r,e.getImmediateChild(".priority"),t),o;if(n.isLeafNode()){let s=n,a=oN(s.getValue(),e,t);return a!==s.getValue()||i!==s.getPriority().val()?new Pa(a,Ze(i)):n}else{let s=n;return o=s,i!==s.getPriority().val()&&(o=o.updatePriority(new Pa(i))),s.forEachChild($e,(a,l)=>{let c=II(l,e.getImmediateChild(a),t);c!==l&&(o=o.updateImmediateChild(a,c))}),o}}var Nc=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function Wp(n,e){let t=e instanceof Pe?e:new Pe(e),r=n,i=ye(t);for(;i!==null;){let o=di(r.node.children,i)||{children:{},childCount:0};r=new Nc(i,r,o),t=Ue(t),i=ye(t)}return r}function Yo(n){return n.node.value}function CI(n,e){n.node.value=e,jE(n)}function rP(n){return n.node.childCount>0}function C4(n){return Yo(n)===void 0&&!rP(n)}function Kp(n,e){It(n.node.children,(t,r)=>{e(new Nc(t,n,r))})}function iP(n,e,t,r){t&&!r&&e(n),Kp(n,i=>{iP(i,e,!0,r)}),t&&r&&e(n)}function D4(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Bc(n){return new Pe(n.parent===null?n.name:Bc(n.parent)+"/"+n.name)}function jE(n){n.parent!==null&&T4(n.parent,n.name,n)}function T4(n,e,t){let r=C4(t),i=Cn(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,jE(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,jE(n))}var b4=/[\[\].#$\/\u0000-\u001F\u007F]/,S4=/[\[\].#$\u0000-\u001F\u007F]/,Yw=10*1024*1024,Qp=function(n){return typeof n=="string"&&n.length!==0&&!b4.test(n)},oP=function(n){return typeof n=="string"&&n.length!==0&&!S4.test(n)},A4=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),oP(n)},Pc=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Bp(n)||n&&typeof n=="object"&&Cn(n,".sv")},vr=function(n,e,t,r){r&&e===void 0||Uc(en(n,"value"),e,t)},Uc=function(n,e,t){let r=t instanceof Pe?new uE(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+qo(r));if(typeof e=="function")throw new Error(n+"contains a function "+qo(r)+" with contents = "+e.toString());if(Bp(e))throw new Error(n+"contains "+e.toString()+" "+qo(r));if(typeof e=="string"&&e.length>Yw/3&&Xl(e)>Yw)throw new Error(n+"contains a string greater than "+Yw+" utf8 bytes "+qo(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,o=!1;if(It(e,(s,a)=>{if(s===".value")i=!0;else if(s!==".priority"&&s!==".sv"&&(o=!0,!Qp(s)))throw new Error(n+" contains an invalid key ("+s+") "+qo(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);iz(r,s),Uc(n,a,r),oz(r)}),i&&o)throw new Error(n+' contains ".value" child '+qo(r)+" in addition to actual children.")}},M4=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let o=Cc(r);for(let s=0;s<o.length;s++)if(!(o[s]===".priority"&&s===o.length-1)){if(!Qp(o[s]))throw new Error(n+"contains an invalid key ("+o[s]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(rz);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&On(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},sP=function(n,e,t,r){if(r&&e===void 0)return;let i=en(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let o=[];It(e,(s,a)=>{let l=new Pe(s);if(Uc(i,a,We(t,l)),sI(l)===".priority"&&!Pc(a))throw new Error(i+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(l)}),M4(i,o)},DI=function(n,e,t){if(!(t&&e===void 0)){if(Bp(e))throw new Error(en(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Pc(e))throw new Error(en(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},$c=function(n,e,t,r){if(!(r&&t===void 0)&&!Qp(t))throw new Error(en(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Ha=function(n,e,t,r){if(!(r&&t===void 0)&&!oP(t))throw new Error(en(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},R4=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Ha(n,e,t,r)},yn=function(n,e){if(ye(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},aP=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Qp(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!A4(t))throw new Error(en(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var BE=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Yp(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],o=i.getPath();t!==null&&!aI(o,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:o}),t.events.push(i)}t&&n.eventLists_.push(t)}function lP(n,e,t){Yp(n,t),uP(n,r=>aI(r,e))}function _n(n,e,t){Yp(n,t),uP(n,r=>On(r,e)||On(e,r))}function uP(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let o=i.path;e(o)?(x4(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function x4(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();zo&&Et("event: "+t.toString()),Ba(r)}}}var cP="repo_interrupt",N4=25,UE=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new BE,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Cp(),this.transactionQueueTree_=new Nc,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function P4(n,e,t){if(n.stats_=oI(n.repoInfo_),n.forceRestClient_||PG())n.server_=new wE(n.repoInfo_,(r,i,o,s)=>{sN(n,r,i,o,s)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>aN(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ut(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new lI(n.repoInfo_,e,(r,i,o,s)=>{sN(n,r,i,o,s)},r=>{aN(n,r)},r=>{k4(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=OG(n.repoInfo_,()=>new TE(n.stats_,n.server_)),n.infoData_=new EE,n.infoSyncTree_=new Np({startListening:(r,i,o,s)=>{let a=[],l=n.infoData_.getNode(r._path);return l.isEmpty()||(a=jc(n.infoSyncTree_,r._path,l),setTimeout(()=>{s("ok")},0)),a},stopListening:()=>{}}),TI(n,"connected",!1),n.serverSyncTree_=new Np({startListening:(r,i,o,s)=>(n.server_.listen(r,o,i,(a,l)=>{let c=s(a,l);_n(n.eventQueue_,r._path,c)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function dP(n){let t=n.infoData_.getNode(new Pe(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Hc(n){return w4({timestamp:dP(n)})}function sN(n,e,t,r,i){n.dataUpdateCount++;let o=new Pe(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let s=[];if(i)if(r){let l=Jl(t,c=>Ze(c));s=p4(n.serverSyncTree_,o,l,i)}else{let l=Ze(t);s=JN(n.serverSyncTree_,o,l,i)}else if(r){let l=Jl(t,c=>Ze(c));s=d4(n.serverSyncTree_,o,l)}else{let l=Ze(t);s=jc(n.serverSyncTree_,o,l)}let a=o;s.length>0&&(a=La(n,o)),_n(n.eventQueue_,a,s)}function aN(n,e){TI(n,"connected",e),e===!1&&V4(n)}function k4(n,e){It(e,(t,r)=>{TI(n,t,r)})}function TI(n,e,t){let r=new Pe("/.info/"+e),i=Ze(t);n.infoData_.updateSnapshot(r,i);let o=jc(n.infoSyncTree_,r,i);_n(n.eventQueue_,r,o)}function Zp(n){return n.nextWriteId_++}function O4(n,e,t){let r=g4(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let o=Ze(i).withIndex(e._queryParams.getIndex());FE(n.serverSyncTree_,e,t,!0);let s;if(e._queryParams.loadsAllData())s=jc(n.serverSyncTree_,e._path,o);else{let a=xc(n.serverSyncTree_,e);s=JN(n.serverSyncTree_,e._path,o,a)}return _n(n.eventQueue_,e._path,s),Pp(n.serverSyncTree_,e,t,null,!0),o},i=>(qa(n,"get for query "+ut(e)+" failed: "+i),Promise.reject(new Error(i))))}function bI(n,e,t,r,i){qa(n,"set",{path:e.toString(),value:t,priority:r});let o=Hc(n),s=Ze(t,r),a=Gp(n.serverSyncTree_,e),l=EI(s,a,o),c=Zp(n),d=yI(n.serverSyncTree_,e,l,c,!0);Yp(n.eventQueue_,d),n.server_.put(e.toString(),s.val(!0),(g,m)=>{let v=g==="ok";v||Lt("set at "+e+" failed: "+g);let T=Pi(n.serverSyncTree_,c,!v);_n(n.eventQueue_,e,T),ji(n,i,g,m)});let f=AI(n,e);La(n,f),_n(n.eventQueue_,f,[])}function F4(n,e,t,r){qa(n,"update",{path:e.toString(),value:t});let i=!0,o=Hc(n),s={};if(It(t,(a,l)=>{i=!1,s[a]=nP(We(e,a),Ze(l),n.serverSyncTree_,o)}),i)Et("update() called with empty data.  Don't do anything."),ji(n,r,"ok",void 0);else{let a=Zp(n),l=c4(n.serverSyncTree_,e,s,a);Yp(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,d)=>{let f=c==="ok";f||Lt("update at "+e+" failed: "+c);let g=Pi(n.serverSyncTree_,a,!f),m=g.length>0?La(n,e):e;_n(n.eventQueue_,m,g),ji(n,r,c,d)}),It(t,c=>{let d=AI(n,We(e,c));La(n,d)}),_n(n.eventQueue_,e,[])}}function V4(n){qa(n,"onDisconnectEvents");let e=Hc(n),t=Cp();CE(n.onDisconnect_,Ne(),(i,o)=>{let s=nP(i,o,n.serverSyncTree_,e);Ua(t,i,s)});let r=[];CE(t,Ne(),(i,o)=>{r=r.concat(jc(n.serverSyncTree_,i,o));let s=AI(n,i);La(n,s)}),n.onDisconnect_=Cp(),_n(n.eventQueue_,Ne(),r)}function L4(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&IE(n.onDisconnect_,e),ji(n,t,r,i)})}function lN(n,e,t,r){let i=Ze(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(o,s)=>{o==="ok"&&Ua(n.onDisconnect_,e,i),ji(n,r,o,s)})}function j4(n,e,t,r,i){let o=Ze(t,r);n.server_.onDisconnectPut(e.toString(),o.val(!0),(s,a)=>{s==="ok"&&Ua(n.onDisconnect_,e,o),ji(n,i,s,a)})}function B4(n,e,t,r){if(nh(t)){Et("onDisconnect().update() called with empty data.  Don't do anything."),ji(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,o)=>{i==="ok"&&It(t,(s,a)=>{let l=Ze(a);Ua(n.onDisconnect_,We(e,s),l)}),ji(n,r,i,o)})}function U4(n,e,t){let r;ye(e._path)===".info"?r=FE(n.infoSyncTree_,e,t):r=FE(n.serverSyncTree_,e,t),lP(n.eventQueue_,e._path,r)}function $E(n,e,t){let r;ye(e._path)===".info"?r=Pp(n.infoSyncTree_,e,t):r=Pp(n.serverSyncTree_,e,t),lP(n.eventQueue_,e._path,r)}function hP(n){n.persistentConnection_&&n.persistentConnection_.interrupt(cP)}function $4(n){n.persistentConnection_&&n.persistentConnection_.resume(cP)}function qa(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Et(t,...e)}function ji(n,e,t,r){e&&Ba(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),o=i;r&&(o+=": "+r);let s=new Error(o);s.code=i,e(s)}})}function H4(n,e,t,r,i,o){qa(n,"transaction on "+e);let s={path:e,update:t,onComplete:r,status:null,order:dN(),applyLocally:o,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=SI(n,e,void 0);s.currentInputSnapshot=a;let l=s.update(a.val());if(l===void 0)s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete&&s.onComplete(null,!1,s.currentInputSnapshot);else{Uc("transaction failed: Data returned ",l,s.path),s.status=0;let c=Wp(n.transactionQueueTree_,e),d=Yo(c)||[];d.push(s),CI(c,d);let f;typeof l=="object"&&l!==null&&Cn(l,".priority")?(f=di(l,".priority"),L(Pc(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(Gp(n.serverSyncTree_,e)||he.EMPTY_NODE).getPriority().val();let g=Hc(n),m=Ze(l,f),v=EI(m,a,g);s.currentOutputSnapshotRaw=m,s.currentOutputSnapshotResolved=v,s.currentWriteId=Zp(n);let T=yI(n.serverSyncTree_,e,v,s.currentWriteId,s.applyLocally);_n(n.eventQueue_,e,T),Jp(n,n.transactionQueueTree_)}}function SI(n,e,t){return Gp(n.serverSyncTree_,e,t)||he.EMPTY_NODE}function Jp(n,e=n.transactionQueueTree_){if(e||Xp(n,e),Yo(e)){let t=pP(n,e);L(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&q4(n,Bc(e),t)}else rP(e)&&Kp(e,t=>{Jp(n,t)})}function q4(n,e,t){let r=t.map(c=>c.currentWriteId),i=SI(n,e,r),o=i,s=i.hash();for(let c=0;c<t.length;c++){let d=t[c];L(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let f=Qt(e,d.path);o=o.updateChild(f,d.currentOutputSnapshotRaw)}let a=o.val(!0),l=e;n.server_.put(l.toString(),a,c=>{qa(n,"transaction put response",{path:l.toString(),status:c});let d=[];if(c==="ok"){let f=[];for(let g=0;g<t.length;g++)t[g].status=2,d=d.concat(Pi(n.serverSyncTree_,t[g].currentWriteId)),t[g].onComplete&&f.push(()=>t[g].onComplete(null,!0,t[g].currentOutputSnapshotResolved)),t[g].unwatcher();Xp(n,Wp(n.transactionQueueTree_,e)),Jp(n,n.transactionQueueTree_),_n(n.eventQueue_,e,d);for(let g=0;g<f.length;g++)Ba(f[g])}else{if(c==="datastale")for(let f=0;f<t.length;f++)t[f].status===3?t[f].status=4:t[f].status=0;else{Lt("transaction at "+l.toString()+" failed: "+c);for(let f=0;f<t.length;f++)t[f].status=4,t[f].abortReason=c}La(n,e)}},s)}function La(n,e){let t=fP(n,e),r=Bc(t),i=pP(n,t);return G4(n,i,r),r}function G4(n,e,t){if(e.length===0)return;let r=[],i=[],s=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=Qt(t,l.path),d=!1,f;if(L(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)d=!0,f=l.abortReason,i=i.concat(Pi(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=N4)d=!0,f="maxretry",i=i.concat(Pi(n.serverSyncTree_,l.currentWriteId,!0));else{let g=SI(n,l.path,s);l.currentInputSnapshot=g;let m=e[a].update(g.val());if(m!==void 0){Uc("transaction failed: Data returned ",m,l.path);let v=Ze(m);typeof m=="object"&&m!=null&&Cn(m,".priority")||(v=v.updatePriority(g.getPriority()));let S=l.currentWriteId,O=Hc(n),B=EI(v,g,O);l.currentOutputSnapshotRaw=v,l.currentOutputSnapshotResolved=B,l.currentWriteId=Zp(n),s.splice(s.indexOf(S),1),i=i.concat(yI(n.serverSyncTree_,l.path,B,l.currentWriteId,l.applyLocally)),i=i.concat(Pi(n.serverSyncTree_,S,!0))}else d=!0,f="nodata",i=i.concat(Pi(n.serverSyncTree_,l.currentWriteId,!0))}_n(n.eventQueue_,t,i),i=[],d&&(e[a].status=2,function(g){setTimeout(g,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}Xp(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Ba(r[a]);Jp(n,n.transactionQueueTree_)}function fP(n,e){let t,r=n.transactionQueueTree_;for(t=ye(e);t!==null&&Yo(r)===void 0;)r=Wp(r,t),e=Ue(e),t=ye(e);return r}function pP(n,e){let t=[];return gP(n,e,t),t.sort((r,i)=>r.order-i.order),t}function gP(n,e,t){let r=Yo(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);Kp(e,i=>{gP(n,i,t)})}function Xp(n,e){let t=Yo(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,CI(e,t.length>0?t:void 0)}Kp(e,r=>{Xp(n,r)})}function AI(n,e){let t=Bc(fP(n,e)),r=Wp(n.transactionQueueTree_,e);return D4(r,i=>{Zw(n,i)}),Zw(n,r),iP(r,i=>{Zw(n,i)}),t}function Zw(n,e){let t=Yo(e);if(t){let r=[],i=[],o=-1;for(let s=0;s<t.length;s++)t[s].status===3||(t[s].status===1?(L(o===s-1,"All SENT items should be at beginning of queue."),o=s,t[s].status=3,t[s].abortReason="set"):(L(t[s].status===0,"Unexpected transaction status in abort"),t[s].unwatcher(),i=i.concat(Pi(n.serverSyncTree_,t[s].currentWriteId,!0)),t[s].onComplete&&r.push(t[s].onComplete.bind(null,new Error("set"),!1,null))));o===-1?CI(e,void 0):t.length=o+1,_n(n.eventQueue_,Bc(e),i);for(let s=0;s<r.length;s++)Ba(r[s])}}function z4(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function W4(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Lt(`Invalid query segment '${t}' in query '${n}'`)}return e}var HE=function(n,e){let t=K4(n),r=t.namespace;t.domain==="firebase.com"&&yr(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&yr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||DG();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new gp(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new Pe(t.pathString)}},K4=function(n){let e="",t="",r="",i="",o="",s=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let d=n.indexOf("/");d===-1&&(d=n.length);let f=n.indexOf("?");f===-1&&(f=n.length),e=n.substring(0,Math.min(d,f)),d<f&&(i=z4(n.substring(d,f)));let g=W4(n.substring(Math.min(n.length,f)));c=e.indexOf(":"),c>=0?(s=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let m=e.slice(0,c);if(m.toLowerCase()==="localhost")t="localhost";else if(m.split(".").length<=2)t=m;else{let v=e.indexOf(".");r=e.substring(0,v).toLowerCase(),t=e.substring(v+1),o=r}"ns"in g&&(o=g.ns)}return{host:e,port:l,domain:t,subdomain:r,secure:s,scheme:a,pathString:i,namespace:o}};var uN="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Q4=function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,o=new Array(8);for(i=7;i>=0;i--)o[i]=uN.charAt(t%64),t=Math.floor(t/64);L(t===0,"Cannot push at time == 0");let s=o.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)s+=uN.charAt(e[i]);return L(s.length===20,"nextPushId: Length should be 20."),s}}();var kp=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ut(this.snapshot.exportVal())}},Op=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var kc=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return L(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Fp=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new wt;return L4(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){yn("OnDisconnect.remove",this._path);let e=new wt;return lN(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){yn("OnDisconnect.set",this._path),vr("OnDisconnect.set",e,this._path,!1);let t=new wt;return lN(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){yn("OnDisconnect.setWithPriority",this._path),vr("OnDisconnect.setWithPriority",e,this._path,!1),DI("OnDisconnect.setWithPriority",t,!1);let r=new wt;return j4(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){yn("OnDisconnect.update",this._path),sP("OnDisconnect.update",e,this._path,!1);let t=new wt;return B4(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var Zt=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return _e(this._path)?null:sI(this._path)}get ref(){return new vn(this._repo,this._path)}get _queryIdentifier(){let e=Qx(this._queryParams),t=iI(e);return t==="{}"?"default":t}get _queryObject(){return Qx(this._queryParams)}isEqual(e){if(e=we(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=aI(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+nz(this._path)}};function eg(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Ui(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===mr){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Fi)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==Wr)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===$e){if(e!=null&&!Pc(e)||t!=null&&!Pc(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(L(n.getIndex()instanceof Dc||n.getIndex()===cI,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function tg(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var vn=class n extends Zt{constructor(e,t){super(e,t,new Ac,!1)}get parent(){let e=NN(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},ja=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new Pe(e),r=Bi(this.ref,e);return new n(this._node.getChild(t),r,$e)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,Bi(this.ref,r),$e)))}hasChild(e){let t=new Pe(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function MI(n,e){return n=we(n),n._checkNotDeleted("ref"),e!==void 0?Bi(n._root,e):n._root}function RI(n,e){n=we(n),n._checkNotDeleted("refFromURL");let t=HE(e,n._repo.repoInfo_.nodeAdmin);aP("refFromURL",t);let r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&yr("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),MI(n,t.path.toString())}function Bi(n,e){return n=we(n),ye(n._path)===null?R4("child","path",e,!1):Ha("child","path",e,!1),new vn(n._repo,We(n._path,e))}function mP(n,e){n=we(n),yn("push",n._path),vr("push",e,n._path,!0);let t=dP(n._repo),r=Q4(t),i=Bi(n,r),o=Bi(n,r),s;return e!=null?s=ng(o,e).then(()=>o):s=Promise.resolve(o),i.then=s.then.bind(s),i.catch=s.then.bind(s,void 0),i}function yP(n){return yn("remove",n._path),ng(n,null)}function ng(n,e){n=we(n),yn("set",n._path),vr("set",e,n._path,!1);let t=new wt;return bI(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function _P(n,e){n=we(n),yn("setPriority",n._path),DI("setPriority",e,!1);let t=new wt;return bI(n._repo,We(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function vP(n,e,t){if(yn("setWithPriority",n._path),vr("setWithPriority",e,n._path,!1),DI("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let r=new wt;return bI(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function wP(n,e){sP("update",e,n._path,!1);let t=new wt;return F4(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function EP(n){n=we(n);let e=new kc(()=>{}),t=new Oc(e);return O4(n._repo,n,t).then(r=>new ja(r,new vn(n._repo,n._path),n._queryParams.getIndex()))}var Oc=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new kp("value",this,new ja(e.snapshotNode,new vn(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Op(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Vp=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Op(this,e,t):null}createEvent(e,t){L(e.childName!=null,"Child events should have a childName.");let r=Bi(new vn(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new kp(e.type,this,new ja(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function qc(n,e,t,r,i){let o;if(typeof r=="object"&&(o=void 0,i=r),typeof r=="function"&&(o=r),i&&i.onlyOnce){let l=t,c=(d,f)=>{$E(n._repo,n,a),l(d,f)};c.userCallback=t.userCallback,c.context=t.context,t=c}let s=new kc(t,o||void 0),a=e==="value"?new Oc(s):new Vp(e,s);return U4(n._repo,n,a),()=>$E(n._repo,n,a)}function rg(n,e,t,r){return qc(n,"value",e,t,r)}function xI(n,e,t,r){return qc(n,"child_added",e,t,r)}function NI(n,e,t,r){return qc(n,"child_changed",e,t,r)}function PI(n,e,t,r){return qc(n,"child_moved",e,t,r)}function kI(n,e,t,r){return qc(n,"child_removed",e,t,r)}function OI(n,e,t){let r=null,i=t?new kc(t):null;e==="value"?r=new Oc(i):e&&(r=new Vp(e,i)),$E(n._repo,n,r)}var wn=class{},Lp=class extends wn{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){vr("endAt",this._value,e._path,!0);let t=vE(e._queryParams,this._value,this._key);if(tg(t),Ui(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Zt(e._repo,e._path,t,e._orderByCalled)}};function IP(n,e){return $c("endAt","key",e,!0),new Lp(n,e)}var qE=class extends wn{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){vr("endBefore",this._value,e._path,!1);let t=Ez(e._queryParams,this._value,this._key);if(tg(t),Ui(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Zt(e._repo,e._path,t,e._orderByCalled)}};function CP(n,e){return $c("endBefore","key",e,!0),new qE(n,e)}var jp=class extends wn{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){vr("startAt",this._value,e._path,!0);let t=_E(e._queryParams,this._value,this._key);if(tg(t),Ui(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Zt(e._repo,e._path,t,e._orderByCalled)}};function DP(n=null,e){return $c("startAt","key",e,!0),new jp(n,e)}var GE=class extends wn{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){vr("startAfter",this._value,e._path,!1);let t=wz(e._queryParams,this._value,this._key);if(tg(t),Ui(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Zt(e._repo,e._path,t,e._orderByCalled)}};function TP(n,e){return $c("startAfter","key",e,!0),new GE(n,e)}var zE=class extends wn{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Zt(e._repo,e._path,_z(e._queryParams,this._limit),e._orderByCalled)}};function bP(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new zE(n)}var WE=class extends wn{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Zt(e._repo,e._path,vz(e._queryParams,this._limit),e._orderByCalled)}};function SP(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new WE(n)}var KE=class extends wn{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){eg(e,"orderByChild");let t=new Pe(this._path);if(_e(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new Dc(t),i=Up(e._queryParams,r);return Ui(i),new Zt(e._repo,e._path,i,!0)}};function AP(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Ha("orderByChild","path",n,!1),new KE(n)}var QE=class extends wn{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){eg(e,"orderByKey");let t=Up(e._queryParams,mr);return Ui(t),new Zt(e._repo,e._path,t,!0)}};function MP(){return new QE}var YE=class extends wn{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){eg(e,"orderByPriority");let t=Up(e._queryParams,$e);return Ui(t),new Zt(e._repo,e._path,t,!0)}};function RP(){return new YE}var ZE=class extends wn{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){eg(e,"orderByValue");let t=Up(e._queryParams,cI);return Ui(t),new Zt(e._repo,e._path,t,!0)}};function xP(){return new ZE}var JE=class extends wn{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(vr("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Lp(this._value,this._key)._apply(new jp(this._value,this._key)._apply(e))}};function NP(n,e){return $c("equalTo","key",e,!0),new JE(n,e)}function Vn(n,...e){let t=we(n);for(let r of e)t=r._apply(t);return t}n4(vn);a4(vn);var Y4="FIREBASE_DATABASE_EMULATOR_HOST",XE={},Z4=!1;function J4(n,e,t,r){n.repoInfo_=new gp(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),r&&(n.authTokenProvider_=r)}function FI(n,e,t,r,i){let o=r||n.options.databaseURL;o===void 0&&(n.options.projectId||yr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Et("Using default host for project ",n.options.projectId),o=`${n.options.projectId}-default-rtdb.firebaseio.com`);let s=HE(o,i),a=s.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[Y4]),c?(l=!0,o=`http://${c}?ns=${a.namespace}`,s=HE(o,i),a=s.repoInfo):l=!s.repoInfo.secure;let d=i&&l?new _c(_c.OWNER):new rE(n.name,n.options,e);aP("Invalid Firebase Database URL",s),_e(s.path)||yr("Database URL must point to the root of a Firebase Database (not including a child path).");let f=eW(a,n,d,new nE(n.name,t));return new eI(f,n)}function X4(n,e){let t=XE[e];(!t||t[n.key]!==n)&&yr(`Database ${e}(${n.repoInfo_}) has already been deleted.`),hP(n),delete t[n.key]}function eW(n,e,t,r){let i=XE[e.name];i||(i={},XE[e.name]=i);let o=i[n.toURLString()];return o&&yr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new UE(n,Z4,t,r),i[n.toURLString()]=o,o}var eI=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(P4(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new vn(this._repo,Ne())),this._rootInternal}_delete(){return this._rootInternal!==null&&(X4(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&yr("Cannot call "+e+" on a deleted database.")}};function PP(){xN.IS_TRANSPORT_INITIALIZED&&Lt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function kP(){PP(),Ic.forceDisallow()}function OP(){PP(),Ma.forceDisallow(),Ic.forceAllow()}function FP(n,e,t,r={}){n=we(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&yr("Cannot call useEmulator() after instance has already been initialized.");let i=n._repoInternal,o;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&yr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new _c(_c.OWNER);else if(r.mockUserToken){let s=typeof r.mockUserToken=="string"?r.mockUserToken:Xd(r.mockUserToken,n.app.options.projectId);o=new _c(s)}J4(i,e,t,o)}function VP(n){n=we(n),n._checkNotDeleted("goOffline"),hP(n._repo)}function LP(n){n=we(n),n._checkNotDeleted("goOnline"),$4(n._repo)}function jP(n,e){fN(n,e)}function tW(n){rI(ih),fo(new ln("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return FI(r,i,o,t)},"PUBLIC").setMultipleInstances(!0)),Un(Nx,Px,n),Un(Nx,Px,"esm2017")}var nW={".sv":"timestamp"};function BP(){return nW}function UP(n){return{".sv":{increment:n}}}var tI=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function $P(n,e,t){var r;if(n=we(n),yn("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(r=t?.applyLocally)!==null&&r!==void 0?r:!0,o=new wt,s=(l,c,d)=>{let f=null;l?o.reject(l):(f=new ja(d,new vn(n._repo,n._path),$e),o.resolve(new tI(c,f)))},a=rg(n,()=>{});return H4(n._repo,n._path,e,s,a,i),o.promise}lI.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};lI.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};tW();var rW="@firebase/database-compat",iW="2.0.2";var oW=new hi("@firebase/database-compat"),HP=function(n){let e="FIREBASE WARNING: "+n;oW.warn(e)};var sW=function(n,e,t,r){if(!(r&&t===void 0)&&typeof t!="boolean")throw new Error(en(n,e)+"must be a boolean.")},aW=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(en(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var VI=class{constructor(e){this._delegate=e}cancel(e){re("OnDisconnect.cancel",0,1,arguments.length),pt("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){re("OnDisconnect.remove",0,1,arguments.length),pt("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){re("OnDisconnect.set",1,2,arguments.length),pt("OnDisconnect.set","onComplete",t,!0);let r=this._delegate.set(e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){re("OnDisconnect.setWithPriority",2,3,arguments.length),pt("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,t);return r&&i.then(()=>r(null),o=>r(o)),i}update(e,t){if(re("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let o=0;o<e.length;++o)i[""+o]=e[o];e=i,HP("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}pt("OnDisconnect.update","onComplete",t,!0);let r=this._delegate.update(e);return t&&r.then(()=>t(null),i=>t(i)),r}};var LI=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return re("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var Zo=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return re("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return re("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return re("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return re("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return re("DataSnapshot.child",0,1,arguments.length),e=String(e),Ha("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return re("DataSnapshot.hasChild",1,1,arguments.length),Ha("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return re("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return re("DataSnapshot.forEach",1,1,arguments.length),pt("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return re("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return re("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return re("DataSnapshot.ref",0,0,arguments.length),new Kr(this._database,this._delegate.ref)}get ref(){return this.getRef()}},ig=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,i){var o;re("Query.on",2,4,arguments.length),pt("Query.on","callback",t,!1);let s=n.getCancelAndContextArgs_("Query.on",r,i),a=(c,d)=>{t.call(s.context,new Zo(this.database,c),d)};a.userCallback=t,a.context=s.context;let l=(o=s.cancel)===null||o===void 0?void 0:o.bind(s.context);switch(e){case"value":return rg(this._delegate,a,l),t;case"child_added":return xI(this._delegate,a,l),t;case"child_removed":return kI(this._delegate,a,l),t;case"child_changed":return NI(this._delegate,a,l),t;case"child_moved":return PI(this._delegate,a,l),t;default:throw new Error(en("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if(re("Query.off",0,3,arguments.length),aW("Query.off",e,!0),pt("Query.off","callback",t,!0),uy("Query.off","context",r,!0),t){let i=()=>{};i.userCallback=t,i.context=r,OI(this._delegate,e,i)}else OI(this._delegate,e)}get(){return EP(this._delegate).then(e=>new Zo(this.database,e))}once(e,t,r,i){re("Query.once",1,4,arguments.length),pt("Query.once","callback",t,!0);let o=n.getCancelAndContextArgs_("Query.once",r,i),s=new wt,a=(c,d)=>{let f=new Zo(this.database,c);t&&t.call(o.context,f,d),s.resolve(f)};a.userCallback=t,a.context=o.context;let l=c=>{o.cancel&&o.cancel.call(o.context,c),s.reject(c)};switch(e){case"value":rg(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":xI(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":kI(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":NI(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":PI(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error(en("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return re("Query.limitToFirst",1,1,arguments.length),new n(this.database,Vn(this._delegate,bP(e)))}limitToLast(e){return re("Query.limitToLast",1,1,arguments.length),new n(this.database,Vn(this._delegate,SP(e)))}orderByChild(e){return re("Query.orderByChild",1,1,arguments.length),new n(this.database,Vn(this._delegate,AP(e)))}orderByKey(){return re("Query.orderByKey",0,0,arguments.length),new n(this.database,Vn(this._delegate,MP()))}orderByPriority(){return re("Query.orderByPriority",0,0,arguments.length),new n(this.database,Vn(this._delegate,RP()))}orderByValue(){return re("Query.orderByValue",0,0,arguments.length),new n(this.database,Vn(this._delegate,xP()))}startAt(e=null,t){return re("Query.startAt",0,2,arguments.length),new n(this.database,Vn(this._delegate,DP(e,t)))}startAfter(e=null,t){return re("Query.startAfter",0,2,arguments.length),new n(this.database,Vn(this._delegate,TP(e,t)))}endAt(e=null,t){return re("Query.endAt",0,2,arguments.length),new n(this.database,Vn(this._delegate,IP(e,t)))}endBefore(e=null,t){return re("Query.endBefore",0,2,arguments.length),new n(this.database,Vn(this._delegate,CP(e,t)))}equalTo(e,t){return re("Query.equalTo",1,2,arguments.length),new n(this.database,Vn(this._delegate,NP(e,t)))}toString(){return re("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return re("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(re("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){let i={cancel:void 0,context:void 0};if(t&&r)i.cancel=t,pt(e,"cancel",i.cancel,!0),i.context=r,uy(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(en(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new Kr(this.database,new vn(this._delegate._repo,this._delegate._path))}},Kr=class n extends ig{constructor(e,t){super(e,new Zt(t._repo,t._path,new Ac,!1)),this.database=e,this._delegate=t}getKey(){return re("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return re("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,Bi(this._delegate,e))}getParent(){re("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return re("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){re("Reference.set",1,2,arguments.length),pt("Reference.set","onComplete",t,!0);let r=ng(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}update(e,t){if(re("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let o=0;o<e.length;++o)i[""+o]=e[o];e=i,HP("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}yn("Reference.update",this._delegate._path),pt("Reference.update","onComplete",t,!0);let r=wP(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){re("Reference.setWithPriority",2,3,arguments.length),pt("Reference.setWithPriority","onComplete",r,!0);let i=vP(this._delegate,e,t);return r&&i.then(()=>r(null),o=>r(o)),i}remove(e){re("Reference.remove",0,1,arguments.length),pt("Reference.remove","onComplete",e,!0);let t=yP(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){re("Reference.transaction",1,3,arguments.length),pt("Reference.transaction","transactionUpdate",e,!1),pt("Reference.transaction","onComplete",t,!0),sW("Reference.transaction","applyLocally",r,!0);let i=$P(this._delegate,e,{applyLocally:r}).then(o=>new LI(o.committed,new Zo(this.database,o.snapshot)));return t&&i.then(o=>t(null,o.committed,o.snapshot),o=>t(o,!1,null)),i}setPriority(e,t){re("Reference.setPriority",1,2,arguments.length),pt("Reference.setPriority","onComplete",t,!0);let r=_P(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}push(e,t){re("Reference.push",0,2,arguments.length),pt("Reference.push","onComplete",t,!0);let r=mP(this._delegate,e),i=r.then(s=>new n(this.database,s));t&&i.then(()=>t(null),s=>t(s));let o=new n(this.database,r);return o.then=i.then.bind(i),o.catch=i.catch.bind(i,void 0),o}onDisconnect(){return yn("Reference.onDisconnect",this._delegate._path),new VI(new Fp(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Jo=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:kP,forceLongPolling:OP}}useEmulator(e,t,r={}){FP(this._delegate,e,t,r)}ref(e){if(re("database.ref",0,1,arguments.length),e instanceof Kr){let t=RI(this._delegate,e.toString());return new Kr(this,t)}else{let t=MI(this._delegate,e);return new Kr(this,t)}}refFromURL(e){re("database.refFromURL",1,1,arguments.length);let r=RI(this._delegate,e);return new Kr(this,r)}goOffline(){return re("database.goOffline",0,0,arguments.length),VP(this._delegate)}goOnline(){return re("database.goOnline",0,0,arguments.length),LP(this._delegate)}};Jo.ServerValue={TIMESTAMP:BP(),increment:n=>UP(n)};function lW({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:i,namespace:o,nodeAdmin:s=!1}){rI(t);let a=new cy("database-standalone"),l=new rh("auth-internal",a);l.setComponent(new ln("auth-internal",()=>r,"PRIVATE"));let c;return i&&(c=new rh("app-check-internal",a),c.setComponent(new ln("app-check-internal",()=>i,"PRIVATE"))),{instance:new Jo(FI(n,l,c,e,s),n),namespace:o}}var uW=Object.freeze({__proto__:null,initStandalone:lW});var cW=Jo.ServerValue;function dW(n){n.INTERNAL.registerComponent(new ln("database-compat",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new Jo(i,r)},"PUBLIC").setServiceProps({Reference:Kr,Query:ig,Database:Jo,DataSnapshot:Zo,enableLogging:jP,INTERNAL:uW,ServerValue:cW}).setMultipleInstances(!0)),n.registerVersion(rW,iW)}dW(Dt);function Gc(n,e,t="on",r=_o){return new de(i=>{let o=null;return o=n[t](e,(s,a)=>{r.schedule(()=>{i.next({snapshot:s,prevKey:a})}),t==="once"&&r.schedule(()=>i.complete())},s=>{r.schedule(()=>i.error(s))}),t==="on"?{unsubscribe(){o!=null&&n.off(e,o)}}:{unsubscribe(){}}}).pipe(Q(i=>{let{snapshot:o,prevKey:s}=i,a=null;return o.exists()&&(a=o.key),{type:e,payload:o,prevKey:s,key:a}}),uu())}function hW(n){return typeof n=="string"}function fW(n){return typeof n.exportVal=="function"}function KP(n){return n==null}function QP(n){return typeof n.set=="function"}function qP(n,e){return QP(e)?e:n.ref(e)}function YP(n,e){if(hW(n))return e.stringCase();if(QP(n))return e.firebaseCase();if(fW(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function ZP(n){return(KP(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function JP(n,e,t){e=ZP(e);let r=e.map(i=>Gc(n,i,"on",t));return Bs(...r)}function pW(n,e,t){let r=JP(n,e).pipe(ar((i,o)=>[...i,o],[]));return mW(n,r,t)}function gW(n,e){return Gc(n,"value","on",e).pipe(Q(t=>{let r;return t.payload.forEach(i=>(r=i.key,!1)),{data:t,lastKeyToLoad:r}}))}function mW(n,e,t){return gW(n,t).pipe(Ly(e),Q(([i,o])=>{let s=i.lastKeyToLoad,a=o.map(l=>l.key);return{actions:o,lastKeyToLoad:s,loadedKeys:a}}),Fy(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),Q(i=>i.actions))}function GP(n,e){return function(r,i){return YP(r,{stringCase:()=>n.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function yW(n){return function(t){return t?YP(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function _W(n,e,t){return Gc(n,"value","once",t).pipe(Qe(r=>{let i=[ne(r)];return e.forEach(o=>i.push(Gc(n,o,"on",t))),Bs(...i).pipe(ar(wW,[]))}),su())}function XP(n,e){let t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function vW(n,e){if(KP(e))return 0;{let t=XP(n,e);return t===-1?n.length:t+1}}function wW(n,e){let{payload:t,prevKey:r,key:i}=e,o=XP(n,i),s=vW(n,r);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(l=>{let c={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,c],!1})}return n;case"child_added":if(o>-1)(n[o-1]?.key||null)!==r&&(n=n.filter(l=>l.payload.key!==t.key),n.splice(s,0,e));else{if(r==null)return[e,...n];n=n.slice(),n.splice(s,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(o>-1){let a=n.splice(o,1)[0];return n=n.slice(),n.splice(s,0,a),n}return n;default:return n}}function zP(n,e,t){return e=ZP(e),_W(n,e,t)}function EW(n,e,t){let r=e.schedulers.outsideAngular,i=V(De).run(()=>n.ref);return{query:n,update:GP(i,"update"),set:GP(i,"set"),push:o=>i.push(o),remove:yW(i),snapshotChanges(o){return zP(n,o,r).pipe(nt(t))},stateChanges(o){return JP(n,o,r).pipe(nt(t))},auditTrail(o){return pW(n,o,r).pipe(nt(t))},valueChanges(o,s){return zP(n,o,r).pipe(Q(l=>l.map(c=>s&&s.idField?pe($({},c.payload.val()),{[s.idField]:c.key}):c.payload.val())),nt(t))}}}function WP(n,e){return function(){return Gc(n,"value","on",e)}}function IW(n,e,t){return{query:n,snapshotChanges(){return WP(n,e.schedulers.outsideAngular)().pipe(nt(t))},update(r){return n.ref.update(r)},set(r){return n.ref.set(r)},remove(){return n.ref.remove()},valueChanges(){return WP(n,e.schedulers.outsideAngular)().pipe(nt(t),Q(i=>i.payload.exists()?i.payload.val():null))}}}var CW=new z("angularfire2.realtimeDatabaseURL"),DW=new z("angularfire2.database.use-emulator"),og=(()=>{class n{schedulers;database;injector=V(it);constructor(t,r,i,o,s,a,l,c,d,f,g,m,v,T,S){this.schedulers=a;let O=l,B=Ho(t,s,r);c&&dc(B,s,d,g,m,v,f,T),this.database=Sa(`${B.name}.database.${i}`,"AngularFireDatabase",B.name,()=>{let F=s.runOutsideAngular(()=>B.database(i||void 0));return O&&F.useEmulator(...O),F},[O])}list(t,r){let i=V(De).runOutsideAngular(()=>qP(this.database,t)),o=i;return r&&(o=r(i)),EW(o,this,this.injector)}object(t){let r=V(De).runOutsideAngular(()=>qP(this.database,t));return IW(r,this,this.injector)}createPushId(){return V(De).runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||n)(j(xi),j(Ni,8),j(CW,8),j(rn),j(De),j($o),j(DW,8),j(hc,8),j(oc,8),j(sc,8),j(ac,8),j(lc,8),j(uc,8),j(cc,8),j(Ri,8))};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var ek=(()=>{class n{constructor(t){this.db=t,this.dbPath="/PowerData",this.lastKey=null,this.database=t.list(this.dbPath),this.data=this.db.list(this.dbPath,r=>r.orderByChild("timestamp").limitToLast(1)).snapshotChanges().pipe(Q(r=>r.map(i=>{let o=i.payload.val();return o&&typeof o=="object"?$({key:i.payload.key},o):null})[0]))}getFilteredMonitoringView(t,r,i){return new de(o=>{let s=this.convertToFirebaseDate(t);this.database.query.ref.orderByChild("current_date").equalTo(s).once("value",a=>{if(!a.exists()){o.next([]),o.complete();return}let l=Object.values(a.val()).filter(c=>this.isTimeInRange(c?.current_time,r,i));o.next(l),o.complete()},a=>o.error(a))})}getLatestMonitoringView(){return this.data}convertToFirebaseDate(t){let r=new Date(t);return`${r.getMonth()+1}/${r.getDate()}/${r.getFullYear()}`}isTimeInRange(t,r,i){if(!t)return!1;let[o,s]=t.split(":").map(Number),[a,l]=r.split(":").map(Number),[c,d]=i.split(":").map(Number),f=o*60+s,g=a*60+l,m=c*60+d;return f>=g&&f<=m}static{this.\u0275fac=function(r){return new(r||n)(j(og))}}static{this.\u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function SW(n,e){if(n&1&&(Y(0,"option",30),ie(1),Z()),n&2){let t=e.$implicit;Rn("value",t.energy_kWh),be(),Kt(" ",t.energy_kWh," kWh ")}}function AW(n,e){n&1&&(Y(0,"tbody")(1,"tr")(2,"td",31),ie(3," Loading data, please wait... "),Y(4,"div",32)(5,"span",33),ie(6,"Loading..."),Z()()()()())}function MW(n,e){if(n&1&&(Y(0,"tr")(1,"td"),ie(2),Z(),Y(3,"td",8),ie(4),Z(),Y(5,"td"),ie(6),Z(),Y(7,"td",8),ie(8),Z(),Y(9,"td"),ie(10),Z(),Y(11,"td"),ie(12),Z(),Y(13,"td"),ie(14),Z(),Y(15,"td"),ie(16),Z()()),n&2){let t=e.$implicit,r=Mv(2);be(2),Si(t.current_date+" "+t.current_time),be(),Rn("ngClass",r.getVoltageClass(t.voltage_V)),be(),Kt("",t.voltage_V," V"),be(2),Kt("",t.current_A," A"),be(),Rn("ngClass",r.getPowerFactorClass(t.power_factor)),be(),Si(t.power_factor),be(2),Kt("",t.frequency_Hz," Hz"),be(2),Kt("",t.phase_angle_deg,"\xB0"),be(2),Kt("",t.active_power_W," W"),be(2),Kt("",t.energy_kWh," kWh")}}function RW(n,e){if(n&1&&(Y(0,"tbody"),bu(1,MW,17,10,"tr",34),Z()),n&2){let t=Mv();be(),Rn("ngForOf",t.filteredMonitoringViewList)}}var tk=(()=>{class n{constructor(t){this.monitoringService=t,this.filteredMonitoringViewList=[],this.monitoringViewList=[],this.monitoringView={active_power_W:0,apparent_power_VA:0,current_A:0,current_date:"",current_time:"",energy_kWh:0,frequency_Hz:0,phase_angle_deg:0,power_factor:0,voltage_V:0},this.loading=!1,this.inputCost=0,this.consumptionKwh=0,this.filterDate="",this.startTime="",this.endTime=""}ngOnInit(){this.getLatestMonitoringView()}getLatestMonitoringView(){this.monitoringService.getLatestMonitoringView().subscribe({next:t=>{this.monitoringView=t},error:t=>{},complete:()=>{}})}onFilter(){this.filterDate&&this.startTime&&this.endTime&&this.loadData()}loadData(){this.filterDate&&this.startTime&&this.endTime?(this.loading=!0,this.monitoringService.getFilteredMonitoringView(this.filterDate,this.startTime,this.endTime).subscribe({next:t=>{this.filteredMonitoringViewList=t,this.loading=!1},error:()=>{this.loading=!1}})):this.filteredMonitoringViewList=[]}calculate(){this.inputCost>0&&(this.consumptionKwh=this.inputCost*this.selectedEnergy)}resetConsumption(){this.inputCost=0,this.consumptionKwh=0}convertDateTime(t){let r=t.substring(0,2),i=t.substring(2,4),o=t.substring(4,8),s=t.substring(8,10),a=t.substring(10,12);return`${r}/${i}/${o} ${s}:${a}`}getVoltageClass(t){return t===220?"green":t>=198&&t<220||t>220&&t<242?"yellow":"red"}getPowerFactorClass(t){return t>=.95&&t<=1?"green":t>=.85&&t<=.94?"yellow":t<.85?"red":""}updateEnergy(){this.monitoringView.energy_kWh=this.selectedEnergy}static{this.\u0275fac=function(r){return new(r||n)(Me(ek))}}static{this.\u0275cmp=ca({type:n,selectors:[["app-monitoring-view"]],decls:127,vars:22,consts:[[1,"container","mt-4"],[1,"row","mb-4"],[1,"col-12"],[1,"text-center"],[1,"row"],[1,"col-12","col-md-6"],[1,"table","table-bordered"],["colspan","2",1,"text-center"],[3,"ngClass"],[1,"wider-dropdown",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"input-group"],["type","number","placeholder","Unit Value kWh","name","inputCost",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-sm","btn-primary",3,"click"],["type","text","readonly","","disabled","",1,"form-control",3,"value"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"filters","mt-4"],[1,"filter-row"],[1,"filter-item"],["for","filterDate"],["type","date","id","filterDate",3,"ngModelChange","ngModel"],["for","startTime"],["type","time","id","startTime",3,"ngModelChange","ngModel"],["for","endTime"],["type","time","id","endTime",3,"ngModelChange","ngModel"],[1,"button","btn","btn-primary","mt-3",3,"click","disabled"],[1,"table-container","mt-3"],[1,"table","table-striped","table-bordered"],[4,"ngIf"],[3,"value"],["colspan","8",1,"text-center"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[4,"ngFor","ngForOf"]],template:function(r,i){r&1&&(Y(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),ie(4,"REMOTE ELECTRICAL ANALYZER AND LOGGER"),Z()()(),Y(5,"div",4)(6,"div",5)(7,"table",6)(8,"thead")(9,"tr")(10,"th",7),ie(11,"Electrical Measurements"),Z()()(),Y(12,"tbody")(13,"tr")(14,"td"),ie(15,"Date"),Z(),Y(16,"td"),ie(17),Z()(),Y(18,"tr")(19,"td"),ie(20,"Time"),Z(),Y(21,"td"),ie(22),Z()(),Y(23,"tr")(24,"td"),ie(25,"Voltage"),Z(),Y(26,"td",8),ie(27),Z()(),Y(28,"tr")(29,"td"),ie(30,"Current"),Z(),Y(31,"td"),ie(32),Z()(),Y(33,"tr")(34,"td"),ie(35,"Frequency"),Z(),Y(36,"td"),ie(37),Z()(),Y(38,"tr")(39,"td"),ie(40,"Active Power"),Z(),Y(41,"td"),ie(42),Z()(),Y(43,"tr")(44,"td"),ie(45,"Power Factor"),Z(),Y(46,"td",8),ie(47),Z()(),Y(48,"tr")(49,"td"),ie(50,"Phase Angle"),Z(),Y(51,"td"),ie(52),Z()()()()(),Y(53,"div",5)(54,"table",6)(55,"thead")(56,"tr")(57,"th",7),ie(58,"Cost Calculation"),Z()()(),Y(59,"tbody")(60,"tr")(61,"td"),ie(62,"Energy Used"),Z(),Y(63,"td")(64,"select",9),ko("ngModelChange",function(s){return da(i.selectedEnergy,s)||(i.selectedEnergy=s),s}),xn("change",function(){return i.updateEnergy()}),bu(65,SW,2,2,"option",10),Z()()(),Y(66,"tr")(67,"td"),ie(68,"Input Cost Per kWh"),Z(),Y(69,"td")(70,"div",11)(71,"input",12),ko("ngModelChange",function(s){return da(i.inputCost,s)||(i.inputCost=s),s}),Z(),Y(72,"button",13),xn("click",function(){return i.calculate()}),ie(73,"Send"),Z()()()(),Y(74,"tr")(75,"td"),ie(76,"Cost Per kWh"),Z(),Y(77,"td"),No(78,"input",14),Z()(),Y(79,"tr")(80,"td"),ie(81,"Consumption in PHP = kWh"),Z(),Y(82,"td")(83,"div",15)(84,"span"),ie(85),Z(),Y(86,"button",16),xn("click",function(){return i.resetConsumption()}),ie(87,"Reset"),Z()()()()()()()(),Y(88,"div",17)(89,"div",18)(90,"div",19)(91,"label",20),ie(92,"Select Date:"),Z(),Y(93,"input",21),ko("ngModelChange",function(s){return da(i.filterDate,s)||(i.filterDate=s),s}),Z()()(),Y(94,"div",18)(95,"div",19)(96,"label",22),ie(97,"Start Time:"),Z(),Y(98,"input",23),ko("ngModelChange",function(s){return da(i.startTime,s)||(i.startTime=s),s}),Z()(),Y(99,"div",19)(100,"label",24),ie(101,"End Time:"),Z(),Y(102,"input",25),ko("ngModelChange",function(s){return da(i.endTime,s)||(i.endTime=s),s}),Z()()(),Y(103,"button",26),xn("click",function(){return i.onFilter()}),ie(104," Apply Filter "),Z()(),Y(105,"div",27)(106,"table",28)(107,"thead")(108,"tr")(109,"th"),ie(110,"DateTime"),Z(),Y(111,"th"),ie(112,"Voltage (V)"),Z(),Y(113,"th"),ie(114,"Current (A)"),Z(),Y(115,"th"),ie(116,"Power Factor"),Z(),Y(117,"th"),ie(118,"Frequency (Hz)"),Z(),Y(119,"th"),ie(120,"Phase Angle (\xB0)"),Z(),Y(121,"th"),ie(122,"Active Power (W)"),Z(),Y(123,"th"),ie(124,"Energy (kWh)"),Z()()(),bu(125,AW,7,0,"tbody",29)(126,RW,2,1,"tbody",29),Z()()()),r&2&&(be(17),Si(i.monitoringView.current_date),be(5),Si(i.monitoringView.current_time),be(4),Rn("ngClass",i.getVoltageClass(i.monitoringView.voltage_V)),be(),Kt("",i.monitoringView.voltage_V," V"),be(5),Kt("",i.monitoringView.current_A," A"),be(5),Kt("",i.monitoringView.frequency_Hz," Hz"),be(5),Kt("",i.monitoringView.active_power_W," KW"),be(4),Rn("ngClass",i.getPowerFactorClass(i.monitoringView.power_factor)),be(),Si(i.monitoringView.power_factor),be(5),Kt("",i.monitoringView.phase_angle_deg," \xB0"),be(12),Po("ngModel",i.selectedEnergy),be(),Rn("ngForOf",i.filteredMonitoringViewList),be(6),Po("ngModel",i.inputCost),be(7),Rv("value","1 kWh = \u20B1",i.inputCost,""),be(7),Si(i.consumptionKwh),be(8),Po("ngModel",i.filterDate),be(5),Po("ngModel",i.startTime),be(4),Po("ngModel",i.endTime),be(),Rn("disabled",!i.filterDate||!i.startTime||!i.endTime),be(22),Rn("ngIf",i.loading),be(),Rn("ngIf",!i.loading))},dependencies:[hx,ux,dx,ap,Ow,up,ox,kw,Ru,GM,zM,WM],styles:[".filters[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;margin-top:50px}.filter-row[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.filter-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.filters[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:.25rem}.button-row[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:10px}button.small[_ngcontent-%COMP%]{font-size:.875rem;padding:.4rem 1rem}button[_ngcontent-%COMP%]{padding:.6rem 1.2rem;font-size:1rem}.table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto;overflow-x:auto;margin-top:15px;width:100%;display:block}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;table-layout:auto}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{word-wrap:break-word;text-overflow:ellipsis;overflow:hidden}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid #ddd}.green[_ngcontent-%COMP%]{color:#57a857}.yellow[_ngcontent-%COMP%]{color:gold}.red[_ngcontent-%COMP%]{color:red}@media (max-width: 768px){.col-md-6[_ngcontent-%COMP%]{width:100%}.filter-row[_ngcontent-%COMP%], .button-row[_ngcontent-%COMP%]{flex-direction:column}.wider-dropdown[_ngcontent-%COMP%]{width:100%}.table-container[_ngcontent-%COMP%]{max-height:350px}}@media (max-width: 576px){button[_ngcontent-%COMP%]{width:50%}.table-container[_ngcontent-%COMP%]{max-height:350px;overflow-x:auto;overflow-y:visible;width:100%}table[_ngcontent-%COMP%]{min-width:600px}}"]})}}return n})();var nk=[{path:"",component:tk}];var rk=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ik={};var Qr,jI;(function(){var n;function e(I,_){function E(){}E.prototype=_.prototype,I.D=_.prototype,I.prototype=new E,I.prototype.constructor=I,I.C=function(C,D,A){for(var w=Array(arguments.length-2),Mr=2;Mr<arguments.length;Mr++)w[Mr-2]=arguments[Mr];return _.prototype[D].apply(C,w)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(I,_,E){E||(E=0);var C=Array(16);if(typeof _=="string")for(var D=0;16>D;++D)C[D]=_.charCodeAt(E++)|_.charCodeAt(E++)<<8|_.charCodeAt(E++)<<16|_.charCodeAt(E++)<<24;else for(D=0;16>D;++D)C[D]=_[E++]|_[E++]<<8|_[E++]<<16|_[E++]<<24;_=I.g[0],E=I.g[1],D=I.g[2];var A=I.g[3],w=_+(A^E&(D^A))+C[0]+3614090360&4294967295;_=E+(w<<7&4294967295|w>>>25),w=A+(D^_&(E^D))+C[1]+3905402710&4294967295,A=_+(w<<12&4294967295|w>>>20),w=D+(E^A&(_^E))+C[2]+606105819&4294967295,D=A+(w<<17&4294967295|w>>>15),w=E+(_^D&(A^_))+C[3]+3250441966&4294967295,E=D+(w<<22&4294967295|w>>>10),w=_+(A^E&(D^A))+C[4]+4118548399&4294967295,_=E+(w<<7&4294967295|w>>>25),w=A+(D^_&(E^D))+C[5]+1200080426&4294967295,A=_+(w<<12&4294967295|w>>>20),w=D+(E^A&(_^E))+C[6]+2821735955&4294967295,D=A+(w<<17&4294967295|w>>>15),w=E+(_^D&(A^_))+C[7]+4249261313&4294967295,E=D+(w<<22&4294967295|w>>>10),w=_+(A^E&(D^A))+C[8]+1770035416&4294967295,_=E+(w<<7&4294967295|w>>>25),w=A+(D^_&(E^D))+C[9]+2336552879&4294967295,A=_+(w<<12&4294967295|w>>>20),w=D+(E^A&(_^E))+C[10]+4294925233&4294967295,D=A+(w<<17&4294967295|w>>>15),w=E+(_^D&(A^_))+C[11]+2304563134&4294967295,E=D+(w<<22&4294967295|w>>>10),w=_+(A^E&(D^A))+C[12]+1804603682&4294967295,_=E+(w<<7&4294967295|w>>>25),w=A+(D^_&(E^D))+C[13]+4254626195&4294967295,A=_+(w<<12&4294967295|w>>>20),w=D+(E^A&(_^E))+C[14]+2792965006&4294967295,D=A+(w<<17&4294967295|w>>>15),w=E+(_^D&(A^_))+C[15]+1236535329&4294967295,E=D+(w<<22&4294967295|w>>>10),w=_+(D^A&(E^D))+C[1]+4129170786&4294967295,_=E+(w<<5&4294967295|w>>>27),w=A+(E^D&(_^E))+C[6]+3225465664&4294967295,A=_+(w<<9&4294967295|w>>>23),w=D+(_^E&(A^_))+C[11]+643717713&4294967295,D=A+(w<<14&4294967295|w>>>18),w=E+(A^_&(D^A))+C[0]+3921069994&4294967295,E=D+(w<<20&4294967295|w>>>12),w=_+(D^A&(E^D))+C[5]+3593408605&4294967295,_=E+(w<<5&4294967295|w>>>27),w=A+(E^D&(_^E))+C[10]+38016083&4294967295,A=_+(w<<9&4294967295|w>>>23),w=D+(_^E&(A^_))+C[15]+3634488961&4294967295,D=A+(w<<14&4294967295|w>>>18),w=E+(A^_&(D^A))+C[4]+3889429448&4294967295,E=D+(w<<20&4294967295|w>>>12),w=_+(D^A&(E^D))+C[9]+568446438&4294967295,_=E+(w<<5&4294967295|w>>>27),w=A+(E^D&(_^E))+C[14]+3275163606&4294967295,A=_+(w<<9&4294967295|w>>>23),w=D+(_^E&(A^_))+C[3]+4107603335&4294967295,D=A+(w<<14&4294967295|w>>>18),w=E+(A^_&(D^A))+C[8]+1163531501&4294967295,E=D+(w<<20&4294967295|w>>>12),w=_+(D^A&(E^D))+C[13]+2850285829&4294967295,_=E+(w<<5&4294967295|w>>>27),w=A+(E^D&(_^E))+C[2]+4243563512&4294967295,A=_+(w<<9&4294967295|w>>>23),w=D+(_^E&(A^_))+C[7]+1735328473&4294967295,D=A+(w<<14&4294967295|w>>>18),w=E+(A^_&(D^A))+C[12]+2368359562&4294967295,E=D+(w<<20&4294967295|w>>>12),w=_+(E^D^A)+C[5]+4294588738&4294967295,_=E+(w<<4&4294967295|w>>>28),w=A+(_^E^D)+C[8]+2272392833&4294967295,A=_+(w<<11&4294967295|w>>>21),w=D+(A^_^E)+C[11]+1839030562&4294967295,D=A+(w<<16&4294967295|w>>>16),w=E+(D^A^_)+C[14]+4259657740&4294967295,E=D+(w<<23&4294967295|w>>>9),w=_+(E^D^A)+C[1]+2763975236&4294967295,_=E+(w<<4&4294967295|w>>>28),w=A+(_^E^D)+C[4]+1272893353&4294967295,A=_+(w<<11&4294967295|w>>>21),w=D+(A^_^E)+C[7]+4139469664&4294967295,D=A+(w<<16&4294967295|w>>>16),w=E+(D^A^_)+C[10]+3200236656&4294967295,E=D+(w<<23&4294967295|w>>>9),w=_+(E^D^A)+C[13]+681279174&4294967295,_=E+(w<<4&4294967295|w>>>28),w=A+(_^E^D)+C[0]+3936430074&4294967295,A=_+(w<<11&4294967295|w>>>21),w=D+(A^_^E)+C[3]+3572445317&4294967295,D=A+(w<<16&4294967295|w>>>16),w=E+(D^A^_)+C[6]+76029189&4294967295,E=D+(w<<23&4294967295|w>>>9),w=_+(E^D^A)+C[9]+3654602809&4294967295,_=E+(w<<4&4294967295|w>>>28),w=A+(_^E^D)+C[12]+3873151461&4294967295,A=_+(w<<11&4294967295|w>>>21),w=D+(A^_^E)+C[15]+530742520&4294967295,D=A+(w<<16&4294967295|w>>>16),w=E+(D^A^_)+C[2]+3299628645&4294967295,E=D+(w<<23&4294967295|w>>>9),w=_+(D^(E|~A))+C[0]+4096336452&4294967295,_=E+(w<<6&4294967295|w>>>26),w=A+(E^(_|~D))+C[7]+1126891415&4294967295,A=_+(w<<10&4294967295|w>>>22),w=D+(_^(A|~E))+C[14]+2878612391&4294967295,D=A+(w<<15&4294967295|w>>>17),w=E+(A^(D|~_))+C[5]+4237533241&4294967295,E=D+(w<<21&4294967295|w>>>11),w=_+(D^(E|~A))+C[12]+1700485571&4294967295,_=E+(w<<6&4294967295|w>>>26),w=A+(E^(_|~D))+C[3]+2399980690&4294967295,A=_+(w<<10&4294967295|w>>>22),w=D+(_^(A|~E))+C[10]+4293915773&4294967295,D=A+(w<<15&4294967295|w>>>17),w=E+(A^(D|~_))+C[1]+2240044497&4294967295,E=D+(w<<21&4294967295|w>>>11),w=_+(D^(E|~A))+C[8]+1873313359&4294967295,_=E+(w<<6&4294967295|w>>>26),w=A+(E^(_|~D))+C[15]+4264355552&4294967295,A=_+(w<<10&4294967295|w>>>22),w=D+(_^(A|~E))+C[6]+2734768916&4294967295,D=A+(w<<15&4294967295|w>>>17),w=E+(A^(D|~_))+C[13]+1309151649&4294967295,E=D+(w<<21&4294967295|w>>>11),w=_+(D^(E|~A))+C[4]+4149444226&4294967295,_=E+(w<<6&4294967295|w>>>26),w=A+(E^(_|~D))+C[11]+3174756917&4294967295,A=_+(w<<10&4294967295|w>>>22),w=D+(_^(A|~E))+C[2]+718787259&4294967295,D=A+(w<<15&4294967295|w>>>17),w=E+(A^(D|~_))+C[9]+3951481745&4294967295,I.g[0]=I.g[0]+_&4294967295,I.g[1]=I.g[1]+(D+(w<<21&4294967295|w>>>11))&4294967295,I.g[2]=I.g[2]+D&4294967295,I.g[3]=I.g[3]+A&4294967295}r.prototype.u=function(I,_){_===void 0&&(_=I.length);for(var E=_-this.blockSize,C=this.B,D=this.h,A=0;A<_;){if(D==0)for(;A<=E;)i(this,I,A),A+=this.blockSize;if(typeof I=="string"){for(;A<_;)if(C[D++]=I.charCodeAt(A++),D==this.blockSize){i(this,C),D=0;break}}else for(;A<_;)if(C[D++]=I[A++],D==this.blockSize){i(this,C),D=0;break}}this.h=D,this.o+=_},r.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var _=1;_<I.length-8;++_)I[_]=0;var E=8*this.o;for(_=I.length-8;_<I.length;++_)I[_]=E&255,E/=256;for(this.u(I),I=Array(16),_=E=0;4>_;++_)for(var C=0;32>C;C+=8)I[E++]=this.g[_]>>>C&255;return I};function o(I,_){var E=a;return Object.prototype.hasOwnProperty.call(E,I)?E[I]:E[I]=_(I)}function s(I,_){this.h=_;for(var E=[],C=!0,D=I.length-1;0<=D;D--){var A=I[D]|0;C&&A==_||(E[D]=A,C=!1)}this.g=E}var a={};function l(I){return-128<=I&&128>I?o(I,function(_){return new s([_|0],0>_?-1:0)}):new s([I|0],0>I?-1:0)}function c(I){if(isNaN(I)||!isFinite(I))return f;if(0>I)return S(c(-I));for(var _=[],E=1,C=0;I>=E;C++)_[C]=I/E|0,E*=4294967296;return new s(_,0)}function d(I,_){if(I.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(I.charAt(0)=="-")return S(d(I.substring(1),_));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=c(Math.pow(_,8)),C=f,D=0;D<I.length;D+=8){var A=Math.min(8,I.length-D),w=parseInt(I.substring(D,D+A),_);8>A?(A=c(Math.pow(_,A)),C=C.j(A).add(c(w))):(C=C.j(E),C=C.add(c(w)))}return C}var f=l(0),g=l(1),m=l(16777216);n=s.prototype,n.m=function(){if(T(this))return-S(this).m();for(var I=0,_=1,E=0;E<this.g.length;E++){var C=this.i(E);I+=(0<=C?C:4294967296+C)*_,_*=4294967296}return I},n.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(v(this))return"0";if(T(this))return"-"+S(this).toString(I);for(var _=c(Math.pow(I,6)),E=this,C="";;){var D=W(E,_).g;E=O(E,D.j(_));var A=((0<E.g.length?E.g[0]:E.h)>>>0).toString(I);if(E=D,v(E))return A+C;for(;6>A.length;)A="0"+A;C=A+C}},n.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function v(I){if(I.h!=0)return!1;for(var _=0;_<I.g.length;_++)if(I.g[_]!=0)return!1;return!0}function T(I){return I.h==-1}n.l=function(I){return I=O(this,I),T(I)?-1:v(I)?0:1};function S(I){for(var _=I.g.length,E=[],C=0;C<_;C++)E[C]=~I.g[C];return new s(E,~I.h).add(g)}n.abs=function(){return T(this)?S(this):this},n.add=function(I){for(var _=Math.max(this.g.length,I.g.length),E=[],C=0,D=0;D<=_;D++){var A=C+(this.i(D)&65535)+(I.i(D)&65535),w=(A>>>16)+(this.i(D)>>>16)+(I.i(D)>>>16);C=w>>>16,A&=65535,w&=65535,E[D]=w<<16|A}return new s(E,E[E.length-1]&-2147483648?-1:0)};function O(I,_){return I.add(S(_))}n.j=function(I){if(v(this)||v(I))return f;if(T(this))return T(I)?S(this).j(S(I)):S(S(this).j(I));if(T(I))return S(this.j(S(I)));if(0>this.l(m)&&0>I.l(m))return c(this.m()*I.m());for(var _=this.g.length+I.g.length,E=[],C=0;C<2*_;C++)E[C]=0;for(C=0;C<this.g.length;C++)for(var D=0;D<I.g.length;D++){var A=this.i(C)>>>16,w=this.i(C)&65535,Mr=I.i(D)>>>16,Nl=I.i(D)&65535;E[2*C+2*D]+=w*Nl,B(E,2*C+2*D),E[2*C+2*D+1]+=A*Nl,B(E,2*C+2*D+1),E[2*C+2*D+1]+=w*Mr,B(E,2*C+2*D+1),E[2*C+2*D+2]+=A*Mr,B(E,2*C+2*D+2)}for(C=0;C<_;C++)E[C]=E[2*C+1]<<16|E[2*C];for(C=_;C<2*_;C++)E[C]=0;return new s(E,0)};function B(I,_){for(;(I[_]&65535)!=I[_];)I[_+1]+=I[_]>>>16,I[_]&=65535,_++}function F(I,_){this.g=I,this.h=_}function W(I,_){if(v(_))throw Error("division by zero");if(v(I))return new F(f,f);if(T(I))return _=W(S(I),_),new F(S(_.g),S(_.h));if(T(_))return _=W(I,S(_)),new F(S(_.g),_.h);if(30<I.g.length){if(T(I)||T(_))throw Error("slowDivide_ only works with positive integers.");for(var E=g,C=_;0>=C.l(I);)E=oe(E),C=oe(C);var D=X(E,1),A=X(C,1);for(C=X(C,2),E=X(E,2);!v(C);){var w=A.add(C);0>=w.l(I)&&(D=D.add(E),A=w),C=X(C,1),E=X(E,1)}return _=O(I,D.j(_)),new F(D,_)}for(D=f;0<=I.l(_);){for(E=Math.max(1,Math.floor(I.m()/_.m())),C=Math.ceil(Math.log(E)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),A=c(E),w=A.j(_);T(w)||0<w.l(I);)E-=C,A=c(E),w=A.j(_);v(A)&&(A=g),D=D.add(A),I=O(I,w)}return new F(D,I)}n.A=function(I){return W(this,I).h},n.and=function(I){for(var _=Math.max(this.g.length,I.g.length),E=[],C=0;C<_;C++)E[C]=this.i(C)&I.i(C);return new s(E,this.h&I.h)},n.or=function(I){for(var _=Math.max(this.g.length,I.g.length),E=[],C=0;C<_;C++)E[C]=this.i(C)|I.i(C);return new s(E,this.h|I.h)},n.xor=function(I){for(var _=Math.max(this.g.length,I.g.length),E=[],C=0;C<_;C++)E[C]=this.i(C)^I.i(C);return new s(E,this.h^I.h)};function oe(I){for(var _=I.g.length+1,E=[],C=0;C<_;C++)E[C]=I.i(C)<<1|I.i(C-1)>>>31;return new s(E,I.h)}function X(I,_){var E=_>>5;_%=32;for(var C=I.g.length-E,D=[],A=0;A<C;A++)D[A]=0<_?I.i(A+E)>>>_|I.i(A+E+1)<<32-_:I.i(A+E);return new s(D,I.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,jI=ik.Md5=r,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=c,s.fromString=d,Qr=ik.Integer=s}).apply(typeof rk<"u"?rk:typeof self<"u"?self:typeof window<"u"?window:{});var sg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Yr={};var BI,xW,Ga,UI,zc,ag,$I,HI,qI;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(u,h,p){return u==Array.prototype||u==Object.prototype||(u[h]=p.value),u};function t(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof sg=="object"&&sg];for(var h=0;h<u.length;++h){var p=u[h];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=t(this);function i(u,h){if(h)e:{var p=r;u=u.split(".");for(var y=0;y<u.length-1;y++){var b=u[y];if(!(b in p))break e;p=p[b]}u=u[u.length-1],y=p[u],h=h(y),h!=y&&h!=null&&e(p,u,{configurable:!0,writable:!0,value:h})}}function o(u,h){u instanceof String&&(u+="");var p=0,y=!1,b={next:function(){if(!y&&p<u.length){var R=p++;return{value:h(R,u[R]),done:!1}}return y=!0,{done:!0,value:void 0}}};return b[Symbol.iterator]=function(){return b},b}i("Array.prototype.values",function(u){return u||function(){return o(this,function(h,p){return p})}});var s=s||{},a=this||self;function l(u){var h=typeof u;return h=h!="object"?h:u?Array.isArray(u)?"array":h:"null",h=="array"||h=="object"&&typeof u.length=="number"}function c(u){var h=typeof u;return h=="object"&&u!=null||h=="function"}function d(u,h,p){return u.call.apply(u.bind,arguments)}function f(u,h,p){if(!u)throw Error();if(2<arguments.length){var y=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(b,y),u.apply(h,b)}}return function(){return u.apply(h,arguments)}}function g(u,h,p){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,g.apply(null,arguments)}function m(u,h){var p=Array.prototype.slice.call(arguments,1);return function(){var y=p.slice();return y.push.apply(y,arguments),u.apply(this,y)}}function v(u,h){function p(){}p.prototype=h.prototype,u.aa=h.prototype,u.prototype=new p,u.prototype.constructor=u,u.Qb=function(y,b,R){for(var U=Array(arguments.length-2),Le=2;Le<arguments.length;Le++)U[Le-2]=arguments[Le];return h.prototype[b].apply(y,U)}}function T(u){let h=u.length;if(0<h){let p=Array(h);for(let y=0;y<h;y++)p[y]=u[y];return p}return[]}function S(u,h){for(let p=1;p<arguments.length;p++){let y=arguments[p];if(l(y)){let b=u.length||0,R=y.length||0;u.length=b+R;for(let U=0;U<R;U++)u[b+U]=y[U]}else u.push(y)}}class O{constructor(h,p){this.i=h,this.j=p,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function B(u){return/^[\s\xa0]*$/.test(u)}function F(){var u=a.navigator;return u&&(u=u.userAgent)?u:""}function W(u){return W[" "](u),u}W[" "]=function(){};var oe=F().indexOf("Gecko")!=-1&&!(F().toLowerCase().indexOf("webkit")!=-1&&F().indexOf("Edge")==-1)&&!(F().indexOf("Trident")!=-1||F().indexOf("MSIE")!=-1)&&F().indexOf("Edge")==-1;function X(u,h,p){for(let y in u)h.call(p,u[y],y,u)}function I(u,h){for(let p in u)h.call(void 0,u[p],p,u)}function _(u){let h={};for(let p in u)h[p]=u[p];return h}let E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(u,h){let p,y;for(let b=1;b<arguments.length;b++){y=arguments[b];for(p in y)u[p]=y[p];for(let R=0;R<E.length;R++)p=E[R],Object.prototype.hasOwnProperty.call(y,p)&&(u[p]=y[p])}}function D(u){var h=1;u=u.split(":");let p=[];for(;0<h&&u.length;)p.push(u.shift()),h--;return u.length&&p.push(u.join(":")),p}function A(u){a.setTimeout(()=>{throw u},0)}function w(){var u=km;let h=null;return u.g&&(h=u.g,u.g=u.g.next,u.g||(u.h=null),h.next=null),h}class Mr{constructor(){this.h=this.g=null}add(h,p){let y=Nl.get();y.set(h,p),this.h?this.h.next=y:this.g=y,this.h=y}}var Nl=new O(()=>new BF,u=>u.reset());class BF{constructor(){this.next=this.g=this.h=null}set(h,p){this.h=h,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let Pl,kl=!1,km=new Mr,GT=()=>{let u=a.Promise.resolve(void 0);Pl=()=>{u.then(UF)}};var UF=()=>{for(var u;u=w();){try{u.h.call(u.g)}catch(p){A(p)}var h=Nl;h.j(u),100>h.h&&(h.h++,u.next=h.g,h.g=u)}kl=!1};function ai(){this.s=this.s,this.C=this.C}ai.prototype.s=!1,ai.prototype.ma=function(){this.s||(this.s=!0,this.N())},ai.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Pt(u,h){this.type=u,this.g=this.target=h,this.defaultPrevented=!1}Pt.prototype.h=function(){this.defaultPrevented=!0};var $F=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,h=Object.defineProperty({},"passive",{get:function(){u=!0}});try{let p=()=>{};a.addEventListener("test",p,h),a.removeEventListener("test",p,h)}catch{}return u}();function Ol(u,h){if(Pt.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var p=this.type=u.type,y=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=h,h=u.relatedTarget){if(oe){e:{try{W(h.nodeName);var b=!0;break e}catch{}b=!1}b||(h=null)}}else p=="mouseover"?h=u.fromElement:p=="mouseout"&&(h=u.toElement);this.relatedTarget=h,y?(this.clientX=y.clientX!==void 0?y.clientX:y.pageX,this.clientY=y.clientY!==void 0?y.clientY:y.pageY,this.screenX=y.screenX||0,this.screenY=y.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=typeof u.pointerType=="string"?u.pointerType:HF[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&Ol.aa.h.call(this)}}v(Ol,Pt);var HF={2:"touch",3:"pen",4:"mouse"};Ol.prototype.h=function(){Ol.aa.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var Fl="closure_listenable_"+(1e6*Math.random()|0),qF=0;function GF(u,h,p,y,b){this.listener=u,this.proxy=null,this.src=h,this.type=p,this.capture=!!y,this.ha=b,this.key=++qF,this.da=this.fa=!1}function kd(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function Od(u){this.src=u,this.g={},this.h=0}Od.prototype.add=function(u,h,p,y,b){var R=u.toString();u=this.g[R],u||(u=this.g[R]=[],this.h++);var U=Fm(u,h,y,b);return-1<U?(h=u[U],p||(h.fa=!1)):(h=new GF(h,this.src,R,!!y,b),h.fa=p,u.push(h)),h};function Om(u,h){var p=h.type;if(p in u.g){var y=u.g[p],b=Array.prototype.indexOf.call(y,h,void 0),R;(R=0<=b)&&Array.prototype.splice.call(y,b,1),R&&(kd(h),u.g[p].length==0&&(delete u.g[p],u.h--))}}function Fm(u,h,p,y){for(var b=0;b<u.length;++b){var R=u[b];if(!R.da&&R.listener==h&&R.capture==!!p&&R.ha==y)return b}return-1}var Vm="closure_lm_"+(1e6*Math.random()|0),Lm={};function zT(u,h,p,y,b){if(y&&y.once)return KT(u,h,p,y,b);if(Array.isArray(h)){for(var R=0;R<h.length;R++)zT(u,h[R],p,y,b);return null}return p=$m(p),u&&u[Fl]?u.K(h,p,c(y)?!!y.capture:!!y,b):WT(u,h,p,!1,y,b)}function WT(u,h,p,y,b,R){if(!h)throw Error("Invalid event type");var U=c(b)?!!b.capture:!!b,Le=Bm(u);if(Le||(u[Vm]=Le=new Od(u)),p=Le.add(h,p,y,U,R),p.proxy)return p;if(y=zF(),p.proxy=y,y.src=u,y.listener=p,u.addEventListener)$F||(b=U),b===void 0&&(b=!1),u.addEventListener(h.toString(),y,b);else if(u.attachEvent)u.attachEvent(YT(h.toString()),y);else if(u.addListener&&u.removeListener)u.addListener(y);else throw Error("addEventListener and attachEvent are unavailable.");return p}function zF(){function u(p){return h.call(u.src,u.listener,p)}let h=WF;return u}function KT(u,h,p,y,b){if(Array.isArray(h)){for(var R=0;R<h.length;R++)KT(u,h[R],p,y,b);return null}return p=$m(p),u&&u[Fl]?u.L(h,p,c(y)?!!y.capture:!!y,b):WT(u,h,p,!0,y,b)}function QT(u,h,p,y,b){if(Array.isArray(h))for(var R=0;R<h.length;R++)QT(u,h[R],p,y,b);else y=c(y)?!!y.capture:!!y,p=$m(p),u&&u[Fl]?(u=u.i,h=String(h).toString(),h in u.g&&(R=u.g[h],p=Fm(R,p,y,b),-1<p&&(kd(R[p]),Array.prototype.splice.call(R,p,1),R.length==0&&(delete u.g[h],u.h--)))):u&&(u=Bm(u))&&(h=u.g[h.toString()],u=-1,h&&(u=Fm(h,p,y,b)),(p=-1<u?h[u]:null)&&jm(p))}function jm(u){if(typeof u!="number"&&u&&!u.da){var h=u.src;if(h&&h[Fl])Om(h.i,u);else{var p=u.type,y=u.proxy;h.removeEventListener?h.removeEventListener(p,y,u.capture):h.detachEvent?h.detachEvent(YT(p),y):h.addListener&&h.removeListener&&h.removeListener(y),(p=Bm(h))?(Om(p,u),p.h==0&&(p.src=null,h[Vm]=null)):kd(u)}}}function YT(u){return u in Lm?Lm[u]:Lm[u]="on"+u}function WF(u,h){if(u.da)u=!0;else{h=new Ol(h,this);var p=u.listener,y=u.ha||u.src;u.fa&&jm(u),u=p.call(y,h)}return u}function Bm(u){return u=u[Vm],u instanceof Od?u:null}var Um="__closure_events_fn_"+(1e9*Math.random()>>>0);function $m(u){return typeof u=="function"?u:(u[Um]||(u[Um]=function(h){return u.handleEvent(h)}),u[Um])}function kt(){ai.call(this),this.i=new Od(this),this.M=this,this.F=null}v(kt,ai),kt.prototype[Fl]=!0,kt.prototype.removeEventListener=function(u,h,p,y){QT(this,u,h,p,y)};function $t(u,h){var p,y=u.F;if(y)for(p=[];y;y=y.F)p.push(y);if(u=u.M,y=h.type||h,typeof h=="string")h=new Pt(h,u);else if(h instanceof Pt)h.target=h.target||u;else{var b=h;h=new Pt(y,u),C(h,b)}if(b=!0,p)for(var R=p.length-1;0<=R;R--){var U=h.g=p[R];b=Fd(U,y,!0,h)&&b}if(U=h.g=u,b=Fd(U,y,!0,h)&&b,b=Fd(U,y,!1,h)&&b,p)for(R=0;R<p.length;R++)U=h.g=p[R],b=Fd(U,y,!1,h)&&b}kt.prototype.N=function(){if(kt.aa.N.call(this),this.i){var u=this.i,h;for(h in u.g){for(var p=u.g[h],y=0;y<p.length;y++)kd(p[y]);delete u.g[h],u.h--}}this.F=null},kt.prototype.K=function(u,h,p,y){return this.i.add(String(u),h,!1,p,y)},kt.prototype.L=function(u,h,p,y){return this.i.add(String(u),h,!0,p,y)};function Fd(u,h,p,y){if(h=u.i.g[String(h)],!h)return!0;h=h.concat();for(var b=!0,R=0;R<h.length;++R){var U=h[R];if(U&&!U.da&&U.capture==p){var Le=U.listener,Ct=U.ha||U.src;U.fa&&Om(u.i,U),b=Le.call(Ct,y)!==!1&&b}}return b&&!y.defaultPrevented}function ZT(u,h,p){if(typeof u=="function")p&&(u=g(u,p));else if(u&&typeof u.handleEvent=="function")u=g(u.handleEvent,u);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(u,h||0)}function JT(u){u.g=ZT(()=>{u.g=null,u.i&&(u.i=!1,JT(u))},u.l);let h=u.h;u.h=null,u.m.apply(null,h)}class KF extends ai{constructor(h,p){super(),this.m=h,this.l=p,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:JT(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Vl(u){ai.call(this),this.h=u,this.g={}}v(Vl,ai);var XT=[];function eb(u){X(u.g,function(h,p){this.g.hasOwnProperty(p)&&jm(h)},u),u.g={}}Vl.prototype.N=function(){Vl.aa.N.call(this),eb(this)},Vl.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Hm=a.JSON.stringify,QF=a.JSON.parse,YF=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function qm(){}qm.prototype.h=null;function tb(u){return u.h||(u.h=u.i())}function nb(){}var Ll={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Gm(){Pt.call(this,"d")}v(Gm,Pt);function zm(){Pt.call(this,"c")}v(zm,Pt);var lo={},rb=null;function Vd(){return rb=rb||new kt}lo.La="serverreachability";function ib(u){Pt.call(this,lo.La,u)}v(ib,Pt);function jl(u){let h=Vd();$t(h,new ib(h))}lo.STAT_EVENT="statevent";function ob(u,h){Pt.call(this,lo.STAT_EVENT,u),this.stat=h}v(ob,Pt);function Ht(u){let h=Vd();$t(h,new ob(h,u))}lo.Ma="timingevent";function sb(u,h){Pt.call(this,lo.Ma,u),this.size=h}v(sb,Pt);function Bl(u,h){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},h)}function Ul(){this.g=!0}Ul.prototype.xa=function(){this.g=!1};function ZF(u,h,p,y,b,R){u.info(function(){if(u.g)if(R)for(var U="",Le=R.split("&"),Ct=0;Ct<Le.length;Ct++){var xe=Le[Ct].split("=");if(1<xe.length){var Ot=xe[0];xe=xe[1];var Ft=Ot.split("_");U=2<=Ft.length&&Ft[1]=="type"?U+(Ot+"="+xe+"&"):U+(Ot+"=redacted&")}}else U=null;else U=R;return"XMLHTTP REQ ("+y+") [attempt "+b+"]: "+h+`
`+p+`
`+U})}function JF(u,h,p,y,b,R,U){u.info(function(){return"XMLHTTP RESP ("+y+") [ attempt "+b+"]: "+h+`
`+p+`
`+R+" "+U})}function Cs(u,h,p,y){u.info(function(){return"XMLHTTP TEXT ("+h+"): "+eV(u,p)+(y?" "+y:"")})}function XF(u,h){u.info(function(){return"TIMEOUT: "+h})}Ul.prototype.info=function(){};function eV(u,h){if(!u.g)return h;if(!h)return null;try{var p=JSON.parse(h);if(p){for(u=0;u<p.length;u++)if(Array.isArray(p[u])){var y=p[u];if(!(2>y.length)){var b=y[1];if(Array.isArray(b)&&!(1>b.length)){var R=b[0];if(R!="noop"&&R!="stop"&&R!="close")for(var U=1;U<b.length;U++)b[U]=""}}}}return Hm(p)}catch{return h}}var Ld={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ab={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Wm;function jd(){}v(jd,qm),jd.prototype.g=function(){return new XMLHttpRequest},jd.prototype.i=function(){return{}},Wm=new jd;function li(u,h,p,y){this.j=u,this.i=h,this.l=p,this.R=y||1,this.U=new Vl(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new lb}function lb(){this.i=null,this.g="",this.h=!1}var ub={},Km={};function Qm(u,h,p){u.L=1,u.v=Hd(Rr(h)),u.m=p,u.P=!0,cb(u,null)}function cb(u,h){u.F=Date.now(),Bd(u),u.A=Rr(u.v);var p=u.A,y=u.R;Array.isArray(y)||(y=[String(y)]),Db(p.i,"t",y),u.C=0,p=u.j.J,u.h=new lb,u.g=$b(u.j,p?h:null,!u.m),0<u.O&&(u.M=new KF(g(u.Y,u,u.g),u.O)),h=u.U,p=u.g,y=u.ca;var b="readystatechange";Array.isArray(b)||(b&&(XT[0]=b.toString()),b=XT);for(var R=0;R<b.length;R++){var U=zT(p,b[R],y||h.handleEvent,!1,h.h||h);if(!U)break;h.g[U.key]=U}h=u.H?_(u.H):{},u.m?(u.u||(u.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.A,u.u,u.m,h)):(u.u="GET",u.g.ea(u.A,u.u,null,h)),jl(),ZF(u.i,u.u,u.A,u.l,u.R,u.m)}li.prototype.ca=function(u){u=u.target;let h=this.M;h&&xr(u)==3?h.j():this.Y(u)},li.prototype.Y=function(u){try{if(u==this.g)e:{let Ft=xr(this.g);var h=this.g.Ba();let bs=this.g.Z();if(!(3>Ft)&&(Ft!=3||this.g&&(this.h.h||this.g.oa()||xb(this.g)))){this.J||Ft!=4||h==7||(h==8||0>=bs?jl(3):jl(2)),Ym(this);var p=this.g.Z();this.X=p;t:if(db(this)){var y=xb(this.g);u="";var b=y.length,R=xr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){uo(this),$l(this);var U="";break t}this.h.i=new a.TextDecoder}for(h=0;h<b;h++)this.h.h=!0,u+=this.h.i.decode(y[h],{stream:!(R&&h==b-1)});y.length=0,this.h.g+=u,this.C=0,U=this.h.g}else U=this.g.oa();if(this.o=p==200,JF(this.i,this.u,this.A,this.l,this.R,Ft,p),this.o){if(this.T&&!this.K){t:{if(this.g){var Le,Ct=this.g;if((Le=Ct.g?Ct.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(Le)){var xe=Le;break t}}xe=null}if(p=xe)Cs(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Zm(this,p);else{this.o=!1,this.s=3,Ht(12),uo(this),$l(this);break e}}if(this.P){p=!0;let Bn;for(;!this.J&&this.C<U.length;)if(Bn=tV(this,U),Bn==Km){Ft==4&&(this.s=4,Ht(14),p=!1),Cs(this.i,this.l,null,"[Incomplete Response]");break}else if(Bn==ub){this.s=4,Ht(15),Cs(this.i,this.l,U,"[Invalid Chunk]"),p=!1;break}else Cs(this.i,this.l,Bn,null),Zm(this,Bn);if(db(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ft!=4||U.length!=0||this.h.h||(this.s=1,Ht(16),p=!1),this.o=this.o&&p,!p)Cs(this.i,this.l,U,"[Invalid Chunked Response]"),uo(this),$l(this);else if(0<U.length&&!this.W){this.W=!0;var Ot=this.j;Ot.g==this&&Ot.ba&&!Ot.M&&(Ot.j.info("Great, no buffering proxy detected. Bytes received: "+U.length),ry(Ot),Ot.M=!0,Ht(11))}}else Cs(this.i,this.l,U,null),Zm(this,U);Ft==4&&uo(this),this.o&&!this.J&&(Ft==4?Lb(this.j,this):(this.o=!1,Bd(this)))}else _V(this.g),p==400&&0<U.indexOf("Unknown SID")?(this.s=3,Ht(12)):(this.s=0,Ht(13)),uo(this),$l(this)}}}catch{}finally{}};function db(u){return u.g?u.u=="GET"&&u.L!=2&&u.j.Ca:!1}function tV(u,h){var p=u.C,y=h.indexOf(`
`,p);return y==-1?Km:(p=Number(h.substring(p,y)),isNaN(p)?ub:(y+=1,y+p>h.length?Km:(h=h.slice(y,y+p),u.C=y+p,h)))}li.prototype.cancel=function(){this.J=!0,uo(this)};function Bd(u){u.S=Date.now()+u.I,hb(u,u.I)}function hb(u,h){if(u.B!=null)throw Error("WatchDog timer not null");u.B=Bl(g(u.ba,u),h)}function Ym(u){u.B&&(a.clearTimeout(u.B),u.B=null)}li.prototype.ba=function(){this.B=null;let u=Date.now();0<=u-this.S?(XF(this.i,this.A),this.L!=2&&(jl(),Ht(17)),uo(this),this.s=2,$l(this)):hb(this,this.S-u)};function $l(u){u.j.G==0||u.J||Lb(u.j,u)}function uo(u){Ym(u);var h=u.M;h&&typeof h.ma=="function"&&h.ma(),u.M=null,eb(u.U),u.g&&(h=u.g,u.g=null,h.abort(),h.ma())}function Zm(u,h){try{var p=u.j;if(p.G!=0&&(p.g==u||Jm(p.h,u))){if(!u.K&&Jm(p.h,u)&&p.G==3){try{var y=p.Da.g.parse(h)}catch{y=null}if(Array.isArray(y)&&y.length==3){var b=y;if(b[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<u.F)Kd(p),zd(p);else break e;ny(p),Ht(18)}}else p.za=b[1],0<p.za-p.T&&37500>b[2]&&p.F&&p.v==0&&!p.C&&(p.C=Bl(g(p.Za,p),6e3));if(1>=gb(p.h)&&p.ca){try{p.ca()}catch{}p.ca=void 0}}else ho(p,11)}else if((u.K||p.g==u)&&Kd(p),!B(h))for(b=p.Da.g.parse(h),h=0;h<b.length;h++){let xe=b[h];if(p.T=xe[0],xe=xe[1],p.G==2)if(xe[0]=="c"){p.K=xe[1],p.ia=xe[2];let Ot=xe[3];Ot!=null&&(p.la=Ot,p.j.info("VER="+p.la));let Ft=xe[4];Ft!=null&&(p.Aa=Ft,p.j.info("SVER="+p.Aa));let bs=xe[5];bs!=null&&typeof bs=="number"&&0<bs&&(y=1.5*bs,p.L=y,p.j.info("backChannelRequestTimeoutMs_="+y)),y=p;let Bn=u.g;if(Bn){let Yd=Bn.g?Bn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Yd){var R=y.h;R.g||Yd.indexOf("spdy")==-1&&Yd.indexOf("quic")==-1&&Yd.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(Xm(R,R.h),R.h=null))}if(y.D){let iy=Bn.g?Bn.g.getResponseHeader("X-HTTP-Session-Id"):null;iy&&(y.ya=iy,qe(y.I,y.D,iy))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-u.F,p.j.info("Handshake RTT: "+p.R+"ms")),y=p;var U=u;if(y.qa=Ub(y,y.J?y.ia:null,y.W),U.K){mb(y.h,U);var Le=U,Ct=y.L;Ct&&(Le.I=Ct),Le.B&&(Ym(Le),Bd(Le)),y.g=U}else Fb(y);0<p.i.length&&Wd(p)}else xe[0]!="stop"&&xe[0]!="close"||ho(p,7);else p.G==3&&(xe[0]=="stop"||xe[0]=="close"?xe[0]=="stop"?ho(p,7):ty(p):xe[0]!="noop"&&p.l&&p.l.ta(xe),p.v=0)}}jl(4)}catch{}}var nV=class{constructor(u,h){this.g=u,this.map=h}};function fb(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=0<u.length&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function pb(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function gb(u){return u.h?1:u.g?u.g.size:0}function Jm(u,h){return u.h?u.h==h:u.g?u.g.has(h):!1}function Xm(u,h){u.g?u.g.add(h):u.h=h}function mb(u,h){u.h&&u.h==h?u.h=null:u.g&&u.g.has(h)&&u.g.delete(h)}fb.prototype.cancel=function(){if(this.i=yb(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let u of this.g.values())u.cancel();this.g.clear()}};function yb(u){if(u.h!=null)return u.i.concat(u.h.D);if(u.g!=null&&u.g.size!==0){let h=u.i;for(let p of u.g.values())h=h.concat(p.D);return h}return T(u.i)}function rV(u){if(u.V&&typeof u.V=="function")return u.V();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if(typeof u=="string")return u.split("");if(l(u)){for(var h=[],p=u.length,y=0;y<p;y++)h.push(u[y]);return h}h=[],p=0;for(y in u)h[p++]=u[y];return h}function iV(u){if(u.na&&typeof u.na=="function")return u.na();if(!u.V||typeof u.V!="function"){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(l(u)||typeof u=="string"){var h=[];u=u.length;for(var p=0;p<u;p++)h.push(p);return h}h=[],p=0;for(let y in u)h[p++]=y;return h}}}function _b(u,h){if(u.forEach&&typeof u.forEach=="function")u.forEach(h,void 0);else if(l(u)||typeof u=="string")Array.prototype.forEach.call(u,h,void 0);else for(var p=iV(u),y=rV(u),b=y.length,R=0;R<b;R++)h.call(void 0,y[R],p&&p[R],u)}var vb=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function oV(u,h){if(u){u=u.split("&");for(var p=0;p<u.length;p++){var y=u[p].indexOf("="),b=null;if(0<=y){var R=u[p].substring(0,y);b=u[p].substring(y+1)}else R=u[p];h(R,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function co(u){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,u instanceof co){this.h=u.h,Ud(this,u.j),this.o=u.o,this.g=u.g,$d(this,u.s),this.l=u.l;var h=u.i,p=new Gl;p.i=h.i,h.g&&(p.g=new Map(h.g),p.h=h.h),wb(this,p),this.m=u.m}else u&&(h=String(u).match(vb))?(this.h=!1,Ud(this,h[1]||"",!0),this.o=Hl(h[2]||""),this.g=Hl(h[3]||"",!0),$d(this,h[4]),this.l=Hl(h[5]||"",!0),wb(this,h[6]||"",!0),this.m=Hl(h[7]||"")):(this.h=!1,this.i=new Gl(null,this.h))}co.prototype.toString=function(){var u=[],h=this.j;h&&u.push(ql(h,Eb,!0),":");var p=this.g;return(p||h=="file")&&(u.push("//"),(h=this.o)&&u.push(ql(h,Eb,!0),"@"),u.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&u.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&u.push("/"),u.push(ql(p,p.charAt(0)=="/"?lV:aV,!0))),(p=this.i.toString())&&u.push("?",p),(p=this.m)&&u.push("#",ql(p,cV)),u.join("")};function Rr(u){return new co(u)}function Ud(u,h,p){u.j=p?Hl(h,!0):h,u.j&&(u.j=u.j.replace(/:$/,""))}function $d(u,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);u.s=h}else u.s=null}function wb(u,h,p){h instanceof Gl?(u.i=h,dV(u.i,u.h)):(p||(h=ql(h,uV)),u.i=new Gl(h,u.h))}function qe(u,h,p){u.i.set(h,p)}function Hd(u){return qe(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Hl(u,h){return u?h?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function ql(u,h,p){return typeof u=="string"?(u=encodeURI(u).replace(h,sV),p&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function sV(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var Eb=/[#\/\?@]/g,aV=/[#\?:]/g,lV=/[#\?]/g,uV=/[#\?@]/g,cV=/#/g;function Gl(u,h){this.h=this.g=null,this.i=u||null,this.j=!!h}function ui(u){u.g||(u.g=new Map,u.h=0,u.i&&oV(u.i,function(h,p){u.add(decodeURIComponent(h.replace(/\+/g," ")),p)}))}n=Gl.prototype,n.add=function(u,h){ui(this),this.i=null,u=Ds(this,u);var p=this.g.get(u);return p||this.g.set(u,p=[]),p.push(h),this.h+=1,this};function Ib(u,h){ui(u),h=Ds(u,h),u.g.has(h)&&(u.i=null,u.h-=u.g.get(h).length,u.g.delete(h))}function Cb(u,h){return ui(u),h=Ds(u,h),u.g.has(h)}n.forEach=function(u,h){ui(this),this.g.forEach(function(p,y){p.forEach(function(b){u.call(h,b,y,this)},this)},this)},n.na=function(){ui(this);let u=Array.from(this.g.values()),h=Array.from(this.g.keys()),p=[];for(let y=0;y<h.length;y++){let b=u[y];for(let R=0;R<b.length;R++)p.push(h[y])}return p},n.V=function(u){ui(this);let h=[];if(typeof u=="string")Cb(this,u)&&(h=h.concat(this.g.get(Ds(this,u))));else{u=Array.from(this.g.values());for(let p=0;p<u.length;p++)h=h.concat(u[p])}return h},n.set=function(u,h){return ui(this),this.i=null,u=Ds(this,u),Cb(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[h]),this.h+=1,this},n.get=function(u,h){return u?(u=this.V(u),0<u.length?String(u[0]):h):h};function Db(u,h,p){Ib(u,h),0<p.length&&(u.i=null,u.g.set(Ds(u,h),T(p)),u.h+=p.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let u=[],h=Array.from(this.g.keys());for(var p=0;p<h.length;p++){var y=h[p];let R=encodeURIComponent(String(y)),U=this.V(y);for(y=0;y<U.length;y++){var b=R;U[y]!==""&&(b+="="+encodeURIComponent(String(U[y]))),u.push(b)}}return this.i=u.join("&")};function Ds(u,h){return h=String(h),u.j&&(h=h.toLowerCase()),h}function dV(u,h){h&&!u.j&&(ui(u),u.i=null,u.g.forEach(function(p,y){var b=y.toLowerCase();y!=b&&(Ib(this,y),Db(this,b,p))},u)),u.j=h}function hV(u,h){let p=new Ul;if(a.Image){let y=new Image;y.onload=m(ci,p,"TestLoadImage: loaded",!0,h,y),y.onerror=m(ci,p,"TestLoadImage: error",!1,h,y),y.onabort=m(ci,p,"TestLoadImage: abort",!1,h,y),y.ontimeout=m(ci,p,"TestLoadImage: timeout",!1,h,y),a.setTimeout(function(){y.ontimeout&&y.ontimeout()},1e4),y.src=u}else h(!1)}function fV(u,h){let p=new Ul,y=new AbortController,b=setTimeout(()=>{y.abort(),ci(p,"TestPingServer: timeout",!1,h)},1e4);fetch(u,{signal:y.signal}).then(R=>{clearTimeout(b),R.ok?ci(p,"TestPingServer: ok",!0,h):ci(p,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(b),ci(p,"TestPingServer: error",!1,h)})}function ci(u,h,p,y,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),y(p)}catch{}}function pV(){this.g=new YF}function gV(u,h,p){let y=p||"";try{_b(u,function(b,R){let U=b;c(b)&&(U=Hm(b)),h.push(y+R+"="+encodeURIComponent(U))})}catch(b){throw h.push(y+"type="+encodeURIComponent("_badmap")),b}}function zl(u){this.l=u.Ub||null,this.j=u.eb||!1}v(zl,qm),zl.prototype.g=function(){return new qd(this.l,this.j)},zl.prototype.i=function(u){return function(){return u}}({});function qd(u,h){kt.call(this),this.D=u,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}v(qd,kt),n=qd.prototype,n.open=function(u,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=u,this.A=h,this.readyState=1,Kl(this)},n.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};u&&(h.body=u),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Wl(this)),this.readyState=0},n.Sa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Kl(this)),this.g&&(this.readyState=3,Kl(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Tb(this)}else u.text().then(this.Ra.bind(this),this.ga.bind(this))};function Tb(u){u.j.read().then(u.Pa.bind(u)).catch(u.ga.bind(u))}n.Pa=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var h=u.value?u.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!u.done}))&&(this.response=this.responseText+=h)}u.done?Wl(this):Kl(this),this.readyState==3&&Tb(this)}},n.Ra=function(u){this.g&&(this.response=this.responseText=u,Wl(this))},n.Qa=function(u){this.g&&(this.response=u,Wl(this))},n.ga=function(){this.g&&Wl(this)};function Wl(u){u.readyState=4,u.l=null,u.j=null,u.v=null,Kl(u)}n.setRequestHeader=function(u,h){this.u.append(u,h)},n.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let u=[],h=this.h.entries();for(var p=h.next();!p.done;)p=p.value,u.push(p[0]+": "+p[1]),p=h.next();return u.join(`\r
`)};function Kl(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(qd.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function bb(u){let h="";return X(u,function(p,y){h+=y,h+=":",h+=p,h+=`\r
`}),h}function ey(u,h,p){e:{for(y in p){var y=!1;break e}y=!0}y||(p=bb(p),typeof u=="string"?p!=null&&encodeURIComponent(String(p)):qe(u,h,p))}function et(u){kt.call(this),this.headers=new Map,this.o=u||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}v(et,kt);var mV=/^https?$/i,yV=["POST","PUT"];n=et.prototype,n.Ha=function(u){this.J=u},n.ea=function(u,h,p,y){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);h=h?h.toUpperCase():"GET",this.D=u,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Wm.g(),this.v=this.o?tb(this.o):tb(Wm),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(h,String(u),!0),this.B=!1}catch(R){Sb(this,R);return}if(u=p||"",p=new Map(this.headers),y)if(Object.getPrototypeOf(y)===Object.prototype)for(var b in y)p.set(b,y[b]);else if(typeof y.keys=="function"&&typeof y.get=="function")for(let R of y.keys())p.set(R,y.get(R));else throw Error("Unknown input type for opt_headers: "+String(y));y=Array.from(p.keys()).find(R=>R.toLowerCase()=="content-type"),b=a.FormData&&u instanceof a.FormData,!(0<=Array.prototype.indexOf.call(yV,h,void 0))||y||b||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[R,U]of p)this.g.setRequestHeader(R,U);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Rb(this),this.u=!0,this.g.send(u),this.u=!1}catch(R){Sb(this,R)}};function Sb(u,h){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=h,u.m=5,Ab(u),Gd(u)}function Ab(u){u.A||(u.A=!0,$t(u,"complete"),$t(u,"error"))}n.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=u||7,$t(this,"complete"),$t(this,"abort"),Gd(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Gd(this,!0)),et.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Mb(this):this.bb())},n.bb=function(){Mb(this)};function Mb(u){if(u.h&&typeof s<"u"&&(!u.v[1]||xr(u)!=4||u.Z()!=2)){if(u.u&&xr(u)==4)ZT(u.Ea,0,u);else if($t(u,"readystatechange"),xr(u)==4){u.h=!1;try{let U=u.Z();e:switch(U){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var p;if(!(p=h)){var y;if(y=U===0){var b=String(u.D).match(vb)[1]||null;!b&&a.self&&a.self.location&&(b=a.self.location.protocol.slice(0,-1)),y=!mV.test(b?b.toLowerCase():"")}p=y}if(p)$t(u,"complete"),$t(u,"success");else{u.m=6;try{var R=2<xr(u)?u.g.statusText:""}catch{R=""}u.l=R+" ["+u.Z()+"]",Ab(u)}}finally{Gd(u)}}}}function Gd(u,h){if(u.g){Rb(u);let p=u.g,y=u.v[0]?()=>{}:null;u.g=null,u.v=null,h||$t(u,"ready");try{p.onreadystatechange=y}catch{}}}function Rb(u){u.I&&(a.clearTimeout(u.I),u.I=null)}n.isActive=function(){return!!this.g};function xr(u){return u.g?u.g.readyState:0}n.Z=function(){try{return 2<xr(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(u){if(this.g){var h=this.g.responseText;return u&&h.indexOf(u)==0&&(h=h.substring(u.length)),QF(h)}};function xb(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.H){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function _V(u){let h={};u=(u.g&&2<=xr(u)&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let y=0;y<u.length;y++){if(B(u[y]))continue;var p=D(u[y]);let b=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();let R=h[b]||[];h[b]=R,R.push(p)}I(h,function(y){return y.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ql(u,h,p){return p&&p.internalChannelParams&&p.internalChannelParams[u]||h}function Nb(u){this.Aa=0,this.i=[],this.j=new Ul,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ql("failFast",!1,u),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ql("baseRetryDelayMs",5e3,u),this.cb=Ql("retryDelaySeedMs",1e4,u),this.Wa=Ql("forwardChannelMaxRetries",2,u),this.wa=Ql("forwardChannelRequestTimeoutMs",2e4,u),this.pa=u&&u.xmlHttpFactory||void 0,this.Xa=u&&u.Tb||void 0,this.Ca=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.h=new fb(u&&u.concurrentRequestLimit),this.Da=new pV,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=u&&u.Rb||!1,u&&u.xa&&this.j.xa(),u&&u.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&u&&u.detectBufferingProxy||!1,this.ja=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.ja=u.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Nb.prototype,n.la=8,n.G=1,n.connect=function(u,h,p,y){Ht(0),this.W=u,this.H=h||{},p&&y!==void 0&&(this.H.OSID=p,this.H.OAID=y),this.F=this.X,this.I=Ub(this,null,this.W),Wd(this)};function ty(u){if(Pb(u),u.G==3){var h=u.U++,p=Rr(u.I);if(qe(p,"SID",u.K),qe(p,"RID",h),qe(p,"TYPE","terminate"),Yl(u,p),h=new li(u,u.j,h),h.L=2,h.v=Hd(Rr(p)),p=!1,a.navigator&&a.navigator.sendBeacon)try{p=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!p&&a.Image&&(new Image().src=h.v,p=!0),p||(h.g=$b(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Bd(h)}Bb(u)}function zd(u){u.g&&(ry(u),u.g.cancel(),u.g=null)}function Pb(u){zd(u),u.u&&(a.clearTimeout(u.u),u.u=null),Kd(u),u.h.cancel(),u.s&&(typeof u.s=="number"&&a.clearTimeout(u.s),u.s=null)}function Wd(u){if(!pb(u.h)&&!u.s){u.s=!0;var h=u.Ga;Pl||GT(),kl||(Pl(),kl=!0),km.add(h,u),u.B=0}}function vV(u,h){return gb(u.h)>=u.h.j-(u.s?1:0)?!1:u.s?(u.i=h.D.concat(u.i),!0):u.G==1||u.G==2||u.B>=(u.Va?0:u.Wa)?!1:(u.s=Bl(g(u.Ga,u,h),jb(u,u.B)),u.B++,!0)}n.Ga=function(u){if(this.s)if(this.s=null,this.G==1){if(!u){this.U=Math.floor(1e5*Math.random()),u=this.U++;let b=new li(this,this.j,u),R=this.o;if(this.S&&(R?(R=_(R),C(R,this.S)):R=this.S),this.m!==null||this.O||(b.H=R,R=null),this.P)e:{for(var h=0,p=0;p<this.i.length;p++){t:{var y=this.i[p];if("__data__"in y.map&&(y=y.map.__data__,typeof y=="string")){y=y.length;break t}y=void 0}if(y===void 0)break;if(h+=y,4096<h){h=p;break e}if(h===4096||p===this.i.length-1){h=p+1;break e}}h=1e3}else h=1e3;h=Ob(this,b,h),p=Rr(this.I),qe(p,"RID",u),qe(p,"CVER",22),this.D&&qe(p,"X-HTTP-Session-Id",this.D),Yl(this,p),R&&(this.O?h="headers="+encodeURIComponent(String(bb(R)))+"&"+h:this.m&&ey(p,this.m,R)),Xm(this.h,b),this.Ua&&qe(p,"TYPE","init"),this.P?(qe(p,"$req",h),qe(p,"SID","null"),b.T=!0,Qm(b,p,null)):Qm(b,p,h),this.G=2}}else this.G==3&&(u?kb(this,u):this.i.length==0||pb(this.h)||kb(this))};function kb(u,h){var p;h?p=h.l:p=u.U++;let y=Rr(u.I);qe(y,"SID",u.K),qe(y,"RID",p),qe(y,"AID",u.T),Yl(u,y),u.m&&u.o&&ey(y,u.m,u.o),p=new li(u,u.j,p,u.B+1),u.m===null&&(p.H=u.o),h&&(u.i=h.D.concat(u.i)),h=Ob(u,p,1e3),p.I=Math.round(.5*u.wa)+Math.round(.5*u.wa*Math.random()),Xm(u.h,p),Qm(p,y,h)}function Yl(u,h){u.H&&X(u.H,function(p,y){qe(h,y,p)}),u.l&&_b({},function(p,y){qe(h,y,p)})}function Ob(u,h,p){p=Math.min(u.i.length,p);var y=u.l?g(u.l.Na,u.l,u):null;e:{var b=u.i;let R=-1;for(;;){let U=["count="+p];R==-1?0<p?(R=b[0].g,U.push("ofs="+R)):R=0:U.push("ofs="+R);let Le=!0;for(let Ct=0;Ct<p;Ct++){let xe=b[Ct].g,Ot=b[Ct].map;if(xe-=R,0>xe)R=Math.max(0,b[Ct].g-100),Le=!1;else try{gV(Ot,U,"req"+xe+"_")}catch{y&&y(Ot)}}if(Le){y=U.join("&");break e}}}return u=u.i.splice(0,p),h.D=u,y}function Fb(u){if(!u.g&&!u.u){u.Y=1;var h=u.Fa;Pl||GT(),kl||(Pl(),kl=!0),km.add(h,u),u.v=0}}function ny(u){return u.g||u.u||3<=u.v?!1:(u.Y++,u.u=Bl(g(u.Fa,u),jb(u,u.v)),u.v++,!0)}n.Fa=function(){if(this.u=null,Vb(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var u=2*this.R;this.j.info("BP detection timer enabled: "+u),this.A=Bl(g(this.ab,this),u)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ht(10),zd(this),Vb(this))};function ry(u){u.A!=null&&(a.clearTimeout(u.A),u.A=null)}function Vb(u){u.g=new li(u,u.j,"rpc",u.Y),u.m===null&&(u.g.H=u.o),u.g.O=0;var h=Rr(u.qa);qe(h,"RID","rpc"),qe(h,"SID",u.K),qe(h,"AID",u.T),qe(h,"CI",u.F?"0":"1"),!u.F&&u.ja&&qe(h,"TO",u.ja),qe(h,"TYPE","xmlhttp"),Yl(u,h),u.m&&u.o&&ey(h,u.m,u.o),u.L&&(u.g.I=u.L);var p=u.g;u=u.ia,p.L=1,p.v=Hd(Rr(h)),p.m=null,p.P=!0,cb(p,u)}n.Za=function(){this.C!=null&&(this.C=null,zd(this),ny(this),Ht(19))};function Kd(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function Lb(u,h){var p=null;if(u.g==h){Kd(u),ry(u),u.g=null;var y=2}else if(Jm(u.h,h))p=h.D,mb(u.h,h),y=1;else return;if(u.G!=0){if(h.o)if(y==1){p=h.m?h.m.length:0,h=Date.now()-h.F;var b=u.B;y=Vd(),$t(y,new sb(y,p)),Wd(u)}else Fb(u);else if(b=h.s,b==3||b==0&&0<h.X||!(y==1&&vV(u,h)||y==2&&ny(u)))switch(p&&0<p.length&&(h=u.h,h.i=h.i.concat(p)),b){case 1:ho(u,5);break;case 4:ho(u,10);break;case 3:ho(u,6);break;default:ho(u,2)}}}function jb(u,h){let p=u.Ta+Math.floor(Math.random()*u.cb);return u.isActive()||(p*=2),p*h}function ho(u,h){if(u.j.info("Error code "+h),h==2){var p=g(u.fb,u),y=u.Xa;let b=!y;y=new co(y||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ud(y,"https"),Hd(y),b?hV(y.toString(),p):fV(y.toString(),p)}else Ht(2);u.G=0,u.l&&u.l.sa(h),Bb(u),Pb(u)}n.fb=function(u){u?(this.j.info("Successfully pinged google.com"),Ht(2)):(this.j.info("Failed to ping google.com"),Ht(1))};function Bb(u){if(u.G=0,u.ka=[],u.l){let h=yb(u.h);(h.length!=0||u.i.length!=0)&&(S(u.ka,h),S(u.ka,u.i),u.h.i.length=0,T(u.i),u.i.length=0),u.l.ra()}}function Ub(u,h,p){var y=p instanceof co?Rr(p):new co(p);if(y.g!="")h&&(y.g=h+"."+y.g),$d(y,y.s);else{var b=a.location;y=b.protocol,h=h?h+"."+b.hostname:b.hostname,b=+b.port;var R=new co(null);y&&Ud(R,y),h&&(R.g=h),b&&$d(R,b),p&&(R.l=p),y=R}return p=u.D,h=u.ya,p&&h&&qe(y,p,h),qe(y,"VER",u.la),Yl(u,y),y}function $b(u,h,p){if(h&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=u.Ca&&!u.pa?new et(new zl({eb:p})):new et(u.pa),h.Ha(u.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Hb(){}n=Hb.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Qd(){}Qd.prototype.g=function(u,h){return new an(u,h)};function an(u,h){kt.call(this),this.g=new Nb(h),this.l=u,this.h=h&&h.messageUrlParams||null,u=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(u?u["X-WebChannel-Content-Type"]=h.messageContentType:u={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(u?u["X-WebChannel-Client-Profile"]=h.va:u={"X-WebChannel-Client-Profile":h.va}),this.g.S=u,(u=h&&h.Sb)&&!B(u)&&(this.g.m=u),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!B(h)&&(this.g.D=h,u=this.h,u!==null&&h in u&&(u=this.h,h in u&&delete u[h])),this.j=new Ts(this)}v(an,kt),an.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},an.prototype.close=function(){ty(this.g)},an.prototype.o=function(u){var h=this.g;if(typeof u=="string"){var p={};p.__data__=u,u=p}else this.u&&(p={},p.__data__=Hm(u),u=p);h.i.push(new nV(h.Ya++,u)),h.G==3&&Wd(h)},an.prototype.N=function(){this.g.l=null,delete this.j,ty(this.g),delete this.g,an.aa.N.call(this)};function qb(u){Gm.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var h=u.__sm__;if(h){e:{for(let p in h){u=p;break e}u=void 0}(this.i=u)&&(u=this.i,h=h!==null&&u in h?h[u]:void 0),this.data=h}else this.data=u}v(qb,Gm);function Gb(){zm.call(this),this.status=1}v(Gb,zm);function Ts(u){this.g=u}v(Ts,Hb),Ts.prototype.ua=function(){$t(this.g,"a")},Ts.prototype.ta=function(u){$t(this.g,new qb(u))},Ts.prototype.sa=function(u){$t(this.g,new Gb)},Ts.prototype.ra=function(){$t(this.g,"b")},Qd.prototype.createWebChannel=Qd.prototype.g,an.prototype.send=an.prototype.o,an.prototype.open=an.prototype.m,an.prototype.close=an.prototype.close,qI=Yr.createWebChannelTransport=function(){return new Qd},HI=Yr.getStatEventTarget=function(){return Vd()},$I=Yr.Event=lo,ag=Yr.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ld.NO_ERROR=0,Ld.TIMEOUT=8,Ld.HTTP_ERROR=6,zc=Yr.ErrorCode=Ld,ab.COMPLETE="complete",UI=Yr.EventType=ab,nb.EventType=Ll,Ll.OPEN="a",Ll.CLOSE="b",Ll.ERROR="c",Ll.MESSAGE="d",kt.prototype.listen=kt.prototype.K,Ga=Yr.WebChannel=nb,xW=Yr.FetchXmlHttpFactory=zl,et.prototype.listenOnce=et.prototype.L,et.prototype.getLastError=et.prototype.Ka,et.prototype.getLastErrorCode=et.prototype.Ba,et.prototype.getStatus=et.prototype.Z,et.prototype.getResponseJson=et.prototype.Oa,et.prototype.getResponseText=et.prototype.oa,et.prototype.send=et.prototype.ea,et.prototype.setWithCredentials=et.prototype.Ha,BI=Yr.XhrIo=et}).apply(typeof sg<"u"?sg:typeof self<"u"?self:typeof window<"u"?window:{});var ok="@firebase/firestore";var ht=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ht.UNAUTHENTICATED=new ht(null),ht.GOOGLE_CREDENTIALS=new ht("google-credentials-uid"),ht.FIRST_PARTY=new ht("first-party-uid"),ht.MOCK_USER=new ht("mock-user");var Il="11.2.0";var Ki=new hi("@firebase/firestore");function Ya(){return Ki.logLevel}function aO(n){Ki.setLogLevel(n)}function k(n,...e){if(Ki.logLevel<=Dn.DEBUG){let t=e.map(KD);Ki.debug(`Firestore (${Il}): ${n}`,...t)}}function ot(n,...e){if(Ki.logLevel<=Dn.ERROR){let t=e.map(KD);Ki.error(`Firestore (${Il}): ${n}`,...t)}}function Jn(n,...e){if(Ki.logLevel<=Dn.WARN){let t=e.map(KD);Ki.warn(`Firestore (${Il}): ${n}`,...t)}}function KD(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function G(n="Unexpected state"){let e=`FIRESTORE (${Il}) INTERNAL ASSERTION FAILED: `+n;throw ot(e),new Error(e)}function K(n,e){n||G()}function lO(n,e){n||G()}function H(n,e){return n}var N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},P=class extends Jb{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var _t=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var vg=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},YI=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ht.UNAUTHENTICATED))}shutdown(){}},ZI=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},JI=class{constructor(e){this.t=e,this.currentUser=ht.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){K(this.o===void 0);let r=this.i,i=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve(),o=new _t;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new _t,e.enqueueRetryable(()=>i(this.currentUser))};let s=()=>{let l=o;e.enqueueRetryable(()=>x(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?a(l):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new _t)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(K(typeof r.accessToken=="string"),new vg(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return K(e===null||typeof e=="string"),new ht(e)}},XI=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=ht.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);let e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}},eC=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new XI(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ht.FIRST_PARTY))}shutdown(){}invalidateToken(){}},tC=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},nC=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){K(this.o===void 0);let r=o=>{o.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let s=o.token!==this.R;return this.R=o.token,k("FirebaseAppCheckTokenProvider",`Received ${s?"new":"existing"} token.`),s?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};let i=o=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){let o=this.A.getImmediate({optional:!0});o?i(o):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(K(typeof t.token=="string"),this.R=t.token,new tC(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function NW(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var wg=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=NW(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%e.length))}return r}};function le(n,e){return n<e?-1:n>e?1:0}function ol(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function uO(n){return n+"\0"}var Je=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new P(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new P(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new P(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new P(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?le(this.nanoseconds,e.nanoseconds):le(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var J=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new Je(0,0))}static max(){return new n(new Je(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Eg=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&G(),r===void 0?r=e.length-t:r>e.length-t&&G(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let o=n.compareSegments(e.get(i),t.get(i));if(o!==0)return o}return Math.sign(e.length-t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):e<t?-1:e>t?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Qr.fromString(e.substring(4,e.length-2))}},Ae=class n extends Eg{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new P(N.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},PW=/^[_a-zA-Z][_a-zA-Z0-9]*$/,st=class n extends Eg{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return PW.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,o=()=>{if(r.length===0)throw new P(N.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new P(N.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new P(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(s=!s,i++):a!=="."||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new P(N.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var q=class n{constructor(e){this.path=e}static fromPath(e){return new n(Ae.fromString(e))}static fromName(e){return new n(Ae.fromString(e).popFirst(5))}static empty(){return new n(Ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new Ae(e.slice()))}};var sl=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function rC(n){return n.fields.find(e=>e.kind===2)}function es(n){return n.fields.filter(e=>e.kind!==2)}sl.UNKNOWN_ID=-1;var nl=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var id=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,Ln.min())}};function cO(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=J.fromTimestamp(r===1e9?new Je(t+1,0):new Je(t,r));return new Ln(i,q.empty(),e)}function dO(n){return new Ln(n.readTime,n.key,-1)}var Ln=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(J.min(),q.empty(),-1)}static max(){return new n(J.max(),q.empty(),-1)}};function QD(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=q.comparator(n.documentKey,e.documentKey),t!==0?t:le(n.largestBatchId,e.largestBatchId))}var hO="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ig=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function io(n){return x(this,null,function*(){if(n.code!==N.FAILED_PRECONDITION||n.message!==hO)throw n;k("LocalStore","Unexpectedly lost primary lease")})}var M=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&G(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,o=0,s=!1;e.forEach(a=>{++i,a.next(()=>{++o,s&&o===i&&t()},l=>r(l))}),s=!0,o===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let o=e.length,s=new Array(o),a=0;for(let l=0;l<o;l++){let c=l;t(e[c]).next(d=>{s[c]=d,++a,a===o&&r(s)},d=>i(d))}})}static doWhile(e,t){return new n((r,i)=>{let o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}};var Cg=class n{static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(o){throw new ss(t,o)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new _t,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ss(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=YD(r.target.error);this.V.reject(new ss(e,i))}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(k("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new oC(t)}},Qi=class n{static delete(e){return k("SimpleDb","Removing database:",e),ts(window.indexedDB.deleteDatabase(e)).toPromise()}static p(){if(!eh())return!1;if(n.S())return!0;let e=Zl(),t=n.D(e),r=0<t&&t<10,i=fO(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)}static S(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.v)==="YES"}static C(e,t){return e.store(t)}static D(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.F=r,n.D(Zl())===12.2&&ot("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}M(e){return x(this,null,function*(){return this.db||(k("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=o=>{let s=o.target.result;t(s)},i.onblocked=()=>{r(new ss(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=o=>{let s=o.target.error;s.name==="VersionError"?r(new P(N.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):s.name==="InvalidStateError"?r(new P(N.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+s)):r(new ss(e,s))},i.onupgradeneeded=o=>{k("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',o.oldVersion);let s=o.target.result;this.F.O(s,i.transaction,o.oldVersion,this.version).next(()=>{k("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}B(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return x(this,null,function*(){let o=t==="readonly",s=0;for(;;){++s;try{this.db=yield this.M(e);let a=Cg.open(this.db,e,o?"readonly":"readwrite",r),l=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),M.reject(c))).toPromise();return l.catch(()=>{}),yield a.m,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&s<3;if(k("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function fO(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var iC=class{constructor(e){this.L=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.L=e}done(){this.k=!0}$(e){this.q=e}delete(){return ts(this.L.delete())}},ss=class extends P{constructor(e,t){super(N.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function oo(n){return n.name==="IndexedDbTransactionError"}var oC=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(k("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(k("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ts(r)}add(e){return k("SimpleDb","ADD",this.store.name,e,e),ts(this.store.add(e))}get(e){return ts(this.store.get(e)).next(t=>(t===void 0&&(t=null),k("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return k("SimpleDb","DELETE",this.store.name,e),ts(this.store.delete(e))}count(){return k("SimpleDb","COUNT",this.store.name),ts(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let o=i.getAll(r.range);return new M((s,a)=>{o.onerror=l=>{a(l.target.error)},o.onsuccess=l=>{s(l.target.result)}})}{let o=this.cursor(r),s=[];return this.W(o,(a,l)=>{s.push(l)}).next(()=>s)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new M((i,o)=>{r.onerror=s=>{o(s.target.error)},r.onsuccess=s=>{i(s.target.result)}})}j(e,t){k("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(o,s,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new M((r,i)=>{t.onerror=o=>{let s=YD(o.target.error);i(s)},t.onsuccess=o=>{let s=o.target.result;s?e(s.primaryKey,s.value).next(a=>{a?s.continue():r()}):r()}})}W(e,t){let r=[];return new M((i,o)=>{e.onerror=s=>{o(s.target.error)},e.onsuccess=s=>{let a=s.target.result;if(!a)return void i();let l=new iC(a),c=t(a.primaryKey,a.value,l);if(c instanceof M){let d=c.catch(f=>(l.done(),M.reject(f)));r.push(d)}l.isDone?i():l.K===null?a.continue():a.continue(l.K)}}).next(()=>M.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function ts(n){return new M((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=YD(r.target.error);t(i)}})}var sk=!1;function YD(n){let e=Qi.D(Zl());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new P("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return sk||(sk=!0,setTimeout(()=>{throw r},0)),r}}return n}var sC=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){k("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>x(this,null,function*(){this.task=null;try{k("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){oo(t)?k("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield io(t)}yield this.X(6e4)}))}},aC=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return x(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,o=!0;return M.doWhile(()=>o===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(s=>{if(s!==null&&!r.has(s))return k("IndexBackfiller",`Processing collection: ${s}`),this.ne(e,s,i).next(a=>{i-=a,r.add(s)});o=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(o=>{let s=o.changes;return this.localStore.indexManager.updateIndexEntries(e,s).next(()=>this.re(i,o)).next(a=>(k("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>s.size)}))}re(e,t){let r=e;return t.changes.forEach((i,o)=>{let s=dO(o);QD(s,r)>0&&(r=s)}),new Ln(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var En=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function bd(n){return n==null}function od(n){return n===0&&1/n==-1/0}function pO(n){return typeof n=="number"&&Number.isInteger(n)&&!od(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Ut(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=ak(e)),e=kW(n.get(t),e);return ak(e)}function kW(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let o=n.charAt(i);switch(o){case"\0":t+="";break;case"":t+="";break;default:t+=o}}return t}function ak(n){return n+""}function wr(n){let e=n.length;if(K(e>=2),e===2)return K(n.charAt(0)===""&&n.charAt(1)===""),Ae.emptyPath();let t=e-2,r=[],i="";for(let o=0;o<e;){let s=n.indexOf("",o);switch((s<0||s>t)&&G(),n.charAt(s+1)){case"":let a=n.substring(o,s),l;i.length===0?l=a:(i+=a,l=i,i=""),r.push(l);break;case"":i+=n.substring(o,s),i+="\0";break;case"":i+=n.substring(o,s+1);break;default:G()}o=s+2}return new Ae(r)}var lk=["userId","batchId"];function fg(n,e){return[n,Ut(e)]}function gO(n,e,t){return[n,Ut(e),t]}var OW={},FW=["prefixPath","collectionGroup","readTime","documentId"],VW=["prefixPath","collectionGroup","documentId"],LW=["collectionGroup","readTime","prefixPath","documentId"],jW=["canonicalId","targetId"],BW=["targetId","path"],UW=["path","targetId"],$W=["collectionId","parent"],HW=["indexId","uid"],qW=["uid","sequenceNumber"],GW=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],zW=["indexId","uid","orderedDocumentKey"],WW=["userId","collectionPath","documentId"],KW=["userId","collectionPath","largestBatchId"],QW=["userId","collectionGroup","largestBatchId"],mO=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],YW=[...mO,"documentOverlays"],yO=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],_O=yO,ZD=[..._O,"indexConfiguration","indexState","indexEntries"],ZW=ZD,JW=[...ZD,"globals"];var sd=class extends Ig{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function vt(n,e){let t=H(n);return Qi.C(t._e,e)}function uk(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function so(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function vO(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ze=class n{constructor(e,t){this.comparator=e,this.root=t||Ir.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ir.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ir.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tl(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tl(this.root,e,this.comparator,!1)}getReverseIterator(){return new tl(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tl(this.root,e,this.comparator,!0)}},tl=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ir=class n{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new n(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw G();let e=this.left.check();if(e!==this.right.check())throw G();return e+(this.isRed()?0:1)}};Ir.EMPTY=null,Ir.RED=!0,Ir.BLACK=!1;Ir.EMPTY=new class{constructor(){this.size=0}get key(){throw G()}get value(){throw G()}get color(){throw G()}get left(){throw G()}get right(){throw G()}copy(e,t,r,i,o){return this}insert(e,t,r){return new Ir(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Ve=class n{constructor(e){this.comparator=e,this.data=new ze(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Dg(this.data.getIterator())}getIteratorFrom(e){return new Dg(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Dg=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function za(n){return n.hasNext()?n.getNext():void 0}var In=class n{constructor(e){this.fields=e,e.sort(st.comparator)}static empty(){return new n([])}unionWith(e){let t=new Ve(st.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ol(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Tg=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function wO(){return typeof atob<"u"}var lt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Tg("Invalid base64 string: "+o):o}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let o="";for(let s=0;s<i.length;++s)o+=String.fromCharCode(i[s]);return o}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return le(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};lt.EMPTY_BYTE_STRING=new lt("");var XW=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Xr(n){if(K(!!n),typeof n=="string"){let e=0,t=XW.exec(n);if(K(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ke(n.seconds),nanos:Ke(n.nanos)}}function Ke(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ei(n){return typeof n=="string"?lt.fromBase64String(n):lt.fromUint8Array(n)}function ym(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function _m(n){let e=n.mapValue.fields.__previous_value__;return ym(e)?_m(e):e}function ad(n){let e=Xr(n.mapValue.fields.__local_write_time__.timestampValue);return new Je(e.seconds,e.nanos)}var lC=class{constructor(e,t,r,i,o,s,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},Yi=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var zi={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},pg={nullValue:"NULL_VALUE"};function Zi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ym(n)?4:EO(n)?9007199254740991:vm(n)?10:11:G()}function Tr(n,e){if(n===e)return!0;let t=Zi(n);if(t!==Zi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ad(n).isEqual(ad(e));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;let s=Xr(i.timestampValue),a=Xr(o.timestampValue);return s.seconds===a.seconds&&s.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,o){return ei(i.bytesValue).isEqual(ei(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,o){return Ke(i.geoPointValue.latitude)===Ke(o.geoPointValue.latitude)&&Ke(i.geoPointValue.longitude)===Ke(o.geoPointValue.longitude)}(n,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return Ke(i.integerValue)===Ke(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){let s=Ke(i.doubleValue),a=Ke(o.doubleValue);return s===a?od(s)===od(a):isNaN(s)&&isNaN(a)}return!1}(n,e);case 9:return ol(n.arrayValue.values||[],e.arrayValue.values||[],Tr);case 10:case 11:return function(i,o){let s=i.mapValue.fields||{},a=o.mapValue.fields||{};if(uk(s)!==uk(a))return!1;for(let l in s)if(s.hasOwnProperty(l)&&(a[l]===void 0||!Tr(s[l],a[l])))return!1;return!0}(n,e);default:return G()}}function ld(n,e){return(n.values||[]).find(t=>Tr(t,e))!==void 0}function Ji(n,e){if(n===e)return 0;let t=Zi(n),r=Zi(e);if(t!==r)return le(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return le(n.booleanValue,e.booleanValue);case 2:return function(o,s){let a=Ke(o.integerValue||o.doubleValue),l=Ke(s.integerValue||s.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return ck(n.timestampValue,e.timestampValue);case 4:return ck(ad(n),ad(e));case 5:return le(n.stringValue,e.stringValue);case 6:return function(o,s){let a=ei(o),l=ei(s);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(o,s){let a=o.split("/"),l=s.split("/");for(let c=0;c<a.length&&c<l.length;c++){let d=le(a[c],l[c]);if(d!==0)return d}return le(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,s){let a=le(Ke(o.latitude),Ke(s.latitude));return a!==0?a:le(Ke(o.longitude),Ke(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return dk(n.arrayValue,e.arrayValue);case 10:return function(o,s){var a,l,c,d;let f=o.fields||{},g=s.fields||{},m=(a=f.value)===null||a===void 0?void 0:a.arrayValue,v=(l=g.value)===null||l===void 0?void 0:l.arrayValue,T=le(((c=m?.values)===null||c===void 0?void 0:c.length)||0,((d=v?.values)===null||d===void 0?void 0:d.length)||0);return T!==0?T:dk(m,v)}(n.mapValue,e.mapValue);case 11:return function(o,s){if(o===zi.mapValue&&s===zi.mapValue)return 0;if(o===zi.mapValue)return 1;if(s===zi.mapValue)return-1;let a=o.fields||{},l=Object.keys(a),c=s.fields||{},d=Object.keys(c);l.sort(),d.sort();for(let f=0;f<l.length&&f<d.length;++f){let g=le(l[f],d[f]);if(g!==0)return g;let m=Ji(a[l[f]],c[d[f]]);if(m!==0)return m}return le(l.length,d.length)}(n.mapValue,e.mapValue);default:throw G()}}function ck(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return le(n,e);let t=Xr(n),r=Xr(e),i=le(t.seconds,r.seconds);return i!==0?i:le(t.nanos,r.nanos)}function dk(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let o=Ji(t[i],r[i]);if(o)return o}return le(t.length,r.length)}function al(n){return uC(n)}function uC(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=Xr(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ei(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return q.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let o of t.values||[])i?i=!1:r+=",",r+=uC(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",o=!0;for(let s of r)o?o=!1:i+=",",i+=`${s}:${uC(t.fields[s])}`;return i+"}"}(n.mapValue):G()}function gg(n){switch(Zi(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=_m(n);return e?16+gg(e):16;case 5:return 2*n.stringValue.length;case 6:return ei(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,o)=>i+gg(o),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return so(r.fields,(o,s)=>{i+=o.length+gg(s)}),i}(n.mapValue);default:throw G()}}function as(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function cC(n){return!!n&&"integerValue"in n}function ud(n){return!!n&&"arrayValue"in n}function hk(n){return!!n&&"nullValue"in n}function fk(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function mg(n){return!!n&&"mapValue"in n}function vm(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Xc(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return so(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Xc(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Xc(n.arrayValue.values[t]);return e}return Object.assign({},n)}function EO(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var IO={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function e9(n){return"nullValue"in n?pg:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?as(Yi.empty(),q.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?vm(n)?IO:{mapValue:{}}:G()}function t9(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?as(Yi.empty(),q.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?IO:"mapValue"in n?vm(n)?{mapValue:{}}:zi:G()}function pk(n,e){let t=Ji(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function gk(n,e){let t=Ji(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Bt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!mg(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Xc(t)}setAll(e){let t=st.emptyPath(),r={},i=[];e.forEach((s,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}s?r[a.lastSegment()]=Xc(s):i.push(a.lastSegment())});let o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){let t=this.field(e.popLast());mg(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Tr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];mg(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){so(t,(i,o)=>e[i]=o);for(let i of r)delete e[i]}clone(){return new n(Xc(this.value))}};function CO(n){let e=[];return so(n.fields,(t,r)=>{let i=new st([t]);if(mg(r)){let o=CO(r.mapValue).fields;if(o.length===0)e.push(i);else for(let s of o)e.push(i.child(s))}else e.push(i)}),new In(e)}var ft=class n{constructor(e,t,r,i,o,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=s,this.documentState=a}static newInvalidDocument(e){return new n(e,0,J.min(),J.min(),J.min(),Bt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,J.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,J.min(),J.min(),Bt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,J.min(),J.min(),Bt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(J.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Bt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Bt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=J.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var br=class{constructor(e,t){this.position=e,this.inclusive=t}};function mk(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let o=e[i],s=n.position[i];if(o.field.isKeyField()?r=q.comparator(q.fromName(s.referenceValue),t.key):r=Ji(s,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function yk(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Tr(n.position[t],e.position[t]))return!1;return!0}var ls=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function n9(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var bg=class{},Ee=class n extends bg{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new fC(e,t,r):t==="array-contains"?new mC(e,r):t==="in"?new Sg(e,r):t==="not-in"?new yC(e,r):t==="array-contains-any"?new _C(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new pC(e,r):new gC(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ji(t,this.value)):t!==null&&Zi(this.value)===Zi(t)&&this.matchesComparison(Ji(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return G()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Fe=class n extends bg{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return ll(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function ll(n){return n.op==="and"}function dC(n){return n.op==="or"}function JD(n){return DO(n)&&ll(n)}function DO(n){for(let e of n.filters)if(e instanceof Fe)return!1;return!0}function hC(n){if(n instanceof Ee)return n.field.canonicalString()+n.op.toString()+al(n.value);if(JD(n))return n.filters.map(e=>hC(e)).join(",");{let e=n.filters.map(t=>hC(t)).join(",");return`${n.op}(${e})`}}function TO(n,e){return n instanceof Ee?function(r,i){return i instanceof Ee&&r.op===i.op&&r.field.isEqual(i.field)&&Tr(r.value,i.value)}(n,e):n instanceof Fe?function(r,i){return i instanceof Fe&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,s,a)=>o&&TO(s,i.filters[a]),!0):!1}(n,e):void G()}function bO(n,e){let t=n.filters.concat(e);return Fe.create(t,n.op)}function SO(n){return n instanceof Ee?function(t){return`${t.field.canonicalString()} ${t.op} ${al(t.value)}`}(n):n instanceof Fe?function(t){return t.op.toString()+" {"+t.getFilters().map(SO).join(" ,")+"}"}(n):"Filter"}var fC=class extends Ee{constructor(e,t,r){super(e,t,r),this.key=q.fromName(r.referenceValue)}matches(e){let t=q.comparator(e.key,this.key);return this.matchesComparison(t)}},pC=class extends Ee{constructor(e,t){super(e,"in",t),this.keys=AO("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},gC=class extends Ee{constructor(e,t){super(e,"not-in",t),this.keys=AO("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function AO(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>q.fromName(r.referenceValue))}var mC=class extends Ee{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ud(t)&&ld(t.arrayValue,this.value)}},Sg=class extends Ee{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&ld(this.value.arrayValue,t)}},yC=class extends Ee{constructor(e,t){super(e,"not-in",t)}matches(e){if(ld(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!ld(this.value.arrayValue,t)}},_C=class extends Ee{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!ud(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>ld(this.value.arrayValue,r))}};var vC=class{constructor(e,t=null,r=[],i=[],o=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=s,this.endAt=a,this.ue=null}};function wC(n,e=null,t=[],r=[],i=null,o=null,s=null){return new vC(n,e,t,r,i,o,s)}function us(n){let e=H(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>hC(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),bd(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>al(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>al(r)).join(",")),e.ue=t}return e.ue}function Sd(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!n9(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!TO(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!yk(n.startAt,e.startAt)&&yk(n.endAt,e.endAt)}function Ag(n){return q.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Mg(n,e){return n.filters.filter(t=>t instanceof Ee&&t.field.isEqual(e))}function _k(n,e,t){let r=pg,i=!0;for(let o of Mg(n,e)){let s=pg,a=!0;switch(o.op){case"<":case"<=":s=e9(o.value);break;case"==":case"in":case">=":s=o.value;break;case">":s=o.value,a=!1;break;case"!=":case"not-in":s=pg}pk({value:r,inclusive:i},{value:s,inclusive:a})<0&&(r=s,i=a)}if(t!==null){for(let o=0;o<n.orderBy.length;++o)if(n.orderBy[o].field.isEqual(e)){let s=t.position[o];pk({value:r,inclusive:i},{value:s,inclusive:t.inclusive})<0&&(r=s,i=t.inclusive);break}}return{value:r,inclusive:i}}function vk(n,e,t){let r=zi,i=!0;for(let o of Mg(n,e)){let s=zi,a=!0;switch(o.op){case">=":case">":s=t9(o.value),a=!1;break;case"==":case"in":case"<=":s=o.value;break;case"<":s=o.value,a=!1;break;case"!=":case"not-in":s=zi}gk({value:r,inclusive:i},{value:s,inclusive:a})>0&&(r=s,i=a)}if(t!==null){for(let o=0;o<n.orderBy.length;++o)if(n.orderBy[o].field.isEqual(e)){let s=t.position[o];gk({value:r,inclusive:i},{value:s,inclusive:t.inclusive})>0&&(r=s,i=t.inclusive);break}}return{value:r,inclusive:i}}var Xn=class{constructor(e,t=null,r=[],i=[],o=null,s="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=s,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function MO(n,e,t,r,i,o,s,a){return new Xn(n,e,t,r,i,o,s,a)}function Cl(n){return new Xn(n)}function wk(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function XD(n){return n.collectionGroup!==null}function rl(n){let e=H(n);if(e.ce===null){e.ce=[];let t=new Set;for(let o of e.explicitOrderBy)e.ce.push(o),t.add(o.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(s){let a=new Ve(st.comparator);return s.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.ce.push(new ls(o,r))}),t.has(st.keyField().canonicalString())||e.ce.push(new ls(st.keyField(),r))}return e.ce}function Jt(n){let e=H(n);return e.le||(e.le=r9(e,rl(n))),e.le}function r9(n,e){if(n.limitType==="F")return wC(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let o=i.dir==="desc"?"asc":"desc";return new ls(i.field,o)});let t=n.endAt?new br(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new br(n.startAt.position,n.startAt.inclusive):null;return wC(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function EC(n,e){let t=n.filters.concat([e]);return new Xn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Rg(n,e,t){return new Xn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ad(n,e){return Sd(Jt(n),Jt(e))&&n.limitType===e.limitType}function RO(n){return`${us(Jt(n))}|lt:${n.limitType}`}function Za(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>SO(i)).join(", ")}]`),bd(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(s){return`${s.field.canonicalString()} (${s.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>al(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>al(i)).join(",")),`Target(${r})`}(Jt(n))}; limitType=${n.limitType})`}function Md(n,e){return e.isFoundDocument()&&function(r,i){let o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):q.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,e)&&function(r,i){for(let o of rl(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let o of r.filters)if(!o.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(s,a,l){let c=mk(s,a,l);return s.inclusive?c<=0:c<0}(r.startAt,rl(r),i)||r.endAt&&!function(s,a,l){let c=mk(s,a,l);return s.inclusive?c>=0:c>0}(r.endAt,rl(r),i))}(n,e)}function xO(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function NO(n){return(e,t)=>{let r=!1;for(let i of rl(n)){let o=i9(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function i9(n,e,t){let r=n.field.isKeyField()?q.comparator(e.key,t.key):function(o,s,a){let l=s.data.field(o),c=a.data.field(o);return l!==null&&c!==null?Ji(l,c):G()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return G()}}var er=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){so(this.inner,(t,r)=>{for(let[i,o]of r)e(i,o)})}isEmpty(){return vO(this.inner)}size(){return this.innerSize}};var o9=new ze(q.comparator);function sn(){return o9}var PO=new ze(q.comparator);function Zc(...n){let e=PO;for(let t of n)e=e.insert(t.key,t);return e}function kO(n){let e=PO;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Er(){return ed()}function OO(){return ed()}function ed(){return new er(n=>n.toString(),(n,e)=>n.isEqual(e))}var s9=new ze(q.comparator),a9=new Ve(q.comparator);function fe(...n){let e=a9;for(let t of n)e=e.add(t);return e}var l9=new Ve(le);function eT(){return l9}function tT(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:od(e)?"-0":e}}function FO(n){return{integerValue:""+n}}function VO(n,e){return pO(e)?FO(e):tT(n,e)}var ul=class{constructor(){this._=void 0}};function u9(n,e,t){return n instanceof Xi?function(i,o){let s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&ym(o)&&(o=_m(o)),o&&(s.fields.__previous_value__=o),{mapValue:s}}(t,e):n instanceof ti?jO(n,e):n instanceof ni?BO(n,e):function(i,o){let s=LO(i,o),a=Ek(s)+Ek(i.Pe);return cC(s)&&cC(i.Pe)?FO(a):tT(i.serializer,a)}(n,e)}function c9(n,e,t){return n instanceof ti?jO(n,e):n instanceof ni?BO(n,e):t}function LO(n,e){return n instanceof eo?function(r){return cC(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}var Xi=class extends ul{},ti=class extends ul{constructor(e){super(),this.elements=e}};function jO(n,e){let t=UO(e);for(let r of n.elements)t.some(i=>Tr(i,r))||t.push(r);return{arrayValue:{values:t}}}var ni=class extends ul{constructor(e){super(),this.elements=e}};function BO(n,e){let t=UO(e);for(let r of n.elements)t=t.filter(i=>!Tr(i,r));return{arrayValue:{values:t}}}var eo=class extends ul{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function Ek(n){return Ke(n.integerValue||n.doubleValue)}function UO(n){return ud(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var cs=class{constructor(e,t){this.field=e,this.transform=t}};function d9(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof ti&&i instanceof ti||r instanceof ni&&i instanceof ni?ol(r.elements,i.elements,Tr):r instanceof eo&&i instanceof eo?Tr(r.Pe,i.Pe):r instanceof Xi&&i instanceof Xi}(n.transform,e.transform)}var IC=class{constructor(e,t){this.version=e,this.transformResults=t}},rt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function yg(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var cl=class{};function $O(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new no(n.key,rt.none()):new to(n.key,n.data,rt.none());{let t=n.data,r=Bt.empty(),i=new Ve(st.comparator);for(let o of e.fields)if(!i.has(o)){let s=t.field(o);s===null&&o.length>1&&(o=o.popLast(),s=t.field(o)),s===null?r.delete(o):r.set(o,s),i=i.add(o)}return new tr(n.key,r,new In(i.toArray()),rt.none())}}function h9(n,e,t){n instanceof to?function(i,o,s){let a=i.value.clone(),l=Ck(i.fieldTransforms,o,s.transformResults);a.setAll(l),o.convertToFoundDocument(s.version,a).setHasCommittedMutations()}(n,e,t):n instanceof tr?function(i,o,s){if(!yg(i.precondition,o))return void o.convertToUnknownDocument(s.version);let a=Ck(i.fieldTransforms,o,s.transformResults),l=o.data;l.setAll(HO(i)),l.setAll(a),o.convertToFoundDocument(s.version,l).setHasCommittedMutations()}(n,e,t):function(i,o,s){o.convertToNoDocument(s.version).setHasCommittedMutations()}(0,e,t)}function td(n,e,t,r){return n instanceof to?function(o,s,a,l){if(!yg(o.precondition,s))return a;let c=o.value.clone(),d=Dk(o.fieldTransforms,l,s);return c.setAll(d),s.convertToFoundDocument(s.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof tr?function(o,s,a,l){if(!yg(o.precondition,s))return a;let c=Dk(o.fieldTransforms,l,s),d=s.data;return d.setAll(HO(o)),d.setAll(c),s.convertToFoundDocument(s.version,d).setHasLocalMutations(),a===null?null:a.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(f=>f.field))}(n,e,t,r):function(o,s,a){return yg(o.precondition,s)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):a}(n,e,t)}function f9(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),o=LO(r.transform,i||null);o!=null&&(t===null&&(t=Bt.empty()),t.set(r.field,o))}return t||null}function Ik(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&ol(r,i,(o,s)=>d9(o,s))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var to=class extends cl{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},tr=class extends cl{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function HO(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Ck(n,e,t){let r=new Map;K(n.length===t.length);for(let i=0;i<t.length;i++){let o=n[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,c9(s,a,t[i]))}return r}function Dk(n,e,t){let r=new Map;for(let i of n){let o=i.transform,s=t.data.field(i.field);r.set(i.field,u9(o,s,e))}return r}var no=class extends cl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},cd=class extends cl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var dd=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let o=this.mutations[i];o.key.isEqual(e.key)&&h9(o,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=td(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=td(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=OO();return this.mutations.forEach(i=>{let o=e.get(i.key),s=o.overlayedDocument,a=this.applyToLocalView(s,o.mutatedFields);a=t.has(i.key)?null:a;let l=$O(s,a);l!==null&&r.set(i.key,l),s.isValidDocument()||s.convertToNoDocument(J.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),fe())}isEqual(e){return this.batchId===e.batchId&&ol(this.mutations,e.mutations,(t,r)=>Ik(t,r))&&ol(this.baseMutations,e.baseMutations,(t,r)=>Ik(t,r))}},CC=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){K(e.mutations.length===r.length);let i=function(){return s9}(),o=e.mutations;for(let s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new n(e,t,r,i)}};var hd=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var DC=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ct,Se;function qO(n){switch(n){default:return G();case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0}}function GO(n){if(n===void 0)return ot("GRPC error has no .code"),N.UNKNOWN;switch(n){case ct.OK:return N.OK;case ct.CANCELLED:return N.CANCELLED;case ct.UNKNOWN:return N.UNKNOWN;case ct.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case ct.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case ct.INTERNAL:return N.INTERNAL;case ct.UNAVAILABLE:return N.UNAVAILABLE;case ct.UNAUTHENTICATED:return N.UNAUTHENTICATED;case ct.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case ct.NOT_FOUND:return N.NOT_FOUND;case ct.ALREADY_EXISTS:return N.ALREADY_EXISTS;case ct.PERMISSION_DENIED:return N.PERMISSION_DENIED;case ct.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case ct.ABORTED:return N.ABORTED;case ct.OUT_OF_RANGE:return N.OUT_OF_RANGE;case ct.UNIMPLEMENTED:return N.UNIMPLEMENTED;case ct.DATA_LOSS:return N.DATA_LOSS;default:return G()}}(Se=ct||(ct={}))[Se.OK=0]="OK",Se[Se.CANCELLED=1]="CANCELLED",Se[Se.UNKNOWN=2]="UNKNOWN",Se[Se.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Se[Se.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Se[Se.NOT_FOUND=5]="NOT_FOUND",Se[Se.ALREADY_EXISTS=6]="ALREADY_EXISTS",Se[Se.PERMISSION_DENIED=7]="PERMISSION_DENIED",Se[Se.UNAUTHENTICATED=16]="UNAUTHENTICATED",Se[Se.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Se[Se.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Se[Se.ABORTED=10]="ABORTED",Se[Se.OUT_OF_RANGE=11]="OUT_OF_RANGE",Se[Se.UNIMPLEMENTED=12]="UNIMPLEMENTED",Se[Se.INTERNAL=13]="INTERNAL",Se[Se.UNAVAILABLE=14]="UNAVAILABLE",Se[Se.DATA_LOSS=15]="DATA_LOSS";var Tk=null;function zO(){return new TextEncoder}var p9=new Qr([4294967295,4294967295],0);function bk(n){let e=zO().encode(n),t=new jI;return t.update(e),new Uint8Array(t.digest())}function Sk(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Qr([t,r],0),new Qr([i,o],0)]}var TC=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new os(`Invalid padding: ${t}`);if(r<0)throw new os(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new os(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new os(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ie=Qr.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(Qr.fromNumber(r)));return i.compare(p9)===1&&(i=new Qr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ie).toNumber()}Ee(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;let t=bk(e),[r,i]=Sk(t);for(let o=0;o<this.hashCount;o++){let s=this.de(r,i,o);if(!this.Ee(s))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),s=new n(o,i,t);return r.forEach(a=>s.insert(a)),s}insert(e){if(this.Te===0)return;let t=bk(e),[r,i]=Sk(t);for(let o=0;o<this.hashCount;o++){let s=this.de(r,i,o);this.Ae(s)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},os=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var fd=class n{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,pd.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(J.min(),i,new ze(le),sn(),fe())}},pd=class n{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,fe(),fe(),fe())}};var il=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},xg=class{constructor(e,t){this.targetId=e,this.me=t}},Ng=class{constructor(e,t,r=lt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Pg=class{constructor(){this.fe=0,this.ge=Ak(),this.pe=lt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=fe(),t=fe(),r=fe();return this.ge.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:G()}}),new pd(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=Ak()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,K(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},bC=class{constructor(e){this.Be=e,this.Le=new Map,this.ke=sn(),this.qe=lg(),this.Qe=lg(),this.Ke=new ze(le)}$e(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.Ue(t,e.Ve):this.We(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.We(t,e.key,e.Ve)}Ge(e){this.forEachTarget(e,t=>{let r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.je(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.De(e.resumeToken));break;default:G()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Le.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){let t=e.targetId,r=e.me.count,i=this.Ye(t);if(i){let o=i.target;if(Ag(o))if(r===0){let s=new q(o.path);this.We(t,s,ft.newNoDocument(s,J.min()))}else K(r===1);else{let s=this.Ze(t);if(s!==r){let a=this.Xe(e),l=a?this.et(a,e,s):1;if(l!==0){this.He(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,c)}Tk?.tt(function(d,f,g,m,v){var T,S,O,B,F,W;let oe={localCacheCount:d,existenceFilterCount:f.count,databaseId:g.database,projectId:g.projectId},X=f.unchangedNames;return X&&(oe.bloomFilter={applied:v===0,hashCount:(T=X?.hashCount)!==null&&T!==void 0?T:0,bitmapLength:(B=(O=(S=X?.bits)===null||S===void 0?void 0:S.bitmap)===null||O===void 0?void 0:O.length)!==null&&B!==void 0?B:0,padding:(W=(F=X?.bits)===null||F===void 0?void 0:F.padding)!==null&&W!==void 0?W:0,mightContain:I=>{var _;return(_=m?.mightContain(I))!==null&&_!==void 0&&_}}),oe}(s,e.me,this.Be.nt(),a,l))}}}}Xe(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t,s,a;try{s=ei(r).toUint8Array()}catch(l){if(l instanceof Tg)return Jn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new TC(s,i,o)}catch(l){return Jn(l instanceof os?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Te===0?null:a}et(e,t,r){return t.me.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){let r=this.Be.getRemoteKeysForTarget(t),i=0;return r.forEach(o=>{let s=this.Be.nt(),a=`projects/${s.projectId}/databases/${s.database}/documents/${o.path.canonicalString()}`;e.mightContain(a)||(this.We(t,o,null),i++)}),i}it(e){let t=new Map;this.Le.forEach((o,s)=>{let a=this.Ye(s);if(a){if(o.current&&Ag(a.target)){let l=new q(a.target.path);this.st(l).has(s)||this.ot(s,l)||this.We(s,l,ft.newNoDocument(l,e))}o.be&&(t.set(s,o.ve()),o.Ce())}});let r=fe();this.Qe.forEach((o,s)=>{let a=!0;s.forEachWhile(l=>{let c=this.Ye(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(o))}),this.ke.forEach((o,s)=>s.setReadTime(e));let i=new fd(e,t,this.Ke,this.ke,r);return this.ke=sn(),this.qe=lg(),this.Qe=lg(),this.Ke=new ze(le),i}Ue(e,t){if(!this.je(e))return;let r=this.ot(e,t.key)?2:0;this.ze(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e)),this.Qe=this.Qe.insert(t.key,this._t(t.key).add(e))}We(e,t,r){if(!this.je(e))return;let i=this.ze(e);this.ot(e,t)?i.Fe(t,1):i.Me(t),this.Qe=this.Qe.insert(t,this._t(t).delete(e)),this.Qe=this.Qe.insert(t,this._t(t).add(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Le.delete(e)}Ze(e){let t=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.ze(e).xe()}ze(e){let t=this.Le.get(e);return t||(t=new Pg,this.Le.set(e,t)),t}_t(e){let t=this.Qe.get(e);return t||(t=new Ve(le),this.Qe=this.Qe.insert(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Ve(le),this.qe=this.qe.insert(e,t)),t}je(e){let t=this.Ye(e)!==null;return t||k("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){let t=this.Le.get(e);return t&&t.Se?null:this.Be.ut(e)}He(e){this.Le.set(e,new Pg),this.Be.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}ot(e,t){return this.Be.getRemoteKeysForTarget(e).has(t)}};function lg(){return new ze(q.comparator)}function Ak(){return new ze(q.comparator)}var g9={asc:"ASCENDING",desc:"DESCENDING"},m9={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},y9={and:"AND",or:"OR"},SC=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function AC(n,e){return n.useProto3Json||bd(e)?e:{value:e}}function dl(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function WO(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function _9(n,e){return dl(n,e.toTimestamp())}function at(n){return K(!!n),J.fromTimestamp(function(t){let r=Xr(t);return new Je(r.seconds,r.nanos)}(n))}function nT(n,e){return MC(n,e).canonicalString()}function MC(n,e){let t=function(i){return new Ae(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function KO(n){let e=Ae.fromString(n);return K(i1(e)),e}function gd(n,e){return nT(n.databaseId,e.path)}function Cr(n,e){let t=KO(e);if(t.get(1)!==n.databaseId.projectId)throw new P(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new P(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new q(ZO(t))}function QO(n,e){return nT(n.databaseId,e)}function YO(n){let e=KO(n);return e.length===4?Ae.emptyPath():ZO(e)}function RC(n){return new Ae(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function ZO(n){return K(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Mk(n,e,t){return{name:gd(n,e),fields:t.value.mapValue.fields}}function JO(n,e,t){let r=Cr(n,e.name),i=at(e.updateTime),o=e.createTime?at(e.createTime):J.min(),s=new Bt({mapValue:{fields:e.fields}}),a=ft.newFoundDocument(r,i,o,s);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function v9(n,e){return"found"in e?function(r,i){K(!!i.found),i.found.name,i.found.updateTime;let o=Cr(r,i.found.name),s=at(i.found.updateTime),a=i.found.createTime?at(i.found.createTime):J.min(),l=new Bt({mapValue:{fields:i.found.fields}});return ft.newFoundDocument(o,s,a,l)}(n,e):"missing"in e?function(r,i){K(!!i.missing),K(!!i.readTime);let o=Cr(r,i.missing),s=at(i.readTime);return ft.newNoDocument(o,s)}(n,e):G()}function w9(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:G()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(c,d){return c.useProto3Json?(K(d===void 0||typeof d=="string"),lt.fromBase64String(d||"")):(K(d===void 0||d instanceof Buffer||d instanceof Uint8Array),lt.fromUint8Array(d||new Uint8Array))}(n,e.targetChange.resumeToken),s=e.targetChange.cause,a=s&&function(c){let d=c.code===void 0?N.UNKNOWN:GO(c.code);return new P(d,c.message||"")}(s);t=new Ng(r,i,o,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Cr(n,r.document.name),o=at(r.document.updateTime),s=r.document.createTime?at(r.document.createTime):J.min(),a=new Bt({mapValue:{fields:r.document.fields}}),l=ft.newFoundDocument(i,o,s,a),c=r.targetIds||[],d=r.removedTargetIds||[];t=new il(c,d,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Cr(n,r.document),o=r.readTime?at(r.readTime):J.min(),s=ft.newNoDocument(i,o),a=r.removedTargetIds||[];t=new il([],a,s.key,s)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Cr(n,r.document),o=r.removedTargetIds||[];t=new il([],o,i,null)}else{if(!("filter"in e))return G();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:o}=r,s=new DC(i,o),a=r.targetId;t=new xg(a,s)}}return t}function md(n,e){let t;if(e instanceof to)t={update:Mk(n,e.key,e.value)};else if(e instanceof no)t={delete:gd(n,e.key)};else if(e instanceof tr)t={update:Mk(n,e.key,e.data),updateMask:b9(e.fieldMask)};else{if(!(e instanceof cd))return G();t={verify:gd(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(o,s){let a=s.transform;if(a instanceof Xi)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ti)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ni)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof eo)return{fieldPath:s.field.canonicalString(),increment:a.Pe};throw G()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,o){return o.updateTime!==void 0?{updateTime:_9(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:G()}(n,e.precondition)),t}function xC(n,e){let t=e.currentDocument?function(o){return o.updateTime!==void 0?rt.updateTime(at(o.updateTime)):o.exists!==void 0?rt.exists(o.exists):rt.none()}(e.currentDocument):rt.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(s,a){let l=null;if("setToServerValue"in a)K(a.setToServerValue==="REQUEST_TIME"),l=new Xi;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];l=new ti(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];l=new ni(d)}else"increment"in a?l=new eo(s,a.increment):G();let c=st.fromServerFormat(a.fieldPath);return new cs(c,l)}(n,i)):[];if(e.update){e.update.name;let i=Cr(n,e.update.name),o=new Bt({mapValue:{fields:e.update.fields}});if(e.updateMask){let s=function(l){let c=l.fieldPaths||[];return new In(c.map(d=>st.fromServerFormat(d)))}(e.updateMask);return new tr(i,o,s,t,r)}return new to(i,o,t,r)}if(e.delete){let i=Cr(n,e.delete);return new no(i,t)}if(e.verify){let i=Cr(n,e.verify);return new cd(i,t)}return G()}function E9(n,e){return n&&n.length>0?(K(e!==void 0),n.map(t=>function(i,o){let s=i.updateTime?at(i.updateTime):at(o);return s.isEqual(J.min())&&(s=at(o)),new IC(s,i.transformResults||[])}(t,e))):[]}function XO(n,e){return{documents:[QO(n,e.path)]}}function e1(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=QO(n,i);let o=function(c){if(c.length!==0)return r1(Fe.create(c,"and"))}(e.filters);o&&(t.structuredQuery.where=o);let s=function(c){if(c.length!==0)return c.map(d=>function(g){return{field:Ja(g.field),direction:C9(g.dir)}}(d))}(e.orderBy);s&&(t.structuredQuery.orderBy=s);let a=AC(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ct:t,parent:i}}function t1(n){let e=YO(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){K(r===1);let d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let o=[];t.where&&(o=function(f){let g=n1(f);return g instanceof Fe&&JD(g)?g.getFilters():[g]}(t.where));let s=[];t.orderBy&&(s=function(f){return f.map(g=>function(v){return new ls(Xa(v.field),function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(g))}(t.orderBy));let a=null;t.limit&&(a=function(f){let g;return g=typeof f=="object"?f.value:f,bd(g)?null:g}(t.limit));let l=null;t.startAt&&(l=function(f){let g=!!f.before,m=f.values||[];return new br(m,g)}(t.startAt));let c=null;return t.endAt&&(c=function(f){let g=!f.before,m=f.values||[];return new br(m,g)}(t.endAt)),MO(e,i,s,o,a,"F",l,c)}function I9(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return G()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function n1(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Xa(t.unaryFilter.field);return Ee.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Xa(t.unaryFilter.field);return Ee.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=Xa(t.unaryFilter.field);return Ee.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let s=Xa(t.unaryFilter.field);return Ee.create(s,"!=",{nullValue:"NULL_VALUE"});default:return G()}}(n):n.fieldFilter!==void 0?function(t){return Ee.create(Xa(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return G()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Fe.create(t.compositeFilter.filters.map(r=>n1(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return G()}}(t.compositeFilter.op))}(n):G()}function C9(n){return g9[n]}function D9(n){return m9[n]}function T9(n){return y9[n]}function Ja(n){return{fieldPath:n.canonicalString()}}function Xa(n){return st.fromServerFormat(n.fieldPath)}function r1(n){return n instanceof Ee?function(t){if(t.op==="=="){if(fk(t.value))return{unaryFilter:{field:Ja(t.field),op:"IS_NAN"}};if(hk(t.value))return{unaryFilter:{field:Ja(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(fk(t.value))return{unaryFilter:{field:Ja(t.field),op:"IS_NOT_NAN"}};if(hk(t.value))return{unaryFilter:{field:Ja(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ja(t.field),op:D9(t.op),value:t.value}}}(n):n instanceof Fe?function(t){let r=t.getFilters().map(i=>r1(i));return r.length===1?r[0]:{compositeFilter:{op:T9(t.op),filters:r}}}(n):G()}function b9(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function i1(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var hl=class n{constructor(e,t,r,i,o=J.min(),s=J.min(),a=lt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var kg=class{constructor(e){this.ht=e}};function S9(n,e){let t;if(e.document)t=JO(n.ht,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=q.fromSegments(e.noDocument.path),i=hs(e.noDocument.readTime);t=ft.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return G();{let r=q.fromSegments(e.unknownDocument.path),i=hs(e.unknownDocument.version);t=ft.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let o=new Je(i[0],i[1]);return J.fromTimestamp(o)}(e.readTime)),t}function Rk(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Og(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(o,s){return{name:gd(o,s.key),fields:s.data.value.mapValue.fields,updateTime:dl(o,s.version.toTimestamp()),createTime:dl(o,s.createTime.toTimestamp())}}(n.ht,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:ds(e.version)};else{if(!e.isUnknownDocument())return G();r.unknownDocument={path:t.path.toArray(),version:ds(e.version)}}return r}function Og(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ds(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function hs(n){let e=new Je(n.seconds,n.nanoseconds);return J.fromTimestamp(e)}function ns(n,e){let t=(e.baseMutations||[]).map(o=>xC(n.ht,o));for(let o=0;o<e.mutations.length-1;++o){let s=e.mutations[o];if(o+1<e.mutations.length&&e.mutations[o+1].transform!==void 0){let a=e.mutations[o+1];s.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(o+1,1),++o}}let r=e.mutations.map(o=>xC(n.ht,o)),i=Je.fromMillis(e.localWriteTimeMs);return new dd(e.batchId,i,t,r)}function Jc(n){let e=hs(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?hs(n.lastLimboFreeSnapshotVersion):J.min(),r;return r=function(o){return o.documents!==void 0}(n.query)?function(o){return K(o.documents.length===1),Jt(Cl(YO(o.documents[0])))}(n.query):function(o){return Jt(t1(o))}(n.query),new hl(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,lt.fromBase64String(n.resumeToken))}function o1(n,e){let t=ds(e.snapshotVersion),r=ds(e.lastLimboFreeSnapshotVersion),i;i=Ag(e.target)?XO(n.ht,e.target):e1(n.ht,e.target).ct;let o=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:us(e.target),readTime:t,resumeToken:o,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function rT(n){let e=t1({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Rg(e,e.limit,"L"):e}function GI(n,e){return new hd(e.largestBatchId,xC(n.ht,e.overlayMutation))}function xk(n,e){let t=e.path.lastSegment();return[n,Ut(e.path.popLast()),t]}function Nk(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:ds(r.readTime),documentKey:Ut(r.documentKey.path),largestBatchId:r.largestBatchId}}var NC=class{getBundleMetadata(e,t){return Pk(e).get(t).next(r=>{if(r)return function(o){return{id:o.bundleId,createTime:hs(o.createTime),version:o.version}}(r)})}saveBundleMetadata(e,t){return Pk(e).put(function(i){return{bundleId:i.id,createTime:ds(at(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return kk(e).get(t).next(r=>{if(r)return function(o){return{name:o.name,query:rT(o.bundledQuery),readTime:hs(o.readTime)}}(r)})}saveNamedQuery(e,t){return kk(e).put(function(i){return{name:i.name,readTime:ds(at(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function Pk(n){return vt(n,"bundles")}function kk(n){return vt(n,"namedQueries")}var Fg=class n{constructor(e,t){this.serializer=e,this.userId=t}static Pt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Wc(e).get(xk(this.userId,t)).next(r=>r?GI(this.serializer,r):null)}getOverlays(e,t){let r=Er();return M.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((o,s)=>{let a=new hd(t,s);i.push(this.Tt(e,a))}),M.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(s=>i.add(Ut(s.getCollectionPath())));let o=[];return i.forEach(s=>{let a=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,r+1],!1,!0);o.push(Wc(e).j("collectionPathOverlayIndex",a))}),M.waitFor(o)}getOverlaysForCollection(e,t,r){let i=Er(),o=Ut(t),s=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,Number.POSITIVE_INFINITY],!0);return Wc(e).U("collectionPathOverlayIndex",s).next(a=>{for(let l of a){let c=GI(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let o=Er(),s,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Wc(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,d)=>{let f=GI(this.serializer,c);o.size()<i||f.largestBatchId===s?(o.set(f.getKey(),f),s=f.largestBatchId):d.done()}).next(()=>o)}Tt(e,t){return Wc(e).put(function(i,o,s){let[a,l,c]=xk(o,s.mutation.key);return{userId:o,collectionPath:l,documentId:c,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:md(i.ht,s.mutation)}}(this.serializer,this.userId,t))}};function Wc(n){return vt(n,"documentOverlays")}var PC=class{It(e){return vt(e,"globals")}getSessionToken(e){return this.It(e).get("sessionToken").next(t=>{let r=t?.value;return r?lt.fromUint8Array(r):lt.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.It(e).put({name:"sessionToken",value:t.toUint8Array()})}};var Zr=class{constructor(){}dt(e,t){this.Et(e,t),t.At()}Et(e,t){if("nullValue"in e)this.Rt(t,5);else if("booleanValue"in e)this.Rt(t,10),t.Vt(e.booleanValue?1:0);else if("integerValue"in e)this.Rt(t,15),t.Vt(Ke(e.integerValue));else if("doubleValue"in e){let r=Ke(e.doubleValue);isNaN(r)?this.Rt(t,13):(this.Rt(t,15),od(r)?t.Vt(0):t.Vt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Rt(t,20),typeof r=="string"&&(r=Xr(r)),t.ft(`${r.seconds||""}`),t.Vt(r.nanos||0)}else if("stringValue"in e)this.gt(e.stringValue,t),this.yt(t);else if("bytesValue"in e)this.Rt(t,30),t.wt(ei(e.bytesValue)),this.yt(t);else if("referenceValue"in e)this.St(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Rt(t,45),t.Vt(r.latitude||0),t.Vt(r.longitude||0)}else"mapValue"in e?EO(e)?this.Rt(t,Number.MAX_SAFE_INTEGER):vm(e)?this.bt(e.mapValue,t):(this.Dt(e.mapValue,t),this.yt(t)):"arrayValue"in e?(this.vt(e.arrayValue,t),this.yt(t)):G()}gt(e,t){this.Rt(t,25),this.Ct(e,t)}Ct(e,t){t.ft(e)}Dt(e,t){let r=e.fields||{};this.Rt(t,55);for(let i of Object.keys(r))this.gt(i,t),this.Et(r[i],t)}bt(e,t){var r,i;let o=e.fields||{};this.Rt(t,53);let s="value",a=((i=(r=o[s].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Rt(t,15),t.Vt(Ke(a)),this.gt(s,t),this.Et(o[s],t)}vt(e,t){let r=e.values||[];this.Rt(t,50);for(let i of r)this.Et(i,t)}St(e,t){this.Rt(t,37),q.fromName(e).path.forEach(r=>{this.Rt(t,60),this.Ct(r,t)})}Rt(e,t){e.Vt(t)}yt(e){e.Vt(2)}};Zr.Ft=new Zr;function A9(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Ok(n){let e=64-function(r){let i=0;for(let o=0;o<8;++o){let s=A9(255&r[o]);if(i+=s,s!==8)break}return i}(n);return Math.ceil(e/8)}var kC=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Mt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.xt(r.value),r=t.next();this.Ot()}Nt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Bt(r.value),r=t.next();this.Lt()}kt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.xt(r);else if(r<2048)this.xt(960|r>>>6),this.xt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.xt(480|r>>>12),this.xt(128|63&r>>>6),this.xt(128|63&r);else{let i=t.codePointAt(0);this.xt(240|i>>>18),this.xt(128|63&i>>>12),this.xt(128|63&i>>>6),this.xt(128|63&i)}}this.Ot()}qt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Bt(r);else if(r<2048)this.Bt(960|r>>>6),this.Bt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Bt(480|r>>>12),this.Bt(128|63&r>>>6),this.Bt(128|63&r);else{let i=t.codePointAt(0);this.Bt(240|i>>>18),this.Bt(128|63&i>>>12),this.Bt(128|63&i>>>6),this.Bt(128|63&i)}}this.Lt()}Qt(e){let t=this.Kt(e),r=Ok(t);this.$t(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Ut(e){let t=this.Kt(e),r=Ok(t);this.$t(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Wt(){this.Gt(255),this.Gt(255)}zt(){this.jt(255),this.jt(255)}reset(){this.position=0}seed(e){this.$t(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ht(){return this.buffer.slice(0,this.position)}Kt(e){let t=function(o){let s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,o,!1),new Uint8Array(s.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}xt(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(t)}Bt(e){let t=255&e;t===0?(this.jt(0),this.jt(255)):t===255?(this.jt(255),this.jt(0)):this.jt(e)}Ot(){this.Gt(0),this.Gt(1)}Lt(){this.jt(0),this.jt(1)}Gt(e){this.$t(1),this.buffer[this.position++]=e}jt(e){this.$t(1),this.buffer[this.position++]=~e}$t(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},OC=class{constructor(e){this.Jt=e}wt(e){this.Jt.Mt(e)}ft(e){this.Jt.kt(e)}Vt(e){this.Jt.Qt(e)}At(){this.Jt.Wt()}},FC=class{constructor(e){this.Jt=e}wt(e){this.Jt.Nt(e)}ft(e){this.Jt.qt(e)}Vt(e){this.Jt.Ut(e)}At(){this.Jt.zt()}},rs=class{constructor(){this.Jt=new kC,this.Yt=new OC(this.Jt),this.Zt=new FC(this.Jt)}seed(e){this.Jt.seed(e)}Xt(e){return e===0?this.Yt:this.Zt}Ht(){return this.Jt.Ht()}reset(){this.Jt.reset()}};var is=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}en(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function $i(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Fk(n.arrayValue,e.arrayValue),t!==0?t:(t=Fk(n.directionalValue,e.directionalValue),t!==0?t:q.comparator(n.documentKey,e.documentKey)))}function Fk(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Vg=class{constructor(e){this.tn=new Ve((t,r)=>st.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.nn=e.orderBy,this.rn=[];for(let t of e.filters){let r=t;r.isInequality()?this.tn=this.tn.add(r):this.rn.push(r)}}get sn(){return this.tn.size>1}on(e){if(K(e.collectionGroup===this.collectionId),this.sn)return!1;let t=rC(e);if(t!==void 0&&!this._n(t))return!1;let r=es(e),i=new Set,o=0,s=0;for(;o<r.length&&this._n(r[o]);++o)i=i.add(r[o].fieldPath.canonicalString());if(o===r.length)return!0;if(this.tn.size>0){let a=this.tn.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[o];if(!this.an(a,l)||!this.un(this.nn[s++],l))return!1}++o}for(;o<r.length;++o){let a=r[o];if(s>=this.nn.length||!this.un(this.nn[s++],a))return!1}return!0}cn(){if(this.sn)return null;let e=new Ve(st.comparator),t=[];for(let r of this.rn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new nl(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new nl(r.field,0))}for(let r of this.nn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new nl(r.field,r.dir==="asc"?0:1)));return new sl(sl.UNKNOWN_ID,this.collectionId,t,id.empty())}_n(e){for(let t of this.rn)if(this.an(t,e))return!0;return!1}an(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}un(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function s1(n){var e,t;if(K(n instanceof Ee||n instanceof Fe),n instanceof Ee){if(n instanceof Sg){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(o=>Ee.create(n.field,"==",o)))||[];return Fe.create(i,"or")}return n}let r=n.filters.map(i=>s1(i));return Fe.create(r,n.op)}function M9(n){if(n.getFilters().length===0)return[];let e=jC(s1(n));return K(a1(e)),VC(e)||LC(e)?[e]:e.getFilters()}function VC(n){return n instanceof Ee}function LC(n){return n instanceof Fe&&JD(n)}function a1(n){return VC(n)||LC(n)||function(t){if(t instanceof Fe&&dC(t)){for(let r of t.getFilters())if(!VC(r)&&!LC(r))return!1;return!0}return!1}(n)}function jC(n){if(K(n instanceof Ee||n instanceof Fe),n instanceof Ee)return n;if(n.filters.length===1)return jC(n.filters[0]);let e=n.filters.map(r=>jC(r)),t=Fe.create(e,n.op);return t=Lg(t),a1(t)?t:(K(t instanceof Fe),K(ll(t)),K(t.filters.length>1),t.filters.reduce((r,i)=>iT(r,i)))}function iT(n,e){let t;return K(n instanceof Ee||n instanceof Fe),K(e instanceof Ee||e instanceof Fe),t=n instanceof Ee?e instanceof Ee?function(i,o){return Fe.create([i,o],"and")}(n,e):Vk(n,e):e instanceof Ee?Vk(e,n):function(i,o){if(K(i.filters.length>0&&o.filters.length>0),ll(i)&&ll(o))return bO(i,o.getFilters());let s=dC(i)?i:o,a=dC(i)?o:i,l=s.filters.map(c=>iT(c,a));return Fe.create(l,"or")}(n,e),Lg(t)}function Vk(n,e){if(ll(e))return bO(e,n.getFilters());{let t=e.filters.map(r=>iT(n,r));return Fe.create(t,"or")}}function Lg(n){if(K(n instanceof Ee||n instanceof Fe),n instanceof Ee)return n;let e=n.getFilters();if(e.length===1)return Lg(e[0]);if(DO(n))return n;let t=e.map(i=>Lg(i)),r=[];return t.forEach(i=>{i instanceof Ee?r.push(i):i instanceof Fe&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:Fe.create(r,n.op)}var BC=class{constructor(){this.ln=new yd}addToCollectionParentIndex(e,t){return this.ln.add(t),M.resolve()}getCollectionParents(e,t){return M.resolve(this.ln.getEntries(t))}addFieldIndex(e,t){return M.resolve()}deleteFieldIndex(e,t){return M.resolve()}deleteAllFieldIndexes(e){return M.resolve()}createTargetIndexes(e,t){return M.resolve()}getDocumentsMatchingTarget(e,t){return M.resolve(null)}getIndexType(e,t){return M.resolve(0)}getFieldIndexes(e,t){return M.resolve([])}getNextCollectionGroupToUpdate(e){return M.resolve(null)}getMinOffset(e,t){return M.resolve(Ln.min())}getMinOffsetFromCollectionGroup(e,t){return M.resolve(Ln.min())}updateCollectionGroup(e,t,r){return M.resolve()}updateIndexEntries(e,t){return M.resolve()}},yd=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ve(Ae.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ve(Ae.comparator)).toArray()}};var ug=new Uint8Array(0),UC=class{constructor(e,t){this.databaseId=t,this.hn=new yd,this.Pn=new er(r=>us(r),(r,i)=>Sd(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.hn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.hn.add(t)});let o={collectionId:r,parent:Ut(i)};return Lk(e).put(o)}return M.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[uO(t),""],!1,!0);return Lk(e).U(i).next(o=>{for(let s of o){if(s.collectionId!==t)break;r.push(wr(s.parent))}return r})}addFieldIndex(e,t){let r=Kc(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete i.indexId;let o=r.add(i);if(t.indexState){let s=Ka(e);return o.next(a=>{s.put(Nk(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return o.next()}deleteFieldIndex(e,t){let r=Kc(e),i=Ka(e),o=Wa(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>o.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Kc(e),r=Wa(e),i=Ka(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return M.forEach(this.Tn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new Vg(r).cn();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=Wa(e),i=!0,o=new Map;return M.forEach(this.Tn(t),s=>this.In(e,s).next(a=>{i&&(i=!!a),o.set(s,a)})).next(()=>{if(i){let s=fe(),a=[];return M.forEach(o,(l,c)=>{k("IndexedDbIndexManager",`Using index ${function(F){return`id=${F.indexId}|cg=${F.collectionGroup}|f=${F.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(l)} to execute ${us(t)}`);let d=function(F,W){let oe=rC(W);if(oe===void 0)return null;for(let X of Mg(F,oe.fieldPath))switch(X.op){case"array-contains-any":return X.value.arrayValue.values||[];case"array-contains":return[X.value]}return null}(c,l),f=function(F,W){let oe=new Map;for(let X of es(W))for(let I of Mg(F,X.fieldPath))switch(I.op){case"==":case"in":oe.set(X.fieldPath.canonicalString(),I.value);break;case"not-in":case"!=":return oe.set(X.fieldPath.canonicalString(),I.value),Array.from(oe.values())}return null}(c,l),g=function(F,W){let oe=[],X=!0;for(let I of es(W)){let _=I.kind===0?_k(F,I.fieldPath,F.startAt):vk(F,I.fieldPath,F.startAt);oe.push(_.value),X&&(X=_.inclusive)}return new br(oe,X)}(c,l),m=function(F,W){let oe=[],X=!0;for(let I of es(W)){let _=I.kind===0?vk(F,I.fieldPath,F.endAt):_k(F,I.fieldPath,F.endAt);oe.push(_.value),X&&(X=_.inclusive)}return new br(oe,X)}(c,l),v=this.dn(l,c,g),T=this.dn(l,c,m),S=this.En(l,c,f),O=this.An(l.indexId,d,v,g.inclusive,T,m.inclusive,S);return M.forEach(O,B=>r.G(B,t.limit).next(F=>{F.forEach(W=>{let oe=q.fromSegments(W.documentKey);s.has(oe)||(s=s.add(oe),a.push(oe))})}))}).next(()=>a)}return M.resolve(null)})}Tn(e){let t=this.Pn.get(e);return t||(e.filters.length===0?t=[e]:t=M9(Fe.create(e.filters,"and")).map(r=>wC(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Pn.set(e,t),t)}An(e,t,r,i,o,s,a){let l=(t!=null?t.length:1)*Math.max(r.length,o.length),c=l/(t!=null?t.length:1),d=[];for(let f=0;f<l;++f){let g=t?this.Rn(t[f/c]):ug,m=this.Vn(e,g,r[f%c],i),v=this.mn(e,g,o[f%c],s),T=a.map(S=>this.Vn(e,g,S,!0));d.push(...this.createRange(m,v,T))}return d}Vn(e,t,r,i){let o=new is(e,q.empty(),t,r);return i?o:o.en()}mn(e,t,r,i){let o=new is(e,q.empty(),t,r);return i?o.en():o}In(e,t){let r=new Vg(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(o=>{let s=null;for(let a of o)r.on(a)&&(!s||a.fields.length>s.fields.length)&&(s=a);return s})}getIndexType(e,t){let r=2,i=this.Tn(t);return M.forEach(i,o=>this.In(e,o).next(s=>{s?r!==0&&s.fields.length<function(l){let c=new Ve(st.comparator),d=!1;for(let f of l.filters)for(let g of f.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:c=c.add(g.field));for(let f of l.orderBy)f.field.isKeyField()||(c=c.add(f.field));return c.size+(d?1:0)}(o)&&(r=1):r=0})).next(()=>function(s){return s.limit!==null}(t)&&i.length>1&&r===2?1:r)}fn(e,t){let r=new rs;for(let i of es(e)){let o=t.data.field(i.fieldPath);if(o==null)return null;let s=r.Xt(i.kind);Zr.Ft.dt(o,s)}return r.Ht()}Rn(e){let t=new rs;return Zr.Ft.dt(e,t.Xt(0)),t.Ht()}gn(e,t){let r=new rs;return Zr.Ft.dt(as(this.databaseId,t),r.Xt(function(o){let s=es(o);return s.length===0?0:s[s.length-1].kind}(e))),r.Ht()}En(e,t,r){if(r===null)return[];let i=[];i.push(new rs);let o=0;for(let s of es(e)){let a=r[o++];for(let l of i)if(this.pn(t,s.fieldPath)&&ud(a))i=this.yn(i,s,a);else{let c=l.Xt(s.kind);Zr.Ft.dt(a,c)}}return this.wn(i)}dn(e,t,r){return this.En(e,t,r.position)}wn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ht();return t}yn(e,t,r){let i=[...e],o=[];for(let s of r.arrayValue.values||[])for(let a of i){let l=new rs;l.seed(a.Ht()),Zr.Ft.dt(s,l.Xt(t.kind)),o.push(l)}return o}pn(e,t){return!!e.filters.find(r=>r instanceof Ee&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Kc(e),i=Ka(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(o=>{let s=[];return M.forEach(o,a=>i.get([a.indexId,this.uid]).next(l=>{s.push(function(d,f){let g=f?new id(f.sequenceNumber,new Ln(hs(f.readTime),new q(wr(f.documentKey)),f.largestBatchId)):id.empty(),m=d.fields.map(([v,T])=>new nl(st.fromServerFormat(v),T));return new sl(d.indexId,d.collectionGroup,m,g)}(a,l))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let o=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return o!==0?o:le(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Kc(e),o=Ka(e);return this.Sn(e).next(s=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>M.forEach(a,l=>o.put(Nk(l.indexId,this.uid,s,r)))))}updateIndexEntries(e,t){let r=new Map;return M.forEach(t,(i,o)=>{let s=r.get(i.collectionGroup);return(s?M.resolve(s):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),M.forEach(a,l=>this.bn(e,i,l).next(c=>{let d=this.Dn(o,l);return c.isEqual(d)?M.resolve():this.vn(e,o,l,c,d)}))))})}Cn(e,t,r,i){return Wa(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.gn(r,t.key),documentKey:t.key.path.toArray()})}Fn(e,t,r,i){return Wa(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.gn(r,t.key),t.key.path.toArray()])}bn(e,t,r){let i=Wa(e),o=new Ve($i);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.gn(r,t)])},(s,a)=>{o=o.add(new is(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>o)}Dn(e,t){let r=new Ve($i),i=this.fn(t,e);if(i==null)return r;let o=rC(t);if(o!=null){let s=e.data.field(o.fieldPath);if(ud(s))for(let a of s.arrayValue.values||[])r=r.add(new is(t.indexId,e.key,this.Rn(a),i))}else r=r.add(new is(t.indexId,e.key,ug,i));return r}vn(e,t,r,i,o){k("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let s=[];return function(l,c,d,f,g){let m=l.getIterator(),v=c.getIterator(),T=za(m),S=za(v);for(;T||S;){let O=!1,B=!1;if(T&&S){let F=d(T,S);F<0?B=!0:F>0&&(O=!0)}else T!=null?B=!0:O=!0;O?(f(S),S=za(v)):B?(g(T),T=za(m)):(T=za(m),S=za(v))}}(i,o,$i,a=>{s.push(this.Cn(e,t,r,a))},a=>{s.push(this.Fn(e,t,r,a))}),M.waitFor(s)}Sn(e){let t=1;return Ka(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,o)=>{o.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((s,a)=>$i(s,a)).filter((s,a,l)=>!a||$i(s,l[a-1])!==0);let i=[];i.push(e);for(let s of r){let a=$i(s,e),l=$i(s,t);if(a===0)i[0]=e.en();else if(a>0&&l<0)i.push(s),i.push(s.en());else if(l>0)break}i.push(t);let o=[];for(let s=0;s<i.length;s+=2){if(this.Mn(i[s],i[s+1]))return[];let a=[i[s].indexId,this.uid,i[s].arrayValue,i[s].directionalValue,ug,[]],l=[i[s+1].indexId,this.uid,i[s+1].arrayValue,i[s+1].directionalValue,ug,[]];o.push(IDBKeyRange.bound(a,l))}return o}Mn(e,t){return $i(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(jk)}getMinOffset(e,t){return M.mapArray(this.Tn(t),r=>this.In(e,r).next(i=>i||G())).next(jk)}};function Lk(n){return vt(n,"collectionParents")}function Wa(n){return vt(n,"indexEntries")}function Kc(n){return vt(n,"indexConfiguration")}function Ka(n){return vt(n,"indexState")}function jk(n){K(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;QD(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Ln(e.readTime,e.documentKey,t)}var Bk={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},on=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};function l1(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),o=[],s=IDBKeyRange.only(t.batchId),a=0,l=r.J({range:s},(d,f,g)=>(a++,g.delete()));o.push(l.next(()=>{K(a===1)}));let c=[];for(let d of t.mutations){let f=gO(e,d.key.path,t.batchId);o.push(i.delete(f)),c.push(d.key)}return M.waitFor(o).next(()=>c)}function jg(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw G();e=n.noDocument}return JSON.stringify(e).length}on.DEFAULT_COLLECTION_PERCENTILE=10,on.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,on.DEFAULT=new on(41943040,on.DEFAULT_COLLECTION_PERCENTILE,on.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),on.DISABLED=new on(-1,0,0);var Bg=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.xn={}}static Pt(e,t,r,i){K(e.uid!=="");let o=e.isAuthenticated()?e.uid:"";return new n(o,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Hi(e).J({index:"userMutationsIndex",range:r},(i,o,s)=>{t=!1,s.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let o=el(e),s=Hi(e);return s.add({}).next(a=>{K(typeof a=="number");let l=new dd(a,t,r,i),c=function(m,v,T){let S=T.baseMutations.map(B=>md(m.ht,B)),O=T.mutations.map(B=>md(m.ht,B));return{userId:v,batchId:T.batchId,localWriteTimeMs:T.localWriteTime.toMillis(),baseMutations:S,mutations:O}}(this.serializer,this.userId,l),d=[],f=new Ve((g,m)=>le(g.canonicalString(),m.canonicalString()));for(let g of i){let m=gO(this.userId,g.key.path,a);f=f.add(g.key.path.popLast()),d.push(s.put(c)),d.push(o.put(m,OW))}return f.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.xn[a]=l.keys()}),M.waitFor(d).next(()=>l)})}lookupMutationBatch(e,t){return Hi(e).get(t).next(r=>r?(K(r.userId===this.userId),ns(this.serializer,r)):null)}On(e,t){return this.xn[t]?M.resolve(this.xn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.xn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Hi(e).J({index:"userMutationsIndex",range:i},(s,a,l)=>{a.userId===this.userId&&(K(a.batchId>=r),o=ns(this.serializer,a)),l.done()}).next(()=>o)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Hi(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,o,s)=>{r=o.batchId,s.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Hi(e).U("userMutationsIndex",t).next(r=>r.map(i=>ns(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=fg(this.userId,t.path),i=IDBKeyRange.lowerBound(r),o=[];return el(e).J({range:i},(s,a,l)=>{let[c,d,f]=s,g=wr(d);if(c===this.userId&&t.path.isEqual(g))return Hi(e).get(f).next(m=>{if(!m)throw G();K(m.userId===this.userId),o.push(ns(this.serializer,m))});l.done()}).next(()=>o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ve(le),i=[];return t.forEach(o=>{let s=fg(this.userId,o.path),a=IDBKeyRange.lowerBound(s),l=el(e).J({range:a},(c,d,f)=>{let[g,m,v]=c,T=wr(m);g===this.userId&&o.path.isEqual(T)?r=r.add(v):f.done()});i.push(l)}),M.waitFor(i).next(()=>this.Nn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,o=fg(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Ve(le);return el(e).J({range:s},(l,c,d)=>{let[f,g,m]=l,v=wr(g);f===this.userId&&r.isPrefixOf(v)?v.length===i&&(a=a.add(m)):d.done()}).next(()=>this.Nn(e,a))}Nn(e,t){let r=[],i=[];return t.forEach(o=>{i.push(Hi(e).get(o).next(s=>{if(s===null)throw G();K(s.userId===this.userId),r.push(ns(this.serializer,s))}))}),M.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return l1(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Bn(t.batchId)}),M.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Bn(e){delete this.xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return M.resolve();let r=IDBKeyRange.lowerBound(function(s){return[s]}(this.userId)),i=[];return el(e).J({range:r},(o,s,a)=>{if(o[0]===this.userId){let l=wr(o[1]);i.push(l)}else a.done()}).next(()=>{K(i.length===0)})})}containsKey(e,t){return u1(e,this.userId,t)}Ln(e){return c1(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function u1(n,e,t){let r=fg(e,t.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return el(n).J({range:o,H:!0},(a,l,c)=>{let[d,f,g]=a;d===e&&f===i&&(s=!0),c.done()}).next(()=>s)}function Hi(n){return vt(n,"mutations")}function el(n){return vt(n,"documentMutations")}function c1(n){return vt(n,"mutationQueues")}var fl=class n{constructor(e){this.kn=e}next(){return this.kn+=2,this.kn}static qn(){return new n(0)}static Qn(){return new n(-1)}};var $C=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Kn(e).next(t=>{let r=new fl(t.highestTargetId);return t.highestTargetId=r.next(),this.$n(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Kn(e).next(t=>J.fromTimestamp(new Je(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Kn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Kn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.$n(e,i)))}addTargetData(e,t){return this.Un(e,t).next(()=>this.Kn(e).next(r=>(r.targetCount+=1,this.Wn(t,r),this.$n(e,r))))}updateTargetData(e,t){return this.Un(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Qa(e).delete(t.targetId)).next(()=>this.Kn(e)).next(r=>(K(r.targetCount>0),r.targetCount-=1,this.$n(e,r)))}removeTargets(e,t,r){let i=0,o=[];return Qa(e).J((s,a)=>{let l=Jc(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,o.push(this.removeTargetData(e,l)))}).next(()=>M.waitFor(o)).next(()=>i)}forEachTarget(e,t){return Qa(e).J((r,i)=>{let o=Jc(i);t(o)})}Kn(e){return Uk(e).get("targetGlobalKey").next(t=>(K(t!==null),t))}$n(e,t){return Uk(e).put("targetGlobalKey",t)}Un(e,t){return Qa(e).put(o1(this.serializer,t))}Wn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Kn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=us(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return Qa(e).J({range:i,index:"queryTargetsIndex"},(s,a,l)=>{let c=Jc(a);Sd(t,c.target)&&(o=c,l.done())}).next(()=>o)}addMatchingKeys(e,t,r){let i=[],o=qi(e);return t.forEach(s=>{let a=Ut(s.path);i.push(o.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,s))}),M.waitFor(i)}removeMatchingKeys(e,t,r){let i=qi(e);return M.forEach(t,o=>{let s=Ut(o.path);return M.waitFor([i.delete([r,s]),this.referenceDelegate.removeReference(e,r,o)])})}removeMatchingKeysForTargetId(e,t){let r=qi(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=qi(e),o=fe();return i.J({range:r,H:!0},(s,a,l)=>{let c=wr(s[1]),d=new q(c);o=o.add(d)}).next(()=>o)}containsKey(e,t){let r=Ut(t.path),i=IDBKeyRange.bound([r],[uO(r)],!1,!0),o=0;return qi(e).J({index:"documentTargetsIndex",H:!0,range:i},([s,a],l,c)=>{s!==0&&(o++,c.done())}).next(()=>o>0)}ut(e,t){return Qa(e).get(t).next(r=>r?Jc(r):null)}};function Qa(n){return vt(n,"targets")}function Uk(n){return vt(n,"targetGlobal")}function qi(n){return vt(n,"targetDocuments")}function $k([n,e],[t,r]){let i=le(n,t);return i===0?le(e,r):i}var HC=class{constructor(e){this.Gn=e,this.buffer=new Ve($k),this.zn=0}jn(){return++this.zn}Hn(e){let t=[e,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();$k(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Ug=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return this.Jn!==null}Yn(e){k("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>x(this,null,function*(){this.Jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){oo(t)?k("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield io(t)}yield this.Yn(3e5)}))}},qC=class{constructor(e,t){this.Zn=e,this.params=t}calculateTargetCount(e,t){return this.Zn.Xn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return M.resolve(En.oe);let r=new HC(t);return this.Zn.forEachTarget(e,i=>r.Hn(i.sequenceNumber)).next(()=>this.Zn.er(e,i=>r.Hn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Zn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),M.resolve(Bk)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Bk):this.tr(e,t))}getCacheSize(e){return this.Zn.getCacheSize(e)}tr(e,t){let r,i,o,s,a,l,c,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),i=this.params.maximumSequenceNumbersToCollect):i=f,s=Date.now(),this.nthSequenceNumber(e,i))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,t))).next(f=>(o=f,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(c=Date.now(),Ya()<=Dn.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-d}ms
	Determined least recently used ${i} in `+(a-s)+`ms
	Removed ${o} targets in `+(l-a)+`ms
	Removed ${f} documents in `+(c-l)+`ms
Total Duration: ${c-d}ms`),M.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:f})))}};function d1(n,e){return new qC(n,e)}var GC=class{constructor(e,t){this.db=e,this.garbageCollector=d1(this,t)}Xn(e){let t=this.nr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}nr(e){let t=0;return this.er(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}er(e,t){return this.rr(e,(r,i)=>t(i))}addReference(e,t,r){return cg(e,r)}removeReference(e,t,r){return cg(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return cg(e,t)}ir(e,t){return function(i,o){let s=!1;return c1(i).Y(a=>u1(i,a,o).next(l=>(l&&(s=!0),M.resolve(!l)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.rr(e,(s,a)=>{if(a<=t){let l=this.ir(e,s).next(c=>{if(!c)return o++,r.getEntry(e,s).next(()=>(r.removeEntry(s,J.min()),qi(e).delete(function(f){return[0,Ut(f.path)]}(s))))});i.push(l)}}).next(()=>M.waitFor(i)).next(()=>r.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return cg(e,t)}rr(e,t){let r=qi(e),i,o=En.oe;return r.J({index:"documentTargetsIndex"},([s,a],{path:l,sequenceNumber:c})=>{s===0?(o!==En.oe&&t(new q(wr(i)),o),o=c,i=l):o=En.oe}).next(()=>{o!==En.oe&&t(new q(wr(i)),o)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function cg(n,e){return qi(n).put(function(r,i){return{targetId:0,path:Ut(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var $g=class{constructor(){this.changes=new er(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ft.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?M.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var zC=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Xo(e).put(r)}removeEntry(e,t,r){return Xo(e).delete(function(o,s){let a=o.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Og(s),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.sr(e,r)))}getEntry(e,t){let r=ft.newInvalidDocument(t);return Xo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Qc(t))},(i,o)=>{r=this._r(t,o)}).next(()=>r)}ar(e,t){let r={size:0,document:ft.newInvalidDocument(t)};return Xo(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Qc(t))},(i,o)=>{r={document:this._r(t,o),size:jg(o)}}).next(()=>r)}getEntries(e,t){let r=sn();return this.ur(e,t,(i,o)=>{let s=this._r(i,o);r=r.insert(i,s)}).next(()=>r)}cr(e,t){let r=sn(),i=new ze(q.comparator);return this.ur(e,t,(o,s)=>{let a=this._r(o,s);r=r.insert(o,a),i=i.insert(o,jg(s))}).next(()=>({documents:r,lr:i}))}ur(e,t,r){if(t.isEmpty())return M.resolve();let i=new Ve(Gk);t.forEach(l=>i=i.add(l));let o=IDBKeyRange.bound(Qc(i.first()),Qc(i.last())),s=i.getIterator(),a=s.getNext();return Xo(e).J({index:"documentKeyIndex",range:o},(l,c,d)=>{let f=q.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Gk(a,f)<0;)r(a,null),a=s.getNext();a&&a.isEqual(f)&&(r(a,c),a=s.hasNext()?s.getNext():null),a?d.$(Qc(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,o){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),Og(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Xo(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{o?.incrementDocumentReadCount(c.length);let d=sn();for(let f of c){let g=this._r(q.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);g.isFoundDocument()&&(Md(t,g)||i.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,i){let o=sn(),s=qk(t,r),a=qk(t,Ln.max());return Xo(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,a,!0)},(l,c,d)=>{let f=this._r(q.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);o=o.insert(f.key,f),o.size===i&&d.done()}).next(()=>o)}newChangeBuffer(e){return new WC(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Hk(e).get("remoteDocumentGlobalKey").next(t=>(K(!!t),t))}sr(e,t){return Hk(e).put("remoteDocumentGlobalKey",t)}_r(e,t){if(t){let r=S9(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(J.min())))return r}return ft.newInvalidDocument(e)}};function h1(n){return new zC(n)}var WC=class extends $g{constructor(e,t){super(),this.hr=e,this.trackRemovals=t,this.Pr=new er(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Ve((o,s)=>le(o.canonicalString(),s.canonicalString()));return this.changes.forEach((o,s)=>{let a=this.Pr.get(o);if(t.push(this.hr.removeEntry(e,o,a.readTime)),s.isValidDocument()){let l=Rk(this.hr.serializer,s);i=i.add(o.path.popLast());let c=jg(l);r+=c-a.size,t.push(this.hr.addEntry(e,o,l))}else if(r-=a.size,this.trackRemovals){let l=Rk(this.hr.serializer,s.convertToNoDocument(J.min()));t.push(this.hr.addEntry(e,o,l))}}),i.forEach(o=>{t.push(this.hr.indexManager.addToCollectionParentIndex(e,o))}),t.push(this.hr.updateMetadata(e,r)),M.waitFor(t)}getFromCache(e,t){return this.hr.ar(e,t).next(r=>(this.Pr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.hr.cr(e,t).next(({documents:r,lr:i})=>(i.forEach((o,s)=>{this.Pr.set(o,{size:s,readTime:r.get(o).readTime})}),r))}};function Hk(n){return vt(n,"remoteDocumentGlobal")}function Xo(n){return vt(n,"remoteDocumentsV14")}function Qc(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function qk(n,e){let t=e.documentKey.path.toArray();return[n,Og(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Gk(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let o=0;o<t.length-2&&o<r.length-2;++o)if(i=le(t[o],r[o]),i)return i;return i=le(t.length,r.length),i||(i=le(t[t.length-2],r[r.length-2]),i||le(t[t.length-1],r[r.length-1]))}var KC=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Hg=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&td(r.mutation,i,In.empty(),Je.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,fe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=fe()){let i=Er();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let s=Zc();return o.forEach((a,l)=>{s=s.insert(a,l.overlayedDocument)}),s}))}getOverlayedDocuments(e,t){let r=Er();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,fe()))}populateOverlays(e,t,r){let i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((s,a)=>{t.set(s,a)})})}computeViews(e,t,r,i){let o=sn(),s=ed(),a=function(){return ed()}();return t.forEach((l,c)=>{let d=r.get(c.key);i.has(c.key)&&(d===void 0||d.mutation instanceof tr)?o=o.insert(c.key,c):d!==void 0?(s.set(c.key,d.mutation.getFieldMask()),td(d.mutation,c,d.mutation.getFieldMask(),Je.now())):s.set(c.key,In.empty())}),this.recalculateAndSaveOverlays(e,o).next(l=>(l.forEach((c,d)=>s.set(c,d)),t.forEach((c,d)=>{var f;return a.set(c,new KC(d,(f=s.get(c))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,t){let r=ed(),i=new ze((s,a)=>s-a),o=fe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(s=>{for(let a of s)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let d=r.get(l)||In.empty();d=a.applyToLocalView(c,d),r.set(l,d);let f=(i.get(a.batchId)||fe()).add(l);i=i.insert(a.batchId,f)})}).next(()=>{let s=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,d=l.value,f=OO();d.forEach(g=>{if(!o.has(g)){let m=$O(t.get(g),r.get(g));m!==null&&f.set(g,m),o=o.add(g)}}),s.push(this.documentOverlayCache.saveOverlays(e,c,f))}return M.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(s){return q.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):XD(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{let s=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):M.resolve(Er()),a=-1,l=o;return s.next(c=>M.forEach(c,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),o.get(d)?M.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{l=l.insert(d,g)}))).next(()=>this.populateOverlays(e,c,o)).next(()=>this.computeViews(e,l,c,fe())).next(d=>({batchId:a,changes:kO(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new q(t)).next(r=>{let i=Zc();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let o=t.collectionGroup,s=Zc();return this.indexManager.getCollectionParents(e,o).next(a=>M.forEach(a,l=>{let c=function(f,g){return new Xn(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(t,l.child(o));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(d=>{d.forEach((f,g)=>{s=s.insert(f,g)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(o=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(s=>{o.forEach((l,c)=>{let d=c.getKey();s.get(d)===null&&(s=s.insert(d,ft.newInvalidDocument(d)))});let a=Zc();return s.forEach((l,c)=>{let d=o.get(l);d!==void 0&&td(d.mutation,c,In.empty(),Je.now()),Md(t,c)&&(a=a.insert(l,c))}),a})}};var QC=class{constructor(e){this.serializer=e,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(e,t){return M.resolve(this.Tr.get(t))}saveBundleMetadata(e,t){return this.Tr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:at(i.createTime)}}(t)),M.resolve()}getNamedQuery(e,t){return M.resolve(this.Ir.get(t))}saveNamedQuery(e,t){return this.Ir.set(t.name,function(i){return{name:i.name,query:rT(i.bundledQuery),readTime:at(i.readTime)}}(t)),M.resolve()}};var YC=class{constructor(){this.overlays=new ze(q.comparator),this.dr=new Map}getOverlay(e,t){return M.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Er();return M.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.Tt(e,t,o)}),M.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.dr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.dr.delete(r)),M.resolve()}getOverlaysForCollection(e,t,r){let i=Er(),o=t.length+1,s=new q(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===o&&l.largestBatchId>r&&i.set(l.getKey(),l)}return M.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new ze((c,d)=>c-d),s=this.overlays.getIterator();for(;s.hasNext();){let c=s.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let d=o.get(c.largestBatchId);d===null&&(d=Er(),o=o.insert(c.largestBatchId,d)),d.set(c.getKey(),c)}}let a=Er(),l=o.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,d)=>a.set(c,d)),!(a.size()>=i)););return M.resolve(a)}Tt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let s=this.dr.get(i.largestBatchId).delete(r.key);this.dr.set(i.largestBatchId,s)}this.overlays=this.overlays.insert(r.key,new hd(t,r));let o=this.dr.get(t);o===void 0&&(o=fe(),this.dr.set(t,o)),this.dr.set(t,o.add(r.key))}};var ZC=class{constructor(){this.sessionToken=lt.EMPTY_BYTE_STRING}getSessionToken(e){return M.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,M.resolve()}};var _d=class{constructor(){this.Er=new Ve(dt.Ar),this.Rr=new Ve(dt.Vr)}isEmpty(){return this.Er.isEmpty()}addReference(e,t){let r=new dt(e,t);this.Er=this.Er.add(r),this.Rr=this.Rr.add(r)}mr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.gr(new dt(e,t))}pr(e,t){e.forEach(r=>this.removeReference(r,t))}yr(e){let t=new q(new Ae([])),r=new dt(t,e),i=new dt(t,e+1),o=[];return this.Rr.forEachInRange([r,i],s=>{this.gr(s),o.push(s.key)}),o}wr(){this.Er.forEach(e=>this.gr(e))}gr(e){this.Er=this.Er.delete(e),this.Rr=this.Rr.delete(e)}Sr(e){let t=new q(new Ae([])),r=new dt(t,e),i=new dt(t,e+1),o=fe();return this.Rr.forEachInRange([r,i],s=>{o=o.add(s.key)}),o}containsKey(e){let t=new dt(e,0),r=this.Er.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},dt=class{constructor(e,t){this.key=e,this.br=t}static Ar(e,t){return q.comparator(e.key,t.key)||le(e.br,t.br)}static Vr(e,t){return le(e.br,t.br)||q.comparator(e.key,t.key)}};var JC=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Dr=1,this.vr=new Ve(dt.Ar)}checkEmpty(e){return M.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let o=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new dd(o,t,r,i);this.mutationQueue.push(s);for(let a of i)this.vr=this.vr.add(new dt(a.key,o)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return M.resolve(s)}lookupMutationBatch(e,t){return M.resolve(this.Cr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Fr(r),o=i<0?0:i;return M.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return M.resolve(this.mutationQueue.length===0?-1:this.Dr-1)}getAllMutationBatches(e){return M.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new dt(t,0),i=new dt(t,Number.POSITIVE_INFINITY),o=[];return this.vr.forEachInRange([r,i],s=>{let a=this.Cr(s.br);o.push(a)}),M.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ve(le);return t.forEach(i=>{let o=new dt(i,0),s=new dt(i,Number.POSITIVE_INFINITY);this.vr.forEachInRange([o,s],a=>{r=r.add(a.br)})}),M.resolve(this.Mr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,o=r;q.isDocumentKey(o)||(o=o.child(""));let s=new dt(new q(o),0),a=new Ve(le);return this.vr.forEachWhile(l=>{let c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(l.br)),!0)},s),M.resolve(this.Mr(a))}Mr(e){let t=[];return e.forEach(r=>{let i=this.Cr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){K(this.Or(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.vr;return M.forEach(t.mutations,i=>{let o=new dt(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.vr=r})}Bn(e){}containsKey(e,t){let r=new dt(t,0),i=this.vr.firstAfterOrEqual(r);return M.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,M.resolve()}Or(e,t){return this.Fr(e)}Fr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Cr(e){let t=this.Fr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var XC=class{constructor(e){this.Nr=e,this.docs=function(){return new ze(q.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),o=i?i.size:0,s=this.Nr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return M.resolve(r?r.document.mutableCopy():ft.newInvalidDocument(t))}getEntries(e,t){let r=sn();return t.forEach(i=>{let o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():ft.newInvalidDocument(i))}),M.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=sn(),s=t.path,a=new q(s.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:d}}=l.getNext();if(!s.isPrefixOf(c.path))break;c.path.length>s.length+1||QD(dO(d),r)<=0||(i.has(d.key)||Md(t,d))&&(o=o.insert(d.key,d.mutableCopy()))}return M.resolve(o)}getAllFromCollectionGroup(e,t,r,i){G()}Br(e,t){return M.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new eD(this)}getSize(e){return M.resolve(this.size)}},eD=class extends $g{constructor(e){super(),this.hr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.hr.addEntry(e,i)):this.hr.removeEntry(r)}),M.waitFor(t)}getFromCache(e,t){return this.hr.getEntry(e,t)}getAllFromCache(e,t){return this.hr.getEntries(e,t)}};var tD=class{constructor(e){this.persistence=e,this.Lr=new er(t=>us(t),Sd),this.lastRemoteSnapshotVersion=J.min(),this.highestTargetId=0,this.kr=0,this.qr=new _d,this.targetCount=0,this.Qr=fl.qn()}forEachTarget(e,t){return this.Lr.forEach((r,i)=>t(i)),M.resolve()}getLastRemoteSnapshotVersion(e){return M.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return M.resolve(this.kr)}allocateTargetId(e){return this.highestTargetId=this.Qr.next(),M.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.kr&&(this.kr=t),M.resolve()}Un(e){this.Lr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Qr=new fl(t),this.highestTargetId=t),e.sequenceNumber>this.kr&&(this.kr=e.sequenceNumber)}addTargetData(e,t){return this.Un(t),this.targetCount+=1,M.resolve()}updateTargetData(e,t){return this.Un(t),M.resolve()}removeTargetData(e,t){return this.Lr.delete(t.target),this.qr.yr(t.targetId),this.targetCount-=1,M.resolve()}removeTargets(e,t,r){let i=0,o=[];return this.Lr.forEach((s,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Lr.delete(s),o.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),M.waitFor(o).next(()=>i)}getTargetCount(e){return M.resolve(this.targetCount)}getTargetData(e,t){let r=this.Lr.get(t)||null;return M.resolve(r)}addMatchingKeys(e,t,r){return this.qr.mr(t,r),M.resolve()}removeMatchingKeys(e,t,r){this.qr.pr(t,r);let i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(s=>{o.push(i.markPotentiallyOrphaned(e,s))}),M.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.qr.yr(t),M.resolve()}getMatchingKeysForTargetId(e,t){let r=this.qr.Sr(t);return M.resolve(r)}containsKey(e,t){return M.resolve(this.qr.containsKey(t))}};var vd=class{constructor(e,t){this.Kr={},this.overlays={},this.$r=new En(0),this.Ur=!1,this.Ur=!0,this.Wr=new ZC,this.referenceDelegate=e(this),this.Gr=new tD(this),this.indexManager=new BC,this.remoteDocumentCache=function(i){return new XC(i)}(r=>this.referenceDelegate.zr(r)),this.serializer=new kg(t),this.jr=new QC(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new YC,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Kr[e.toKey()];return r||(r=new JC(t,this.referenceDelegate),this.Kr[e.toKey()]=r),r}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(e,t,r){k("MemoryPersistence","Starting transaction:",e);let i=new nD(this.$r.next());return this.referenceDelegate.Hr(),r(i).next(o=>this.referenceDelegate.Jr(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Yr(e,t){return M.or(Object.values(this.Kr).map(r=>()=>r.containsKey(e,t)))}},nD=class extends Ig{constructor(e){super(),this.currentSequenceNumber=e}},qg=class n{constructor(e){this.persistence=e,this.Zr=new _d,this.Xr=null}static ei(e){return new n(e)}get ti(){if(this.Xr)return this.Xr;throw G()}addReference(e,t,r){return this.Zr.addReference(r,t),this.ti.delete(r.toString()),M.resolve()}removeReference(e,t,r){return this.Zr.removeReference(r,t),this.ti.add(r.toString()),M.resolve()}markPotentiallyOrphaned(e,t){return this.ti.add(t.toString()),M.resolve()}removeTarget(e,t){this.Zr.yr(t.targetId).forEach(i=>this.ti.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.ti.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Hr(){this.Xr=new Set}Jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return M.forEach(this.ti,r=>{let i=q.fromPath(r);return this.ni(e,i).next(o=>{o||t.removeEntry(i,J.min())})}).next(()=>(this.Xr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ni(e,t).next(r=>{r?this.ti.delete(t.toString()):this.ti.add(t.toString())})}zr(e){return 0}ni(e,t){return M.or([()=>M.resolve(this.Zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Yr(e,t)])}},Gg=class n{constructor(e,t){this.persistence=e,this.ri=new er(r=>Ut(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=d1(this,t)}static ei(e,t){return new n(e,t)}Hr(){}Jr(e){return M.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}Xn(e){let t=this.nr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}nr(e){let t=0;return this.er(e,r=>{t++}).next(()=>t)}er(e,t){return M.forEach(this.ri,(r,i)=>this.ir(e,r,i).next(o=>o?M.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.Br(e,s=>this.ir(e,s,t).next(a=>{a||(r++,o.removeEntry(s,J.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.ri.set(t,e.currentSequenceNumber),M.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.ri.set(r,e.currentSequenceNumber),M.resolve()}removeReference(e,t,r){return this.ri.set(r,e.currentSequenceNumber),M.resolve()}updateLimboDocument(e,t){return this.ri.set(t,e.currentSequenceNumber),M.resolve()}zr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=gg(e.data.value)),t}ir(e,t,r){return M.or([()=>this.persistence.Yr(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.ri.get(t);return M.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var rD=class{constructor(e){this.serializer=e}O(e,t,r,i){let o=new Cg("createOrUpgrade",t);r<1&&i>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",lk,{unique:!0}),l.createObjectStore("documentMutations")}(e),zk(e),function(l){l.createObjectStore("remoteDocuments")}(e));let s=M.resolve();return r<3&&i>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),zk(e)),s=s.next(()=>function(l){let c=l.store("targetGlobal"),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:J.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",d)}(o))),r<4&&i>=4&&(r!==0&&(s=s.next(()=>function(l,c){return c.store("mutations").U().next(d=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",lk,{unique:!0});let f=c.store("mutations"),g=d.map(m=>f.put(m));return M.waitFor(g)})}(e,o))),s=s.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(s=s.next(()=>this.ii(o))),r<6&&i>=6&&(s=s.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.si(o)))),r<7&&i>=7&&(s=s.next(()=>this.oi(o))),r<8&&i>=8&&(s=s.next(()=>this._i(e,o))),r<9&&i>=9&&(s=s.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(s=s.next(()=>this.ai(o))),r<11&&i>=11&&(s=s.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(s=s.next(()=>{(function(l){let c=l.createObjectStore("documentOverlays",{keyPath:WW});c.createIndex("collectionPathOverlayIndex",KW,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",QW,{unique:!1})})(e)})),r<13&&i>=13&&(s=s.next(()=>function(l){let c=l.createObjectStore("remoteDocumentsV14",{keyPath:FW});c.createIndex("documentKeyIndex",VW),c.createIndex("collectionGroupIndex",LW)}(e)).next(()=>this.ui(e,o)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(s=s.next(()=>this.ci(e,o))),r<15&&i>=15&&(s=s.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:HW}).createIndex("sequenceNumberIndex",qW,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:GW}).createIndex("documentKeyIndex",zW,{unique:!1})}(e))),r<16&&i>=16&&(s=s.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&i>=17&&(s=s.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),s}si(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=jg(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ii(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>M.forEach(i,o=>{let s=IDBKeyRange.bound([o.userId,-1],[o.userId,o.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",s).next(a=>M.forEach(a,l=>{K(l.userId===o.userId);let c=ns(this.serializer,l);return l1(e,o.userId,c).next(()=>{})}))}))}oi(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let o=[];return r.J((s,a)=>{let l=new Ae(s),c=function(f){return[0,Ut(f)]}(l);o.push(t.get(c).next(d=>d?M.resolve():(f=>t.put({targetId:0,path:Ut(f),sequenceNumber:i.highestListenSequenceNumber}))(l)))}).next(()=>M.waitFor(o))})}_i(e,t){e.createObjectStore("collectionParents",{keyPath:$W});let r=t.store("collectionParents"),i=new yd,o=s=>{if(i.add(s)){let a=s.lastSegment(),l=s.popLast();return r.put({collectionId:a,parent:Ut(l)})}};return t.store("remoteDocuments").J({H:!0},(s,a)=>{let l=new Ae(s);return o(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([s,a,l],c)=>{let d=wr(a);return o(d.popLast())}))}ai(e){let t=e.store("targets");return t.J((r,i)=>{let o=Jc(i),s=o1(this.serializer,o);return t.put(s)})}ui(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((o,s)=>{let a=t.store("remoteDocumentsV14"),l=function(f){return f.document?new q(Ae.fromString(f.document.name).popFirst(5)):f.noDocument?q.fromSegments(f.noDocument.path):f.unknownDocument?q.fromSegments(f.unknownDocument.path):G()}(s).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:s.readTime||[0,0],unknownDocument:s.unknownDocument,noDocument:s.noDocument,document:s.document,hasCommittedMutations:!!s.hasCommittedMutations};i.push(a.put(c))}).next(()=>M.waitFor(i))}ci(e,t){let r=t.store("mutations"),i=h1(this.serializer),o=new vd(qg.ei,this.serializer.ht);return r.U().next(s=>{let a=new Map;return s.forEach(l=>{var c;let d=(c=a.get(l.userId))!==null&&c!==void 0?c:fe();ns(this.serializer,l).keys().forEach(f=>d=d.add(f)),a.set(l.userId,d)}),M.forEach(a,(l,c)=>{let d=new ht(c),f=Fg.Pt(this.serializer,d),g=o.getIndexManager(d),m=Bg.Pt(d,this.serializer,g,o.referenceDelegate);return new Hg(i,m,f,g).recalculateAndSaveOverlaysForDocumentKeys(new sd(t,En.oe),l).next()})})}};function zk(n){n.createObjectStore("targetDocuments",{keyPath:BW}).createIndex("documentTargetsIndex",UW,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",jW,{unique:!0}),n.createObjectStore("targetGlobal")}var zI="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",iD=class n{constructor(e,t,r,i,o,s,a,l,c,d,f=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.li=o,this.window=s,this.document=a,this.hi=c,this.Pi=d,this.Ti=f,this.$r=null,this.Ur=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ii=null,this.inForeground=!1,this.di=null,this.Ei=null,this.Ai=Number.NEGATIVE_INFINITY,this.Ri=g=>Promise.resolve(),!n.p())throw new P(N.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new GC(this,i),this.Vi=t+"main",this.serializer=new kg(l),this.mi=new Qi(this.Vi,this.Ti,new rD(this.serializer)),this.Wr=new PC,this.Gr=new $C(this.referenceDelegate,this.serializer),this.remoteDocumentCache=h1(this.serializer),this.jr=new NC,this.window&&this.window.localStorage?this.fi=this.window.localStorage:(this.fi=null,d===!1&&ot("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.gi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new P(N.FAILED_PRECONDITION,zI);return this.pi(),this.yi(),this.wi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Gr.getHighestSequenceNumber(e))}).then(e=>{this.$r=new En(e,this.hi)}).then(()=>{this.Ur=!0}).catch(e=>(this.mi&&this.mi.close(),Promise.reject(e)))}Si(e){return this.Ri=t=>x(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.mi.B(t=>x(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.li.enqueueAndForget(()=>x(this,null,function*(){this.started&&(yield this.gi())})))}gi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>dg(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.bi(e).next(t=>{t||(this.isPrimary=!1,this.li.enqueueRetryable(()=>this.Ri(!1)))})}).next(()=>this.Di(e)).next(t=>this.isPrimary&&!t?this.vi(e).next(()=>!1):!!t&&this.Ci(e).next(()=>!0))).catch(e=>{if(oo(e))return k("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return k("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.li.enqueueRetryable(()=>this.Ri(e)),this.isPrimary=e})}bi(e){return Yc(e).get("owner").next(t=>M.resolve(this.Fi(t)))}Mi(e){return dg(e).delete(this.clientId)}xi(){return x(this,null,function*(){if(this.isPrimary&&!this.Oi(this.Ai,18e5)){this.Ai=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=vt(t,"clientMetadata");return r.U().next(i=>{let o=this.Ni(i,18e5),s=i.filter(a=>o.indexOf(a)===-1);return M.forEach(s,a=>r.delete(a.clientId)).next(()=>s)})}).catch(()=>[]);if(this.fi)for(let t of e)this.fi.removeItem(this.Bi(t.clientId))}})}wi(){this.Ei=this.li.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.gi().then(()=>this.xi()).then(()=>this.wi()))}Fi(e){return!!e&&e.ownerId===this.clientId}Di(e){return this.Pi?M.resolve(!0):Yc(e).get("owner").next(t=>{if(t!==null&&this.Oi(t.leaseTimestampMs,5e3)&&!this.Li(t.ownerId)){if(this.Fi(t)&&this.networkEnabled)return!0;if(!this.Fi(t)){if(!t.allowTabSynchronization)throw new P(N.FAILED_PRECONDITION,zI);return!1}}return!(!this.networkEnabled||!this.inForeground)||dg(e).U().next(r=>this.Ni(r,5e3).find(i=>{if(this.clientId!==i.clientId){let o=!this.networkEnabled&&i.networkEnabled,s=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(o||s&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&k("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return x(this,null,function*(){this.Ur=!1,this.ki(),this.Ei&&(this.Ei.cancel(),this.Ei=null),this.qi(),this.Qi(),yield this.mi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new sd(e,En.oe);return this.vi(t).next(()=>this.Mi(t))}),this.mi.close(),this.Ki()})}Ni(e,t){return e.filter(r=>this.Oi(r.updateTimeMs,t)&&!this.Li(r.clientId))}$i(){return this.runTransaction("getActiveClients","readonly",e=>dg(e).U().next(t=>this.Ni(t,18e5).map(r=>r.clientId)))}get started(){return this.Ur}getGlobalsCache(){return this.Wr}getMutationQueue(e,t){return Bg.Pt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new UC(e,this.serializer.ht.databaseId)}getDocumentOverlayCache(e){return Fg.Pt(this.serializer,e)}getBundleCache(){return this.jr}runTransaction(e,t,r){k("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",o=function(l){return l===17?JW:l===16?ZW:l===15?ZD:l===14?_O:l===13?yO:l===12?YW:l===11?mO:void G()}(this.Ti),s;return this.mi.runTransaction(e,i,o,a=>(s=new sd(a,this.$r?this.$r.next():En.oe),t==="readwrite-primary"?this.bi(s).next(l=>!!l||this.Di(s)).next(l=>{if(!l)throw ot(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.li.enqueueRetryable(()=>this.Ri(!1)),new P(N.FAILED_PRECONDITION,hO);return r(s)}).next(l=>this.Ci(s).next(()=>l)):this.Ui(s).next(()=>r(s)))).then(a=>(s.raiseOnCommittedEvent(),a))}Ui(e){return Yc(e).get("owner").next(t=>{if(t!==null&&this.Oi(t.leaseTimestampMs,5e3)&&!this.Li(t.ownerId)&&!this.Fi(t)&&!(this.Pi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new P(N.FAILED_PRECONDITION,zI)})}Ci(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Yc(e).put("owner",t)}static p(){return Qi.p()}vi(e){let t=Yc(e);return t.get("owner").next(r=>this.Fi(r)?(k("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):M.resolve())}Oi(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(ot(`Detected an update time that is in the future: ${e} > ${r}`),!1))}pi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.di=()=>{this.li.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.gi()))},this.document.addEventListener("visibilitychange",this.di),this.inForeground=this.document.visibilityState==="visible")}qi(){this.di&&(this.document.removeEventListener("visibilitychange",this.di),this.di=null)}yi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Ii=()=>{this.ki();let t=/(?:Version|Mobile)\/1[456]/;ay()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.li.enterRestrictedMode(!0),this.li.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ii))}Qi(){this.Ii&&(this.window.removeEventListener("pagehide",this.Ii),this.Ii=null)}Li(e){var t;try{let r=((t=this.fi)===null||t===void 0?void 0:t.getItem(this.Bi(e)))!==null;return k("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ot("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}ki(){if(this.fi)try{this.fi.setItem(this.Bi(this.clientId),String(Date.now()))}catch(e){ot("Failed to set zombie client id.",e)}}Ki(){if(this.fi)try{this.fi.removeItem(this.Bi(this.clientId))}catch{}}Bi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Yc(n){return vt(n,"owner")}function dg(n){return vt(n,"clientMetadata")}function oT(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var oD=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Wi=r,this.Gi=i}static zi(e,t){let r=fe(),i=fe();for(let o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new n(e,t.fromCache,r,i)}};var sD=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var zg=class{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return ay()?8:fO(Zl())>0?6:4}()}initialize(e,t){this.Zi=e,this.indexManager=t,this.ji=!0}getDocumentsMatchingQuery(e,t,r,i){let o={result:null};return this.Xi(e,t).next(s=>{o.result=s}).next(()=>{if(!o.result)return this.es(e,t,i,r).next(s=>{o.result=s})}).next(()=>{if(o.result)return;let s=new sD;return this.ts(e,t,s).next(a=>{if(o.result=a,this.Hi)return this.ns(e,t,s,a.size)})}).next(()=>o.result)}ns(e,t,r,i){return r.documentReadCount<this.Ji?(Ya()<=Dn.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",Za(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),M.resolve()):(Ya()<=Dn.DEBUG&&k("QueryEngine","Query:",Za(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Yi*i?(Ya()<=Dn.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",Za(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Jt(t))):M.resolve())}Xi(e,t){if(wk(t))return M.resolve(null);let r=Jt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Rg(t,null,"F"),r=Jt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{let s=fe(...o);return this.Zi.getDocuments(e,s).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.rs(t,a);return this.ss(t,c,s,l.readTime)?this.Xi(e,Rg(t,null,"F")):this.os(e,c,t,l)}))})))}es(e,t,r,i){return wk(t)||i.isEqual(J.min())?M.resolve(null):this.Zi.getDocuments(e,r).next(o=>{let s=this.rs(t,o);return this.ss(t,s,r,i)?M.resolve(null):(Ya()<=Dn.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Za(t)),this.os(e,s,t,cO(i,-1)).next(a=>a))})}rs(e,t){let r=new Ve(NO(e));return t.forEach((i,o)=>{Md(e,o)&&(r=r.add(o))}),r}ss(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}ts(e,t,r){return Ya()<=Dn.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",Za(t)),this.Zi.getDocumentsMatchingQuery(e,t,Ln.min(),r)}os(e,t,r,i){return this.Zi.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(s=>{o=o.insert(s.key,s)}),o))}};var aD=class{constructor(e,t,r,i){this.persistence=e,this._s=t,this.serializer=i,this.us=new ze(le),this.cs=new er(o=>us(o),Sd),this.ls=new Map,this.hs=e.getRemoteDocumentCache(),this.Gr=e.getTargetCache(),this.jr=e.getBundleCache(),this.Ps(r)}Ps(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Hg(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.us))}};function f1(n,e,t,r){return new aD(n,e,t,r)}function p1(n,e){return x(this,null,function*(){let t=H(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.Ps(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let s=[],a=[],l=fe();for(let c of i){s.push(c.batchId);for(let d of c.mutations)l=l.add(d.key)}for(let c of o){a.push(c.batchId);for(let d of c.mutations)l=l.add(d.key)}return t.localDocuments.getDocuments(r,l).next(c=>({Ts:c,removedBatchIds:s,addedBatchIds:a}))})})})}function R9(n,e){let t=H(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),o=t.hs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,d){let f=c.batch,g=f.keys(),m=M.resolve();return g.forEach(v=>{m=m.next(()=>d.getEntry(l,v)).next(T=>{let S=c.docVersions.get(v);K(S!==null),T.version.compareTo(S)<0&&(f.applyToRemoteDocument(T,c),T.isValidDocument()&&(T.setReadTime(c.commitVersion),d.addEntry(T)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(l,f))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=fe();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function g1(n){let e=H(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Gr.getLastRemoteSnapshotVersion(t))}function x9(n,e){let t=H(n),r=e.snapshotVersion,i=t.us;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let s=t.hs.newChangeBuffer({trackRemovals:!0});i=t.us;let a=[];e.targetChanges.forEach((d,f)=>{let g=i.get(f);if(!g)return;a.push(t.Gr.removeMatchingKeys(o,d.removedDocuments,f).next(()=>t.Gr.addMatchingKeys(o,d.addedDocuments,f)));let m=g.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(f)!==null?m=m.withResumeToken(lt.EMPTY_BYTE_STRING,J.min()).withLastLimboFreeSnapshotVersion(J.min()):d.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(d.resumeToken,r)),i=i.insert(f,m),function(T,S,O){return T.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=3e8?!0:O.addedDocuments.size+O.modifiedDocuments.size+O.removedDocuments.size>0}(g,m,d)&&a.push(t.Gr.updateTargetData(o,m))});let l=sn(),c=fe();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(o,d))}),a.push(m1(o,s,e.documentUpdates).next(d=>{l=d.Is,c=d.ds})),!r.isEqual(J.min())){let d=t.Gr.getLastRemoteSnapshotVersion(o).next(f=>t.Gr.setTargetsMetadata(o,o.currentSequenceNumber,r));a.push(d)}return M.waitFor(a).next(()=>s.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,l,c)).next(()=>l)}).then(o=>(t.us=i,o))}function m1(n,e,t){let r=fe(),i=fe();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let s=sn();return t.forEach((a,l)=>{let c=o.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(J.min())?(e.removeEntry(a,l.readTime),s=s.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),s=s.insert(a,l)):k("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Is:s,ds:i}})}function N9(n,e){let t=H(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function pl(n,e){let t=H(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Gr.getTargetData(r,e).next(o=>o?(i=o,M.resolve(i)):t.Gr.allocateTargetId(r).next(s=>(i=new hl(e,s,"TargetPurposeListen",r.currentSequenceNumber),t.Gr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.us.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.us=t.us.insert(r.targetId,r),t.cs.set(e,r.targetId)),r})}function gl(n,e,t){return x(this,null,function*(){let r=H(n),i=r.us.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",o,s=>r.persistence.referenceDelegate.removeTarget(s,i)))}catch(s){if(!oo(s))throw s;k("LocalStore",`Failed to update sequence numbers for target ${e}: ${s}`)}r.us=r.us.remove(e),r.cs.delete(i.target)})}function Wg(n,e,t){let r=H(n),i=J.min(),o=fe();return r.persistence.runTransaction("Execute query","readwrite",s=>function(l,c,d){let f=H(l),g=f.cs.get(d);return g!==void 0?M.resolve(f.us.get(g)):f.Gr.getTargetData(c,d)}(r,s,Jt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Gr.getMatchingKeysForTargetId(s,a.targetId).next(l=>{o=l})}).next(()=>r._s.getDocumentsMatchingQuery(s,e,t?i:J.min(),t?o:fe())).next(a=>(v1(r,xO(e),a),{documents:a,Es:o})))}function y1(n,e){let t=H(n),r=H(t.Gr),i=t.us.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",o=>r.ut(o,e).next(s=>s?s.target:null))}function _1(n,e){let t=H(n),r=t.ls.get(e)||J.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.hs.getAllFromCollectionGroup(i,e,cO(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(v1(t,e,i),i))}function v1(n,e,t){let r=n.ls.get(e)||J.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.ls.set(e,r)}function P9(n,e,t,r){return x(this,null,function*(){let i=H(n),o=fe(),s=sn();for(let c of t){let d=e.As(c.metadata.name);c.document&&(o=o.add(d));let f=e.Rs(c);f.setReadTime(e.Vs(c.metadata.readTime)),s=s.insert(d,f)}let a=i.hs.newChangeBuffer({trackRemovals:!0}),l=yield pl(i,function(d){return Jt(Cl(Ae.fromString(`__bundle__/docs/${d}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>m1(c,a,s).next(d=>(a.apply(c),d)).next(d=>i.Gr.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.Gr.addMatchingKeys(c,o,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,d.Is,d.ds)).next(()=>d.Is)))})}function k9(r,i){return x(this,arguments,function*(n,e,t=fe()){let o=yield pl(n,Jt(rT(e.bundledQuery))),s=H(n);return s.persistence.runTransaction("Save named query","readwrite",a=>{let l=at(e.readTime);if(o.snapshotVersion.compareTo(l)>=0)return s.jr.saveNamedQuery(a,e);let c=o.withResumeToken(lt.EMPTY_BYTE_STRING,l);return s.us=s.us.insert(c.targetId,c),s.Gr.updateTargetData(a,c).next(()=>s.Gr.removeMatchingKeysForTargetId(a,o.targetId)).next(()=>s.Gr.addMatchingKeys(a,t,o.targetId)).next(()=>s.jr.saveNamedQuery(a,e))})})}function Wk(n,e){return`firestore_clients_${n}_${e}`}function Kk(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function WI(n,e){return`firestore_targets_${n}_${e}`}var Kg=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fs(e,t,r){let i=JSON.parse(r),o,s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new P(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(ot("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},nd=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fs(e,t){let r=JSON.parse(t),i,o=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return o&&r.error&&(o=typeof r.error.message=="string"&&typeof r.error.code=="string",o&&(i=new P(r.error.code,r.error.message))),o?new n(e,r.state,i):(ot("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Qg=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fs(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,o=eT();for(let s=0;i&&s<r.activeTargetIds.length;++s)i=pO(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new n(e,o):(ot("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},lD=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(ot("SharedClientState",`Failed to parse online state: ${e}`),null)}},wd=class{constructor(){this.activeTargetIds=eT()}ps(e){this.activeTargetIds=this.activeTargetIds.add(e)}ys(e){this.activeTargetIds=this.activeTargetIds.delete(e)}gs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},rd=class{constructor(e,t,r,i,o){this.window=e,this.li=t,this.persistenceKey=r,this.ws=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ss=this.bs.bind(this),this.Ds=new ze(le),this.started=!1,this.vs=[];let s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=o,this.Cs=Wk(this.persistenceKey,this.ws),this.Fs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ds=this.Ds.insert(this.ws,new wd),this.Ms=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.xs=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Os=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.Ns=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Bs=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.Ss)}static p(e){return!(!e||!e.localStorage)}start(){return x(this,null,function*(){let e=yield this.syncEngine.$i();for(let r of e){if(r===this.ws)continue;let i=this.getItem(Wk(this.persistenceKey,r));if(i){let o=Qg.fs(r,i);o&&(this.Ds=this.Ds.insert(o.clientId,o))}}this.Ls();let t=this.storage.getItem(this.Ns);if(t){let r=this.ks(t);r&&this.qs(r)}for(let r of this.vs)this.bs(r);this.vs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.Fs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Qs(this.Ds)}isActiveQueryTarget(e){let t=!1;return this.Ds.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ks(e,"pending")}updateMutationState(e,t,r){this.Ks(e,t,r),this.$s(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(WI(this.persistenceKey,e));if(i){let o=nd.fs(e,i);o&&(r=o.state)}}return t&&this.Us.ps(e),this.Ls(),r}removeLocalQueryTarget(e){this.Us.ys(e),this.Ls()}isLocalQueryTarget(e){return this.Us.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(WI(this.persistenceKey,e))}updateQueryState(e,t,r){this.Ws(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.$s(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Gs(e)}notifyBundleLoaded(e){this.zs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ss),this.removeItem(this.Cs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return k("SharedClientState","READ",e,t),t}setItem(e,t){k("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){k("SharedClientState","REMOVE",e),this.storage.removeItem(e)}bs(e){let t=e;if(t.storageArea===this.storage){if(k("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Cs)return void ot("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.li.enqueueRetryable(()=>x(this,null,function*(){if(this.started){if(t.key!==null){if(this.Ms.test(t.key)){if(t.newValue==null){let r=this.js(t.key);return this.Hs(r,null)}{let r=this.Js(t.key,t.newValue);if(r)return this.Hs(r.clientId,r)}}else if(this.xs.test(t.key)){if(t.newValue!==null){let r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(this.Os.test(t.key)){if(t.newValue!==null){let r=this.Xs(t.key,t.newValue);if(r)return this.eo(r)}}else if(t.key===this.Ns){if(t.newValue!==null){let r=this.ks(t.newValue);if(r)return this.qs(r)}}else if(t.key===this.Fs){let r=function(o){let s=En.oe;if(o!=null)try{let a=JSON.parse(o);K(typeof a=="number"),s=a}catch(a){ot("SharedClientState","Failed to read sequence number from WebStorage",a)}return s}(t.newValue);r!==En.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Bs){let r=this.no(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.ro(i)))}}}else this.vs.push(t)}))}}get Us(){return this.Ds.get(this.ws)}Ls(){this.setItem(this.Cs,this.Us.gs())}Ks(e,t,r){let i=new Kg(this.currentUser,e,t,r),o=Kk(this.persistenceKey,this.currentUser,e);this.setItem(o,i.gs())}$s(e){let t=Kk(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Gs(e){let t={clientId:this.ws,onlineState:e};this.storage.setItem(this.Ns,JSON.stringify(t))}Ws(e,t,r){let i=WI(this.persistenceKey,e),o=new nd(e,t,r);this.setItem(i,o.gs())}zs(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Bs,t)}js(e){let t=this.Ms.exec(e);return t?t[1]:null}Js(e,t){let r=this.js(e);return Qg.fs(r,t)}Ys(e,t){let r=this.xs.exec(e),i=Number(r[1]),o=r[2]!==void 0?r[2]:null;return Kg.fs(new ht(o),i,t)}Xs(e,t){let r=this.Os.exec(e),i=Number(r[1]);return nd.fs(i,t)}ks(e){return lD.fs(e)}no(e){return JSON.parse(e)}Zs(e){return x(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.io(e.batchId,e.state,e.error);k("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}eo(e){return this.syncEngine.so(e.targetId,e.state,e.error)}Hs(e,t){let r=t?this.Ds.insert(e,t):this.Ds.remove(e),i=this.Qs(this.Ds),o=this.Qs(r),s=[],a=[];return o.forEach(l=>{i.has(l)||s.push(l)}),i.forEach(l=>{o.has(l)||a.push(l)}),this.syncEngine.oo(s,a).then(()=>{this.Ds=r})}qs(e){this.Ds.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Qs(e){let t=eT();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Yg=class{constructor(){this._o=new wd,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this._o.ps(e),this.ao[e]||"not-current"}updateQueryState(e,t,r){this.ao[e]=t}removeLocalQueryTarget(e){this._o.ys(e)}isLocalQueryTarget(e){return this._o.activeTargetIds.has(e)}clearQueryState(e){delete this.ao[e]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(e){return this._o.activeTargetIds.has(e)}start(){return this._o=new wd,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var uD=class{uo(e){}shutdown(){}};var Zg=class{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(e){this.To.push(e)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){k("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.To)e(0)}Po(){k("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.To)e(1)}static p(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var hg=null;function KI(){return hg===null?hg=function(){return 268435456+Math.round(2147483648*Math.random())}():hg++,"0x"+hg.toString(16)}var O9={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var cD=class{constructor(e){this.Eo=e.Eo,this.Ao=e.Ao}Ro(e){this.Vo=e}mo(e){this.fo=e}po(e){this.yo=e}onMessage(e){this.wo=e}close(){this.Ao()}send(e){this.Eo(e)}So(){this.Vo()}bo(){this.fo()}Do(e){this.yo(e)}vo(e){this.wo(e)}};var jt="WebChannelConnection",dD=class extends class{get Co(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),o=encodeURIComponent(this.databaseId.database);this.Fo=r+"://"+t.host,this.Mo=`projects/${i}/databases/${o}`,this.xo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${o}`}Oo(t,r,i,o,s){let a=KI(),l=this.No(t,r.toUriEncodedString());k("RestConnection",`Sending RPC '${t}' ${a}:`,l,i);let c={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Bo(c,o,s),this.Lo(t,l,c,i).then(d=>(k("RestConnection",`Received RPC '${t}' ${a}: `,d),d),d=>{throw Jn("RestConnection",`RPC '${t}' ${a} failed with error: `,d,"url: ",l,"request:",i),d})}ko(t,r,i,o,s,a){return this.Oo(t,r,i,o,s)}Bo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Il}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((o,s)=>t[s]=o),i&&i.headers.forEach((o,s)=>t[s]=o)}No(t,r){let i=O9[t];return`${this.Fo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Lo(e,t,r,i){let o=KI();return new Promise((s,a)=>{let l=new BI;l.setWithCredentials(!0),l.listenOnce(UI.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case zc.NO_ERROR:let d=l.getResponseJson();k(jt,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(d)),s(d);break;case zc.TIMEOUT:k(jt,`RPC '${e}' ${o} timed out`),a(new P(N.DEADLINE_EXCEEDED,"Request time out"));break;case zc.HTTP_ERROR:let f=l.getStatus();if(k(jt,`RPC '${e}' ${o} failed with status:`,f,"response text:",l.getResponseText()),f>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);let m=g?.error;if(m&&m.status&&m.message){let v=function(S){let O=S.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(O)>=0?O:N.UNKNOWN}(m.status);a(new P(v,m.message))}else a(new P(N.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new P(N.UNAVAILABLE,"Connection failed."));break;default:G()}}finally{k(jt,`RPC '${e}' ${o} completed.`)}});let c=JSON.stringify(i);k(jt,`RPC '${e}' ${o} sending request:`,i),l.send(t,"POST",c,r,15)})}qo(e,t,r){let i=KI(),o=[this.Fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=qI(),a=HI(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Bo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;let d=o.join("");k(jt,`Creating RPC '${e}' stream ${i}: ${d}`,l);let f=s.createWebChannel(d,l),g=!1,m=!1,v=new cD({Eo:S=>{m?k(jt,`Not sending because RPC '${e}' stream ${i} is closed:`,S):(g||(k(jt,`Opening RPC '${e}' stream ${i} transport.`),f.open(),g=!0),k(jt,`RPC '${e}' stream ${i} sending:`,S),f.send(S))},Ao:()=>f.close()}),T=(S,O,B)=>{S.listen(O,F=>{try{B(F)}catch(W){setTimeout(()=>{throw W},0)}})};return T(f,Ga.EventType.OPEN,()=>{m||(k(jt,`RPC '${e}' stream ${i} transport opened.`),v.So())}),T(f,Ga.EventType.CLOSE,()=>{m||(m=!0,k(jt,`RPC '${e}' stream ${i} transport closed`),v.Do())}),T(f,Ga.EventType.ERROR,S=>{m||(m=!0,Jn(jt,`RPC '${e}' stream ${i} transport errored:`,S),v.Do(new P(N.UNAVAILABLE,"The operation could not be completed")))}),T(f,Ga.EventType.MESSAGE,S=>{var O;if(!m){let B=S.data[0];K(!!B);let F=B,W=F?.error||((O=F[0])===null||O===void 0?void 0:O.error);if(W){k(jt,`RPC '${e}' stream ${i} received error:`,W);let oe=W.status,X=function(E){let C=ct[E];if(C!==void 0)return GO(C)}(oe),I=W.message;X===void 0&&(X=N.INTERNAL,I="Unknown error status: "+oe+" with message "+W.message),m=!0,v.Do(new P(X,I)),f.close()}else k(jt,`RPC '${e}' stream ${i} received:`,B),v.vo(B)}}),T(a,$I.STAT_EVENT,S=>{S.stat===ag.PROXY?k(jt,`RPC '${e}' stream ${i} detected buffering proxy`):S.stat===ag.NOPROXY&&k(jt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{v.bo()},0),v}};function w1(){return typeof window<"u"?window:null}function _g(){return typeof document<"u"?document:null}function Rd(n){return new SC(n,!0)}var Ed=class{constructor(e,t,r=1e3,i=1.5,o=6e4){this.li=e,this.timerId=t,this.Qo=r,this.Ko=i,this.$o=o,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(e){this.cancel();let t=Math.floor(this.Uo+this.Ho()),r=Math.max(0,Date.now()-this.Go),i=Math.max(0,t-r);i>0&&k("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Uo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,i,()=>(this.Go=Date.now(),e())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}};var Jg=class{constructor(e,t,r,i,o,s,a,l){this.li=e,this.Yo=r,this.Zo=i,this.connection=o,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new Ed(e,t)}i_(){return this.state===1||this.state===5||this.s_()}s_(){return this.state===2||this.state===3}start(){this.n_=0,this.state!==4?this.auth():this.o_()}stop(){return x(this,null,function*(){this.i_()&&(yield this.close(0))})}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&this.e_===null&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(e){this.l_(),this.stream.send(e)}u_(){return x(this,null,function*(){if(this.s_())return this.close(0)})}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}close(e,t){return x(this,null,function*(){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,e!==4?this.r_.reset():t&&t.code===N.RESOURCE_EXHAUSTED?(ot(t.toString()),ot("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):t&&t.code===N.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.P_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.po(t)})}P_(){}auth(){this.state=1;let e=this.T_(this.Xo),t=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Xo===t&&this.I_(r,i)},r=>{e(()=>{let i=new P(N.UNKNOWN,"Fetching auth token failed: "+r.message);return this.d_(i)})})}I_(e,t){let r=this.T_(this.Xo);this.stream=this.E_(e,t),this.stream.Ro(()=>{r(()=>this.listener.Ro())}),this.stream.mo(()=>{r(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(i=>{r(()=>this.d_(i))}),this.stream.onMessage(i=>{r(()=>++this.n_==1?this.A_(i):this.onNext(i))})}o_(){this.state=5,this.r_.jo(()=>x(this,null,function*(){this.state=0,this.start()}))}d_(e){return k("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}T_(e){return t=>{this.li.enqueueAndForget(()=>this.Xo===e?t():(k("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},hD=class extends Jg{constructor(e,t,r,i,o,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,s),this.serializer=o}E_(e,t){return this.connection.qo("Listen",e,t)}A_(e){return this.onNext(e)}onNext(e){this.r_.reset();let t=w9(this.serializer,e),r=function(o){if(!("targetChange"in o))return J.min();let s=o.targetChange;return s.targetIds&&s.targetIds.length?J.min():s.readTime?at(s.readTime):J.min()}(e);return this.listener.R_(t,r)}V_(e){let t={};t.database=RC(this.serializer),t.addTarget=function(o,s){let a,l=s.target;if(a=Ag(l)?{documents:XO(o,l)}:{query:e1(o,l).ct},a.targetId=s.targetId,s.resumeToken.approximateByteSize()>0){a.resumeToken=WO(o,s.resumeToken);let c=AC(o,s.expectedCount);c!==null&&(a.expectedCount=c)}else if(s.snapshotVersion.compareTo(J.min())>0){a.readTime=dl(o,s.snapshotVersion.toTimestamp());let c=AC(o,s.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);let r=I9(this.serializer,e);r&&(t.labels=r),this.c_(t)}m_(e){let t={};t.database=RC(this.serializer),t.removeTarget=e,this.c_(t)}},fD=class extends Jg{constructor(e,t,r,i,o,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,s),this.serializer=o}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}E_(e,t){return this.connection.qo("Write",e,t)}A_(e){return K(!!e.streamToken),this.lastStreamToken=e.streamToken,K(!e.writeResults||e.writeResults.length===0),this.listener.p_()}onNext(e){K(!!e.streamToken),this.lastStreamToken=e.streamToken,this.r_.reset();let t=E9(e.writeResults,e.commitTime),r=at(e.commitTime);return this.listener.y_(r,t)}w_(){let e={};e.database=RC(this.serializer),this.c_(e)}g_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>md(this.serializer,r))};this.c_(t)}};var pD=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.S_=!1}b_(){if(this.S_)throw new P(N.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(e,t,r,i){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,s])=>this.connection.Oo(e,MC(t,r),i,o,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new P(N.UNKNOWN,o.toString())})}ko(e,t,r,i,o){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.ko(e,MC(t,r),i,s,a,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new P(N.UNKNOWN,s.toString())})}terminate(){this.S_=!0,this.connection.terminate()}},gD=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){this.D_===0&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(e){this.state==="Online"?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.M_("Offline")))}set(e){this.N_(),this.D_=0,e==="Online"&&(this.C_=!1),this.M_(e)}M_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}x_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(ot(t),this.C_=!1):k("OnlineStateTracker",t)}N_(){this.v_!==null&&(this.v_.cancel(),this.v_=null)}};var mD=class{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.B_=[],this.L_=new Map,this.k_=new Set,this.q_=[],this.Q_=o,this.Q_.uo(s=>{r.enqueueAndForget(()=>x(this,null,function*(){ao(this)&&(k("RemoteStore","Restarting streams for network reachability change."),yield function(l){return x(this,null,function*(){let c=H(l);c.k_.add(4),yield Dl(c),c.K_.set("Unknown"),c.k_.delete(4),yield xd(c)})}(this))}))}),this.K_=new gD(r,i)}};function xd(n){return x(this,null,function*(){if(ao(n))for(let e of n.q_)yield e(!0)})}function Dl(n){return x(this,null,function*(){for(let e of n.q_)yield e(!1)})}function wm(n,e){let t=H(n);t.L_.has(e.targetId)||(t.L_.set(e.targetId,e),lT(t)?aT(t):bl(t).s_()&&sT(t,e))}function ml(n,e){let t=H(n),r=bl(t);t.L_.delete(e),r.s_()&&E1(t,e),t.L_.size===0&&(r.s_()?r.a_():ao(t)&&t.K_.set("Unknown"))}function sT(n,e){if(n.U_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(J.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}bl(n).V_(e)}function E1(n,e){n.U_.xe(e),bl(n).m_(e)}function aT(n){n.U_=new bC({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>n.L_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),bl(n).start(),n.K_.F_()}function lT(n){return ao(n)&&!bl(n).i_()&&n.L_.size>0}function ao(n){return H(n).k_.size===0}function I1(n){n.U_=void 0}function F9(n){return x(this,null,function*(){n.K_.set("Online")})}function V9(n){return x(this,null,function*(){n.L_.forEach((e,t)=>{sT(n,e)})})}function L9(n,e){return x(this,null,function*(){I1(n),lT(n)?(n.K_.O_(e),aT(n)):n.K_.set("Unknown")})}function j9(n,e,t){return x(this,null,function*(){if(n.K_.set("Online"),e instanceof Ng&&e.state===2&&e.cause)try{yield function(i,o){return x(this,null,function*(){let s=o.cause;for(let a of o.targetIds)i.L_.has(a)&&(yield i.remoteSyncer.rejectListen(a,s),i.L_.delete(a),i.U_.removeTarget(a))})}(n,e)}catch(r){k("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Xg(n,r)}else if(e instanceof il?n.U_.$e(e):e instanceof xg?n.U_.Je(e):n.U_.Ge(e),!t.isEqual(J.min()))try{let r=yield g1(n.localStore);t.compareTo(r)>=0&&(yield function(o,s){let a=o.U_.it(s);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){let d=o.L_.get(c);d&&o.L_.set(c,d.withResumeToken(l.resumeToken,s))}}),a.targetMismatches.forEach((l,c)=>{let d=o.L_.get(l);if(!d)return;o.L_.set(l,d.withResumeToken(lt.EMPTY_BYTE_STRING,d.snapshotVersion)),E1(o,l);let f=new hl(d.target,l,c,d.sequenceNumber);sT(o,f)}),o.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){k("RemoteStore","Failed to raise snapshot:",r),yield Xg(n,r)}})}function Xg(n,e,t){return x(this,null,function*(){if(!oo(e))throw e;n.k_.add(1),yield Dl(n),n.K_.set("Offline"),t||(t=()=>g1(n.localStore)),n.asyncQueue.enqueueRetryable(()=>x(this,null,function*(){k("RemoteStore","Retrying IndexedDB access"),yield t(),n.k_.delete(1),yield xd(n)}))})}function C1(n,e){return e().catch(t=>Xg(n,t,e))}function Tl(n){return x(this,null,function*(){let e=H(n),t=ro(e),r=e.B_.length>0?e.B_[e.B_.length-1].batchId:-1;for(;B9(e);)try{let i=yield N9(e.localStore,r);if(i===null){e.B_.length===0&&t.a_();break}r=i.batchId,U9(e,i)}catch(i){yield Xg(e,i)}D1(e)&&T1(e)})}function B9(n){return ao(n)&&n.B_.length<10}function U9(n,e){n.B_.push(e);let t=ro(n);t.s_()&&t.f_&&t.g_(e.mutations)}function D1(n){return ao(n)&&!ro(n).i_()&&n.B_.length>0}function T1(n){ro(n).start()}function $9(n){return x(this,null,function*(){ro(n).w_()})}function H9(n){return x(this,null,function*(){let e=ro(n);for(let t of n.B_)e.g_(t.mutations)})}function q9(n,e,t){return x(this,null,function*(){let r=n.B_.shift(),i=CC.from(r,e,t);yield C1(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Tl(n)})}function G9(n,e){return x(this,null,function*(){e&&ro(n).f_&&(yield function(r,i){return x(this,null,function*(){if(function(s){return qO(s)&&s!==N.ABORTED}(i.code)){let o=r.B_.shift();ro(r).__(),yield C1(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield Tl(r)}})}(n,e)),D1(n)&&T1(n)})}function Qk(n,e){return x(this,null,function*(){let t=H(n);t.asyncQueue.verifyOperationInProgress(),k("RemoteStore","RemoteStore received new credentials");let r=ao(t);t.k_.add(3),yield Dl(t),r&&t.K_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.k_.delete(3),yield xd(t)})}function yD(n,e){return x(this,null,function*(){let t=H(n);e?(t.k_.delete(2),yield xd(t)):e||(t.k_.add(2),yield Dl(t),t.K_.set("Unknown"))})}function bl(n){return n.W_||(n.W_=function(t,r,i){let o=H(t);return o.b_(),new hD(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{Ro:F9.bind(null,n),mo:V9.bind(null,n),po:L9.bind(null,n),R_:j9.bind(null,n)}),n.q_.push(e=>x(this,null,function*(){e?(n.W_.__(),lT(n)?aT(n):n.K_.set("Unknown")):(yield n.W_.stop(),I1(n))}))),n.W_}function ro(n){return n.G_||(n.G_=function(t,r,i){let o=H(t);return o.b_(),new fD(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{Ro:()=>Promise.resolve(),mo:$9.bind(null,n),po:G9.bind(null,n),p_:H9.bind(null,n),y_:q9.bind(null,n)}),n.q_.push(e=>x(this,null,function*(){e?(n.G_.__(),yield Tl(n)):(yield n.G_.stop(),n.B_.length>0&&(k("RemoteStore",`Stopping write stream with ${n.B_.length} pending writes`),n.B_=[]))}))),n.G_}var _D=class n{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new _t,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(s=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){let s=Date.now()+r,a=new n(e,t,s,i,o);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new P(N.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Sl(n,e){if(ot("AsyncQueue",`${e}: ${n}`),oo(n))return new P(N.UNAVAILABLE,`${e}: ${n}`);throw n}var em=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||q.comparator(t.key,r.key):(t,r)=>q.comparator(t.key,r.key),this.keyedMap=Zc(),this.sortedSet=new ze(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var tm=class{constructor(){this.z_=new ze(q.comparator)}track(e){let t=e.doc.key,r=this.z_.get(t);r?e.type!==0&&r.type===3?this.z_=this.z_.insert(t,e):e.type===3&&r.type!==1?this.z_=this.z_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.z_=this.z_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.z_=this.z_.remove(t):e.type===1&&r.type===2?this.z_=this.z_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.z_=this.z_.insert(t,{type:2,doc:e.doc}):G():this.z_=this.z_.insert(t,e)}j_(){let e=[];return this.z_.inorderTraversal((t,r)=>{e.push(r)}),e}},yl=class n{constructor(e,t,r,i,o,s,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,o){let s=[];return t.forEach(a=>{s.push({type:0,doc:a})}),new n(e,t,em.emptySet(t),s,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ad(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var vD=class{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(e=>e.Z_())}},wD=class{constructor(){this.queries=Yk(),this.onlineState="Unknown",this.X_=new Set}terminate(){(function(t,r){let i=H(t),o=i.queries;i.queries=Yk(),o.forEach((s,a)=>{for(let l of a.J_)l.onError(r)})})(this,new P(N.ABORTED,"Firestore shutting down"))}};function Yk(){return new er(n=>RO(n),Ad)}function uT(n,e){return x(this,null,function*(){let t=H(n),r=3,i=e.query,o=t.queries.get(i);o?!o.Y_()&&e.Z_()&&(r=2):(o=new vD,r=e.Z_()?0:1);try{switch(r){case 0:o.H_=yield t.onListen(i,!0);break;case 1:o.H_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(s){let a=Sl(s,`Initialization of query '${Za(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,o),o.J_.push(e),e.ea(t.onlineState),o.H_&&e.ta(o.H_)&&dT(t)})}function cT(n,e){return x(this,null,function*(){let t=H(n),r=e.query,i=3,o=t.queries.get(r);if(o){let s=o.J_.indexOf(e);s>=0&&(o.J_.splice(s,1),o.J_.length===0?i=e.Z_()?0:1:!o.Y_()&&e.Z_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function z9(n,e){let t=H(n),r=!1;for(let i of e){let o=i.query,s=t.queries.get(o);if(s){for(let a of s.J_)a.ta(i)&&(r=!0);s.H_=i}}r&&dT(t)}function W9(n,e,t){let r=H(n),i=r.queries.get(e);if(i)for(let o of i.J_)o.onError(t);r.queries.delete(e)}function dT(n){n.X_.forEach(e=>{e.next()})}var ED,Zk;(Zk=ED||(ED={})).na="default",Zk.Cache="cache";var Id=class{constructor(e,t,r){this.query=e,this.ra=t,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=r||{}}ta(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new yl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ia?this.oa(e)&&(this.ra.next(e),t=!0):this._a(e,this.onlineState)&&(this.aa(e),t=!0),this.sa=e,t}onError(e){this.ra.error(e)}ea(e){this.onlineState=e;let t=!1;return this.sa&&!this.ia&&this._a(this.sa,e)&&(this.aa(this.sa),t=!0),t}_a(e,t){if(!e.fromCache||!this.Z_())return!0;let r=t!=="Offline";return(!this.options.ua||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}oa(e){if(e.docChanges.length>0)return!0;let t=this.sa&&this.sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}aa(e){e=yl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ia=!0,this.ra.next(e)}Z_(){return this.options.source!==ED.Cache}};var ID=class{constructor(e,t){this.ca=e,this.byteLength=t}la(){return"metadata"in this.ca}};var nm=class{constructor(e){this.serializer=e}As(e){return Cr(this.serializer,e)}Rs(e){return e.metadata.exists?JO(this.serializer,e.document,!1):ft.newNoDocument(this.As(e.metadata.name),this.Vs(e.metadata.readTime))}Vs(e){return at(e)}},CD=class{constructor(e,t,r){this.ha=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=b1(e)}Pa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ca.namedQuery)this.queries.push(e.ca.namedQuery);else if(e.ca.documentMetadata){this.documents.push({metadata:e.ca.documentMetadata}),e.ca.documentMetadata.exists||++t;let r=Ae.fromString(e.ca.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ca.document&&(this.documents[this.documents.length-1].document=e.ca.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ta(e){let t=new Map,r=new nm(this.serializer);for(let i of e)if(i.metadata.queries){let o=r.As(i.metadata.name);for(let s of i.metadata.queries){let a=(t.get(s)||fe()).add(o);t.set(s,a)}}return t}complete(){return x(this,null,function*(){let e=yield P9(this.localStore,new nm(this.serializer),this.documents,this.ha.id),t=this.Ta(this.documents);for(let r of this.queries)yield k9(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Ia:this.collectionGroups,da:e}})}};function b1(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var rm=class{constructor(e){this.key=e}},im=class{constructor(e){this.key=e}},om=class{constructor(e,t){this.query=e,this.Ea=t,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=fe(),this.mutatedKeys=fe(),this.Va=NO(e),this.ma=new em(this.Va)}get fa(){return this.Ea}ga(e,t){let r=t?t.pa:new tm,i=t?t.ma:this.ma,o=t?t.mutatedKeys:this.mutatedKeys,s=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,f)=>{let g=i.get(d),m=Md(this.query,f)?f:null,v=!!g&&this.mutatedKeys.has(g.key),T=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations),S=!1;g&&m?g.data.isEqual(m.data)?v!==T&&(r.track({type:3,doc:m}),S=!0):this.ya(g,m)||(r.track({type:2,doc:m}),S=!0,(l&&this.Va(m,l)>0||c&&this.Va(m,c)<0)&&(a=!0)):!g&&m?(r.track({type:0,doc:m}),S=!0):g&&!m&&(r.track({type:1,doc:g}),S=!0,(l||c)&&(a=!0)),S&&(m?(s=s.add(m),o=T?o.add(d):o.delete(d)):(s=s.delete(d),o=o.delete(d)))}),this.query.limit!==null)for(;s.size>this.query.limit;){let d=this.query.limitType==="F"?s.last():s.first();s=s.delete(d.key),o=o.delete(d.key),r.track({type:1,doc:d})}return{ma:s,pa:r,ss:a,mutatedKeys:o}}ya(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let o=this.ma;this.ma=e.ma,this.mutatedKeys=e.mutatedKeys;let s=e.pa.j_();s.sort((d,f)=>function(m,v){let T=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return G()}};return T(m)-T(v)}(d.type,f.type)||this.Va(d.doc,f.doc)),this.wa(r),i=i!=null&&i;let a=t&&!i?this.Sa():[],l=this.Ra.size===0&&this.current&&!i?1:0,c=l!==this.Aa;return this.Aa=l,s.length!==0||c?{snapshot:new yl(this.query,e.ma,o,s,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),ba:a}:{ba:a}}ea(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ma:this.ma,pa:new tm,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(e){return!this.Ea.has(e)&&!!this.ma.has(e)&&!this.ma.get(e).hasLocalMutations}wa(e){e&&(e.addedDocuments.forEach(t=>this.Ea=this.Ea.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ea=this.Ea.delete(t)),this.current=e.current)}Sa(){if(!this.current)return[];let e=this.Ra;this.Ra=fe(),this.ma.forEach(r=>{this.Da(r.key)&&(this.Ra=this.Ra.add(r.key))});let t=[];return e.forEach(r=>{this.Ra.has(r)||t.push(new im(r))}),this.Ra.forEach(r=>{e.has(r)||t.push(new rm(r))}),t}va(e){this.Ea=e.Es,this.Ra=fe();let t=this.ga(e.documents);return this.applyChanges(t,!0)}Ca(){return yl.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,this.Aa===0,this.hasCachedResults)}},DD=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},TD=class{constructor(e){this.key=e,this.Fa=!1}},bD=class{constructor(e,t,r,i,o,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=s,this.Ma={},this.xa=new er(a=>RO(a),Ad),this.Oa=new Map,this.Na=new Set,this.Ba=new ze(q.comparator),this.La=new Map,this.ka=new _d,this.qa={},this.Qa=new Map,this.Ka=fl.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return this.$a===!0}};function K9(n,e,t=!0){return x(this,null,function*(){let r=Em(n),i,o=r.xa.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.Ca()):i=yield S1(r,e,t,!0),i})}function Q9(n,e){return x(this,null,function*(){let t=Em(n);yield S1(t,e,!0,!1)})}function S1(n,e,t,r){return x(this,null,function*(){let i=yield pl(n.localStore,Jt(e)),o=i.targetId,s=n.sharedClientState.addLocalQueryTarget(o,t),a;return r&&(a=yield hT(n,e,o,s==="current",i.resumeToken)),n.isPrimaryClient&&t&&wm(n.remoteStore,i),a})}function hT(n,e,t,r,i){return x(this,null,function*(){n.Ua=(f,g,m)=>function(T,S,O,B){return x(this,null,function*(){let F=S.view.ga(O);F.ss&&(F=yield Wg(T.localStore,S.query,!1).then(({documents:I})=>S.view.ga(I,F)));let W=B&&B.targetChanges.get(S.targetId),oe=B&&B.targetMismatches.get(S.targetId)!=null,X=S.view.applyChanges(F,T.isPrimaryClient,W,oe);return SD(T,S.targetId,X.ba),X.snapshot})}(n,f,g,m);let o=yield Wg(n.localStore,e,!0),s=new om(e,o.Es),a=s.ga(o.documents),l=pd.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=s.applyChanges(a,n.isPrimaryClient,l);SD(n,t,c.ba);let d=new DD(e,t,s);return n.xa.set(e,d),n.Oa.has(t)?n.Oa.get(t).push(e):n.Oa.set(t,[e]),c.snapshot})}function Y9(n,e,t){return x(this,null,function*(){let r=H(n),i=r.xa.get(e),o=r.Oa.get(i.targetId);if(o.length>1)return r.Oa.set(i.targetId,o.filter(s=>!Ad(s,e))),void r.xa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield gl(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&ml(r.remoteStore,i.targetId),_l(r,i.targetId)}).catch(io))):(_l(r,i.targetId),yield gl(r.localStore,i.targetId,!0))})}function Z9(n,e){return x(this,null,function*(){let t=H(n),r=t.xa.get(e),i=t.Oa.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ml(t.remoteStore,r.targetId))})}function J9(n,e,t){return x(this,null,function*(){let r=mT(n);try{let i=yield function(s,a){let l=H(s),c=Je.now(),d=a.reduce((m,v)=>m.add(v.key),fe()),f,g;return l.persistence.runTransaction("Locally write mutations","readwrite",m=>{let v=sn(),T=fe();return l.hs.getEntries(m,d).next(S=>{v=S,v.forEach((O,B)=>{B.isValidDocument()||(T=T.add(O))})}).next(()=>l.localDocuments.getOverlayedDocuments(m,v)).next(S=>{f=S;let O=[];for(let B of a){let F=f9(B,f.get(B.key).overlayedDocument);F!=null&&O.push(new tr(B.key,F,CO(F.value.mapValue),rt.exists(!0)))}return l.mutationQueue.addMutationBatch(m,c,O,a)}).next(S=>{g=S;let O=S.applyToLocalDocumentSet(f,T);return l.documentOverlayCache.saveOverlays(m,S.batchId,O)})}).then(()=>({batchId:g.batchId,changes:kO(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(s,a,l){let c=s.qa[s.currentUser.toKey()];c||(c=new ze(le)),c=c.insert(a,l),s.qa[s.currentUser.toKey()]=c}(r,i.batchId,t),yield oi(r,i.changes),yield Tl(r.remoteStore)}catch(i){let o=Sl(i,"Failed to persist write");t.reject(o)}})}function A1(n,e){return x(this,null,function*(){let t=H(n);try{let r=yield x9(t.localStore,e);e.targetChanges.forEach((i,o)=>{let s=t.La.get(o);s&&(K(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?s.Fa=!0:i.modifiedDocuments.size>0?K(s.Fa):i.removedDocuments.size>0&&(K(s.Fa),s.Fa=!1))}),yield oi(t,r,e)}catch(r){yield io(r)}})}function Jk(n,e,t){let r=H(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.xa.forEach((o,s)=>{let a=s.view.ea(e);a.snapshot&&i.push(a.snapshot)}),function(s,a){let l=H(s);l.onlineState=a;let c=!1;l.queries.forEach((d,f)=>{for(let g of f.J_)g.ea(a)&&(c=!0)}),c&&dT(l)}(r.eventManager,e),i.length&&r.Ma.R_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function X9(n,e,t){return x(this,null,function*(){let r=H(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.La.get(e),o=i&&i.key;if(o){let s=new ze(q.comparator);s=s.insert(o,ft.newNoDocument(o,J.min()));let a=fe().add(o),l=new fd(J.min(),new Map,new ze(le),s,a);yield A1(r,l),r.Ba=r.Ba.remove(o),r.La.delete(e),gT(r)}else yield gl(r.localStore,e,!1).then(()=>_l(r,e,t)).catch(io)})}function e3(n,e){return x(this,null,function*(){let t=H(n),r=e.batch.batchId;try{let i=yield R9(t.localStore,e);pT(t,r,null),fT(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield oi(t,i)}catch(i){yield io(i)}})}function t3(n,e,t){return x(this,null,function*(){let r=H(n);try{let i=yield function(s,a){let l=H(s);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let d;return l.mutationQueue.lookupMutationBatch(c,a).next(f=>(K(f!==null),d=f.keys(),l.mutationQueue.removeMutationBatch(c,f))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,d,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,d)).next(()=>l.localDocuments.getDocuments(c,d))})}(r.localStore,e);pT(r,e,t),fT(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield oi(r,i)}catch(i){yield io(i)}})}function n3(n,e){return x(this,null,function*(){let t=H(n);ao(t.remoteStore)||k("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(s){let a=H(s);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>a.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(r===-1)return void e.resolve();let i=t.Qa.get(r)||[];i.push(e),t.Qa.set(r,i)}catch(r){let i=Sl(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function fT(n,e){(n.Qa.get(e)||[]).forEach(t=>{t.resolve()}),n.Qa.delete(e)}function pT(n,e,t){let r=H(n),i=r.qa[r.currentUser.toKey()];if(i){let o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.qa[r.currentUser.toKey()]=i}}function _l(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Oa.get(e))n.xa.delete(r),t&&n.Ma.Wa(r,t);n.Oa.delete(e),n.isPrimaryClient&&n.ka.yr(e).forEach(r=>{n.ka.containsKey(r)||M1(n,r)})}function M1(n,e){n.Na.delete(e.path.canonicalString());let t=n.Ba.get(e);t!==null&&(ml(n.remoteStore,t),n.Ba=n.Ba.remove(e),n.La.delete(t),gT(n))}function SD(n,e,t){for(let r of t)r instanceof rm?(n.ka.addReference(r.key,e),r3(n,r)):r instanceof im?(k("SyncEngine","Document no longer in limbo: "+r.key),n.ka.removeReference(r.key,e),n.ka.containsKey(r.key)||M1(n,r.key)):G()}function r3(n,e){let t=e.key,r=t.path.canonicalString();n.Ba.get(t)||n.Na.has(r)||(k("SyncEngine","New document in limbo: "+t),n.Na.add(r),gT(n))}function gT(n){for(;n.Na.size>0&&n.Ba.size<n.maxConcurrentLimboResolutions;){let e=n.Na.values().next().value;n.Na.delete(e);let t=new q(Ae.fromString(e)),r=n.Ka.next();n.La.set(r,new TD(t)),n.Ba=n.Ba.insert(t,r),wm(n.remoteStore,new hl(Jt(Cl(t.path)),r,"TargetPurposeLimboResolution",En.oe))}}function oi(n,e,t){return x(this,null,function*(){let r=H(n),i=[],o=[],s=[];r.xa.isEmpty()||(r.xa.forEach((a,l)=>{s.push(r.Ua(l,e,t).then(c=>{var d;if((c||t)&&r.isPrimaryClient){let f=c?!c.fromCache:(d=t?.targetChanges.get(l.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(c){i.push(c);let f=oD.zi(l.targetId,c);o.push(f)}}))}),yield Promise.all(s),r.Ma.R_(i),yield function(l,c){return x(this,null,function*(){let d=H(l);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>M.forEach(c,g=>M.forEach(g.Wi,m=>d.persistence.referenceDelegate.addReference(f,g.targetId,m)).next(()=>M.forEach(g.Gi,m=>d.persistence.referenceDelegate.removeReference(f,g.targetId,m)))))}catch(f){if(!oo(f))throw f;k("LocalStore","Failed to update sequence numbers: "+f)}for(let f of c){let g=f.targetId;if(!f.fromCache){let m=d.us.get(g),v=m.snapshotVersion,T=m.withLastLimboFreeSnapshotVersion(v);d.us=d.us.insert(g,T)}}})}(r.localStore,o))})}function i3(n,e){return x(this,null,function*(){let t=H(n);if(!t.currentUser.isEqual(e)){k("SyncEngine","User change. New user:",e.toKey());let r=yield p1(t.localStore,e);t.currentUser=e,function(o,s){o.Qa.forEach(a=>{a.forEach(l=>{l.reject(new P(N.CANCELLED,s))})}),o.Qa.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield oi(t,r.Ts)}})}function o3(n,e){let t=H(n),r=t.La.get(e);if(r&&r.Fa)return fe().add(r.key);{let i=fe(),o=t.Oa.get(e);if(!o)return i;for(let s of o){let a=t.xa.get(s);i=i.unionWith(a.view.fa)}return i}}function s3(n,e){return x(this,null,function*(){let t=H(n),r=yield Wg(t.localStore,e.query,!0),i=e.view.va(r);return t.isPrimaryClient&&SD(t,e.targetId,i.ba),i})}function a3(n,e){return x(this,null,function*(){let t=H(n);return _1(t.localStore,e).then(r=>oi(t,r))})}function l3(n,e,t,r){return x(this,null,function*(){let i=H(n),o=yield function(a,l){let c=H(a),d=H(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",f=>d.On(f,l).next(g=>g?c.localDocuments.getDocuments(f,g):M.resolve(null)))}(i.localStore,e);o!==null?(t==="pending"?yield Tl(i.remoteStore):t==="acknowledged"||t==="rejected"?(pT(i,e,r||null),fT(i,e),function(a,l){H(H(a).mutationQueue).Bn(l)}(i.localStore,e)):G(),yield oi(i,o)):k("SyncEngine","Cannot apply mutation batch with id: "+e)})}function u3(n,e){return x(this,null,function*(){let t=H(n);if(Em(t),mT(t),e===!0&&t.$a!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Xk(t,r.toArray());t.$a=!0,yield yD(t.remoteStore,!0);for(let o of i)wm(t.remoteStore,o)}else if(e===!1&&t.$a!==!1){let r=[],i=Promise.resolve();t.Oa.forEach((o,s)=>{t.sharedClientState.isLocalQueryTarget(s)?r.push(s):i=i.then(()=>(_l(t,s),gl(t.localStore,s,!0))),ml(t.remoteStore,s)}),yield i,yield Xk(t,r),function(s){let a=H(s);a.La.forEach((l,c)=>{ml(a.remoteStore,c)}),a.ka.wr(),a.La=new Map,a.Ba=new ze(q.comparator)}(t),t.$a=!1,yield yD(t.remoteStore,!1)}})}function Xk(n,e,t){return x(this,null,function*(){let r=H(n),i=[],o=[];for(let s of e){let a,l=r.Oa.get(s);if(l&&l.length!==0){a=yield pl(r.localStore,Jt(l[0]));for(let c of l){let d=r.xa.get(c),f=yield s3(r,d);f.snapshot&&o.push(f.snapshot)}}else{let c=yield y1(r.localStore,s);a=yield pl(r.localStore,c),yield hT(r,R1(c),s,!1,a.resumeToken)}i.push(a)}return r.Ma.R_(o),i})}function R1(n){return MO(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function c3(n){return function(t){return H(H(t).persistence).$i()}(H(n).localStore)}function d3(n,e,t,r){return x(this,null,function*(){let i=H(n);if(i.$a)return void k("SyncEngine","Ignoring unexpected query state notification.");let o=i.Oa.get(e);if(o&&o.length>0)switch(t){case"current":case"not-current":{let s=yield _1(i.localStore,xO(o[0])),a=fd.createSynthesizedRemoteEventForCurrentChange(e,t==="current",lt.EMPTY_BYTE_STRING);yield oi(i,s,a);break}case"rejected":yield gl(i.localStore,e,!0),_l(i,e,r);break;default:G()}})}function h3(n,e,t){return x(this,null,function*(){let r=Em(n);if(r.$a){for(let i of e){if(r.Oa.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){k("SyncEngine","Adding an already active target "+i);continue}let o=yield y1(r.localStore,i),s=yield pl(r.localStore,o);yield hT(r,R1(o),s.targetId,!1,s.resumeToken),wm(r.remoteStore,s)}for(let i of t)r.Oa.has(i)&&(yield gl(r.localStore,i,!1).then(()=>{ml(r.remoteStore,i),_l(r,i)}).catch(io))}})}function Em(n){let e=H(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=A1.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=o3.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=X9.bind(null,e),e.Ma.R_=z9.bind(null,e.eventManager),e.Ma.Wa=W9.bind(null,e.eventManager),e}function mT(n){let e=H(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=e3.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=t3.bind(null,e),e}function f3(n,e,t){let r=H(n);(function(o,s,a){return x(this,null,function*(){try{let l=yield s.getMetadata();if(yield function(m,v){let T=H(m),S=at(v.createTime);return T.persistence.runTransaction("hasNewerBundle","readonly",O=>T.jr.getBundleMetadata(O,v.id)).then(O=>!!O&&O.createTime.compareTo(S)>=0)}(o.localStore,l))return yield s.close(),a._completeWith(function(m){return{taskState:"Success",documentsLoaded:m.totalDocuments,bytesLoaded:m.totalBytes,totalDocuments:m.totalDocuments,totalBytes:m.totalBytes}}(l)),Promise.resolve(new Set);a._updateProgress(b1(l));let c=new CD(l,o.localStore,s.serializer),d=yield s.Ga();for(;d;){let g=yield c.Pa(d);g&&a._updateProgress(g),d=yield s.Ga()}let f=yield c.complete();return yield oi(o,f.da,void 0),yield function(m,v){let T=H(m);return T.persistence.runTransaction("Save bundle","readwrite",S=>T.jr.saveBundleMetadata(S,v))}(o.localStore,l),a._completeWith(f.progress),Promise.resolve(f.Ia)}catch(l){return Jn("SyncEngine",`Loading bundle failed with ${l}`),a._failWith(l),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var yT=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return x(this,null,function*(){this.serializer=Rd(t.databaseInfo.databaseId),this.sharedClientState=this.za(t),this.persistence=this.ja(t),yield this.persistence.start(),this.localStore=this.Ha(t),this.gcScheduler=this.Ja(t,this.localStore),this.indexBackfillerScheduler=this.Ya(t,this.localStore)})}Ja(t,r){return null}Ya(t,r){return null}Ha(t){return f1(this.persistence,new zg,t.initialUser,this.serializer)}ja(t){return new vd(qg.ei,this.serializer)}za(t){return new Yg}terminate(){return x(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),AD=class extends yT{constructor(e){super(),this.cacheSizeBytes=e}Ja(e,t){K(this.persistence.referenceDelegate instanceof Gg);let r=this.persistence.referenceDelegate.garbageCollector;return new Ug(r,e.asyncQueue,t)}ja(e){let t=this.cacheSizeBytes!==void 0?on.withCacheSize(this.cacheSizeBytes):on.DEFAULT;return new vd(r=>Gg.ei(r,t),this.serializer)}},sm=class n extends yT{constructor(e,t,r){super(),this.Za=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return x(this,null,function*(){yield oy(n.prototype,this,"initialize").call(this,e),yield this.Za.initialize(this,e),yield mT(this.Za.syncEngine),yield Tl(this.Za.remoteStore),yield this.persistence.Si(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}Ha(e){return f1(this.persistence,new zg,e.initialUser,this.serializer)}Ja(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new Ug(r,e.asyncQueue,t)}Ya(e,t){let r=new aC(t,this.persistence);return new sC(e.asyncQueue,r)}ja(e){let t=oT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?on.withCacheSize(this.cacheSizeBytes):on.DEFAULT;return new iD(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,w1(),_g(),this.serializer,this.sharedClientState,!!this.forceOwnership)}za(e){return new Yg}},MD=class n extends sm{constructor(e,t){super(e,t,!1),this.Za=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return x(this,null,function*(){yield oy(n.prototype,this,"initialize").call(this,e);let t=this.Za.syncEngine;this.sharedClientState instanceof rd&&(this.sharedClientState.syncEngine={io:l3.bind(null,t),so:d3.bind(null,t),oo:h3.bind(null,t),$i:c3.bind(null,t),ro:a3.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.Si(r=>x(this,null,function*(){yield u3(this.Za.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}za(e){let t=w1();if(!rd.p(t))throw new P(N.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=oT(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new rd(t,e.asyncQueue,r,e.clientId,e.initialUser)}},_T=(()=>{class n{initialize(t,r){return x(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Jk(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=i3.bind(null,this.syncEngine),yield yD(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new wD}()}createDatastore(t){let r=Rd(t.databaseInfo.databaseId),i=function(s){return new dD(s)}(t.databaseInfo);return function(s,a,l,c){return new pD(s,a,l,c)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,o,s,a,l){return new mD(i,o,s,a,l)}(this.localStore,this.datastore,t.asyncQueue,r=>Jk(this.syncEngine,r,0),function(){return Zg.p()?new Zg:new uD}())}createSyncEngine(t,r){return function(o,s,a,l,c,d,f){let g=new bD(o,s,a,l,c,d);return f&&(g.$a=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return x(this,null,function*(){var t,r;yield function(o){return x(this,null,function*(){let s=H(o);k("RemoteStore","RemoteStore shutting down."),s.k_.add(5),yield Dl(s),s.Q_.shutdown(),s.K_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();function eO(n,e=10240){let t=0;return{read(){return x(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return x(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var vl=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Xa(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Xa(this.observer.error,e):ot("Uncaught Error in snapshot listener:",e.toString()))}eu(){this.muted=!0}Xa(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var RD=class{constructor(e,t){this.tu=e,this.serializer=t,this.metadata=new _t,this.buffer=new Uint8Array,this.nu=function(){return new TextDecoder("utf-8")}(),this.ru().then(r=>{r&&r.la()?this.metadata.resolve(r.ca.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.ca)}`))},r=>this.metadata.reject(r))}close(){return this.tu.cancel()}getMetadata(){return x(this,null,function*(){return this.metadata.promise})}Ga(){return x(this,null,function*(){return yield this.getMetadata(),this.ru()})}ru(){return x(this,null,function*(){let e=yield this.iu();if(e===null)return null;let t=this.nu.decode(e),r=Number(t);isNaN(r)&&this.su(`length string (${t}) is not valid number`);let i=yield this.ou(r);return new ID(JSON.parse(i),e.length+r)})}_u(){return this.buffer.findIndex(e=>e===123)}iu(){return x(this,null,function*(){for(;this._u()<0&&!(yield this.au()););if(this.buffer.length===0)return null;let e=this._u();e<0&&this.su("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}ou(e){return x(this,null,function*(){for(;this.buffer.length<e;)(yield this.au())&&this.su("Reached the end of bundle when more is expected.");let t=this.nu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}su(e){throw this.tu.cancel(),new Error(`Invalid bundle format: ${e}`)}au(){return x(this,null,function*(){let e=yield this.tu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var xD=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return x(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new P(N.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,o){return x(this,null,function*(){let s=H(i),a={documents:o.map(f=>gd(s.serializer,f))},l=yield s.ko("BatchGetDocuments",s.serializer.databaseId,Ae.emptyPath(),a,o.length),c=new Map;l.forEach(f=>{let g=v9(s.serializer,f);c.set(g.key.toString(),g)});let d=[];return o.forEach(f=>{let g=c.get(f.toString());K(!!g),d.push(g)}),d})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new no(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return x(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=q.fromPath(r);this.mutations.push(new cd(i,this.precondition(i)))}),yield function(r,i){return x(this,null,function*(){let o=H(r),s={writes:i.map(a=>md(o.serializer,a))};yield o.Oo("Commit",o.serializer.databaseId,Ae.emptyPath(),s)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw G();t=J.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new P(N.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(J.min())?rt.exists(!1):rt.updateTime(t):rt.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(J.min()))throw new P(N.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return rt.updateTime(t)}return rt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var ND=class{constructor(e,t,r,i,o){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=o,this.uu=r.maxAttempts,this.r_=new Ed(this.asyncQueue,"transaction_retry")}cu(){this.uu-=1,this.lu()}lu(){this.r_.jo(()=>x(this,null,function*(){let e=new xD(this.datastore),t=this.hu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.Pu(i)}))}).catch(r=>{this.Pu(r)})}))}hu(e){try{let t=this.updateFunction(e);return!bd(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Pu(e){this.uu>0&&this.Tu(e)?(this.uu-=1,this.asyncQueue.enqueueAndForget(()=>(this.lu(),Promise.resolve()))):this.deferred.reject(e)}Tu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!qO(t)}return!1}};var PD=class{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ht.UNAUTHENTICATED,this.clientId=wg.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,s=>x(this,null,function*(){k("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(k("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new _t;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>x(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Sl(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function QI(n,e){return x(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),k("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>x(this,null,function*(){r.isEqual(i)||(yield p1(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function tO(n,e){return x(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield vT(n);k("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Qk(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Qk(e.remoteStore,i)),n._onlineComponents=e})}function vT(n){return x(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){k("FirestoreClient","Using user provided OfflineComponentProvider");try{yield QI(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===N.FAILED_PRECONDITION||i.code===N.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;Jn("Error using user provided cache. Falling back to memory cache: "+t),yield QI(n,new yT)}}else k("FirestoreClient","Using default OfflineComponentProvider"),yield QI(n,new AD(void 0));return n._offlineComponents})}function Im(n){return x(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(k("FirestoreClient","Using user provided OnlineComponentProvider"),yield tO(n,n._uninitializedComponentsProvider._online)):(k("FirestoreClient","Using default OnlineComponentProvider"),yield tO(n,new _T))),n._onlineComponents})}function x1(n){return vT(n).then(e=>e.persistence)}function wT(n){return vT(n).then(e=>e.localStore)}function N1(n){return Im(n).then(e=>e.remoteStore)}function ET(n){return Im(n).then(e=>e.syncEngine)}function p3(n){return Im(n).then(e=>e.datastore)}function wl(n){return x(this,null,function*(){let e=yield Im(n),t=e.eventManager;return t.onListen=K9.bind(null,e.syncEngine),t.onUnlisten=Y9.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Q9.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Z9.bind(null,e.syncEngine),t})}function g3(n){return n.asyncQueue.enqueue(()=>x(this,null,function*(){let e=yield x1(n),t=yield N1(n);return e.setNetworkEnabled(!0),function(i){let o=H(i);return o.k_.delete(0),xd(o)}(t)}))}function m3(n){return n.asyncQueue.enqueue(()=>x(this,null,function*(){let e=yield x1(n),t=yield N1(n);return e.setNetworkEnabled(!1),function(i){return x(this,null,function*(){let o=H(i);o.k_.add(0),yield Dl(o),o.K_.set("Offline")})}(t)}))}function y3(n,e){let t=new _t;return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,o,s){return x(this,null,function*(){try{let a=yield function(c,d){let f=H(c);return f.persistence.runTransaction("read document","readonly",g=>f.localDocuments.getDocument(g,d))}(i,o);a.isFoundDocument()?s.resolve(a):a.isNoDocument()?s.resolve(null):s.reject(new P(N.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let l=Sl(a,`Failed to get document '${o} from cache`);s.reject(l)}})}(yield wT(n),e,t)})),t.promise}function P1(n,e,t={}){let r=new _t;return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(o,s,a,l,c){let d=new vl({next:g=>{d.eu(),s.enqueueAndForget(()=>cT(o,f));let m=g.docs.has(a);!m&&g.fromCache?c.reject(new P(N.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&g.fromCache&&l&&l.source==="server"?c.reject(new P(N.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Id(Cl(a.path),d,{includeMetadataChanges:!0,ua:!0});return uT(o,f)}(yield wl(n),n.asyncQueue,e,t,r)})),r.promise}function _3(n,e){let t=new _t;return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,o,s){return x(this,null,function*(){try{let a=yield Wg(i,o,!0),l=new om(o,a.Es),c=l.ga(a.documents),d=l.applyChanges(c,!1);s.resolve(d.snapshot)}catch(a){let l=Sl(a,`Failed to execute query '${o} against cache`);s.reject(l)}})}(yield wT(n),e,t)})),t.promise}function k1(n,e,t={}){let r=new _t;return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(o,s,a,l,c){let d=new vl({next:g=>{d.eu(),s.enqueueAndForget(()=>cT(o,f)),g.fromCache&&l.source==="server"?c.reject(new P(N.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(g)},error:g=>c.reject(g)}),f=new Id(a,d,{includeMetadataChanges:!0,ua:!0});return uT(o,f)}(yield wl(n),n.asyncQueue,e,t,r)})),r.promise}function v3(n,e){let t=new vl(e);return n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,o){H(i).X_.add(o),o.next()}(yield wl(n),t)})),()=>{t.eu(),n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return function(i,o){H(i).X_.delete(o)}(yield wl(n),t)}))}}function w3(n,e,t,r){let i=function(s,a){let l;return l=typeof s=="string"?zO().encode(s):s,function(d,f){return new RD(d,f)}(function(d,f){if(d instanceof Uint8Array)return eO(d,f);if(d instanceof ArrayBuffer)return eO(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),a)}(t,Rd(e));n.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){f3(yield ET(n),i,r)}))}function E3(n,e){return n.asyncQueue.enqueue(()=>x(this,null,function*(){return function(r,i){let o=H(r);return o.persistence.runTransaction("Get named query","readonly",s=>o.jr.getNamedQuery(s,i))}(yield wT(n),e)}))}function O1(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var nO=new Map;function IT(n,e,t){if(!t)throw new P(N.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function CT(n,e,t,r){if(e===!0&&r===!0)throw new P(N.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function rO(n){if(!q.isDocumentKey(n))throw new P(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function iO(n){if(q.isDocumentKey(n))throw new P(N.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Cm(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":G()}function Re(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new P(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Cm(n);throw new P(N.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function F1(n,e){if(e<=0)throw new P(N.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var am=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new P(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new P(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}CT("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=O1((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new P(N.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new P(N.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new P(N.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},fs=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new am({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new P(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new P(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new am(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new YI;switch(r.type){case"firstParty":return new eC(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new P(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return x(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=nO.get(t);r&&(k("ComponentProvider","Removing Datastore"),nO.delete(t),r.terminate())}(this),Promise.resolve()}};function V1(n,e,t,r={}){var i;let o=(n=Re(n,fs))._getSettings(),s=`${e}:${t}`;if(o.host!=="firestore.googleapis.com"&&o.host!==s&&Jn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},o),{host:s,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=ht.MOCK_USER;else{a=Xd(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new P(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new ht(c)}n._authCredentials=new ZI(new vg(a,l))}}var xt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},He=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Dr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Dr=class n extends xt{constructor(e,t,r){super(e,t,Cl(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new He(this.firestore,null,new q(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function DT(n,e,...t){if(n=we(n),IT("collection","path",e),n instanceof fs){let r=Ae.fromString(e,...t);return iO(r),new Dr(n,null,r)}{if(!(n instanceof He||n instanceof Dr))throw new P(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Ae.fromString(e,...t));return iO(r),new Dr(n.firestore,null,r)}}function L1(n,e){if(n=Re(n,fs),IT("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new P(N.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new xt(n,null,function(r){return new Xn(Ae.emptyPath(),r)}(e))}function Nd(n,e,...t){if(n=we(n),arguments.length===1&&(e=wg.newId()),IT("doc","path",e),n instanceof fs){let r=Ae.fromString(e,...t);return rO(r),new He(n,null,new q(r))}{if(!(n instanceof He||n instanceof Dr))throw new P(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Ae.fromString(e,...t));return rO(r),new He(n.firestore,n instanceof Dr?n.converter:null,new q(r))}}function TT(n,e){return n=we(n),e=we(e),(n instanceof He||n instanceof Dr)&&(e instanceof He||e instanceof Dr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function bT(n,e){return n=we(n),e=we(e),n instanceof xt&&e instanceof xt&&n.firestore===e.firestore&&Ad(n._query,e._query)&&n.converter===e.converter}var lm=class{constructor(e=Promise.resolve()){this.Iu=[],this.du=!1,this.Eu=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new Ed(this,"async_queue_retry"),this.fu=()=>{let r=_g();r&&k("AsyncQueue","Visibility state changed to "+r.visibilityState),this.r_.Jo()},this.gu=e;let t=_g();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.du}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.yu(e)}enterRestrictedMode(e){if(!this.du){this.du=!0,this.Vu=e||!1;let t=_g();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.fu)}}enqueue(e){if(this.pu(),this.du)return new Promise(()=>{});let t=new _t;return this.yu(()=>this.du&&this.Vu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Iu.push(e),this.wu()))}wu(){return x(this,null,function*(){if(this.Iu.length!==0){try{yield this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(e){if(!oo(e))throw e;k("AsyncQueue","Operation failed with retryable error: "+e)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}})}yu(e){let t=this.gu.then(()=>(this.Ru=!0,e().catch(r=>{this.Au=r,this.Ru=!1;let i=function(s){let a=s.message||"";return s.stack&&(a=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),a}(r);throw ot("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.Ru=!1,r))));return this.gu=t,t}enqueueAfterDelay(e,t,r){this.pu(),this.mu.indexOf(e)>-1&&(t=0);let i=_D.createAndSchedule(this,e,t,r,o=>this.Su(o));return this.Eu.push(i),i}pu(){this.Au&&G()}verifyOperationInProgress(){}bu(){return x(this,null,function*(){let e;do e=this.gu,yield e;while(e!==this.gu)})}Du(e){for(let t of this.Eu)if(t.timerId===e)return!0;return!1}vu(e){return this.bu().then(()=>{this.Eu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.Eu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.bu()})}Cu(e){this.mu.push(e)}Su(e){let t=this.Eu.indexOf(e);this.Eu.splice(t,1)}};function kD(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let o of r)if(o in i&&typeof i[o]=="function")return!0;return!1}(n,["next","error","complete"])}var OD=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new _t,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var j1=-1,Xe=class extends fs{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new lm,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return x(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new lm(e),this._firestoreClient=void 0,yield e}})}};function Nt(n){if(n._terminated)throw new P(N.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||B1(n),n._firestoreClient}function B1(n){var e,t,r;let i=n._freezeSettings(),o=function(a,l,c,d){return new lC(a,l,c,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,O1(d.experimentalLongPollingOptions),d.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new PD(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(a){let l=a?._online.build();return{_offline:a?._offline.build(l),_online:l}}(n._componentsProvider))}function U1(n,e){Jn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return H1(n,_T.provider,{build:r=>new sm(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function $1(n){return x(this,null,function*(){Jn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();H1(n,_T.provider,{build:t=>new MD(t,e.cacheSizeBytes)})})}function H1(n,e,t){if((n=Re(n,Xe))._firestoreClient||n._terminated)throw new P(N.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new P(N.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},B1(n)}function q1(n){if(n._initialized&&!n._terminated)throw new P(N.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new _t;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>x(this,null,function*(){try{yield function(r){return x(this,null,function*(){if(!Qi.p())return Promise.resolve();let i=r+"main";yield Qi.delete(i)})}(oT(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function G1(n){return function(t){let r=new _t;return t.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return n3(yield ET(t),r)})),r.promise}(Nt(n=Re(n,Xe)))}function z1(n){return g3(Nt(n=Re(n,Xe)))}function W1(n){return m3(Nt(n=Re(n,Xe)))}function K1(n,e){let t=Nt(n=Re(n,Xe)),r=new OD;return w3(t,n._databaseId,e,r),r}function Q1(n,e){return E3(Nt(n=Re(n,Xe)),e).then(t=>t?new xt(n,null,t.query):null)}var Sr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(lt.fromBase64String(e))}catch(t){throw new P(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(lt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var nr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new P(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new st(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var ri=class{constructor(e){this._methodName=e}};var ps=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new P(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new P(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return le(this._lat,e._lat)||le(this._long,e._long)}};var Cd=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(this._values,e._values)}};var I3=/^__.*__$/,FD=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new tr(e,this.data,this.fieldMask,t,this.fieldTransforms):new to(e,this.data,t,this.fieldTransforms)}},um=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new tr(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function Y1(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw G()}}var cm=class n{constructor(e,t,r,i,o,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Fu(),this.fieldTransforms=o||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.xu({path:r,Nu:!1});return i.Bu(e),i}Lu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.xu({path:r,Nu:!1});return i.Fu(),i}ku(e){return this.xu({path:void 0,Nu:!0})}qu(e){return dm(e,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Fu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Bu(this.path.get(e))}Bu(e){if(e.length===0)throw this.qu("Document fields must not be empty");if(Y1(this.Mu)&&I3.test(e))throw this.qu('Document fields cannot begin and end with "__"')}},VD=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Rd(e)}$u(e,t,r,i=!1){return new cm({Mu:e,methodName:t,Ku:r,path:st.emptyPath(),Nu:!1,Qu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function ys(n){let e=n._freezeSettings(),t=Rd(n._databaseId);return new VD(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Dm(n,e,t,r,i,o={}){let s=n.$u(o.merge||o.mergeFields?2:0,e,t,i);MT("Data must be an object, but it was:",s,r);let a=X1(r,s),l,c;if(o.merge)l=new In(s.fieldMask),c=s.fieldTransforms;else if(o.mergeFields){let d=[];for(let f of o.mergeFields){let g=$D(e,f,t);if(!s.contains(g))throw new P(N.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);tF(d,g)||d.push(g)}l=new In(d),c=s.fieldTransforms.filter(f=>l.covers(f.field))}else l=null,c=s.fieldTransforms;return new FD(new Bt(a),l,c)}var Dd=class n extends ri{_toFieldTransform(e){if(e.Mu!==2)throw e.Mu===1?e.qu(`${this._methodName}() can only appear at the top level of your update data`):e.qu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function Z1(n,e,t){return new cm({Mu:3,Ku:e.settings.Ku,methodName:n._methodName,Nu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var LD=class n extends ri{_toFieldTransform(e){return new cs(e.path,new Xi)}isEqual(e){return e instanceof n}},jD=class n extends ri{constructor(e,t){super(e),this.Uu=t}_toFieldTransform(e){let t=Z1(this,e,!0),r=this.Uu.map(o=>_s(o,t)),i=new ti(r);return new cs(e.path,i)}isEqual(e){return e instanceof n&&ly(this.Uu,e.Uu)}},BD=class n extends ri{constructor(e,t){super(e),this.Uu=t}_toFieldTransform(e){let t=Z1(this,e,!0),r=this.Uu.map(o=>_s(o,t)),i=new ni(r);return new cs(e.path,i)}isEqual(e){return e instanceof n&&ly(this.Uu,e.Uu)}},UD=class n extends ri{constructor(e,t){super(e),this.Wu=t}_toFieldTransform(e){let t=new eo(e.serializer,VO(e.serializer,this.Wu));return new cs(e.path,t)}isEqual(e){return e instanceof n&&this.Wu===e.Wu}};function ST(n,e,t,r){let i=n.$u(1,e,t);MT("Data must be an object, but it was:",i,r);let o=[],s=Bt.empty();so(r,(l,c)=>{let d=RT(e,l,t);c=we(c);let f=i.Lu(d);if(c instanceof Dd)o.push(d);else{let g=_s(c,f);g!=null&&(o.push(d),s.set(d,g))}});let a=new In(o);return new um(s,a,i.fieldTransforms)}function AT(n,e,t,r,i,o){let s=n.$u(1,e,t),a=[$D(e,r,t)],l=[i];if(o.length%2!=0)throw new P(N.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<o.length;g+=2)a.push($D(e,o[g])),l.push(o[g+1]);let c=[],d=Bt.empty();for(let g=a.length-1;g>=0;--g)if(!tF(c,a[g])){let m=a[g],v=l[g];v=we(v);let T=s.Lu(m);if(v instanceof Dd)c.push(m);else{let S=_s(v,T);S!=null&&(c.push(m),d.set(m,S))}}let f=new In(c);return new um(d,f,s.fieldTransforms)}function J1(n,e,t,r=!1){return _s(t,n.$u(r?4:3,e))}function _s(n,e){if(eF(n=we(n)))return MT("Unsupported field value:",e,n),X1(n,e);if(n instanceof ri)return function(r,i){if(!Y1(i.Mu))throw i.qu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.qu(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Nu&&e.Mu!==4)throw e.qu("Nested arrays are not supported");return function(r,i){let o=[],s=0;for(let a of r){let l=_s(a,i.ku(s));l==null&&(l={nullValue:"NULL_VALUE"}),o.push(l),s++}return{arrayValue:{values:o}}}(n,e)}return function(r,i){if((r=we(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return VO(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=Je.fromDate(r);return{timestampValue:dl(i.serializer,o)}}if(r instanceof Je){let o=new Je(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:dl(i.serializer,o)}}if(r instanceof ps)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Sr)return{bytesValue:WO(i.serializer,r._byteString)};if(r instanceof He){let o=i.databaseId,s=r.firestore._databaseId;if(!s.isEqual(o))throw i.qu(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:nT(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Cd)return function(s,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:s.toArray().map(l=>{if(typeof l!="number")throw a.qu("VectorValues must only contain numeric values.");return tT(a.serializer,l)})}}}}}}(r,i);throw i.qu(`Unsupported field value: ${Cm(r)}`)}(n,e)}function X1(n,e){let t={};return vO(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):so(n,(r,i)=>{let o=_s(i,e.Ou(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function eF(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Je||n instanceof ps||n instanceof Sr||n instanceof He||n instanceof ri||n instanceof Cd)}function MT(n,e,t){if(!eF(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=Cm(t);throw r==="an object"?e.qu(n+" a custom object"):e.qu(n+" "+r)}}function $D(n,e,t){if((e=we(e))instanceof nr)return e._internalPath;if(typeof e=="string")return RT(n,e);throw dm("Field path arguments must be of type string or ",n,!1,void 0,t)}var C3=new RegExp("[~\\*/\\[\\]]");function RT(n,e,t){if(e.search(C3)>=0)throw dm(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new nr(...e.split("."))._internalPath}catch{throw dm(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function dm(n,e,t,r,i){let o=r&&!r.isEmpty(),s=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(o||s)&&(l+=" (found",o&&(l+=` in field ${r}`),s&&(l+=` in document ${i}`),l+=")"),new P(N.INVALID_ARGUMENT,a+n+l)}function tF(n,e){return n.some(t=>t.isEqual(e))}var gs=class{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new He(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new HD(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Tm("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},HD=class extends gs{data(){return super.data()}};function Tm(n,e){return typeof e=="string"?RT(n,e):e instanceof nr?e._internalPath:e._delegate._internalPath}function nF(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new P(N.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Td=class{},ms=class extends Td{};function si(n,e,...t){let r=[];e instanceof Td&&r.push(e),r=r.concat(t),function(o){let s=o.filter(l=>l instanceof qD).length,a=o.filter(l=>l instanceof hm).length;if(s>1||s>0&&a>0)throw new P(N.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var hm=class n extends ms{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return hF(e._query,t),new xt(e.firestore,e.converter,EC(e._query,t))}_parse(e){let t=ys(e.firestore);return function(o,s,a,l,c,d,f){let g;if(c.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new P(N.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){sO(f,d);let m=[];for(let v of f)m.push(oO(l,o,v));g={arrayValue:{values:m}}}else g=oO(l,o,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||sO(f,d),g=J1(a,s,f,d==="in"||d==="not-in");return Ee.create(c,d,g)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function rF(n,e,t){let r=e,i=Tm("where",n);return hm._create(i,r,t)}var qD=class n extends Td{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Fe.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,o){let s=i,a=o.getFlattenedFilters();for(let l of a)hF(s,l),s=EC(s,l)}(e._query,t),new xt(e.firestore,e.converter,EC(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var GD=class n extends ms{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,o,s){if(i.startAt!==null)throw new P(N.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new P(N.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ls(o,s)}(e._query,this._field,this._direction);return new xt(e.firestore,e.converter,function(i,o){let s=i.explicitOrderBy.concat([o]);return new Xn(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function iF(n,e="asc"){let t=e,r=Tm("orderBy",n);return GD._create(r,t)}var fm=class n extends ms{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new xt(e.firestore,e.converter,Rg(e._query,this._limit,this._limitType))}};function oF(n){return F1("limit",n),fm._create("limit",n,"F")}function sF(n){return F1("limitToLast",n),fm._create("limitToLast",n,"L")}var pm=class n extends ms{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=dF(e,this.type,this._docOrFields,this._inclusive);return new xt(e.firestore,e.converter,function(i,o){return new Xn(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,o,i.endAt)}(e._query,t))}};function aF(...n){return pm._create("startAt",n,!0)}function lF(...n){return pm._create("startAfter",n,!1)}var gm=class n extends ms{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=dF(e,this.type,this._docOrFields,this._inclusive);return new xt(e.firestore,e.converter,function(i,o){return new Xn(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,o)}(e._query,t))}};function uF(...n){return gm._create("endBefore",n,!1)}function cF(...n){return gm._create("endAt",n,!0)}function dF(n,e,t,r){if(t[0]=we(t[0]),t[0]instanceof gs)return function(o,s,a,l,c){if(!l)throw new P(N.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let f of rl(o))if(f.field.isKeyField())d.push(as(s,l.key));else{let g=l.data.field(f.field);if(ym(g))throw new P(N.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){let m=f.field.canonicalString();throw new P(N.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${m}' (used as the orderBy) does not exist.`)}d.push(g)}return new br(d,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=ys(n.firestore);return function(s,a,l,c,d,f){let g=s.explicitOrderBy;if(d.length>g.length)throw new P(N.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let m=[];for(let v=0;v<d.length;v++){let T=d[v];if(g[v].field.isKeyField()){if(typeof T!="string")throw new P(N.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof T}`);if(!XD(s)&&T.indexOf("/")!==-1)throw new P(N.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${T}' contains a slash.`);let S=s.path.child(Ae.fromString(T));if(!q.isDocumentKey(S))throw new P(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${S}' is not because it contains an odd number of segments.`);let O=new q(S);m.push(as(a,O))}else{let S=J1(l,c,T);m.push(S)}}return new br(m,f)}(n._query,n.firestore._databaseId,i,e,t,r)}}function oO(n,e,t){if(typeof(t=we(t))=="string"){if(t==="")throw new P(N.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!XD(e)&&t.indexOf("/")!==-1)throw new P(N.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(Ae.fromString(t));if(!q.isDocumentKey(r))throw new P(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return as(n,new q(r))}if(t instanceof He)return as(n,t._key);throw new P(N.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Cm(t)}.`)}function sO(n,e){if(!Array.isArray(n)||n.length===0)throw new P(N.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function hF(n,e){let t=function(i,o){for(let s of i)for(let a of s.getFlattenedFilters())if(o.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new P(N.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new P(N.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var El=class{convertValue(e,t="none"){switch(Zi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ke(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ei(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw G()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return so(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){var t,r,i;let o=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(s=>Ke(s.doubleValue));return new Cd(o)}convertGeoPoint(e){return new ps(Ke(e.latitude),Ke(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=_m(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ad(e));default:return null}}convertTimestamp(e){let t=Xr(e);return new Je(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=Ae.fromString(e);K(i1(r));let i=new Yi(r.get(1),r.get(3)),o=new q(r.popFirst(5));return i.isEqual(t)||ot(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}};function bm(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var zD=class extends El{constructor(e){super(),this.firestore=e}convertBytes(e){return new Sr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new He(this.firestore,null,t)}};var Jr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},jn=class extends gs{constructor(e,t,r,i,o,s){super(e,t,r,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Wi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Tm("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Wi=class extends jn{data(e={}){return super.data(e)}},rr=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Jr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Wi(this._firestore,this._userDataWriter,r.key,r,new Jr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new P(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let s=0;return i._snapshot.docChanges.map(a=>{let l=new Wi(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Jr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:s++}})}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>o||a.type!==3).map(a=>{let l=new Wi(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Jr(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,d=-1;return a.type!==0&&(c=s.indexOf(a.doc.key),s=s.delete(a.doc.key)),a.type!==1&&(s=s.add(a.doc),d=s.indexOf(a.doc.key)),{type:D3(a.type),doc:l,oldIndex:c,newIndex:d}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function D3(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return G()}}function xT(n,e){return n instanceof jn&&e instanceof jn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof rr&&e instanceof rr&&n._firestore===e._firestore&&bT(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function fF(n){n=Re(n,He);let e=Re(n.firestore,Xe);return P1(Nt(e),n._key).then(t=>OT(e,n,t))}var ii=class extends El{constructor(e){super(),this.firestore=e}convertBytes(e){return new Sr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new He(this.firestore,null,t)}};function pF(n){n=Re(n,He);let e=Re(n.firestore,Xe),t=Nt(e),r=new ii(e);return y3(t,n._key).then(i=>new jn(e,r,n._key,i,new Jr(i!==null&&i.hasLocalMutations,!0),n.converter))}function gF(n){n=Re(n,He);let e=Re(n.firestore,Xe);return P1(Nt(e),n._key,{source:"server"}).then(t=>OT(e,n,t))}function mF(n){n=Re(n,xt);let e=Re(n.firestore,Xe),t=Nt(e),r=new ii(e);return nF(n._query),k1(t,n._query).then(i=>new rr(e,r,n,i))}function yF(n){n=Re(n,xt);let e=Re(n.firestore,Xe),t=Nt(e),r=new ii(e);return _3(t,n._query).then(i=>new rr(e,r,n,i))}function _F(n){n=Re(n,xt);let e=Re(n.firestore,Xe),t=Nt(e),r=new ii(e);return k1(t,n._query,{source:"server"}).then(i=>new rr(e,r,n,i))}function NT(n,e,t){n=Re(n,He);let r=Re(n.firestore,Xe),i=bm(n.converter,e,t);return Al(r,[Dm(ys(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,rt.none())])}function PT(n,e,t,...r){n=Re(n,He);let i=Re(n.firestore,Xe),o=ys(i),s;return s=typeof(e=we(e))=="string"||e instanceof nr?AT(o,"updateDoc",n._key,e,t,r):ST(o,"updateDoc",n._key,e),Al(i,[s.toMutation(n._key,rt.exists(!0))])}function vF(n){return Al(Re(n.firestore,Xe),[new no(n._key,rt.none())])}function wF(n,e){let t=Re(n.firestore,Xe),r=Nd(n),i=bm(n.converter,e);return Al(t,[Dm(ys(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,rt.exists(!1))]).then(()=>r)}function kT(n,...e){var t,r,i;n=we(n);let o={includeMetadataChanges:!1,source:"default"},s=0;typeof e[s]!="object"||kD(e[s])||(o=e[s],s++);let a={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(kD(e[s])){let f=e[s];e[s]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[s+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[s+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let l,c,d;if(n instanceof He)c=Re(n.firestore,Xe),d=Cl(n._key.path),l={next:f=>{e[s]&&e[s](OT(c,n,f))},error:e[s+1],complete:e[s+2]};else{let f=Re(n,xt);c=Re(f.firestore,Xe),d=f._query;let g=new ii(c);l={next:m=>{e[s]&&e[s](new rr(c,g,f,m))},error:e[s+1],complete:e[s+2]},nF(n._query)}return function(g,m,v,T){let S=new vl(T),O=new Id(m,S,v);return g.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return uT(yield wl(g),O)})),()=>{S.eu(),g.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return cT(yield wl(g),O)}))}}(Nt(c),d,a,l)}function EF(n,e){return v3(Nt(n=Re(n,Xe)),kD(e)?e:{next:e})}function Al(n,e){return function(r,i){let o=new _t;return r.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){return J9(yield ET(r),i,o)})),o.promise}(Nt(n),e)}function OT(n,e,t){let r=t.docs.get(e._key),i=new ii(n);return new jn(n,i,e._key,r,new Jr(t.hasPendingWrites,t.fromCache),e.converter)}var T3={maxAttempts:5};var mm=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ys(e)}set(e,t,r){this._verifyNotCommitted();let i=Gi(e,this._firestore),o=bm(i.converter,t,r),s=Dm(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(s.toMutation(i._key,rt.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let o=Gi(e,this._firestore),s;return s=typeof(t=we(t))=="string"||t instanceof nr?AT(this._dataReader,"WriteBatch.update",o._key,t,r,i):ST(this._dataReader,"WriteBatch.update",o._key,t),this._mutations.push(s.toMutation(o._key,rt.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Gi(e,this._firestore);return this._mutations=this._mutations.concat(new no(t._key,rt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new P(N.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Gi(n,e){if((n=we(n)).firestore!==e)throw new P(N.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var WD=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=ys(t)}get(t){let r=Gi(t,this._firestore),i=new zD(this._firestore);return this._transaction.lookup([r._key]).then(o=>{if(!o||o.length!==1)return G();let s=o[0];if(s.isFoundDocument())return new gs(this._firestore,i,s.key,s,r.converter);if(s.isNoDocument())return new gs(this._firestore,i,r._key,null,r.converter);throw G()})}set(t,r,i){let o=Gi(t,this._firestore),s=bm(o.converter,r,i),a=Dm(this._dataReader,"Transaction.set",o._key,s,o.converter!==null,i);return this._transaction.set(o._key,a),this}update(t,r,i,...o){let s=Gi(t,this._firestore),a;return a=typeof(r=we(r))=="string"||r instanceof nr?AT(this._dataReader,"Transaction.update",s._key,r,i,o):ST(this._dataReader,"Transaction.update",s._key,r),this._transaction.update(s._key,a),this}delete(t){let r=Gi(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Gi(e,this._firestore),r=new ii(this._firestore);return super.get(e).then(i=>new jn(this._firestore,r,t._key,i._document,new Jr(!1,!1),t.converter))}};function IF(n,e,t){n=Re(n,Xe);let r=Object.assign(Object.assign({},T3),t);return function(o){if(o.maxAttempts<1)throw new P(N.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(o,s,a){let l=new _t;return o.asyncQueue.enqueueAndForget(()=>x(this,null,function*(){let c=yield p3(o);new ND(o.asyncQueue,c,a,s,l).cu()})),l.promise}(Nt(n),i=>e(new WD(n,i)),r)}function CF(){return new Dd("deleteField")}function DF(){return new LD("serverTimestamp")}function TF(...n){return new jD("arrayUnion",n)}function bF(...n){return new BD("arrayRemove",n)}function SF(n){return new UD("increment",n)}(function(e,t=!0){(function(i){Il=i})(ih),fo(new ln("firestore",(r,{instanceIdentifier:i,options:o})=>{let s=r.getProvider("app").getImmediate(),a=new Xe(new JI(r.getProvider("auth-internal")),new nC(r.getProvider("app-check-internal")),function(c,d){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new P(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Yi(c.options.projectId,d)}(s,i),s);return o=Object.assign({useFetchStreams:t},o),a._setSettings(o),a},"PUBLIC").setMultipleInstances(!0)),Un(ok,"4.7.6",e),Un(ok,"4.7.6","esm2017")})();var b3="@firebase/firestore-compat",S3="0.3.41";function UT(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new P("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function AF(){if(typeof Uint8Array>"u")throw new P("unimplemented","Uint8Arrays are not available in this environment.")}function MF(){if(!wO())throw new P("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Sm=class n{constructor(e){this._delegate=e}static fromBase64String(e){return MF(),new n(Sr.fromBase64String(e))}static fromUint8Array(e){return AF(),new n(Sr.fromUint8Array(e))}toBase64(){return MF(),this._delegate.toBase64()}toUint8Array(){return AF(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function FT(n){return A3(n,["next","error","complete"])}function A3(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var VT=class{enableIndexedDbPersistence(e,t){return U1(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return $1(e._delegate)}clearIndexedDbPersistence(e){return q1(e._delegate)}},Am=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Yi||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Jn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){V1(this._delegate,e,t,r)}enableNetwork(){return z1(this._delegate)}disableNetwork(){return W1(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,CT("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return G1(this._delegate)}onSnapshotsInSync(e){return EF(this._delegate,e)}get app(){if(!this._appCompat)throw new P("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new xl(this,DT(this._delegate,e))}catch(t){throw Xt(t,"collection()","Firestore.collection()")}}doc(e){try{return new Ar(this,Nd(this._delegate,e))}catch(t){throw Xt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Is(this,L1(this._delegate,e))}catch(t){throw Xt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return IF(this._delegate,t=>e(new Mm(this,t)))}batch(){return Nt(this._delegate),new Rm(new mm(this._delegate,e=>Al(this._delegate,e)))}loadBundle(e){return K1(this._delegate,e)}namedQuery(e){return Q1(this._delegate,e).then(t=>t?new Is(this,t):null)}},Ml=class extends El{constructor(e){super(),this.firestore=e}convertBytes(e){return new Sm(new Sr(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Ar.forKey(t,this.firestore,null)}};function M3(n){aO(n)}var Mm=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ml(e)}get(e){let t=vs(e);return this._delegate.get(t).then(r=>new ws(this._firestore,new jn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=vs(e);return r?(UT("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let o=vs(e);return arguments.length===2?this._delegate.update(o,t):this._delegate.update(o,t,r,...i),this}delete(e){let t=vs(e);return this._delegate.delete(t),this}},Rm=class{constructor(e){this._delegate=e}set(e,t,r){let i=vs(e);return r?(UT("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let o=vs(e);return arguments.length===2?this._delegate.update(o,t):this._delegate.update(o,t,r,...i),this}delete(e){let t=vs(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Rl=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Wi(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Es(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let o=i.get(t);return o||(o=new n(e,new Ml(e),t),i.set(t,o)),o}};Rl.INSTANCES=new WeakMap;var Ar=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ml(e)}static forPath(e,t,r){if(e.length%2!==0)throw new P("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new He(t._delegate,r,new q(e)))}static forKey(e,t,r){return new n(t,new He(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new xl(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new xl(this.firestore,DT(this._delegate,e))}catch(t){throw Xt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=we(e),e instanceof He?TT(this._delegate,e):!1}set(e,t){t=UT("DocumentReference.set",t);try{return t?NT(this._delegate,e,t):NT(this._delegate,e)}catch(r){throw Xt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?PT(this._delegate,e):PT(this._delegate,e,t,...r)}catch(i){throw Xt(i,"updateDoc()","DocumentReference.update()")}}delete(){return vF(this._delegate)}onSnapshot(...e){let t=RF(e),r=xF(e,i=>new ws(this.firestore,new jn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return kT(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=pF(this._delegate):e?.source==="server"?t=gF(this._delegate):t=fF(this._delegate),t.then(r=>new ws(this.firestore,new jn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Rl.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Xt(n,e,t){return n.message=n.message.replace(e,t),n}function RF(n){for(let e of n)if(typeof e=="object"&&!FT(e))return e;return{}}function xF(n,e){var t,r;let i;return FT(n[0])?i=n[0]:FT(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:o=>{i.next&&i.next(e(o))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var ws=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Ar(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return xT(this._delegate,e._delegate)}},Es=class extends ws{data(e){let t=this._delegate.data(e);return this._delegate._converter||lO(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Is=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ml(e)}where(e,t,r){try{return new n(this.firestore,si(this._delegate,rF(e,t,r)))}catch(i){throw Xt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,si(this._delegate,iF(e,t)))}catch(r){throw Xt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,si(this._delegate,oF(e)))}catch(t){throw Xt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,si(this._delegate,sF(e)))}catch(t){throw Xt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,si(this._delegate,aF(...e)))}catch(t){throw Xt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,si(this._delegate,lF(...e)))}catch(t){throw Xt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,si(this._delegate,uF(...e)))}catch(t){throw Xt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,si(this._delegate,cF(...e)))}catch(t){throw Xt(t,"endAt()","Query.endAt()")}}isEqual(e){return bT(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=yF(this._delegate):e?.source==="server"?t=_F(this._delegate):t=mF(this._delegate),t.then(r=>new Pd(this.firestore,new rr(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=RF(e),r=xF(e,i=>new Pd(this.firestore,new rr(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return kT(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Rl.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},LT=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Es(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Pd=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Is(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Es(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new LT(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Es(this._firestore,r))})}isEqual(e){return xT(this._delegate,e._delegate)}},xl=class n extends Is{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Ar(this.firestore,e):null}doc(e){try{return e===void 0?new Ar(this.firestore,Nd(this._delegate)):new Ar(this.firestore,Nd(this._delegate,e))}catch(t){throw Xt(t,"doc()","CollectionReference.doc()")}}add(e){return wF(this._delegate,e).then(t=>new Ar(this.firestore,t))}isEqual(e){return TT(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Rl.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function vs(n){return Re(n,He)}var jT=class n{constructor(...e){this._delegate=new nr(...e)}static documentId(){return new n(st.keyField().canonicalString())}isEqual(e){return e=we(e),e instanceof nr?this._delegate._internalPath.isEqual(e._internalPath):!1}};var BT=class n{static serverTimestamp(){let e=DF();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=CF();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=TF(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=bF(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=SF(e);return t._methodName="FieldValue.increment",new n(t)}constructor(e){this._delegate=e}isEqual(e){return this._delegate.isEqual(e._delegate)}};var R3={Firestore:Am,GeoPoint:ps,Timestamp:Je,Blob:Sm,Transaction:Mm,WriteBatch:Rm,DocumentReference:Ar,DocumentSnapshot:ws,Query:Is,QueryDocumentSnapshot:Es,QuerySnapshot:Pd,CollectionReference:xl,FieldPath:jT,FieldValue:BT,setLogLevel:M3,CACHE_SIZE_UNLIMITED:j1};function x3(n,e){n.INTERNAL.registerComponent(new ln("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},R3)))}function N3(n){x3(n,(e,t)=>new Am(e,t,new VT)),n.registerVersion(b3,S3)}N3(Dt);function P3(n,e=_o){return new de(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function NF(n,e){return P3(n,e)}function k3(n,e){return NF(n,e).pipe(vo(void 0),lu(),Q(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function qT(n,e){return NF(n,e).pipe(Q(t=>({payload:t,type:"query"})))}var xm=class{ref;afs;injector=V(it);constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:o}=OF(r,t);return new Pm(i,o,this.afs)}snapshotChanges(){return k3(this.ref,this.afs.schedulers.outsideAngular).pipe(nt(this.injector))}valueChanges(e={}){return this.snapshotChanges().pipe(Q(({payload:t})=>e.idField?pe($({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return ke(this.ref.get(e)).pipe(nt(this.injector))}};function Nm(n,e){return qT(n,e).pipe(vo(void 0),lu(),Q(t=>{let[r,i]=t,o=i.payload.docChanges(),s=o.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=o.find(f=>f.doc.ref.isEqual(a.ref)),d=r?.payload.docs.find(f=>f.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||s.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),s}))}function PF(n,e,t){return Nm(n,t).pipe(ar((r,i)=>O3(r,i.map(o=>o.payload),e),[]),su(),Q(r=>r.map(i=>({type:i.type,payload:i}))))}function O3(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=F3(n,r))}),n}function $T(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function F3(n,e){switch(e.type){case"added":if(!n[e.newIndex]?.doc.ref.isEqual(e.doc.ref))return $T(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return $T(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]?.doc.ref.isEqual(e.doc.ref))return $T(n,e.oldIndex,1);break}return n}function kF(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Pm=class{ref;query;afs;injector=V(it);constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Nm(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Q(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(vo(void 0),lu(),Vt(([r,i])=>i.length>0||!r),Q(([,r])=>r),nt(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(ar((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=kF(e);return PF(this.query,t,this.afs.schedulers.outsideAngular).pipe(nt(this.injector))}valueChanges(e={}){return qT(this.query,this.afs.schedulers.outsideAngular).pipe(Q(t=>t.payload.docs.map(r=>e.idField?pe($({},r.data()),{[e.idField]:r.id}):r.data())),nt(this.injector))}get(e){return ke(this.query.get(e)).pipe(nt(this.injector))}add(e){return this.ref.add(e)}doc(e){return new xm(this.ref.doc(e),this.afs)}},HT=class{query;afs;injector=V(it);constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Nm(this.query,this.afs.schedulers.outsideAngular).pipe(nt(this.injector)):Nm(this.query,this.afs.schedulers.outsideAngular).pipe(Q(t=>t.filter(r=>e.indexOf(r.type)>-1)),Vt(t=>t.length>0),nt(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(ar((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=kF(e);return PF(this.query,t,this.afs.schedulers.outsideAngular).pipe(nt(this.injector))}valueChanges(e={}){return qT(this.query,this.afs.schedulers.outsideAngular).pipe(Q(r=>r.payload.docs.map(i=>e.idField?$({[e.idField]:i.id},i.data()):i.data())),nt(this.injector))}get(e){return ke(this.query.get(e)).pipe(nt(this.injector))}},V3=new z("angularfire2.enableFirestorePersistence"),L3=new z("angularfire2.firestore.persistenceSettings"),j3=new z("angularfire2.firestore.settings"),B3=new z("angularfire2.firestore.use-emulator");function OF(n,e=t=>t){return{query:e(n),ref:n}}var FF=(()=>{class n{schedulers;firestore;persistenceEnabled$;ngZone=V(De);constructor(t,r,i,o,s,a,l,c,d,f,g,m,v,T,S,O,B){this.schedulers=l;let F=Ho(t,a,r),W=d;f&&dc(F,a,g,v,T,S,m,O),[this.firestore,this.persistenceEnabled$]=Sa(`${F.name}.firestore`,"AngularFirestore",F.name,()=>{let oe=a.runOutsideAngular(()=>F.firestore());if(o&&oe.settings(o),W&&oe.useEmulator(...W),i&&!Vo(s)){let X=()=>{try{return ke(oe.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(I){return typeof console<"u"&&console.warn(I),ne(!1)}};return[oe,a.runOutsideAngular(X)]}else return[oe,ne(!1)]},[o,W,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:o,query:s}=OF(i,r),a=this.ngZone.run(()=>o);return new Pm(a,s,this)}collectionGroup(t,r){let i=r||(s=>s),o=this.firestore.collectionGroup(t);return new HT(i(o),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.ngZone.run(()=>r);return new xm(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(j(xi),j(Ni,8),j(V3,8),j(j3,8),j(rn),j(De),j($o),j(L3,8),j(B3,8),j(hc,8),j(oc,8),j(sc,8),j(ac,8),j(lc,8),j(uc,8),j(cc,8),j(Ri,8))};static \u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var VF={apiKey:"AIzaSyAgzLE6J3CGJM-PgSRFhp5hFsvnY8mymug",authDomain:"iot-multiparameter.firebaseapp.com",databaseURL:"https://iot-multiparameter-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"iot-multiparameter",storageBucket:"iot-multiparameter.appspot.com",messagingSenderId:"773940000383",appId:"1:773940000383:web:0be13598bc82c0d522f14a",measurementId:"G-DSZ9883T5H"};var LF={providers:[$R(nk),G_([Mx.initializeApp(VF),Rx,og,FF])]};var jF=(()=>{class n{constructor(){this.title="electrical-load-Monitoring"}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=ca({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(r,i){r&1&&No(0,"router-outlet")},dependencies:[Ru,Cw],encapsulation:2})}}return n})();iR(jF,LF).catch(n=>console.error(n));
